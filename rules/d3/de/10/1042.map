# DE 1042.  Neumünster (ausschl.) - Heide (Holst) (ausschl.)
#
let altkie = path("path.de.1220");
let neuhei = path("path.de.1042");

with detail = 3 {
    # Streckengleis Neumünster - Wasbek
    track(:second :open, neuhei[:nst - .5ssw, :was - 1ssw]);

    # Neumünster Stadtwald
    marker(:de.hp :open :left, neuhei[:nst]);
    slabel(:left, neuhei[:nst] >> 1dt, "N. Stadtwald");

    # Wasbek
    track(:second :station :open, neuhei[:was - 1ssw, :was + 1ssw]);
    marker(:de.hp :open :left, neuhei[:was]);
    with layer = -1 marker(:de.bf :gone :left, neuhei[:was]);
    slabel(:bottom :open, neuhei[:was] << 1.4ssw, "Wasbek");

    # Streckengleis Wasbek - Aukrug
    track(:second :open, neuhei[:was + 1ssw, :auk - 1ssw]);

    # .Bünzenfeld
    #
    marker(:de.ldst :removed :left, neuhei[:bun]);
    slabel(:bottom :removed, neuhei[:bun] << 1.2ssw, "Bünzenfeld");

    # Aukrug
    track(:second :station :open, neuhei[:auk - 1ssw, :auk + 1ssw]);
    marker(:de.hp :open :right, neuhei[:auk]);
    with layer = -1 marker(:de.bf :gone :right, neuhei[:auk]);
    slabel(:top :open, neuhei[:auk] >> 1.4ssw, "Aukrug");

    # Streckengleis Aukrug - Hohenwestedt
    track(:second :open, neuhei[:auk + 1ssw, :hwe - 1ssw]);
    with layer = 1 line_badge(:open, neuhei[:auk + 3.0km], "1042");

    # Hohenwestedt
    track(:second :station :open, neuhei[:hwe - 1ssw, :hwe + 1ssw]);
    marker(:de.bf :open :right, neuhei[:hwe]);
    slabel(:bottom :open, neuhei[:hwe - 0.7km] << 0.5dt,
        span(:small :bold, "Hohenwestedt")
    );

    # Streckengleis Hohenwestedt - Osterstedt
    track(:second :open, neuhei[:hwe + 1ssw, :ost - 1ssw]);

    # Osterstedt
    track(:second :station :open, neuhei[:ost - 1ssw, :ost + 1ssw]);
    marker(:de.hp :open :right, neuhei[:ost]);
    with layer = -1 marker(:de.bf :gone :right, neuhei[:ost]);
    slabel(:top :open, neuhei[:ost] >> 1.4ssw + (1ssw, 0ssw), "Osterstedt");

    # Streckengleis Osterstedt - Beringstedt
    track(:second :open, neuhei[:ost + 1ssw, :ber - 1ssw]);

    # Beringstedt
    track(:second :station :open, neuhei[:ber - 1ssw, :ber + 1ssw]);
    marker(:de.hp :open :left, neuhei[:ber]);
    with layer = -1 marker(:de.bf :gone :left, neuhei[:ber]);
    slabel(:top :open, neuhei[:ber] >> 1dt, "Beringstedt");

    # Streckengleis Beringstedt - Gokels
    track(:second :open, neuhei[:ber + 1ssw, :gok - 1ssw]);

    # Gokels
    track(:second :station :open, neuhei[:gok - 1ssw, :gok + 1ssw]);
    marker(:de.hp :open :left, neuhei[:gok]);
    with layer = -1 marker(:de.bf :gone :left, neuhei[:gok]);
    slabel(:bottom :open, neuhei[:gok] << 1.4ssw, "Gokels");

    # Streckengleis Gokels - Hademarschen
    track(:second :open, neuhei[:gok + 1ssw, :had - 1ssw]);

    # Hademarschen
    track(:second :station :open, neuhei[:had - 1ssw, :had + 1ssw]);
    marker(:de.hp :open :right, neuhei[:had]);
    with layer = -1 marker(:de.bf :gone :right, neuhei[:had]);
    slabel(:top :open, neuhei[:had] >> 1.4ssw, "Hademarschen");

    # Streckengleis Hademarschen - Beldorf
    track(:second :open, neuhei[:had + 1ssw, :bel - 1ssw]);

    # Beldorf
    track(:second :station :open, neuhei[:bel - 1ssw, :bel + 1ssw]);
    marker(:de.hp :open :left, neuhei[:bel]);
    with layer = -1 marker(:de.bf :gone :left, neuhei[:bel]);
    slabel(:bottom :open, neuhei[:bel] << 1.4ssw, "Beldorf");

    # Streckengleis Beldorf - Albersdorf
    track(:second :open, neuhei[:bel + 1ssw, :alb - 1ssw]);

    # Beldorf Dkst
    marker(:de.dkst :closed :right, neuhei[:bed]);

    # Albersdorf
    track(:second :station :open, neuhei[:alb - 1ssw, :alb + 1ssw]);
    marker(:de.hp :open :left, neuhei[:alb]);
    with layer = -1 marker(:de.bf :gone :left, neuhei[:alb]);
    slabel(:left :open, neuhei[:alb - 0.4ssw] << 2.4ssw, "Albersdorf");

    # Streckengleis Albersdorf - Nordhastedt
    track(:second :open, neuhei[:alb + 1ssw, :nha - 1ssw]);
    with layer = 1 line_badge(:open, neuhei[:alb + 4.0km], "1042");
    
    # Nordhastedt
    track(:second :station :open, neuhei[:nha - 1ssw, :nha + 1ssw]);
    marker(:de.hp :open :right, neuhei[:nha]);
    with layer = -1 marker(:de.bf :gone :right, neuhei[:nha]);
    slabel(:top :open, neuhei[:nha] >> 1.4ssw + (2ssw, 0ssw), "Nordhastedt");

    with link = "line.de.1042" {
        track(:second :open,
                neuhei[:nha + 1ssw, :ff - 1000m]
            ..  path("path.de.1210.hei")[:hei - 1.1ssw, :hei - 1ssw] >> 1.5dt
        );
    }
}

