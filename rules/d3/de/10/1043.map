# DE 1043.  Neumünster (ausschl.) - Bad Oldesloe (ausschl.)
#
let altkie = path("path.de.1220");
let neuold = path("path.de.1043");
let lubham = path("path.de.1120.old");

with detail = 3 {
    # Streckengleis Neumünster - Neumünster Süd
    track(:first :open,
            altkie[:neu.a, :neu.a - 0.1dl] << 1.5dt
        ..  neuold[:aa, :nes - 1.5ssw] << 0.5dt
    );
    with layer = -1 track(:first :removed,
            altkie[:neu.a, :neu.a - 0.1dl] << .5dt
        ..  neuold[:aa, :nes - 1.5ssw] >> 0.5dt
    );

    # Neumünster Süd
    track(:first :station :open, neuold[:nes - 1.5ssw, :nes + 1ssw] << 0.5dt);
    with layer = -1 track(:first :station :removed,
            neuold[:nes - 1.5ssw, :nes + 1ssw] >> 0.5dt
    );
    track(:second :station :open,
            neuold[:nes - 0.5ssw - 2.1dl, :nes - 0.5ssw - 2dl] << 0.5dt
        --  neuold[:nes - 0.5ssw, :nes + 1ssw] >> 1.5dt
    );
    with layer = -1 marker(:de.bf :removed :left, neuold[:nes] << 0.5dt);
    marker(:de.bf :open :right, neuold[:nes] >> 1.5dt);
    slabel(:right, neuold[:nes + 0.7ssw] << 0.5dt << 1.4ssw,
        span(:bold, "N. Süd")
    );

    # Streckengleis Neumünster Süd - Kleinkummerfeld
    track(:first :open, neuold[:nes + 1ssw, :kku - 1ssw] << 0.5dt);
    with layer = -1 track(:first :removed,
            neuold[:nes + 1ssw, :kku - 1ssw] >> 0.5dt
    );

    # Kleinkummerfeld
    track(:first :station :open, neuold[:kku - 1ssw, :kku + 1ssw] << 0.5dt);
    with layer = -1 track(:first :station :removed,
            neuold[:kku - 1ssw, :kku + 1ssw] >> 0.5dt
    );
    with layer = -2 marker(:de.bf :closed, neuold[:kku] >> 0.5dt);
    slabel(:left :closed, neuold[:kku] >> 0.5dt >> 2.0ssw,
        "Kleinkummerfeld"
    );

    # Streckengleise Kleinkummerfeld - Rickling
    track(:first :open, neuold[:kku + 1ssw, :ric - 1ssw] << 0.5dt);
    with layer = -1 track(:first :removed,
            neuold[:kku + 1ssw, :ric - 1ssw] >> 0.5dt
    );

    # Rickling Ölweiche
    with layer = -1 marker(:de.anst :removed :left, neuold[:rio] << 0.5dt);

    # Rickling
    track(:first :station :open, neuold[:ric - 1ssw, :ric + 1ssw] << 0.5dt);
    with layer = -1 track(:first :station :removed,
            neuold[:ric - 1ssw, :ric + 1ssw] >> 0.5dt
    );
    marker(:de.hp :open :left, neuold[:ric] << 0.5dt);
    with layer = -1 marker(:de.bf :gone :left, neuold[:ric] << 0.5dt);
    slabel(:right :open, neuold[:ric + 0.6ssw] << 0.5dt << 1.5ssw,
        "Rickling"
    );

    # Streckengleise Rickling - Fahrenkrug
    track(:first :open, neuold[:ric + 1ssw, :fah - 1ssw] << 0.5dt);
    with layer = -1 track(:first :removed,
            neuold[:ric + 1ssw, :fah - 1ssw] >> 0.5dt
    );
    with layer = 2 line_badge(:open, neuold[:ric + 3.2km], "1043");

    # Wahlstedt
    marker(:de.hp :open :left, neuold[:wah] << 0.5dt);
    slabel(:right :open, neuold[:wah + .6ssw] << 0.5dt << 1.4ssw,
        "Wahlstedt"
    );

    # Fahrenkrug
    track(:first :station :open, neuold[:fah - 1ssw, :fak + 1ssw] << 0.5dt);
    with layer = -1 track(:first :station :removed,
            neuold[:fah - 1ssw, :fak + 1ssw] >> 0.5dt
    );
    marker(:de.bft :open :left, neuold[:fak] << 0.5dt);
    with layer = -2 marker(:de.bf :gone :right, neuold[:fah] >> 0.5dt);
    slabel(:left :open, neuold[:fak + 1ssw] >> 0.5dt >> 2.2ssw,
        "Fahrenkrug"
    );

    # Streckengleise Fahrenkrug - Bad Segeberg
    track(:first :open, neuold[:fak + 1ssw, :seb - 1ssw] << 0.5dt);
    with layer = -1 track(:first :removed,
            neuold[:fak + 1ssw, :seb - 1ssw] >> 0.5dt
    );

    # Bad Segeberg
    track(:first :station :open, neuold[:seb - 1ssw, :seg + 1ssw] << 0.5dt);
    with layer = -1 track(:first :station :removed,
            neuold[:seb - 1ssw, :seg + 1ssw] >> 0.5dt
    );
    marker(:de.bf :open :left, neuold[:seb] << 0.5dt);
    with layer = -1 marker(:de.bf :gone :left, neuold[:seg] << 0.5dt);
    slabel(:right :open, neuold[:seg - .5ssw] << 0.5dt << 1.5ssw,
        span(:small :bold, "Bad Segeberg")
    );

    # Streckengleise Bad Segeberg - Wakendorf
    track(:first :open, neuold[:seg + 1ssw, :wak - 1ssw] << 0.5dt);
    with layer = -1 track(:first :removed,
            neuold[:seg + 1ssw, :wak - 1ssw] >> 0.5dt
    );

    # Altengörs
    marker(:de.hp :open :left, neuold[:ago] << 0.5dt);
    slabel(:right :open, neuold[:ago + 0.6ssw] << 0.5dt << 1.4ssw,
        "Altengörs"
    );

    # Wakendorf
    track(:first :station :open, neuold[:wak - 1ssw, :wak + 1ssw] << 0.5dt);
    with layer = -1 track(:first :station :removed,
            neuold[:wak - 1ssw, :wak + 1ssw] >> 0.5dt
    );
    marker(:de.hpext :open :right, neuold[:wak] << 0.5dt);
    marker(:de.hp :open :right, neuold[:wak] >> 0.5dt);
    with layer = -2 marker(:de.bf :gone :right, neuold[:wak] >> 0.5dt);
    slabel(:left :open, neuold[:wak] >> 0.5dt >> 2.2ssw,
        "Wakendorf"
    );

    # Streckengleise Wakendorf - Fresenburg
    track(:first :open, neuold[:wak + 1ssw, :fre - 1ssw] << 0.5dt);
    with layer = -1 track(:first :removed,
            neuold[:wak + 1ssw, :fre - 1ssw] >> 0.5dt
    );

    # Fresenburg
    track(:first :station :open, neuold[:fre - 1ssw, :fre + 1ssw] << 0.5dt);
    with layer = -1 track(:first :station :removed,
            neuold[:fre - 1ssw, :fre + 1ssw] >> 0.5dt
    );
    marker(:de.hpext :open :right, neuold[:fre] << 0.5dt);
    marker(:de.hp :open :right, neuold[:fre] >> 0.5dt);
    with layer = -2 marker(:de.bf :gone :right, neuold[:fre] >> 0.5dt);
    slabel(:left :open, neuold[:fre + 0.5ssw] >> 0.5dt >> 1.5ssw,
        "Fresenburg"
    );

    # Streckengleise Fresenburg - Bad Oldesloe
    track(:first :open, neuold[:fre + 1ssw, :ff] << 0.5dt
    );
    with layer = -1 track(:first :removed, neuold[:fre + 1ssw, :ff] >> 0.5dt);

    # Poggensee
    with layer = -2 marker(:de.hp :removed :left, neuold[:pog] << 0.5dt);
    slabel(:left :removed, neuold[:pog + .6ssw] >> 1.0dt,
        "Poggensee"
    );
}

