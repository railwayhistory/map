# DE 1022.  Kiel Hbf (ausschl) - Osterrönfeld (ausschl)
#
let altkie = path("path.de.1220");
let hasfle = path("path.de.1020");
let haskiw = path("path.de.1021");
let kieost = path("path.de.1022");
let neufle = path("path.de.1040");

with detail = 3 {
    # Kiel Hbf bis Kiel-Hassee
    track(:first :station,
            altkie[:kie, :fhas] >> 1.5dt
        ..  kieost[:khg, :has - 1ssw] >> 0.5dt
    );

    # Kiel-Hassee
    track(:double :first :station, kieost[:has - 1ssw, :has + 1ssw]);

    marker(:de.bf :left, kieost[:has] << 0.5dt);
    slabel(:left, kieost[:has - 0.2ssw] << 0.5dt << 2ssw + (0dt, 1dt),
        vbox(:right :base,
            span(:small :bold, "K.-Hassee"),
            span(:small :bold, "Cittipark")
        )
    );

    # Streckengleise Kiel-Hassee - Melsdorf
    track(:first,
            kieost[:has + 1ssw, :has + 1.1ssw] << 0.5dt
        ..  kieost[:has.ff, :mel - 1ssw]
    );

    # Russee
    #
    marker(:de.hp :right, kieost[:rus]);
    #slabel(:top, kieost[:rus] >> 1.4ssw, "K.-Russee");

    # Mettenhof
    with layer = -1 marker(:de.hp :removed :right, kieost[:met]);

    # Melsdorf
    track(:first :station, kieost[:mel - 1ssw, :mel + 1ssw]);
    marker(:de.hp :right, kieost[:mel]);
    with layer = -1 marker(:de.bf :gone :right, kieost[:mel]);
    slabel(:top, kieost[:mel] >> 1.4ssw, "Melsdorf");

    # Streckengleis Melsdorf - Felde-Brandsbek
    track(:first, kieost[:mel + 1ssw, :fel - 1ssw]);

    # Flemhude
    with layer = -1 marker(:de.hst :closed :right, kieost[:fle]);
    with layer = -2 marker(:de.bf :gone :right, kieost[:fle]);
    slabel(:top :removed, kieost[:fle] >> 1.4ssw, "Flemhude");

    # Achterwehr
    marker(:de.hp :left, kieost[:ach]);
    with layer = -1 slabel(:left, kieost[:ach + .3ssw] >> .5dt, "Achterwehr");

    # Felde-Brandsbek
    track(:first :station, kieost[:fel - 1ssw, :fel + 1ssw]);
    marker(:de.bf :left, kieost[:fel]);
    slabel(:bottom, kieost[:fel] << 1.2ssw, "Felde-Brandsbek");

    # Streckengleis Felde-Brandsbek - Kronsburg
    track(:first, kieost[:fel + 1ssw, :kro - 1ssw]);
    with layer = 1 line_badge(:open, kieost[:fel + 1.4km], "1022");

    # Bredenbek
    marker(:de.hp :left, kieost[:bre]);
    slabel(:bottom, kieost[:bre] << 1.2ssw, "Bredenbek");

    # Kronsburg
    track(:first :station, kieost[:kro - 1ssw, :kro + 1ssw]);
    marker(:de.bf :right :removed, kieost[:kro]);
    slabel(:top :removed, kieost[:kro] >> 1.2ssw, "Kronsburg");

    # Streckengleis Kronsburg - Ostenfeld
    track(:first, kieost[:kro + 1ssw, :ost - 1ssw]);

    # Ostenfeld
    track(:first, kieost[:ost - 1ssw, :ost + 1ssw]);
    with layer = -1 marker(:de.hst :closed, kieost[:ost]);
    with layer = -1 marker(:de.bf :gone, kieost[:ost]);
    slabel(:left :removed, kieost[:ost] >> 1.5ssw + (1.5ssw, 0ssw),
        vbox(:right :bottom,
            span(:small :removed, "Ostenfeld"),
            span(:small :light :removed, "(Kr Rendsburg)")
        )
    );

    # Streckengleis Ostenfeld - Schülldorf
    track(:first, kieost[:ost + 1ssw, :sul - 1ssw]);

    # Schülldorf
    track(:first :station, kieost[:sul - 1ssw, :sul + 1ssw]);
    marker(:de.hp, kieost[:sul]);
    with layer = -1 marker(:de.bf :gone, kieost[:sul]);
    with layer = -2 slabel(:right, kieost[:sul + .5ssw] << 1.5ssw,
        "Schülldorf"
    );

    # Streckengleis Schülldorf - Osterrönfeld
    track(:first,
            kieost[:sul + 1ssw, :oro.aa]
        ..  neufle[:fkie, :oro - 1ssw] >> 1.5dt
    );

    # Osterrönfeld Awanst
    marker(:de.awanst, neufle[:ora] >> 1.5dt);
}

