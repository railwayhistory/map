# DE 1220.  Altona Palmaille - Kiel Altonaer Bf
#

#--- Hamburg-Altona - Pinneberg (einschl.)

with detail = 3 {
    let altkie = path("metro.de.hmb.1220");

    with link = "point.de.Hamburg-Altona" {
        with layer = -2 track(:first:station :cat,
                altkie[:alt, :aham] >> 0.5dt
            ..  altkie[:fham, :fham + 0.1dl] << 1.5dt
        );

        track(:first:station :double :cat,
                altkie[:alt, :aham] << 1dt
        );

        track(:first:station :cat,
                altkie[:alt, :aham] << 2.5dt
            ..  altkie[:fham, :fham + 0.1dl] << 2.5dt
        );

        marker(:de.bf :bottom, altkie[:alt + 0.5ssw]);
        marker(:de.bf :bottom, altkie[:alt + 0.5ssw] << 1dt);
        marker(:de.bf :bottom, altkie[:alt + 0.5ssw] << 2dt);
    }

    with link = "point.de.Hamburg-Altona-Gbf" {
        track(:first:station :double :cat,
                altkie[:fham, :fham + 1ssw]
        );
        track(:first:station :double :cat,
                altkie[:fham, :fham + 1ssw] << 2dt
        );
    }

    with link = "line.de.1220" {
        track(:first :cat :tight :flip,
                altkie[:fham + 1ssw, :alt.f] << 1.5dt
            --  altkie[:alt.f + 2dl, :ala - 1ssw] << 2.5dt
        );

        with layer = 2 track(:first :cat :tight,
                altkie[:fham + 1ssw, :alt.f] << 2.5dt
            --  altkie[:alt.f + 3dl, :ala - 1ssw] >> 0.5dt
        );
        with layer = 1 casing(:first :cat :tight,
                altkie[:fham + 1ssw, :alt.f] << 2.5dt
            --  altkie[:alt.f + 3dl, :ala - 1ssw] >> 0.5dt
        );
    }

    with link = "point.de.Hamburg-Langenfelde-Bbf" {
        track(:first:station :cat, altkie[:ala - 1ssw, :ala + 1ssw] >> 0.5dt);
        track(:first:station :cat, altkie[:ala - 1ssw, :ala + 1ssw] << 0.5dt);
        track(:first:station :cat, altkie[:ala - 1ssw, :ala + 1ssw] << 1.5dt);
        track(:first:station :cat, altkie[:ala - 1ssw, :ala + 1ssw] << 2.5dt);
        marker(:de.bbf :left, altkie[:ala] << 2.5dt);
    }

    with link = "line.de.1220" {
        with layer = 2 track(:first :cat :tight,
                altkie[:ala + 1ssw, :frot] >> 0.5dt
        );
        with layer = 1 casing(:first:station :cat,
                altkie[:frot - 1ssw, :frot + 1ssw] >> 0.5dt
        );
        track(:first :cat :tight :flip, altkie[:ala + 1ssw, :frot] << 2.5dt);
    }

    with link = "point.de.Hamburg-Eidelstedt" {
        let eidrot = path("metro.de.hmb.1234");
        
        with layer = 2 track(:first:station :cat,
                altkie[:frot, :eid + 6dl] >> 0.5dt
        );

        track(:first:station :cat,
                altkie[:frot, :eid + 2dl] << 0.5dt
            --  altkie[:eid + 3dl, :eid + 3.1dl] >> 0.5dt
        );

        track(:first:station :cat,
                altkie[:frot, :eid + 3dl] << 1.5dt
        );

        track(:first:station :cat,
                altkie[:frot, :eid + 2dl] << 2.5dt
            --  altkie[:eid + 4dl, :eid + 6dl] << 0.5dt
        );

        track(:first:station :cat,
                eidrot[:aa + 0.1dl, :aa]
            ..  altkie[:frot + 1ssw, :frot + 1.1ssw] << 0.5dt
        );

        marker(:de.bbf :left, altkie[:eid] << 2.5dt);
    }

    with link = "line.de.1220" {
        track(:first :double :cat,
                path("metro.de.hmb.1220")[:eid + 6dl, :f]
            ..  altkie[:the, :pin - 2ssw]
        );
    }

    with link = "point.de.Thesdorf-Bk" {
        with layer = -1 marker(:de.bk :removed :left, altkie[:the] << 0.5dt);
    }

    with link = "point.de.Pinneberg" {
        track(:first:station :double :cat, altkie[:pin - 2ssw, :pin + 1ssw]);
        marker(:de.bf :right, altkie[:pin] >> 0.5dt);
        slabel(:right, altkie[:pin] >> 0.5dt >> 1.6ssw,
            span(:bold, "Pinneberg")
        );
    }
}


#--- Pinneberg (ausschl.) - Kiel Hbf

with detail = 3 {
    let altkie = path("path.de.1220");
    let kieost = path("d3.de.1022");
    let neuasc = path("d3.de.1041");
    let neufle = path("d3.de.1040");
    let neuhei = path("d3.de.1042");

    with link = "line.de.1220" {
        track(:first :double :cat,
                path("metro.de.hmb.1220")[:pin + 1ssw, :pin + 1.2km]
            ..  altkie[:pri - 1.4km, :pri - 1ssw]
        );
    }

    with link = "point.de.Prisdorf" {
        track(:first:station :double :cat, altkie[:pri - 1ssw, :pri + 1ssw]);
        marker(:de.hp :right, altkie[:pri] >> 0.5dt)
        with layer = -1 marker(:de.bf :removed :right, altkie[:pri] >> 0.5dt);
        slabel(:right, altkie[:pri - 0.5ssw] >> 0.5dt >> 1.2ssw,
            "Prisdorf"
        );
    }

    with link = "line.de.1220" {
        track(:first :double :cat, altkie[:pri + 1ssw, :tor - 1ssw]);
    }

    with link = "point.de.Tornesch" {
        track(:first:station :double :cat, altkie[:tor - 1ssw, :tor + 1ssw]);
        marker(:de.bf :left, altkie[:tor] << 0.5dt);
        slabel(:right, altkie[:tor - 0.5ssw] >> 1.0dt,
            span(:bold, "Tornesch")
        );
    }

    with link = "line.de.1220" {
        track(:first :double :cat, altkie[:tor + 1ssw, :els - 1ssw]);
    }

    with link = "point.de.Himmel" {
        with layer = -1 marker(:de.bk :removed :right, altkie[:him] >> 0.5dt);
    }

    with link = "point.de.Lieth" {
        with layer = -1 marker(:de.bk :removed :right, altkie[:lie] >> 0.5dt);
    }

    with link = "point.de.Elmshorn-Els" {
        track(:first:station :double :cat, altkie[:els - 1ssw, :elm.r]);
        with layer = -1 marker(:de.bft :removed :left, altkie[:els] << 0.5dt);
    }

    with link = "point.de.Elmshorn" {
        track(:first:station :double :cat, altkie[:elm.r, :elm.u]);
        track(:first:station :double :cat,
                altkie[:aitz - 1m, :aitz]
            ..  path("path.de.1210")[:elw - 1.1ssw, :elw - 1ssw]
        );
        marker(:de.bf :right, altkie[:elm] >> 0.5dt);
        slabel(:right, altkie[:elm - 0.6ssw] >> 0.5dt >> 1.4ssw,
            span(:bold, "Elmshorn")
        );
    }

    with link = "point.de.Elmshorn-Nord" {
        track(:first:station :double :cat, altkie[:elm.u, :eln + 1ssw]);
        marker(:de.bft :right, altkie[:eln] >> 0.5dt);
    }

    with link = "line.de.1220" {
        track(:first :double :cat, altkie[:eln + 1ssw, :hot - 1ssw]);
    }

    with link = "point.de.Horst-in-Holstein" {
        track(:first:station :double :cat, altkie[:hot - 1ssw, :hot + 1ssw]);
        marker(:de.hp :left, altkie[:hot] << 0.5dt);
        slabel(:right, altkie[:hot - 0.5ssw] >> 1.5dt,
            "Horst in Holstein"
        );
    }

    with link = "line.de.1220" {
        track(:first :double :cat, altkie[:hot + 1ssw, :hrt - 1ssw]);
    }       

    with link = "point.de.Horst-Holst" {
        track(:first:station :double :cat, altkie[:hrt - 1ssw, :hrt + 1ssw]);
        with layer = -1 marker(:de.bf :removed :left, altkie[:hrt] << 0.5dt);
        slabel(:left :removed, altkie[:hrt - 0.4ssw] << 0.5dt << 1.6ssw,
            hbox(:right:base,
                span(:regular, "Horst "),
                span(:light, "(Holst)")
            )
        );
    }

    with link = "line.de.1220" {
        track(:first :double :cat, altkie[:hrt + 1ssw, :dhf - 1ssw]);
        with layer = 1 line_badge(:open, altkie[:dhf - 2.5km], "1220");
    }

    with link = "point.de.Dauenhof" {
        track(:first:station :double :cat, altkie[:dhf - 1ssw, :dhf + 1ssw]);
        marker(:de.bf :left, altkie[:dhf] << 0.5dt);
        slabel(:left, altkie[:dhf - 0.8ssw] << 0.5dt << 1.5ssw, "Dauenhof");
    }

    with link = "line.de.1220" {
        track(:first :double :cat, altkie[:dhf + 1ssw, :wri - 1ssw]);
    }       

    with link = "point.de.Siebenecksknöll" {
        with layer = -1 marker(:de.bk :removed :left, altkie[:sie] << 0.5dt);
    }

    with link = "point.de.Wrist" {
        track(:first:station :double :cat, altkie[:wri - 1ssw, :wri + 1ssw]);
        marker(:de.bf :left, altkie[:wri] << 0.5dt);
        slabel(:right, altkie[:wri - 0.2ssw] >> 2.5dt,
            span(:bold, "Wrist")
        );
    }

    with link = "line.de.1220" {
        track(:first :double :cat, altkie[:wri + 1ssw, :brs - 1ssw]);
    }       

    with link = "point.de.Quarnstedt" {
        with layer = -1 marker(:de.bk :removed :left, altkie[:qua] << 0.5dt);
    }

    with link = "point.de.Brokstedt" {
        track(:first:station :double :cat, altkie[:brs - 1ssw, :brs + 1ssw]);
        marker(:de.bf :left, altkie[:brs] << 0.5dt);
        slabel(:left, altkie[:brs - 0.5ssw] << 0.5dt << 1.5ssw,
            "Brokstedt"
        );
    }

    with link = "line.de.1220" {
        track(:first :double :cat, altkie[:brs + 1ssw, :arp - 1ssw]);
        with layer = 1 line_badge(:open, altkie[:brs + 2.5km], "1220");
    }       

    with link = "point.de.Arpsdorf" {
        track(:first:station :double :cat, altkie[:arp - 1ssw, :arp + 1ssw]);
        with layer = -1 marker(:de.bk :removed :left, altkie[:arp] << 0.5dt);
        with layer = -2 marker(:de.bf :gone :left, altkie[:arp] << 0.5dt);
        slabel(:left :removed, altkie[:arp - 0.6ssw] << 0.5dt << 1.4ssw,
            "Arpsdorf"
        );
    }

    with link = "line.de.1220" {
        track(:first :double :cat, altkie[:arp + 1ssw, :neu.a]);
    }       

    with link = "point.de.Padenstedt" {
        with layer = -1 marker(:de.bk :removed :left, altkie[:pad] << 0.5dt);
    }

    with link = "point.de.Neumüster" {
        track(:double :first :station, altkie[:neu.a, :neu.f]);
        track(:first :station, altkie[:neu.a, :neu + .5ssw] >> 1.5dt);
        track(:first :station :closed,
                altkie[:neu + .5ssw, :neu + .51ssw] >> 1.5dt
            ..  neuasc[:neu.hh + .29km, :neu.hh + .3km]
        );
        track(:first :station,
                altkie[:neu - .5ssw - 2.1dl, :neu - .5ssw - 2dl] << 0.5dt
            --  altkie[:neu - .5ssw - 1dl, :aren] << 1.5dt
            ..  neufle[:neu.gg - .1dl, :neu.gg] << 0.5dt
        );
        track(:first :station,
                altkie[:aren - .1dl, :aren] << 0.5dt
            ..  neufle[:neu.gg - .1dl, :neu.gg] >> 0.5dt
        );
        track(:second :station,
                altkie[:neu - .5ssw - 1.01dl, :neu - .5ssw - 1dl] << 1.5dt
            --  altkie[:neu - .5ssw, :neu + .5ssw] << 2.5dt
            ..  neuhei[:nst - .51ssw, :nst - .5ssw]
        );

        marker(:de.bf :right, altkie[:neu] >> 1.5dt);
        slabel(:right, altkie[:neu - .5ssw] >> 1.5dt >> 1.6ssw,
            span(:small :bold, "NEUMÜNSTER")
        );
    }
}

