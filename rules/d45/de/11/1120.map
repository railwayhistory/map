# DE 1120.  Lübeck Hbf (einschl.) - Hamburg-Wandsbek (einschl.)
#
#           Hamburg-Wandsbek - Hamburg Hbf: DE 1241.
#
let lubham = path("path.de.1120");
let lubham.old = path("path.de.1120.old");
let lubput = path("path.de.1100");

with detail = [4, 5] {
    with link = "point.de.Lübeck-Hbf" {
        # Ein-/Ausfahrt Puttgarden
        track(:first:station :double :cat, lubput[:aluh, :lub + 0.6sw + 2dl]);

        # Ausfahrt Hamburg
        track(:first:station :cat,
                lubham[:lub - 0.6sw - 2.1dl, :lub - 0.6sw - 2dl] >> 0.5dt
            --  lubham[:lub - 0.6sw - 1dl, :lub.f] >> 1.5dt
        );

        # Ausfahrt Büchen
        with layer = -1 track(:first:station :closed,
                lubham[:lub - 0.6sw - 2dl, :lub.f] >> 0.5dt);

        # Einfahrt Hamburg
        with layer = -1 track(:first:station :closed,
                lubham[:lub - 0.6sw - 2dl, :lub.f] << 0.5dt
        );

        # Einfahrt Büchen
        track(:first:station, lubham[:lub - 0.6sw - 1dl, :lub.f] << 1.5dt);

        # Ein-/Ausfahrt Bad Kleinen
        track(:first:station,
                lubham[:lub - 0.6sw - 2.1dl, :lub - 0.6sw - 2dl] << 0.5dt
            --  lubham[:lub - 0.6sw, :lub.f] << 2.5dt
        );

        # Hafenbahn
        track(:second:station,
                lubput[:aluh, :aluh - 1sw] << 1.5dt
            ..  lubham[:lub - 0.6sw, :lub.f] << 3.5dt
        );

        # Kleinbahn
        with layer = -1 track(:third:station :removed,
                lubham[:lub - 0.6sw - 1.1dl, :lub - 0.6sw - 1dl] >> 1.5dt
            --  lubham[:lub - 0.6sw, :aseg] >> 2.5dt
        );

        marker(:de.bf :open :left, lubham[:lub] << 3.5dt);
        label(lubham[:lub + 0.5sw] >> 3.5dt,
            hbox(:right:bottom,
                vbox(:center:bottom,
                    hbox(:center:top :xsmall,
                        vbox(:right:top,
                            span(:open, "1100: "),
                            span(:removed, "1110: "),
                            span(:open, "1120: "),
                            span(:closed, "1121: "),
                            span(:open, "1122: "),
                            span(:open, "1130: "),
                            span(:removed, "91151: ")
                        ),
                        vbox(:right:top,
                            span(:open, "0,"),
                            span(:removed, "32,"),
                            span(:open, "0,"),
                            span(:closed, ""),
                            span(:open, ""),
                            span(:open, ""),
                            span(:removed, "")
                        ),
                        vbox(:left:top,
                            span(:open, "00"),
                            span(:removed, "90"),
                            span(:open, "00"),
                            span(:closed, "??"),
                            span(:open, "??"),
                            span(:open, "??"),
                            span(:removed, "??")
                        )
                    ),
                    span(:medium :bold, "Lübeck Hbf")
                )
            )
        );
    }

    with link = "point.de.Lübeck-Hgbf" {
        # Ausfahrt Hamburg
        track(:first:station :cat, lubham[:lub.f, :lua - 1sw] >> 1.5dt);

        # Ausfahrt Büchen
        track(:first:station :closed,
                lubham[:lub.f, :lub.f + 1dl] >> 0.5dt
            ..  lubham[:lub.f + 400m, :lua - 1sw] << 0.5dt
        );
        with layer = -0.5 casing(:first:station,
                lubham[:lub.f, :lub.f + 1dl] >> 0.5dt
            ..  lubham[:lub.f + 400m, :lub.f + 401m] << 0.5dt
        );

        # Einfahrt Hamburg
        with layer = -1 track(:first:station :closed,
                lubham[:lub.f, :lub.f + 1dl] << 0.5dt
            ..  lubham[:lub.f + 400m, :lua - 1sw] >> 0.5dt
        );

        # Einfahrt Büchen
        track(:first:station, lubham[:lub.f, :lua - 1sw] << 1.5dt);

        # Bad Kleinen
        track(:first:station, lubham[:lub.f, :lua - 1sw] << 2.5dt);

        # Hafenbahn
        track(:second:station, lubham[:lub.f, :lua - 1sw] << 3.5dt);

        marker(:de.gbf :open :left, lubham[:lug] << 3.5dt);
        label(lubham[:lug + 0.5sw] >> 3.5dt,
            hbox(:right:bottom,
                vbox(:center:bottom,
                    hbox(:center:top :xsmall,
                        vbox(:right:top,
                            span(:closed, "1120: "),
                            span(:closed, "1121: "),
                            span(:closed, "1122: "),
                            span(:open, "1130: "),
                            span(:closed, "1131: ")
                        ),
                        vbox(:right:top,
                            span(:closed, "2,"),
                            span(:closed, "2,"),
                            span(:closed, "2,"),
                            span(:open, "1,"),
                            span(:closed, "")
                        ),
                        vbox(:left:top,
                            span(:closed, "28"),
                            span(:closed, "26"),
                            span(:closed, "20"),
                            span(:open, "80"),
                            span(:closed, "??")
                        )
                    ),
                    span(:medium, "Lübeck Hgbf")
                )
            )
        );
    }

    with link = "point.de.Lübeck-Hgbf-Abzw" {
        # Ausfahrt Hamburg
        track(:first:station :cat, lubham[:lua - 1sw, :lua + 1sw] >> 1.5dt);

        # Einfahrt Hamburg
        with layer = -1 track(:first:station :closed,
                lubham[:lua - 1sw, :lua + 1dl] >> 0.5dt
        );
        track(:first:station :cat, lubham[:lua + 1dl, :lua + 1sw] >> 0.5dt);

        # Ausfahrt Büchen
        with layer = -1 track(:first:station :closed,
                lubham[:lua - 1sw, :lua] << 0.5dt
        );

        # Einfahrt Büchen
        track(:first:station :cat, lubham[:lua - 1sw, :lua + 1sw] << 1.5dt);

        # Bad Kleinen
        track(:first:station :cat, lubham[:lua - 1sw, :lua + 1sw] << 2.5dt);

        # Hafenbahn
        track(:second:station,
                lubham[:lua - 1sw, :lua - 3dl] << 3.5dt
            --  lubham[:lua + 2dl, :lua + 2.1dl] >> 1.5dt
        );

        # Industriebahn Steinhof
        with layer = -1 track(:private:station :removed,
                lubham[:lua - 2.1dl, :lua - 2dl] << 3.5dt
            --  lubham[:lua - 1dl, :lua + 2dl] << 4.5dt
        );
        
        marker(:de.abzw :right, lubham[:lua] >> 1.5dt);
        station(:left, lubham[:lua + 0.4sw] >> 1.5dt >> 1.6sh,
            span(:bold, "Lübeck Hgbf Abzw"),
            hbox(:center:top,
                vbox(:right:top,
                    span(:open, "1120: "),
                    span(:open, "1121: "),
                    span(:open, "1122: "),
                    span(:open, "1130: "),
                    span(:open, "1135: ")
                ),
                vbox(:right:top,
                    span(:open, "2,"),
                    span(:open, "2,"),
                    span(:open, ""),
                    span(:open, ""),
                    span(:open, "")
                ),
                vbox(:left:top,
                    span(:open, "49"),
                    span(:open, "48"),
                    span(:open, "??"),
                    span(:open, "??"),
                    span(:open, "??")
                )
            )
        );
    }


    with link = "line.de.1120" {
        track(:first :double :cat,
                lubham[:lua + 1sw, :akle] >> 1dt
            ..  lubham[:gea, :gea + 1m]
        );
    }


    with link = "point.de.Lübeck-Genin-Abzw" {
        track(:first:station :double :cat, lubham[:gea + 1m, :gea + 1sw]);
        with layer = -1 marker(:de.abzw :gone :left,
            lubham[:gea + 0.5sw] << 0.5dt
        );
    }


    with link = "line.de.1120" {
        track(:first :double :cat, lubham[:gea + 1sw, :gef - 0.5sw]);
    }


    with link = "point.de.Lübeck-Genin-Fehlstelle" {
        track(:first:station :double :cat, lubham[:gef - 0.5sw, :gef + 0.5sw]);
        marker(:statdt :right, lubham[:gef] >> 0.5dt);
        marker(:statdt :right, lubham[:gef] << 0.5dt);
        marker(:statdt :left, lubham[:gef] << 0.5dt);
        label(lubham[:gef] << 2dt,
            hbox(:top:center, span(:xsmall, "4,751 = 5,800"))
        );
    }


    with link = "line.de.1120" {
        track(:first :double :cat, lubham[:gef + 0.5sw, :nie - 1sw]);
        with layer = 1 line_badge(:open, lubham[:nie - 0.9km], "1120");
    }


    with link = "point.de.Lübeck-Niendorf" {
        track(:first:station :double :cat, lubham[:nie - 1sw, :nie + 1sw]);

        with layer = -1 marker(:de.bf :closed :right, lubham[:nie] >> 0.5dt);
        station(:top :closed, lubham[:nie] >> 0.5dt >> 1.2sh,
            vbox(:center:bottom,
                span(:gone, "Reecke-Niendorf"),
                span(:closed, "Lübeck-Niendorf")
            ),
            "7,51"
        );
    }


    with link = "line.de.1120" {
        track(:first :double :cat, lubham[:nie + 1sw, :rei - 1sw]);
        with detail = 5, layer = 1 line_badge(
            :open, lubham[:rei - 1.4km], "1120"
        );
    }


    with link = "point.de.Wesenberg-Holst" {
        with layer = -1 marker(:de.bk :removed :left, lubham[:wes] << 0.5dt);
        station(:bottom :removed, lubham[:wes] << 0.5dt << 1.2sh,
            "Wesenberg", "11,55"
        );
    }


    with link = "point.de.Reinfeld-Holst" {
        track(:first:station :double :cat, lubham[:rei - 1sw, :rei + 1sw]);

        marker(:de.bf :open :right, lubham[:rei] >> 0.5dt);
        station(:left :open, lubham[:rei + 0.4sw] >> 0.5dt >> 1.2sh,
            hbox(:center:base,
                span(:regular, "Reinfeld "),
                span(:light, "(Holst)")
            ),
            "15,83"
        );
    }


    with link = "line.de.1120" {
        track(:first :double :cat,
                lubham[:rei + 1sw, :old.aa]
            ..  lubham.old[:old.a - 1m, :old.a]
        );
        with layer = 1 line_badge(:open, lubham[:old.a - 1.4km], "1120");
    }


    with link = "point.de.Steinfeld" {
        with layer = -1 marker(:de.bk :removed :left, lubham[:ste] << 0.5dt);
        station(:bottom :removed, lubham[:ste] << 0.5dt << 1.2sh,
            "Steinfeld", "19,35"
        );
    }


    with link = "point.de.Bad-Oldesloe" {
        # Str. 1120
        track(:first:station :double :cat, lubham.old[:old.a, :old.f]);
        with layer = -1 casing(:first:station :double :cat,
                lubham[:old.f - 400m, :old.f + 200m]
        );

        # Str. 1043
        track(:first:station,
                lubham.old[:old.a, :old + 0.5sw] >> 1.5dt
        );
        with layer = -1 track(:first:station:removed,
                lubham.old[:old.a, :old.a + 1m] >> 1.5dt
            ..  lubham.old[:old - 0.6sw, :old] >> 4.5dt
        );
        with layer = -1 track(:first:station:removed,
                lubham.old[:old.a, :old.a + 1m] >> 2.5dt
            ..  lubham.old[:old - 0.6sw, :old] >> 5.5dt
        );

        # Str. 1141
        with layer = -1 track(:second:station :removed,
                lubham.old[:old, :aulz] >> 4.5dt
            ..  lubham.old[:old.f - 400m, :old.f] >> 1.5dt
        );
        with layer = -1.5 casing(:second:station,
                lubham[:old.f - 400m, :old.f + 100m] >> 1.5dt
        );

        # Str. 6928
        with layer = -2 track(:second:station :removed,
                lubham.old[:old, :aulz] >> 5.5dt
            ..  path("path.de.6928")[:ff + 1m, :ff]
        );

        # Str. 9120
        with layer = -1 track(:first:station:removed,
                lubham.old[:old - 0.5sw, :aulz] >> 6.5dt
        );

        marker(:de.bf :open :right, lubham[:old] >> 1.5dt);
        station(:right :open, lubham[:old + 0.3sw] << 3dt,
            span(:bold, "Bad Oldesloe"),
            hbox(:center:top,
                vbox(:right:top,
                    span(:open, "1043: "),
                    span(:open, "1120: "),
                    span(:removed, "1141: "),
                    span(:removed, "6928: "),
                    span(:removed, "9120: ")
                ),
                vbox(:right:top,
                    span(:open, "119,"),
                    span(:open, "23,"),
                    span(:removed, "285,"),
                    span(:removed, "78,"),
                    span(:removed, "")
                ),
                vbox(:left:top,
                    span(:open, "57"),
                    span(:open, "89"),
                    span(:removed, "53"),
                    span(:removed, "34"),
                    span(:removed, "??")
                )
            )
        );
        
    }


    with link = "line.de.1020" {
        track(:first :double :cat, lubham[:old.f, :kup - 1sw]);
        with layer = -1 casing(:first :double,
            lubham[:rup.x - 200m, :rup.x + 200m]
        );
        with layer = 1 line_badge(:open, lubham[:kup - 1.4km], "1120");
    }


    with link = "point.de.Kupfermühle" {
        track(:first:station :double :cat, lubham[:kup - 1sw, :kup + 1sw]);
        marker(:de.hp :right, lubham[:kup] >> 0.5dt);
        station(:left, lubham[:kup + 0.3sw] >> 0.5dt >> 1.4sh,
            "Kupfermühle", "29,97"
        );
    }


    with link = "line.de.1020" {
        track(:first :double :cat, lubham[:kup + 1sw, :bar - 1sw]);
    }


    with link = "point.de.Tremsbüttel" {
        with layer = -1 marker(:de.bk :removed :left, lubham[:tre] << 0.5dt);
        station(:right :removed, lubham[:tre + 0.3sw] << 0.5dt << 1.8sh,
            "Tremsbüttel", "31,9"
        );
    }


    with link = "point.de.Bargteheide" {
        track(:first:station :double :cat, lubham[:bar - 1sw, :bar + 1sw]);
        marker(:de.bf :right, lubham[:bar] >> 0.5dt);
        station(:left, lubham[:bar + 0.3sw] >> 0.5dt >> 1.4sh,
            "Bargteheide", "35,41"
        );
    }


    with link = "line.de.1020" {
        track(:first :double :cat, lubham[:bar + 1sw, :gar - 1sw]);
        with layer = 1 line_badge(:open, lubham[:bar + 1.7km], "1120");
    }


    with link = "point.de.Delingsdorf" {
        with layer = -1 marker(:de.bk :removed :right, lubham[:del] >> 0.5dt);
        station(:left :removed, lubham[:del + 0.5sw] >> 0.5dt >> 1.4sh,
            "Delingsdorf", "38,69"
        );
    }


    with link = "point.de.Ahrensburg-Gartenholz" {
        track(:first:station :double :cat, lubham[:gar - 1sw, :gar + 1sw]);
        marker(:de.hp :left, lubham[:gar] << 0.5dt);
        station(:right, lubham[:gar + 0.3sw] << 0.5dt << 1.4sh,
            "Ahrensburg-Gartenholz", "39,91"
        );
    }


    with link = "line.de.1020" {
        track(:first :double :cat, lubham[:gar + 1sw, :ahr - 1sw]);
    }


    with link = "point.de.Ahrensburg-Nord" {
        marker(:de.awanst :right, lubham[:ahn] >> 0.5dt);
        station(:left, lubham[:ahn + 0.5sw] >> 0.5dt >> 1.4sh,
            "Ahrensburg Nord", "40,30"
        );
    }


    with link = "point.de.Ahrensburg" {
        track(:first:station :double :cat, lubham[:ahr - 1sw, :ahr + 1sw]);
        marker(:de.bf :right, lubham[:ahr] >> 0.5dt);
        station(:left, lubham[:ahr + 0.3sw] >> 0.5dt >> 1.4sh,
            "Ahrensburg", "42,43"
        );
    }


    with link = "line.de.1020" {
        track(:first :double :cat, lubham[:ahr + 1sw, :rab - 1sw]);
        with layer = 1 line_badge(:open, lubham[:ahr + 2.3km], "1120");
    }


    with link = "point.de.Meiendorf" {
        with layer = -1 marker(:de.bk :removed :right, lubham[:mei] >> 0.5dt);
        station(:left :removed, lubham[:mei + 0.5sw] >> 0.5dt >> 1.2sh,
            "Meiendorf", "47,40"
        );
    }


    with link = "point.de.Hamburg-Rahlstedt-Bbf" {
        track(:first:station :double :cat, lubham[:rab - 1sw, :rab + 1sw]);
        marker(:de.bft :right, lubham[:rab] >> 0.5dt);
        station(:left, lubham[:rab + 0.6sw] >> 0.5dt >> 1.2sh,
            "Hamburg-Rahlstedt Bbf", "??"
        );
    }


    with link = "point.de.Hamburg-Rahlstedt" {
        track(:first:station :double :cat, lubham[:rab + 1sw, :rah + 1sw]);
        marker(:de.bf :left, lubham[:rah] << 0.5dt);
        station(:right, lubham[:rah + 0.3sw] << 0.5dt << 1.8sh,
            "Hamburg-Rahlstedt", "51,67"
        );
    }


    with link = "line.de.1020" {
        track(:first :double :cat, lubham[:ahr + 1sw, :ton - 1sw]);
    }


    with link = "point.de.Wandsbek-Ost-Bk" {
        with layer = -1 marker(:de.bk :removed :left, lubham[:wab] << 0.5dt);
        station(:right :removed, lubham[:wab + 0.3sw] << 0.5dt << 1.8sh,
            "Wandsbek Ost", "54,42"
        );
    }


    with link = "point.de.Hamburg-Tonndorf" {
        track(:first:station :double :cat, lubham[:ton - 1sw, :ton + 1sw]);
        marker(:de.bf :right, lubham[:ton] >> 0.5dt);
        station(:left, lubham[:ton + 0.6sw] >> 0.5dt >> 1.2sh,
            vbox(:center:bottom,
                span(:closed, "Wandsbek Ost"),
                span(:open, "Hamburg-Tonndorf")
            ),
            "54,44"
        );
    }


    with link = "line.de.1020" {
        track(:first :double :cat, lubham[:ton + 1sw, :waf - 1sw]);
        with layer = 1 line_badge(:open, lubham[:ton + 1.2km], "1120");
    }


    with link = "point.de.Hamburg-Wandsbek-Wf" {
        track(:first:station :double :cat, lubham[:waf - 1sw, :waf + 1sw]);
        track(:first:station :cat,
                lubham[:waf - 0.5sw - 1.1dl, :waf - 0.5sw - 1dl] << 0.5dt
            --  lubham[:waf - 0.5sw, :waf + 1sw] << 1.5dt
        );
        marker(:de.bft :left, lubham[:waf] << 1.5dt);
        station(:right, lubham[:waf + 0.6sw] << 1.5dt << 2.0sh,
            "Hamburg-Wandsbek Wf", "??"
        );
    }


    with link = "point.de.Hamburg-Wandsbek" {
        track(:first:station :double :cat, lubham[:waf + 1sw, :arot]);
        track(:first:station :cat, lubham[:waf + 1sw, :arot] << 1.5dt);
        marker(:de.bf :right, lubham[:wan] >> 0.5dt);
        station(:top, lubham[:wan] >> 0.5dt >> 1.6sh,
            span(:bold, "Hamburg-Wandsbek"),
            hbox(:center:top,
                vbox(:right:top,
                    span(:open, "1120: "),
                    span(:open, "1242: ")
                ),
                vbox(:right:top,
                    span(:open, "58,20"),
                    span(:open, "58,20")
                )
            )
        );
    }


}

