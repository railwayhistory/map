# DE AF1.  Flensburg Kreisb - Kappeln (Schlei)
#
let fk = path("d4.de.af1");

with detail = 3 {
    with link = "point.de.Flensburg-Kreisb" {
        track(:third:station :narrow:g1000 :removed,
                fk[:fkr - 0.5sw, :fkr.f] >> 1dt
        );
        marker(:right :de.bf :removed, fk[:fkr + 0.2sw] >> 0.8dt);
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed,
                fk[:fkr.f, :xgl - 1dt] >> 1dt
            ..  fk[:eng - 1.1sw, :run.ys]
        );
        line_label(:right:w :removed, fk[:wee + 0.8km], "AF1");
    }

    with link = "point.de.Engelsby" {
        marker(:right :de.khp :removed, fk[:eng]);
        slabel(:right :removed :xsmall, fk[:eng + 0.2sw] >> 1.5sh,
            "Engelsby"
        );
    }

    with link = "point.de.Kauslund" {
        marker(:right :de.khp :removed, fk[:kau]);
        slabel(:left :removed :xsmall, fk[:kau + 0.5sw] << 1.0dt,
            "Kauslund"
        );
    }

    with link = "point.de.Wees" {
        marker(:right :de.kbf :removed, fk[:wee]);
        slabel(:right :removed :xsmall, fk[:wee] + (0.8sw, 0dt),
            hbox(:left:top, "Wees")
        );
    }

    with link = "point.de.Rothenhaus" {
        marker(:right :de.kbf :removed, fk[:rot]);
        slabel(:left :removed :xsmall, fk[:rot] + (-0.3sw, -0.7sh),
            "Rothenhaus"
        );
    }
    
    with link = "point.de.Glücksburg" {
        marker(:right :de.kbf :removed, fk[:glu + 0.8sw]);
        slabel(:right :removed :xsmall, fk[:glu + 1.4sw] << 0.8dt,
            hbox(:left:base, "Glücksburg", span(:light, " (Kr Flensburg)"))
        );
    }

    with link = "point.de.Rüde" {
        marker(:left :de.khp :removed, fk[:rud]);
        slabel(:right :removed :xsmall, fk[:rud + 0.7sw] << 1.0sw, "Rüde");
    }

    with link = "point.de.Ringsberg" {
        marker(:left :de.kbf :removed, fk[:rin + 0.2sw]);
        slabel(:right :removed :xsmall, fk[:rin] + (0.2sw, -1.2sw),
            "Ringsberg"
        );
    }

    with link = "line.de.AF1" {
        line_label(:right:n :removed, fk[:rin + 1.0km], "AF1");
    }

    with link = "point.de.Langballig" {
        marker(:left :de.kbf :removed, fk[:lan]);
        slabel(:right :removed :xsmall, fk[:lan - 1.0sw] << 1.3sw,
            "Langballig"
        );
    }

    with link = "point.de.Streichmühle" {
        marker(:left :de.kbf :removed, fk[:str]);
        slabel(:right :removed :xsmall, fk[:str] + (-0.8sw, -1.4sw),
            "Streichmühle"
        );
    }

    with link = "point.de.Dollerup" {
        marker(:left :de.kbf :removed, fk[:dol - 0.34sw]);
        slabel(:left :removed :xsmall, fk[:dol] + (-0.8sw, 0.2sw), "Dollerup");
    }

    with link = "point.de.Nübelfeld" {
        marker(:right :de.kbf :removed, fk[:nub + 0.1sw]);
        slabel(:right :removed :xsmall, fk[:nub - 0.5sw] << 0.5sh, "Nübelfeld");
    }

    with link = "point.de.Steinbergkirche" {
        marker(:right :de.kbf :removed, fk[:stk]);
        slabel(:left :removed :xsmall, fk[:stk + 0.8sw] >> 0.8sh,
            hbox(:right:top, "Steinbergkirche")
        );
    }

    with link = "point.de.Steinberg-Flensburg" {
        marker(:left :de.kbf :removed, fk[:ste]);
        slabel(:right :removed :xsmall, fk[:ste] + (-1.2sw, -1.0sw),
            vbox(:left:bottom, "Steinberg", span(:light, " (Kr Flensburg)"))
        );
    }

    with link = "point.de.Niesgrau" {
        marker(:left :de.kbf :removed, fk[:nie]);
        slabel(:right :removed :xsmall, fk[:nie] + (-1.2sw, -1.4sw),
            "Niesgrau"
        );
    }

    with link = "point.de.Stausmark" {
        marker(:left :de.kbf :removed, fk[:sta]);
        slabel(:left :removed :xsmall, fk[:sta - 0.5sw] >> 0.1sw,
            hbox(:right:top, "Stausmark")
        );
    }

    with link = "line.de.AF1" {
        line_label(:right:ne :removed, fk[:sta + 0.9km], "AF1");
    }

    with link = "point.de.Rundhof" {
        track(:third:station :narrow:g1000 :removed,
                fk[:run.ys, :run + 1sw]
        );
        marker(:right :de.bf :removed, fk[:run]);
        slabel(:right :removed, fk[:run] + (-0.5sw, 1.2sw),
            hbox(:left:top :bold, "Rundhof")
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:run + 1sw, :kap.a]);
        line_label(:left:se :removed, fk[:run + 1.9km], "AF1");
        line_label(:right:ne :removed, fk[:swa + 1.1km], "AF1");
    }

    with link = "point.de.Lehbek" {
        marker(:right :de.kbf :removed, fk[:leh + 0.25sw]);
        slabel(:right :removed :xsmall, fk[:leh] + (-0.2sw, 1.0sw),
            hbox(:left:top, "Lehbek")
        );
    }

    with link = "point.de.Gelting" {
        marker(:left :de.kbf :removed, fk[:gel]);
        slabel(:top :removed :xsmall, fk[:gel] << 0.9sh, "Gelting");
    }

    with link = "point.de.Stenderup" {
        marker(:right :de.kbf :removed, fk[:stp] >> 0.2dt);
        slabel(:right :removed :xsmall, fk[:stp + 0.4sw] << 0.4sh, "Stenderup");
    }

    with link = "point.de.Schwackendorf" {
        marker(:left :de.kbf :removed, fk[:swa] @ 5 << 0.2dt);
        slabel(:right :removed :xsmall, fk[:swa + 0.5sw] << 1.3sh,
            "Schwackendorf"
        );
    }

    with link = "point.de.Rabel" {
        marker(:left :de.kbf :removed, fk[:rab]);
        slabel(:right :removed :xsmall, fk[:rab + 0.5sw] << 1.3sh, "Rabel");
    }

    with link = "point.de.Grimsnis" {
        marker(:right :de.khp :removed, fk[:gri]);
        slabel(:left :removed :xsmall, fk[:gri] + (-1.5sw, 0.5sw), "Grimsnis");
    }
}

