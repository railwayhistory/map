# DE 1023.  Kiel Hbf (ausschl.) - Neustadt (Holst)
#
let kieneu = path("path.de.1023");
let kieneu.nst = path("path.de.1023.nst");
let lubput = path("path.de.1100");
let neuhei = path("path.de.11011.neu");

with detail = 5 {
    with link = "line.de.1023" {
        track(:second :removed, kieneu[:neg.aa, :neg.a]);
    }

    with link = "line.de.1023", layer = -2 {
        track(:first :gone,
                kieneu[:neg.aa, :neg.aa + 1m]
            ..  kieneu.nst[:a, :nst.w3 - 300m] >> 1dt
        );
    }


    with link = "point.de.Neustadt-Holst-Gbf" {
        # Einfahrt aus Eutin
        with layer = -1 track(:second :station :removed,
                kieneu[:neg.a, :neg.ns - 40m]
        );

        # Gl. 7
        track(:first :station,
                lubput[:neg.a, :neg.a + 10m]
            ..  kieneu[:neg.ns - 40m, :neg.nn]
            ..  lubput[:neg.f - 60m, :neg.f]
        );

        # Gl. 8 (>> 1dt)
        track(:second :station,
                kieneu[:neg.ns, :neg.ns + 5m]
            ..  kieneu[:neg.ns +  90m, :neg.nn + 90m] >> 1dt
            ..  kieneu[:nst.a  -  10m, :nst.a]
        );
            # W45 - W47
            track(:station,
                    kieneu[:neg.nn + 90m, :neg.nn + 91m] >> 1dt
                ..  lubput[:neg.f  - 60m, :neg.f  - 59m]
            );

        # Gl. 9 (>> 2dt)
        with layer = -1 track(:station :removed,
                lubput[:neg.a, :neg.a + 10m] >> 1dt
           ..   kieneu[:neg.ns - 40m, :neg.ns -  39m] >> 1dt
           ..   kieneu[:neg.ns + 90m, :neg.ns + 140m] >> 2dt
        );
        track(:station,
                kieneu[:neg.ns + 140m, :neg.nn + 10m] >> 2dt
           ..   kieneu[:neg.nn +  80m, :neg.nn + 81m] >> 1dt
        );

        # Gl. 10 (>> 3dt)
        track(:station,
                kieneu[:neg.ns + 160m, :neg.nn - 10m] >> 3dt
           ..   kieneu[:neg.nn +  80m, :neg.nn + 81m] >> 1dt
        );

        # Gl. 11 (>> 4dt)
        with layer = -1 track(:station :removed,
                kieneu[:neg.ns + 50m, :neg.ns + 180m] >> 4dt
        );
        track(:station,
                kieneu[:neg.ns + 180m, :neg.ns + 300m] >> 4dt
        );
        with layer = -1 track(:station :removed,
                kieneu[:neg.ns + 300m, :neg.nn - 30m] >> 4dt
           ..   kieneu[:neg.nn +  80m, :neg.nn + 81m] >> 1dt
        );

        # Gl. 12 (>> 5dt)
        with layer = -1 track(:station :removed,
                kieneu[:neg.ns + 50m, :neg.ns + 230m] >> 5dt
        );
        track(:station,
                kieneu[:neg.ns + 89m, :neg.ns + 90m] >> 1dt
            ..  kieneu[:neg.ns + 230m, :neg.ns + 300m] >> 5dt
        );
        with layer = -1 track(:station :removed,
                kieneu[:neg.ns + 300m, :neg.nn - 160m] >> 5dt
        );
        track(:station,
                kieneu[:neg.nn - 160m, :neg.nn - 60m] >> 5dt
            ..  kieneu[:neg.nn +  80m, :neg.nn + 81m] >> 1dt
        );

        marker(:de.gbf :right, kieneu[:neg] >> 5dt);
        station(:right, kieneu[:neg - .3sw] >> 5dt >> 1.6sh,
            hbox(:left :base,
                span(:medium :bold, "Neustadt "),
                span(:medium, "(Holst) "),
                span(:medium :bold, "Gbf")
            ),
            hbox(:center :base,
                vbox(:right :top,
                    span(:xsmall, "1023: "),
                    span(:xsmall, "1100: ")
                ),
                vbox(:right :top,
                    span(:xsmall, "62,"),
                    span(:xsmall, "29,")
                ),
                vbox(:left :top,
                    span(:xsmall, "02"),
                    span(:xsmall, "07")
                )
            )
        );

        marker(:de.stw :left, kieneu[:neg.ns]);
        slabel(:left, kieneu[:neg.ns - 1dt] << 3dt, "Ns");
        marker(:de.stw :left, kieneu[:neg.nn]);
        slabel(:left, kieneu[:neg.nn - 1dt] << 3dt, "Nn");

        marker(:de.est :removed :bottom, kieneu[:neg.ns + 50m] >> 4.5dt);
    }


    with link = "point.de.Neustadt-Holst" {
        # Streckengl. aus Oldenburg
        with layer = -1 track(:second :station :removed,
                neuhei[:nst.f, :nst.f - 1m]
            ..  kieneu[:fold - 20m] << 0.5dt
            --  kieneu[:fold]
        );

        # Gl. 1 (Hauptgleis)
        track(:first :station, kieneu[:nst.a, :fold + 100m]);
        with layer = -1 track(:first :station :removed,
                kieneu[:fold + 100m, :nst + 120m]
        );
        track(:station :closed, kieneu[:nst + 120m, :nst.f]);

        # Gl. 2 (>> 1dt)
        with layer = -1 track(:station :removed,
                kieneu.nst[:nst.w3 - 300m, :nst.w3] >> 1dt
            ..  kieneu[:fold, :fold + 40m] >> 1dt
        );
        track(:station,
                kieneu[:fold - 1m, :fold]
            --  kieneu[:fold + 40m, :nst + 40m] >> 1dt
        );
        with layer = -1 track(:station:closed,
                kieneu[:nst + 40m, :nst + 75m] >> 1dt
        );
            # W7 - W8
            with layer = -1 track(:station:removed,
                    kieneu[:fold + 40m] >> 1dt
                --  kieneu[:fold + 80m] >> 2dt
            );
            # W10 - W11
            with layer = -1 track(:station :removed,
                    kieneu[:fold + 60m] >> 1dt
                --  kieneu[:fold + 90m]
            );

        # Gl. 3 (>> 2dt)
        track(:station :removed,
                kieneu.nst[:nst.w3 - 300m, :nst.w3] >> 2dt
            ..  kieneu[:fold, :nst + 100m] >> 2dt
        );
            # W14 - W15
            with layer = -1 track(:station:removed,
                    kieneu[:nst.nk] >> 2dt
                --  kieneu[:nst.nk + 30m] >> 3dt
            );
            # W18 - W21
            with layer = -1 track(:station:removed,
                    kieneu[:nst + 29m, :nst + 30m] >> 2dt
                ..  kieneu[:nst + 60m] >> 1.5dt
                --  kieneu[:nst + 75m] >> 1dt
            );
            with layer = -1 track(:station:closed,
                    kieneu[:nst + 75m] >> 1dt
                --  kieneu[:nst + 90m] >> 0.5dt
                ..  kieneu[:nst + 120m, :nst + 121m]
            );

        # Gl. 4 (>> 3dt)
        track(:station :removed,
                kieneu[:fold + 30m] >> 2dt
            --  kieneu[:fold + 45m] >> 2.5dt
            ..  kieneu[:fold + 75m, :nst + 80m] >> 3dt
            ..  kieneu[:nst.x - 1m, :nst.x]
        );

        # Gl. 5 (>> 4dt)
        track(:station :removed,
                kieneu[:nst.nk + 45m] >> 3dt
            --  kieneu[:nst.nk + 60m] >> 3.5dt
            ..  kieneu[:nst.nk + 75m, :nst + 60m] >> 4dt
        );

        marker(:de.stw :removed :left, kieneu[:nst.nk]);
        slabel(:top :removed, kieneu[:nst.nk] << 2.5dt, "Nk");

    marker(:de.hp :left, kieneu[:nst]);
    marker(:de.awanst :left, kieneu[:nst]);
    with layer = -1 marker(:de.bf :gone :left, kieneu[:nst]);
    station(:right, kieneu[:nst] >> 5dt >> 4pt,
        hbox(:left :base,
            span(:medium :bold, "Neustadt "),
            span(:medium, "(Holst) ")
        ),
        hbox(:left :top,
            vbox(:right :top,
                span(:xsmall, "1023: "),
                span(:xsmall :closed, "11001: "),
                span(:xsmall :closed, "11011: ")
            ),
            vbox(:right :top,
                span(:xsmall, "63,"),
                span(:xsmall :closed, "24,"),
                span(:xsmall :closed, "0,")
            ),
            vbox(:right :top,
                span(:xsmall, "31"),
                span(:xsmall :closed, "45"),
                span(:xsmall :closed, "00")
            )
        )
    );

    }
}

