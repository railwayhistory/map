# GB AI.  Aviemore - Forres - Millburn Junction (- Inverness)
#
let ai = path("d4.gb.ai");

with detail = 3 {
    # point.gb.Aviemore: gb.AI

    with link = "line.gb.AI" {
        track(:first :museum,
                path("d4.gb.hl")[:avi + 1sw, :avi + 1.1sw] >> 1dt
            ..  ai[:avi.ffd, :boa - 1sw]
        );
        line_label(:right:w :museum, ai[:avi.ffd + 1.4km], "AI");
    }

    with link = "point.gb.Boat-of-Garten" {
        track(:first:station :museum, ai[:boa - 1sw, :boa + 1sw]);
        track(:first:station :removed,
                ai[:boa - 1sw + 0.9dl, :boa - 1sw + 1dl]
            --  ai[:boa - 1sw + 2dl, :boa + 1sw] >> 1dt
        );
        marker(:left :de.bf :museum, ai[:boa]);
        slabel(:right :museum, ai[:boa - 0.3sw] >> 3.0dt,
            span(:bold, "Boat of Garten")
        );
    }

    with link = "line.gb.AI" {
        track(:first :museum, ai[:boa + 1sw, :bro - 1sw]);
        line_label(:left:se :museum, ai[:boa + 1.5km], "AI");
    }

    with link = "point.gb.Broomhill" {
        track(:first:station :museum, ai[:bro - 1sw, :bro + 1sw]);
        marker(:right :de.bf :museum, ai[:bro]);
        slabel(:right :museum, ai[:bro - 0.1sw] >> 1.8sh, "Broomhill");
    }

    with link = "line.gb.AI" {
        track(:first :museum, ai[:bro + 1sw, :bro.ff]);
        track(:first :removed, ai[:bro.ff, :gra - 1sw]);
    }

    with link = "point.gb.Grantown-on-Spey-West" {
        track(:first:station :removed, ai[:gra - 1sw, :gra + 1sw]);
        marker(:right :de.bf :removed, ai[:gra]);
        slabel(:left :removed, ai[:gra - 0.6sw] << 1.5dt,
            "Grantown-on-Spey West"
        );
    }

    with link = "line.gb.AI" {
        track(:first :removed, ai[:gra + 1sw, :cgr - 1sw]);
    }

    with link = "point.gb.Castle-Grant" {
        track(:first:station :removed, ai[:cgr - 1sw, :cgr + 1sw]);
        marker(:right :de.hp :removed, ai[:cgr] >> 0.2dt);
        slabel(:right :removed, ai[:cgr] + (1.5sh, 1.2sh), "Castle Grant");
    }

    with link = "line.gb.AI" {
        track(:first :removed, ai[:cgr + 1sw, :dav - 1sw]);
        line_badge(:removed, ai[:dav - 4.0km], "AI");
    }

    with link = "point.gb.Dava" {
        track(:first:station :removed, ai[:dav - 1sw, :dav + 1sw]);
        marker(:left :de.hp :removed, ai[:dav]);
        slabel(:left :removed, ai[:dav - 0.3sw] << 1.7sh, "Dava");
    }

    with link = "line.gb.AI" {
        track(:first :removed, ai[:dav + 1sw, :dun - 1sw]);
    }

    with link = "point.gb.Dunphail" {
        track(:first:station :removed, ai[:dun - 1sw, :dun + 1sw]);
        marker(:left :de.bf :removed, ai[:dun]);
        slabel(:left :removed, ai[:dun - 0.3sw] << 1.8sh, "Dunphail");
    }

    with link = "line.gb.AI" {
        track(:first :removed, ai[:dun + 1sw, :raf - 1sw]);
        line_label(:right:w :removed, ai[:raf - 2.2km], "AI");
    }

    with link = "point.gb.Rafford" {
        track(:first:station :removed, ai[:raf - 1sw, :raf + 1sw]);
        marker(:right :de.bf :gone, ai[:raf]);
        slabel(:top :gone, ai[:raf] >> 1.2sh + (1sw, 0dt), "Rafford");
    }

    with link = "line.gb.AI" {
        track(:first :removed, ai[:raf + 1sw, :for - 1sw]);
    }

    with link = "point.gb.Forres" {
        track(:first:station :removed, ai[:for - 1sw, :for.yk]);
        track(:first:station :pax, ai[:for.yk, :for.yk + 0.5sw]);
    }

    with link = "line.gb.AI" {
        track(:first :pax, ai[:for.yk + 0.5sw, :dal - 1sw]);
    }

    with link = "point.gb.Dalvey" {
        track(:first:station :pax, ai[:dal - 1sw, :dal + 1sw]);
        marker(:right :de.bf :gone, ai[:dal]);
        slabel(:left :gone, ai[:dal + 0.2sw] >> 1.4sh, "Dalvey");
    }

    with link = "line.gb.AI" {
        track(:first :pax, ai[:dal + 1sw, :bod - 1sw]);
    }

    with link = "point.gb.Brodie" {
        track(:first:station :pax, ai[:bod - 1sw, :bod + 1sw]);
        marker(:left :de.bf :removed, ai[:bod]);
        slabel(:bottom :removed, ai[:bod] << 1.0sh, "Brodie");
    }

    with link = "line.gb.AI" {
        track(:first :pax, ai[:bod + 1sw, :aul - 1sw]);
        line_badge(:pax, ai[:bod + 2.5km], "AI");
    }

    with link = "point.gb.Auldearn" {
        track(:first:station :pax, ai[:aul - 1sw, :aul + 1sw]);
        marker(:left :de.bf :removed, ai[:aul]);
        slabel(:bottom :removed, ai[:aul] << 1.2sh, "Auldearn");
    }

    with link = "line.gb.AI" {
        track(:first :pax, ai[:aul + 1sw, :nai - 1sw]);
    }

    with link = "point.gb.Nairn" {
        track(:first:station :pax, ai[:nai - 1sw, :nai + 1sw]);
        marker(:right :de.bf :pax, ai[:nai]);
        slabel(:top :pax, ai[:nai + 0.1sh] >> 1.4sh, "Nairn");
    }

    with link = "line.gb.AI" {
        track(:first :pax, ai[:nai + 1sw, :kil - 1sw]);
    }

    with link = "point.gb.Kildrummie" {
        track(:first:station :pax, ai[:kil - 1sw, :kil + 1sw]);
        marker(:right :de.hp :removed, ai[:kil]);
        slabel(:top :removed, ai[:kil] >> 1.2sh + (-2sw, 0dt), "Kildrummie");
    }

    with link = "line.gb.AI" {
        track(:first :pax, ai[:kil + 1sw, :gol - 1sw]);
        line_badge(:pax, ai[:gol - 3.0km], "AI");
    }

    with link = "point.gb.Gollanfield" {
        track(:first:station :pax, ai[:gol - 1sw, :gol + 1sw]);
        marker(:left :de.bf :removed, ai[:gol]);
        slabel(:bottom :removed, ai[:gol] << 1.2sh + (2sw, 0dt),
            span(:bold, "Gollanfield")
        );
    }

    with link = "line.gb.AI" {
        track(:first :pax, ai[:gol + 1sw, :ina - 1sw]);
    }

    with link = "point.gb.Inverness-Airport" {
        track(:first:station :pax, ai[:ina - 1sw, :ina + 1sw]);
        marker(:right :de.bf :pax, ai[:ina]);
        slabel(:left :pax, ai[:ina + 0.5sw] >> 1.4sh, "Inverness Airport");
    }

    with link = "line.gb.AI" {
        track(:first :pax, ai[:ina + 1sw, :dac - 1sw]);
    }

    with link = "point.gb.Dalcross" {
        track(:first:station :pax, ai[:dac - 1sw, :dac + 1sw]);
        track(:first:station :removed,
                ai[:dac - 1sw + 0.9dl, :dac - 1sw + 1dl]
            --  ai[:dac - 1sw + 2dl, :dac + 1sw] >> 1dt
        );
        marker(:left :de.bf :removed, ai[:dac]);
        slabel(:right :removed, ai[:dac + 0.2sw] << 2.1sh, "Dalcross");
    }

    with link = "line.gb.AI" {
        track(:first :pax, ai[:dac + 1sw, :all - 1sw]);
        track(:first :removed, ai[:dac + 1sw, :all - 1sw] >> 1dt);
        line_badge(:pax, ai[:all - 1.5km] >> 0.5dt, "AI");
    }

    with link = "point.gb.Allanfearn" {
        track(:first:station :pax, ai[:all - 1sw, :all + 1sw]);
        track(:first:station :removed, ai[:all - 1sw, :all + 1sw] >> 1dt);
        marker(:left :de.bf :removed, ai[:all]);
        slabel(:left :removed, ai[:all + 0.3sw] >> 2.5dt, "Allanfearn");
    }

    with link = "line.gb.AI" {
        let hl = path("d4.gb.hl");

        track(:first :pax,
                ai[:all + 1sw, :mil.xe]
            ..  ai[:mil.xw, :inv.af] << 1.5dt
            ..  hl[:mil - 2.1dl, :mil - 2dl] << 1.5dt
        );

        track(:first :removed,
                ai[:all + 1sw, :all.xe] >> 1dt
            ..  ai[:all.xw, :all.xw + 0.1dl]
        );
        track(:first :removed,
                ai[:all.xe - 0.1dl, :all.xe]
            ..  ai[:all.xw, :mil.xe] << 1dt
            ..  ai[:mil.xw, :inv.af] << 2.5dt
            ..  hl[:mil - 2.1dl, :mil - 2dl] << 2.5dt
        );
    }

    # point.gb.Millburn-Jn: gb.HL
}

