# GB AI.  Aviemore - Forres - Millburn Junction (- Inverness)
#
let ai = path("d4.gb.ai");

with detail = [4, 5] {
    # point.gb.Aviemore: gb.AI

    with link = "line.gb.AI" {
        track(:first :museum,
                ai[:avi.yf + 500m, :avi.ffd - 1dl] >> 1.5dt
            ..  ai[:avi.ffd + 800m, :boa - 570m]
        );
        line_badge(:museum, ai[:avi.yf + 1800m] >> 1.5dt, "AI");
        line_badge(:museum, ai[:boa - 1700m], "AI");
    }

    with link = "point.gb.Boat-of-Garten" {
        track(:first:station :museum,
                ai[:boa - 570m, :boa + 50m]
            --  ai[:boa + 120m, :boa + 200m] >> 1dt
            --  ai[:boa + 280m, :boa + 350m]
        );
        track(:station :removed, ai[:boa + 50m, :boa + 280m]);
            track(:station :museum,
                    ai[:boa - 445m]
                --  ai[:boa - 350m] >> 1dt
            );

        track(:station :museum, ai[:boa - 520m, :boa + 120m] >> 1dt);
            track(:station :museum,
                    ai[:boa - 260m] >> 1dt
                --  ai[:boa - 200m]
            );

        track(:first:station, ai[:boa - 170m, :boa + 30m] >> 2dt);
        track(:first:station :removed,
                ai[:boa + 30m, :boa + 200m + 0.7dl] >> 2dt
            ..  ai[:boa + 280m + 0.7dl, :boa + 350m] >> 1dt
        );

        track(:station,
                ai[:boa - 211m, :boa - 210m] >> 1dt
            --  ai[:boa - 130m, :boa - 50m] >> 3dt
        );
        track(:station :removed, ai[:boa - 50m, :boa + 110m] >> 3dt);

        track(:station :removed, ai[:boa - 90m, :boa + 70m] >> 4dt);

        track(:station :removed,
                ai[:boa - 131m, :boa - 130m] >> 3dt
            --  ai[:boa - 50m, :boa + 30m] >> 5dt
            --  ai[:boa + 150m, :boa + 151m] >> 2dt
        );

        track(:station,
                ai[:boa - 300m] >> 1dt
            --  ai[:boa - 140m] >> 5dt
        );

        platform(:museum,
                ai[:boa - 170m, :boa + 50m]
            --  ai[:boa + 50m, :boa - 170m] >> 0.7dt
        );
        platform(:museum,
                ai[:boa - 130m, :boa + 50m] >> 1.0dt
            --  ai[:boa + 50m, :boa - 130m] << 2.0dt
        );

        marker(:left :de.bf :museum, ai[:boa] << 0.5dt);
        station(:right :museum, ai[:boa - 0.1sw] >> 6.5dt,
            span(:bold, "Boat of Garten"),
            hbox(:center:top,
                vbox(:right:top, "AI: ", "BGC: "),
                vbox(:right:top, "??", "??")
            )
        );
    }

    with link = "line.gb.AI" {
        track(:first :museum, ai[:boa + 350m, :bro - 270m]);
        line_label(:left:se :museum, ai[:boa + 1.5km], "AI");
    }

    with link = "point.gb.Broomhill" {
        track(:first:station :museum,
                ai[:bro - 270m, :bro + 100m]
            --  ai[:bro + 150m, :bro + 340m] >> 0.5dt
            --  ai[:bro + 390m, :bro + 440m]
        );
        track(:first:station :museum,
                ai[:bro + 99m, :bro + 100m]
            --  ai[:bro + 150m, :bro + 340m] << 0.5dt
            --  ai[:bro + 390m, :bro + 391m]
        );

        track(:station,
                ai[:bro - 210m, :bro - 110m] >> 1.0dt
            --  ai[:bro - 40m, :bro - 30m] >> 1.2dt
        );
            track(:station,
                    ai[:bro - 110m] >> 1.0dt
                --  ai[:bro - 60m]
            );

        platform(:museum,
                ai[:bro - 40m, :bro + 80m]
            --  ai[:bro + 80m, :bro - 40m] << 0.7dt
        );

        marker(:right :de.bf :museum, ai[:bro] >> 1.0dt);
        station(:right :museum, ai[:bro - 0.1sw] >> 1.0dt >> 1.8sh,
            "Broomhill", "??"
        );
    }

    with link = "line.gb.AI" {
        track(:first :museum, ai[:bro + 440m, :bro.ff]);
        track(:first :removed, ai[:bro.ff, :gra - 380m]);
        line_badge(:removed, ai[:gra - 2.0km], "AI");
    }

    with link = "point.gb.Grantown-on-Spey-West" {
        track(:station :removed,
                ai[:gra - 30m, :gra + 150m] << 2.2dt
            --  ai[:gra + 220m, :gra + 221m] << 1dt
        );
        track(:station :removed,
                ai[:gra - 351m, :gra - 350m]
            --  ai[:gra - 250m, :gra + 220m] << 1dt
            --  ai[:gra + 300m, :gra + 301m]
        );
        track(:first:station :removed, ai[:gra - 400m, :gra + 350m]);
            track(:station :removed,
                    ai[:gra + 60m]
                --  ai[:gra + 120m] << 1dt
            );
        track(:station :removed,
                ai[:gra - 325m, :gra - 50m] >> 1dt
        );
        track(:station :removed,
                ai[:gra - 325m, :gra - 70m] >> 2dt
        );
        track(:station :removed,
                ai[:gra - 325m, :gra - 170m] >> 3dt
            --  ai[:gra - 50m, :gra - 49m]
        );

        platform(:removed,
                ai[:gra - 170m, :gra + 120m] << 1.0dt
            --  ai[:gra + 120m, :gra - 170m] >> 1.7dt
        );
        platform(:removed,
                ai[:gra - 50m, :gra + 225m]
            --  ai[:gra + 225m, :gra - 50m] << 0.7dt
        );

        marker(:right :de.bf :removed, ai[:gra] >> 2dt);
        station(:right :removed, ai[:gra - 0.35sw] >> 2dt >> 1.7sh,
            vbox(:left:bottom,
                span(:italic, "  Grantom"),
                span(:italic, " Grantom-on-Spey"),
                "Grantown-on-Spey West"
            ),
            "??"
        );
    }

    with link = "line.gb.AI" {
        track(:first :removed, ai[:gra + 350m, :cgr - 1sw]);
    }

    with link = "point.gb.Castle-Grant" {
        track(:first:station :removed, ai[:cgr - 1sw, :cgr + 1sw]);
        marker(:right :de.hp :removed, ai[:cgr]);
        station(:right :removed, ai[:cgr - 0.45sw] >> 1.6sh,
            "Castle Grant", "??"
        );
    }

    with link = "line.gb.AI" {
        track(:first :removed, ai[:cgr + 1sw, :dav - 1sw]);
        line_badge(:removed, ai[:dav - 4.0km], "AI");
    }

    with link = "point.gb.Dava" {
        track(:first:station :removed, ai[:dav - 1sw, :dav + 1sw]);
        marker(:left :de.hp :removed, ai[:dav]);
        station(:left :removed, ai[:dav - 0.3sw] << 1.5sh,
            "Dava", "??"
        );
    }

    with link = "line.gb.AI" {
        track(:first :removed, ai[:dav + 1sw, :div.a]);
    }

    with link = "struct.gb.Divie-Viaduct" {
        track(:station :removed,
                ai[:div.a - 0.6dt, :div.a - 0.5dt] << 1.2dt
            --  ai[:div.a, :div.f] << 0.7dt
            --  ai[:div.f + 0.5dt, :div.f + 0.6dt] << 1.2dt
        );
        track(:first:station :removed, ai[:div.a, :div.f]);
        track(:station :removed,
                ai[:div.a - 0.6dt, :div.a - 0.5dt] >> 1.2dt
            --  ai[:div.a, :div.f] >> 0.7dt
            --  ai[:div.f + 0.5dt, :div.f + 0.6dt] >> 1.2dt
        );
        slabel(:left :removed, ai[:div.a + 0.1sh] << 2.5dt,
            "Divie Viaduct"
        );
    }

    with link = "line.gb.AI" {
        track(:first :removed, ai[:div.f, :dun - 380m]);
    }

    with link = "point.gb.Dunphail" {
        track(:station :removed,
                ai[:dun + 30m, :dun + 140m] << 3dt
        );
        track(:station :removed,
                ai[:dun + 80m, :dun + 200m] << 2dt
        );
        track(:station :removed,
                ai[:dun - 331m, :dun - 330m]
            ..  ai[:dun - 230m, :dun + 100m] << 1dt
            ..  ai[:dun + 200m, :dun + 201m]
        );
        track(:first:station :removed, ai[:dun - 380m, :dun + 250m]);
            track(:station :removed,
                    ai[:dun + 10m]
                --  ai[:dun + 110m] << 3dt
            );

        platform(:removed,
                ai[:dun - 35m, :dun + 30m] << 1dt
            --  ai[:dun + 30m, :dun - 35m] >> 1.7dt
        );
        platform(:removed,
                ai[:dun - 45m, :dun + 30m]
            --  ai[:dun + 30m, :dun - 45m] << 0.7dt
        );

        marker(:left :de.bf :removed, ai[:dun] << 3dt);
        station(:left :removed, ai[:dun - 0.25sw] << 3dt << 1.6sh,
            "Dunphail", "??"
        );
    }

    with link = "line.gb.AI" {
        track(:first :removed, ai[:dun + 250m, :raf - 1sw]);
        line_badge(:removed, ai[:dun + 3.6km], "AI");
    }

    with link = "point.gb.Rafford" {
        track(:first:station :removed, ai[:raf - 1sw, :raf + 1sw]);
        marker(:right :de.bf :gone, ai[:raf]);
        station(:top :gone, ai[:raf] >> 1.2sh, "Rafford", "??");
    }

    with link = "line.gb.AI" {
        track(:first :removed, ai[:raf + 1sw, :for - 290m]);
        line_badge(:removed, ai[:for - 1.2km], "AI");
    }

    with link = "point.gb.Forres" {
        track(:station :removed,
                ai[:for - 241m, :for - 240m]
            ..  ai[:for - 140m, :for.yk - 100m] << 2dt
            ..  ai[:for.yk, :for.yk + 0.1dl]
        );
        track(:station :removed, ai[:for - 190m, :for.yk - 50m] << 1dt);
        track(:first:station :removed, ai[:for - 290m, :for.yk]);

        platform(:removed,
                ai[:for - 160m, :for + 40m]
            --  ai[:for + 40m, :for - 160m] << 0.7dt
        );
        platform(:removed,
                ai[:for - 140m, :for + 40m] << 1.0dt
            --  ai[:for + 40m, :for - 140m] >> 2.0dt
        );



        track(:first:station :pax, ai[:for.yk, :for.f]);
        track(:first:station :pax,
                ai[:for.yk, :for.f - 150m] >> 1dt
            ..  ai[:for.f - 50m, :for.f - 49m]
        );
    }

    with link = "line.gb.AI" {
        track(:first :pax, ai[:for.f, :fiv.a]);
    }

    with link = "struct.gb.Findhorn-Viaduct" {
        track(:station :pax,
                ai[:fiv.a - 0.6dt, :fiv.a - 0.5dt] << 1.2dt
            --  ai[:fiv.a, :fiv.f] << 0.7dt
            --  ai[:fiv.f + 0.5dt, :fiv.f + 0.6dt] << 1.2dt
        );
        track(:first:station :pax, ai[:fiv.a, :fiv.f]);
        track(:station :pax,
                ai[:fiv.a - 0.6dt, :fiv.a - 0.5dt] >> 1.2dt
            --  ai[:fiv.a, :fiv.f] >> 0.7dt
            --  ai[:fiv.f + 0.5dt, :fiv.f + 0.6dt] >> 1.2dt
        );
        slabel(:left :pax, ai[:fiv.a + 60m] >> 2.0dt,
            "Findhorn Viaduct"
        );
    }

    with link = "line.gb.AI" {
        track(:first :pax, ai[:fiv.f, :dal - 1sw]);
    }

    with link = "point.gb.Dalvey" {
        track(:first:station :pax, ai[:dal - 1sw, :dal + 1sw]);
        marker(:right :de.bf :gone, ai[:dal]);
        station(:left :gone, ai[:dal + 0.2sw] >> 1.3sh,
            "Dalvey", "??"
        );
    }

    with link = "line.gb.AI" {
        track(:first :pax, ai[:dal + 1sw, :bod - 390m]);
    }

    with link = "point.gb.Brodie" {
        track(:station :removed,
                ai[:bod - 201m, :bod - 200m] << 1dt
            --  ai[:bod - 130m, :bod - 20m] << 2dt
        );
        track(:station :removed,
                ai[:bod - 341m, :bod - 340m]
            ..  ai[:bod - 240m, :bod + 200m] << 1dt
            ..  ai[:bod + 300m, :bod + 301m]
        );
        track(:first:station :pax, ai[:bod - 390m, :bod + 350m]);

        platform(:removed,
                ai[:bod - 35m, :bod + 140m] << 1dt
            --  ai[:bod + 140m, :bod - 5m] >> 1.7dt
            --  ai[:bod - 5m, :bod - 35m] >> 1.5dt
        );
        platform(:removed,
                ai[:bod - 180m, :bod + 120m]
            --  ai[:bod + 120m, :bod - 180m] << 0.7dt
        );
        marker(:left :de.bf :removed, ai[:bod] << 2.0dt);
        station(:bottom :removed, ai[:bod] << 2.0dt << 1.2sh,
            "Brodie", "??"
        );
    }

    with link = "line.gb.AI" {
        track(:first :pax, ai[:bod + 350m, :aul - 110m]);
    }

    with link = "point.gb.Auldearn" {
        track(:station :removed,
                ai[:aul + 30m, :aul + 80m] << 2dt
            ..  ai[:aul + 175m] << 1dt -- ai[:aul + 230m]
        );
        track(:station :removed, ai[:aul + 175m, :aul + 260m] << 1dt);
        track(:first:station :pax, ai[:aul - 110m, :aul + 310m]);

        platform(:removed,
                ai[:aul - 50m, :aul + 130m]
            --  ai[:aul + 130m, :aul - 50m] >> 0.7dt
        );

        marker(:left :de.bf :removed, ai[:aul] << 2dt);
        station(:bottom :removed, ai[:aul] << 2dt << 1.2sh,
            "Auldearn", "??"
        );
    }

    with link = "line.gb.AI" {
        track(:first :pax, ai[:aul + 310m, :nai - 600m]);
    }

    with link = "point.gb.Nairn" {
        track(:station :removed,
                ai[:nai + 299m, :nai + 300m] << 2dt
            --  ai[:nai + 350m, :nai + 400m] << 3dt
        );

        track(:station,
                ai[:nai + 49m, :nai + 50m] << 1dt
            ..  ai[:nai + 120m, :nai + 250m] << 2dt
        );
        track(:station :removed, ai[:nai + 250m, :nai + 550m] << 2dt);
            track(:station :removed,
                    ai[:nai + 290m] << 2dt
                --  ai[:nai + 360m] << 1dt
            );
            track(:station :removed,
                    ai[:nai + 440m] << 2dt
                --  ai[:nai + 490m] << 1dt
            );

        track(:station :removed, ai[:nai - 550m, :nai - 190m] << 1dt);
        track(:station :pax,
                ai[:nai - 301m, :nai - 300m]
            ..  ai[:nai - 190m, :nai + 250m] << 1dt
            ..  ai[:nai + 350m, :nai + 351m]
        );
        track(:station :removed, ai[:nai + 250m, :nai + 780m] << 1dt);
            track(:station :removed,
                    ai[:nai + 180m] << 1dt
                --  ai[:nai + 250m] << 2dt
            );

        track(:first:station :pax, ai[:nai - 600m, :nai + 830m]);

        platform(:pax,
                ai[:nai - 120m, :nai + 30m] << 1dt
            --  ai[:nai + 30m, :nai - 120m] >> 1.7dt
        );
        platform(:pax,
                ai[:nai - 100m, :nai + 60m]
            --  ai[:nai + 60m, :nai - 100m] << 0.7dt
        );

        marker(:right :de.bf :pax, ai[:nai] >> 0.5dt);
        station(:top :pax, ai[:nai + 0.1sh] >> 0.5dt >> 1.4sh,
            "Nairn", "128 72"
        );
    }

    with link = "line.gb.AI" {
        track(:first :pax, ai[:nai + 830m, :kil - 1sw]);
    }

    with link = "point.gb.Kildrummie" {
        track(:first:station :pax, ai[:kil - 1sw, :kil + 1sw]);
        marker(:right :de.hp :removed, ai[:kil]);
        station(:top :removed, ai[:kil] >> 1.2sh,
            vbox(:center:bottom, span(:italic, "Cawdor"), "Kildrummie"),
            "??"
        );
    }

    with link = "line.gb.AI" {
        track(:first :pax, ai[:kil + 1sw, :gol - 340m]);
        line_badge(:pax, ai[:gol - 2.4km], "AI");
    }

    with link = "point.gb.Gollanfield" {
        let gf = path("d4.gb.gfg");

        # AI side

        track(:station :removed, ai[:gol - 270m, :gol - 150m] << 2dt);
            track(:station :removed,
                    ai[:gol - 240m] << 2dt
                --  ai[:gol - 180m] << 1dt
            );

        track(:station :removed, ai[:gol - 290m, :gol - 25m] << 1dt);
            track(:station :removed,
                    ai[:gol - 100m] << 1dt
                --  ai[:gol - 30m]
            );

        track(:first:station :pax, ai[:gol - 340m, :gol + 450m]);

        track(:station :removed,
                ai[:gol - 271m, :gol - 270m]
            ..  ai[:gol - 170m, :gol + 300m] >> 1dt
            ..  ai[:gol + 400m, :gol + 401m]
        );
            track(:station :removed,
                    ai[:gol - 110m] >> 1dt
                --  ai[:gol - 60m]
            );

        # GFG side

        track(:first:station :removed, gf[:gol.yf, :gol.yf + 300m]);
        track(:station :removed,
                gf[:gol.yf - 0.1dl, :gol.yf] >> 1dt
            ..  gf[:gol.yf + 250m, :gol.yf + 251m]
        );
        track(:station :removed,
                gf[:gol - 150m, :gol.yf] >> 2dt
            ..  gf[:gol.yf + 250m, :gol.yf + 251m]
        );

        platform(:removed,
                gf[:gol, :gol.yf + 70m]
            --  gf[:gol.yf + 70m, :gol] >> 0.7dt
        );
        platform(:removed,
                gf[:gol, :gol.yf] >> 1dt
            --  gf[:gol.yf, :gol] << 2dt
        );

        marker(:left :de.bf :removed, ai[:gol] << 1.0dt);
        station(:bottom :removed, ai[:gol - 0.5sw] << 1.0dt << 1.4sh,
            vbox(:center:bottom,
                span(:italic, "Fort George"),
                span(:italic, "Gollanfield Jn."),
                span(:bold, "Gollanfield")
            ),
            hbox(:center:top,
                vbox(:right:top, "GFG: ", "AI: "),
                vbox(:right:top, "??", "??")
            )
        );
    }

    with link = "line.gb.AI" {
        track(:first :pax, ai[:gol + 450m, :ina - 650m]);
    }

    with link = "point.gb.Inverness-Airport" {
        track(:station :pax,
                ai[:ina - 601m, :ina - 600m]
            ..  ai[:ina - 500m, :ina + 480m] << 1dt
            ..  ai[:ina + 580m, :ina + 581m]
        );
        track(:first:station :pax, ai[:ina - 650m, :ina + 630m]);

        platform(:pax,
                ai[:ina - 70m, :ina + 70m] << 1dt
            --  ai[:ina + 70m, :ina - 70m] >> 1.7dt
        );
        platform(:pax,
                ai[:ina - 70m, :ina + 70m]
            --  ai[:ina + 70m, :ina - 70m] << 0.7dt
        );

        marker(:right :de.bf :pax, ai[:ina] >> 0.5dt);
        station(:left :pax, ai[:ina + 0.4sw] >> 0.5dt >> 1.2sh,
            "Inverness Airport", "136 43"
        );
    }

    with link = "line.gb.AI" {
        track(:first :pax, ai[:ina + 630m, :dac - 330m]);
    }

    with link = "point.gb.Dalcross" {
        track(:station :removed, ai[:dac - 205m, :dac - 20m] << 1dt);
            track(:station :removed,
                    ai[:dac - 95m] << 1dt
                --  ai[:dac - 25m]
            );
        track(:first:station :pax, ai[:dac - 330m, :dac + 180m]);
        track(:first:station :removed,
                ai[:dac - 281m, :dac - 280m]
            ..  ai[:dac - 180m, :dac + 180m] >> 1dt
        );

        platform(:removed,
                ai[:dac - 10m, :dac + 130m]
            --  ai[:dac + 130m, :dac - 10m] >> 0.7dt
        );
        platform(:removed,
                ai[:dac - 10m, :dac + 130m] >> 1.0dt
            --  ai[:dac + 130m, :dac - 10m] << 1.7dt
        );

        marker(:left :de.bf :removed, ai[:dac] << 1.0dt);
        station(:right :removed, ai[:dac + 0.2sw] << 1.0dt << 1.8sh,
            "Dalcross", "??"
        );
    }

    with link = "line.gb.AI" {
        track(:first :pax, ai[:dac + 180m, :all - 160m]);
        track(:first :removed, ai[:dac + 180m, :all - 160m] >> 1dt);
    }

    with link = "point.gb.Allanfearn" {
        track(:station :removed, ai[:all + 35m, :all + 200m] << 1dt);
            track(:station :removed,
                    ai[:all + 110m] << 1dt
                --  ai[:all + 180m]
            );
        track(:first:station :pax, ai[:all - 160m, :all + 250m]);
        track(:first:station :removed, ai[:all - 160m, :all + 250m] >> 1dt);
            track(:station :removed,
                    ai[:all + 30m] >> 1dt
                --  ai[:all + 80m]
            );

        platform(:removed,
                ai[:all - 110m, :all + 20m]
            --  ai[:all + 20m, :all - 110m] >> 0.7dt
        );
        platform(:removed,
                ai[:all - 110m, :all + 20m] >> 1.0dt
            --  ai[:all + 20m, :all - 110m] << 1.7dt
        );

        marker(:left :de.bf :removed, ai[:all] << 1.0dt);
        station(:right :removed, ai[:all + 0.3sw] << 1.0dt << 1.8sh,
            vbox(:center:bottom,
                span(:italic, "Culloden"),
                "Allanfearn"
            ),
            "??"
        );
    }

    with link = "line.gb.AI" {
        track(:first :pax,
                ai[:all + 250m, :mil.xe]
            ..  ai[:mil.xw, :inv.af] << 1.5dt
        );

        track(:first :removed,
                ai[:all + 250m, :all.xe] >> 1dt
            ..  ai[:all.xw, :all.xw + 0.1dl]
        );
        track(:first :removed,
                ai[:all.xe - 0.1dl, :all.xe]
            ..  ai[:all.xw, :mil.xe] << 1dt
            ..  ai[:mil.xw, :inv.af] << 2.5dt
        );

        line_badge(:pax, ai[:all.xw + 0.7km] << 0.5dt, "AI");
    }

    # point.gb.Millburn-Jn: gb.HL
}

