# GB HL.  Stanley Junction - Inverness (Highland Line)
#
let hl = path("d4.gb.hl");

with detail = [4, 5] {

    with link = "line.gb.HL" {
        track(:first :pax, hl[:sta.yd + 200m, :mur - 220m]);
        line_badge(:pax, hl[:sta.yd + 2km], "HL");
    }

    with link = "point.gb.Murthly" {
        track(:station :removed,
                hl[:mur + 50m, :mur + 140m] << 2dt
            --  hl[:mur + 220m, :mur + 221m]
        );
        track(:station :removed, hl[:mur + 50m, :mur + 180m] << 1dt);
        track(:first:station :pax, hl[:mur - 220m, :mur + 450m]);
        track(:station :removed,
                hl[:mur - 161m, :mur - 160m]
            ..  hl[:mur - 60m, :mur + 270m] >> 1dt
            ..  hl[:mur + 370m, :mur + 371m]
        );
        track(:station :removed,
                hl[:mur + 229m, :mur + 230m] >> 1dt
            ..  hl[:mur + 350m] >> 3dt -- hl[:mur + 380m] >> 6dt
        );

        platform(:removed,
                hl[:mur - 20m, :mur + 135m]
            --  hl[:mur + 135m, :mur + 50m] >> 1dt
            --  hl[:mur + 50m, :mur - 20m] >> 0.7dt
        );
        platform(:removed,
                hl[:mur - 20m, :mur + 135m] >> 1dt
            --  hl[:mur + 135m, :mur - 20m] << 1.7dt
        );

        marker(:left :de.bf :removed, hl[:mur] << 2dt);
        station(:left :removed, hl[:mur - 0.2sw] << 2dt << 1.8sh,
            "Murthly", "??"
        );
    }

    with link = "line.gb.HL" {
        track(:first :pax, hl[:mur + 450m, :kwt.a]);
    }

    with link = "struct.gb.Kingswood-Tunnel" {
        marker(:top :tunnel.r :pax, hl[:kwt.a]);
        marker(:top :tunnel.l :pax, hl[:kwt.a]);
        marker(:bottom :tunnel.r :pax, hl[:kwt.f]);
        marker(:bottom :tunnel.l :pax, hl[:kwt.f]);
        slabel(:left :pax, hl[:kwt.a + 200m] << 1.0dt,
            hbox(:right:top,
                vbox(:center:top,
                    "Kingswood Tunnel",
                    span(:xsmall, "(330 yd)")
                )
            )
        );
    }

    with link = "line.gb.HL" {
        track(:first :pax, hl[:kwt.f, :dun - 400m]);
    }

    with link = "point.gb.Dunkeld-Birnam" {
        track(:first:station :pax,
                hl[:dun - 341m, :dun - 340m]
            ..  hl[:dun - 240m, :dun + 90m] << 1dt
            ..  hl[:dun + 190m, :dun + 191m]
        );
        track(:first:station :pax, hl[:dun - 400m, :dun + 250m]);
        track(:station :removed,
                hl[:dun - 220m, :dun - 30m] >> 1.0dt
        );
        track(:station :removed,
                hl[:dun - 180m, :dun - 60m] >> 2.0dt
        );
        track(:station :removed,
                hl[:dun - 261m, :dun - 260m]
            --  hl[:dun - 140m, :dun - 90m] >> 3.0dt
        );

        platform(:pax,
                hl[:dun - 190m, :dun + 55m] << 1dt
            --  hl[:dun + 55m, :dun - 190m] >> 1.7dt
        );
        platform(:pax,
                hl[:dun - 190m, :dun + 55m]
            --  hl[:dun + 55m, :dun - 190m] << 0.7dt
        );

        marker(:right :de.bf :pax, hl[:dun] >> 3.0dt);
        station(:top :pax, hl[:dun] >> 3.0dt >> 1.5sh,
            "Dunkeld & Birnam", "15 31"
        );
    }

    with link = "line.gb.HL" {
        track(:first :pax, hl[:dun + 250m, :int.a]);
    }

    with link = "struct.gb.Inver-Tunnel" {
        marker(:top :tunnel.r :pax, hl[:int.a]);
        marker(:top :tunnel.l :pax, hl[:int.a]);
        marker(:bottom :tunnel.r :pax, hl[:int.f]);
        marker(:bottom :tunnel.l :pax, hl[:int.f]);
        slabel(:left :pax, hl[:int.a + 200m] << 1.0dt,
            hbox(:right:top,
                vbox(:center:top,
                    "Inver Tunnel",
                    span(:xsmall, "(370 yd)")
                )
            )
        );
    }

    with link = "line.gb.HL" {
        track(:first :pax, hl[:int.f, :dag - 190m]);
    }

    with link = "point.gb.Dalguise" {
        track(:station :removed, hl[:dag - 190m, :dag - 60m] << 2dt);
            track(:station :removed,
                    hl[:dag - 120m] << 2dt
                --  hl[:dag - 60m]
            );
        track(:station :removed, hl[:dag - 170m, :dag - 90m] << 1dt);
        track(:first:station :pax, hl[:dag - 400m, :dag + 310m]);
        track(:station :removed,
                hl[:dag - 331m, :dag - 300m]
            ..  hl[:dag - 240m, :dag + 140m] >> 1dt
            ..  hl[:dag + 240m, :dag + 241m]
        );
            track(:station :removed,
                    hl[:dag - 230m] >> 1dt
                --  hl[:dag - 140m] << 2dt
            );

        platform(:removed,
                hl[:dag - 65m, :dag + 25m]
            --  hl[:dag + 25m, :dag - 65m] >> 0.7dt
        );
        platform(:removed,
                hl[:dag - 65m, :dag + 25m] >> 1.0dt
            --  hl[:dag + 25m, :dag - 65m] << 1.7dt
        );

        marker(:left :de.bf :removed, hl[:dag] << 2dt);
        station(:left :removed, hl[:dag - 0.35sw] << 2dt << 1.5sh,
            "Dalguise", "??"
        );
    }

    with link = "line.gb.HL" {
        track(:first :pax, hl[:dag + 310m, :gua - 320m]);
    }

    with link = "point.gb.Guay" {
        track(:first:station :pax, hl[:gua - 320m, :gua + 110m]);
        track(:station :removed,
                hl[:gua - 250m] -- hl[:gua - 200m] >> 1dt
            ..  hl[:gua - 140m, :gua - 20m] >> 2dt
        );
        track(:station :removed,
                hl[:gua - 200m, :gua - 100m] >> 1dt
            --  hl[:gua - 60m, :gua - 59m] >> 2dt
        );

        platform(:removed,
                hl[:gua - 60m, :gua + 40m]
            --  hl[:gua + 40m, :gua - 60m] << 0.7dt
        );

        marker(:right :de.hp :removed, hl[:gua] >> 2dt);
        station(:right :removed, hl[:gua - 0.3sw] >> 2dt >> 1.3sh,
            "Guay", "??"
        );
    }

    with link = "line.gb.HL" {
        track(:first :pax, hl[:gua + 110m, :bal - 280m]);
        line_badge(:pax, hl[:bal - 2.0km], "HL");
    }

    with link = "point.gb.Ballinluig" {
        track(:station :removed,
                hl[:bal - 280m, :bal - 90m - 0.7dl] << 2dt
        );
        track(:first:station :removed,
                hl[:bal - 181m - 0.7dl, :bal - 180m - 0.7dl]
            --  hl[:bal - 90m - 0.7dl, :bal + 30m - 0.7dl] << 2dt
            ..  path("d4.gb.baf")[:bal.fa, :bal.fa + 0.1dl]
        );
        track(:first:station :removed,
                hl[:bal - 181m, :bal - 180m] >> 1dt
            --  hl[:bal - 90m, :bal + 30m] << 1dt
        );

        track(:first:station :pax, hl[:bal - 370m, :bal + 480m]);
        
        track(:station :removed,
                hl[:bal - 321m, :bal - 320m]
            ..  hl[:bal - 220m, :bal + 330m] >> 1dt
            ..  hl[:bal + 430m, :bal + 431m]
        );
        track(:station :removed, hl[:bal + 45m, :bal + 320m] >> 2dt);
        track(:station :removed,
                hl[:bal + 44m, :bal + 45m] >> 1dt
            ..  hl[:bal + 160m, :bal + 250m] >> 3dt
            ..  hl[:bal + 300m, :bal + 301m] >> 2dt
        );

        platform(:removed,
                hl[:bal - 90m, :bal + 30m]
            --  hl[:bal + 30m, :bal - 90m] >> 1dt
        );
        platform(:removed,
                hl[:bal - 130m, :bal + 30m] >> 1dt
            --  hl[:bal + 30m, :bal - 130m] << 1.7dt
        );

        marker(:right :de.bf :removed, hl[:bal] >> 2.0dt);
        station(:right :removed, hl[:bal - 0.5sw] >> 2.0dt >> 1.3sh,
            span(:bold, "Ballinluig"),
            hbox(:center:top,
                vbox(:right:top, "BAF: ??", "HL: ??")
            )
        );
    }

    with link = "line.gb.HL" {
        track(:first :pax, hl[:bal + 480m, :pit - 250m]);
        line_badge(:pax, hl[:bal + 2.5km], "HL");
    }

    with link = "point.gb.Pitlochry" {
        track(:station :pax,
                hl[:pit - 201m, :pit - 200m]
            ..  hl[:pit - 100m, :pit + 200m] << 1dt
            ..  hl[:pit + 300m, :pit + 301m]
        );
        track(:first:station :pax, hl[:pit - 250m, :pit + 350m]);

        platform(:pax,
                hl[:pit - 70m, :pit + 170m] << 1dt
            --  hl[:pit + 170m, :pit - 70m] >> 1.7dt
        );
        platform(:pax,
                hl[:pit - 70m, :pit + 170m]
            --  hl[:pit + 170m, :pit - 70m] << 0.7dt
        );

        marker(:right :de.bf :pax, hl[:pit] >> 0.5dt);
        station(:top :pax, hl[:pit] >> 0.5dt >> 1.3sh,
            "Pitlochry", "28 22"
        );
    }

    with link = "line.gb.HL" {
        track(:first :pax, hl[:pit + 350m, :kit.a]);
    }

    with link = "struct.gb.Killiecrankie-Tunnel" {
        marker(:top :tunnel.r :pax, hl[:kit.a]);
        marker(:top :tunnel.l :pax, hl[:kit.a]);
        marker(:bottom :tunnel.r :pax, hl[:kit.f]);
        marker(:bottom :tunnel.l :pax, hl[:kit.f]);
        slabel(:right :pax, hl[:kit.a + 50m] >> 2.0dt,
            hbox(:left:base,
                "Killiecrankie Tunnel",
                span(:xsmall, " (240 yd)")
            )
        );
    }

    with link = "line.gb.HL" {
        track(:first :pax, hl[:kit.f, :kil - 190m]);
    }

    with link = "point.gb.Killiecrankie" {
        track(:station :removed,
                hl[:kil - 140m] -- hl[:kil - 20m] << 3.0dt
        );
        track(:station :removed,
                hl[:kil - 100m, :kil + 340m] << 1dt
            ..  hl[:kil + 440m, :kil + 441m]
        );
        track(:first:station :pax, hl[:kil - 190m, :kil + 490m]);

        platform(:removed,
                hl[:kil - 60m, :kil + 130m] << 1.0dt
            --  hl[:kil + 130m, :kil - 60m] >> 1.7dt
        );
        platform(:removed,
                hl[:kil - 60m, :kil + 130m]
            --  hl[:kil + 130m, :kil - 60m] << 0.7dt
        );

        marker(:right :de.bf :removed, hl[:kil] >> 0.5dt);
        station(:top :removed, hl[:kil - 0.1sw] >> 0.5dt >> 1.3sh,
            "  Killiecrankie", "??"
        );
    }

    with link = "line.gb.HL" {
        track(:first :pax, hl[:kil + 490m, :bla - 330m]);
    }

    with link = "point.gb.Blair-Atholl" {
        track(:first:station :pax,
                hl[:bla - 330m, :bla - 280m]
            ..  hl[:bla - 150m, :bla.f] >> 0.5dt
        );
            track(:station,
                    hl[:bla.f - 120m] >> 0.5dt
                --  hl[:bla.f - 50m] << 0.5dt
            );
        track(:first:station :pax,
                hl[:bla - 281m, :bla - 280m]
            ..  hl[:bla - 150m, :bla.f] << 0.5dt
        );

        platform(:pax,
                hl[:bla - 120m, :bla + 110m] << 0.5dt
            --  hl[:bla + 110m, :bla - 120m] >> 1.2dt
        );
        platform(:pax,
                hl[:bla - 110m, :bla + 40m] >> 0.5dt
            --  hl[:bla + 40m, :bla - 120m] << 1.2dt
        );

        marker(:right :de.bf :pax, hl[:bla] >> 1.0dt);
        station(:top :pax, hl[:bla] >> 1.0dt >> 1.2sh,
            vbox(:center:bottom,
                span(:removed :italic, "Blair Athole"),
                "Blair Atholl"
            ),
            "35 09"
        );
    }

    with link = "line.gb.HL" {
        track(:first :double :pax, hl[:bla.f, :bli - 100m]);
    }

    with link = "point.gb.Black-Island" {
        track(:first:station :double :pax, hl[:bli - 100m, :bli + 100m]);

        platform(:removed,
                hl[:bli - 30m, :bli + 30m] << 0.5dt
            --  hl[:bli + 30m, :bli - 30m] >> 1.2dt
        );
        platform(:removed,
                hl[:bli - 30m, :bli + 30m] >> 0.5dt
            --  hl[:bli + 30m, :bli - 30m] << 1.2dt
        );

        marker(:left :de.hp :removed, hl[:bli] << 1.0dt);
        station(:bottom :removed, hl[:bli] << 1.0dt << 1.4sh,
            "Black Island Pl.", "??"
        );
    }

    with link = "line.gb.HL" {
        track(:first :double :pax, hl[:bli + 100m, :str - 100m]);
        line_badge(:pax, hl[:bli + 1.3km], "HL");
    }

    with link = "point.gb.Struan" {
        track(:first:station :double :pax, hl[:str - 100m, :str + 100m]);

        platform(:removed,
                hl[:str - 30m, :str + 30m] << 0.5dt
            --  hl[:str + 30m, :str - 30m] >> 1.2dt
        );
        platform(:removed,
                hl[:str - 30m, :str + 30m] >> 0.5dt
            --  hl[:str + 30m, :str - 30m] << 1.2dt
        );

        marker(:left :de.bf :removed, hl[:str] << 1.0dt);
        station(:bottom :removed, hl[:str] << 1.0dt << 1.2sh,
            "Struan", "??"
        );
    }

    with link = "line.gb.HL" {
        track(:first :double :pax, hl[:str + 100m, :dac - 100m]);
    }

    with link = "point.gb.Dalnacardoch" {
        track(:first:station :double :pax, hl[:dac - 100m, :dac + 100m]);
            track(:station,
                    hl[:dac - 50m] >> 0.5dt
                --  hl[:dac + 50m] << 0.5dt
            );
        marker(:right :de.uest, hl[:dac] >> 0.5dt);
        station(:top, hl[:dac] >> 0.5dt >> 1.2sh, "Dalnacardoch", "44 76");
    }

    with link = "line.gb.HL" {
        track(:first :double :pax, hl[:dac + 100m, :das - 100m]);
        line_badge(:pax, hl[:das - 5.7km], "HL");
    }

    with link = "point.gb.Dalnaspidal" {
        track(:first:station :double :pax, hl[:das - 100m, :das + 100m]);

        platform(:removed,
                hl[:das - 30m, :das + 30m] << 0.5dt
            --  hl[:das + 30m, :das - 30m] >> 1.2dt
        );
        platform(:removed,
                hl[:das - 30m, :das + 30m] >> 0.5dt
            --  hl[:das + 30m, :das - 30m] << 1.2dt
        );

        marker(:right :de.bf :removed, hl[:das] >> 1.0dt);
        station(:right :removed, hl[:das - 0.4sw] >> 1.0dt >> 1.4sh,
            "Dalnaspidal", "??"
        );
    }

    with link = "line.gb.HL" {
        track(:first :double :pax, hl[:das + 100m, :dal - 150m]);
    }

    with link = "point.gb.Dalwhinnie" {
        track(:first:station :pax,
                hl[:dal - 150m, :dal + 430m] << 0.5dt
            ..  hl[:dal + 650m, :dal + 700m]
        );
        track(:first:station :pax,
                hl[:dal - 150m, :dal + 280m] >> 0.5dt
            ..  hl[:dal + 430m, :dal + 431m] << 0.5dt
        );
        track(:station,
                hl[:dal + 75m, :dal + 280m] >> 1.5dt
            ..  hl[:dal + 430m, :dal + 650m] >> 1dt
        );
        track(:station,
                hl[:dal + 64m, :dal+ 65m] >> 0.5dt
            --  hl[:dal + 220m, :dal + 280m] >> 2.5dt
            ..  hl[:dal + 430m, :dal + 650m] >> 2dt
        );

        platform(:pax,
                hl[:dal - 40m, :dal + 155m] << 0.5dt
            --  hl[:dal + 155m, :dal - 40m] >> 1.2dt
        );
        platform(:pax,
                hl[:dal - 55m, :dal + 60m] >> 0.5dt
            --  hl[:dal + 60m, :dal - 55m] << 1.2dt
        );

        marker(:right :de.bf :pax, hl[:dal] >> 1.5dt);
        station(:right :pax, hl[:dal - 0.4sw] >> 1.5dt >> 1.5sh,
            "Dalwhinnie", "58 47"
        );
    }

    with link = "line.gb.HL" {
        track(:first :pax, hl[:dal + 700m, :new - 210m]);
        line_badge(:pax, hl[:dal + 6.0km], "HL");
    }

    with link = "point.gb.Newtonmore" {
        track(:station :removed,
                hl[:new + 210m, :new + 240m] << 3.0dt
            --  hl[:new + 360m, :new + 361m]
        );
        track(:station :removed,
                hl[:new + 80m, :new + 220m] << 2.0dt
            --  hl[:new + 260m, :new + 261m] << 1.0dt
        );
            track(:station :removed,
                    hl[:new + 130m] << 2.0dt
                --  hl[:new + 170m] << 1.0dt
            );
        track(:station :removed, hl[:new + 85m, :new + 320m] << 1.0dt);
        track(:first:station :pax, hl[:new - 210m, :new + 490m]);
        track(:station :removed,
                hl[:new - 161m, :new - 160m]
            ..  hl[:new - 60m, :new + 340m] >> 1dt
            ..  hl[:new + 440m, :new + 441m]
        );

        platform(:removed,
                hl[:new - 80m, :new + 10m]
            --  hl[:new + 10m, :new - 80m] >> 0.7dt
        );
        platform(:pax,
                hl[:new + 10m, :new + 130m]
            --  hl[:new + 130m, :new + 10m] >> 0.7dt
        );
        platform(:removed,
                hl[:new - 80m, :new + 80m] >> 1dt
            --  hl[:new + 80m, :new - 80m] << 1.7dt
        );

        marker(:left :de.hp :pax, hl[:new] << 2.0dt);
        marker(:left :de.exbf :pax, hl[:new] << 2.0dt);
        station(:left :pax, hl[:new - 0.3sw] << 3.0dt << 1.2sh,
            "Newtonmore", "68 62"
        );
    }

    with link = "line.gb.HL" {
        track(:first :pax, hl[:new + 490m, :kin - 460m]);
    }

    with link = "point.gb.Kingussie" {
        let kin = path("d4.gb.hl.kin");

        track(:station :removed,
                kin[:b - 0.1dl, :b]
            ..  kin[:c, :f] << 1dt
        );
        track(:station :removed,
                hl[:kin.yd - 0.1dl, :kin.yd]
            ..  kin[:a, :f]
        );
        track(:first:station :pax, hl[:kin - 460m, :kin + 300m]);
        track(:station :pax,
                hl[:kin - 411m, :kin - 410m]
            ..  hl[:kin - 310m, :kin + 150m] >> 1dt
            ..  hl[:kin + 250m, :kin + 251m]
        );
            track(:station,
                    hl[:kin - 280m] >> 1dt
                --  hl[:kin - 220m] >> 2.2dt
            );
        track(:station,
                hl[:kin - 285m, :kin - 20m] >> 2.2dt
        );
        track(:station,
                hl[:kin - 175m, :kin - 80m] >> 3.2dt
        );
        track(:station,
                hl[:kin - 206m, :kin - 205m] >> 2.2dt
            --  hl[:kin - 145m, :kin - 80m] >> 4.2dt
        );

        platform(:pax,
                hl[:kin - 200m, :kin + 50m]
            --  hl[:kin + 50m, :kin - 200m] >> 0.7dt
        );
        platform(:pax,
                hl[:kin - 200m, :kin + 50m] >> 1.0dt
            --  hl[:kin + 50m, :kin - 200m] << 1.7dt
        );

        marker(:left :de.bf :pax, hl[:kin] << 0.5dt);
        station(:top :pax, kin[:f] << 1.5dt,
            "Kingussie", "71 43"
        );
    }

    with link = "line.gb.HL" {
        track(:first :pax, hl[:kin + 300m, :kic - 290m]);
    }

    with link = "point.gb.Kincraig" {
        track(:station :removed,
                hl[:kic + 20m, :kic + 240m] << 1dt
        );
            track(:station :removed,
                    hl[:kic + 90m] << 1dt
                --  hl[:kic + 230m]
            );
        track(:first:station :pax, hl[:kic - 290m, :kic + 490m]);
        track(:station,
                hl[:kic - 241m, :kic - 240m]
            ..  hl[:kic - 140m, :kic + 340m] >> 1dt
            ..  hl[:kic + 440m, :kic + 441m]
        );
            track(:station :removed,
                    hl[:kic] >> 1dt
                --  hl[:kic + 70m] << 1dt
            );

        platform(:removed,
                hl[:kic - 120m, :kic + 20m]
            --  hl[:kic + 20m, :kic - 120m] >> 0.7dt
        );
        platform(:removed,
                hl[:kic - 50m, :kic + 130m] >> 1.0dt
            --  hl[:kic + 130m, :kic - 50m] << 1.7dt
        );

        marker(:left :de.bbf, hl[:kic] << 1.0dt);
        marker(:left :de.exbf, hl[:kic] << 1.0dt);
        station(:left, hl[:kic - 0.4sw] << 2.0dt << 1.3sh,
            "Kincraig", "??"
        );
    }

    with link = "line.gb.HL" {
        track(:first :pax, hl[:kic + 490m, :avi.a]);
        line_badge(:pax, hl[:avi.a - 2.8km], "HL");
    }

    with link = "point.gb.Aviemore" {
        let ai = path("d4.gb.ai");

        track(:station,
                hl[:avi.yf - 31m, :avi.yf - 30m] << 0.5dt
            --  hl[:avi.yf + 40m, :avi.yf + 200m] << 1.5dt
        );
        track(:first:station :pax,
                hl[:avi.a, :avi - 420m]
            ..  hl[:avi - 320m, :avi + 640m] << 0.5dt
            ..  hl[:avi + 740m, :avi.fi]
        );
        track(:first:station :pax,
                hl[:avi - 421m, :avi - 420m]
            ..  hl[:avi - 320m, :avi + 640m] >> 0.5dt
            ..  hl[:avi + 740m, :avi + 741m]
        );
        track(:first:station :museum,
                hl[:avi - 286m, :avi - 285m] >> 0.5dt
            ..  hl[:avi - 185m, :avi.yf] >> 1.5dt
            ..  ai[:avi.yf + 100m, :avi.yf + 500m] >> 1.5dt
        );
        track(:station,
                hl[:avi - 31m, :avi - 30m] >> 1.5dt
            ..  hl[:avi + 30m, :avi + 160m] >> 2.5dt
            ..  hl[:avi + 240m, :avi + 241m] >> 1.5dt
        );
            track(:station,
                    ai[:avi.yf + 260m] >> 1.5dt
                --  ai[:avi.yf + 320m] >> 2.5dt
            );
        track(:station,
                hl[:avi.yf - 120m, :avi.yf] >> 2.5dt
            ..  ai[:avi.yf + 100m, :avi.yf + 450m] >> 2.5dt
        );
        track(:station,
                ai[:avi.yf + 140m, :avi.yf + 240m] >> 3.5dt
        );
        track(:station,
                ai[:avi.yf + 99m, :avi.yf + 100m] >> 2.5dt
            --  ai[:avi.yf + 180m, :avi.yf + 240m] >> 4.5dt
        );
        track(:station,
                ai[:avi.yf + 59m - 0.7dl, :avi.yf + 60m - 0.7dl] >> 2.5dt
            --  ai[:avi.yf + 180m - 0.7dl, :avi.yf + 240m] >> 5.5dt
        );

        platform(:pax,
                hl[:avi - 90m, :avi + 200m] << 0.5dt
            --  hl[:avi + 200m, :avi - 90m] >> 1.2dt
        );
        platform(:pax,
                hl[:avi - 100m, :avi + 205m] >> 0.5dt
            --  hl[:avi + 205m, :avi - 100m] << 1.0dt
        );
        platform(:museum,
                hl[:avi - 70m, :avi + 205m] >> 1.5dt
            --  hl[:avi + 205m, :avi - 70m] << 1.0dt
        );

        marker(:left :de.bf :pax, hl[:avi] << 1.0dt);
        station(:left :pax, hl[:avi - 0.3sw] << 1.0dt << 1.5sh,
            span(:bold, "Aviemore"),
            hbox(:center:top,
                vbox(:right:top, "HL: ", "AI: "),
                vbox(:right:top, "83 ", "83 "),
                vbox(:left:top, "31", "31")
            )
        );
    }

    with link = "line.gb.HL" {
        track(:first :pax, hl[:avi.fi, :car - 440m]);
        line_badge(:pax, hl[:avi.fi + 1.3km], "HL");
    }

    with link = "point.gb.Carrbridge" {
        track(:station :pax,
                hl[:car - 391m, :car - 390m]
            ..  hl[:car - 290m, :car + 140m] << 1dt
            ..  hl[:car + 240m, :car + 241m]
        );
        track(:first:station :pax, hl[:car - 440m, :car + 290m]);

        platform(:pax,
                hl[:car - 150m, :car + 110m]
            --  hl[:car + 110m, :car - 150m] << 0.7dt
        );
        platform(:pax,
                hl[:car - 150m, :car + 110m] << 1.0dt
            --  hl[:car + 110m, :car - 150m] >> 1.7dt
        );

        marker(:right :de.bf :pax, hl[:car] >> 0.5dt);
        station(:right :pax, hl[:car - 0.4sw] >> 0.5dt >> 1.0sh,
            vbox(:center:bottom,
                span(:removed :italic, "Carr Bridge"),
                "Carrbridge"
            ),
            "90 00"
        );
    }

    with link = "line.gb.HL" {
        track(:first :pax, hl[:car + 290m, :slo - 460m]);
        line_badge(:pax, hl[:slo - 3.5km], "HL");
    }

    with link = "point.gb.Slochd" {
        track(:station :pax,
                hl[:slo - 411m, :slo - 410m]
            ..  hl[:slo - 310m, :slo + 130m] << 1dt
            ..  hl[:slo + 230m, :slo + 231m]
        );
        track(:first:station :pax, hl[:slo - 460m, :slo + 280m]);
        marker(:left :de.bbf, hl[:slo] << 1dt);
        station(:left, hl[:slo - 0.2sw] << 1dt << 1.8sh, "Slochd", "??");
    }

    with link = "line.gb.HL" {
        track(:first :pax, hl[:slo + 280m, :tom - 480m]);
    }

    with link = "point.gb.Tomatin" {
        track(:first:station :pax, hl[:tom - 480m, :tom + 260m]);
        track(:station,
                hl[:tom - 431m, :tom - 430m]
            ..  hl[:tom - 330m, :tom + 110m] >> 1dt
            ..  hl[:tom + 210m, :tom + 211m]
        );
        track(:station :removed, hl[:tom - 260m, :tom - 50m] >> 2dt);
        track(:station :removed, hl[:tom - 190m, :tom - 50m] >> 3dt);
        track(:station,
                hl[:tom - 331m, :tom - 330m] >> 1dt
            --  hl[:tom - 120m, :tom - 50m] >> 4dt
        );

        platform(:removed,
                hl[:tom - 50m, :tom + 50m] >> 1dt
            --  hl[:tom + 50m, :tom - 50m] << 1.7dt
        );
        platform(:removed,
                hl[:tom - 50m, :tom + 50m]
            --  hl[:tom + 50m, :tom - 50m] >> 0.7dt
        );

        marker(:right :de.bbf, hl[:tom] >> 4dt);
        marker(:right :de.exbf, hl[:tom] >> 4dt);
        station(:top, hl[:tom - 0.2sw] >> 4dt >> 1.6sh,
            "Tomatin", "??"
        );
    }

    with link = "line.gb.HL" {
        track(:first :pax, hl[:tom + 260m, :moy - 490m]);
    }

    with link = "point.gb.Moy" {
        track(:first:station :pax, hl[:moy - 490m, :moy + 280m]);
        track(:station :pax,
                hl[:moy - 441m, :moy - 440m]
            ..  hl[:moy - 340m, :moy + 130m] >> 1dt
            ..  hl[:moy + 230m, :moy + 231m]
        );

        platform(:removed,
                hl[:moy - 60m, :moy + 60m] >> 1dt
            --  hl[:moy + 60m, :moy - 60m] << 1.7dt
        );
        platform(:removed,
                hl[:moy - 60m, :moy + 60m]
            --  hl[:moy + 60m, :moy - 60m] >> 0.7dt
        );

        marker(:right :de.bbf, hl[:moy] >> 1.5dt);
        marker(:right :de.exbf, hl[:moy] >> 1.5dt);
        station(:top, hl[:moy - 0.1sw] >> 1.5dt >> 1.6sh, "Moy", "??");
    }

    with link = "line.gb.HL" {
        track(:first :pax, hl[:moy + 280m, :dav - 370m]);
        line_badge(:pax, hl[:moy + 3.8km], "HL");
    }

    with link = "point.gb.Daviot" {
        track(:station :removed,
                hl[:dav - 210m, :dav - 170m] << 2.8dt
            --  hl[:dav - 140m, :dav - 139m] << 1.8dt
        );
        track(:station :removed,
                hl[:dav - 270m, :dav - 60m] << 1.8dt
        );
            track(:station :removed,
                    hl[:dav - 130m] << 1.8dt
                --  hl[:dav - 60m] << 0.5dt
            );
        track(:first:station :removed,
                hl[:dav - 321m, :dav - 320m]
            ..  hl[:dav - 220m, :dav + 70m] << 0.5dt
        );
        track(:first:station :pax,
                hl[:dav - 370m, :dav - 320m]
            ..  hl[:dav - 220m, :dav + 70m] >> 0.5dt
        );
            track(:station :removed,
                    hl[:dav - 150m] >> 0.5dt
                --  hl[:dav - 90m] << 0.5dt
            );

        platform(:removed,
                hl[:dav - 60m, :dav + 20m] >> 0.5dt
            --  hl[:dav + 20m, :dav - 60m] << 1.2dt
        );
        platform(:removed,
                hl[:dav - 60m, :dav + 20m] << 0.5dt
            --  hl[:dav + 20m, :dav - 60m] >> 1.2dt
        );

        marker(:left :de.bf :removed, hl[:dav] << 1.8dt);
        station(:left :removed, hl[:dav - 0.2sw] << 1.8dt << 1.6sh,
            "Daviot", "??"
        );
    }

    with link = "line.gb.HL" {
        track(:first :removed, hl[:dav + 70m, :ban.xn] << 0.5dt);
        track(:first :pax,
                hl[:dav + 70m, :ban.xs] >> 0.5dt
            ..  hl[:ban.xn, :cul - 450m] << 0.5dt
        );
        track(:first :removed, hl[:ban.xs, :cul - 450m] >> 0.5dt);
    }

    with link = "point.gb.Culloden-Moor" {
        track(:first:station :pax, hl[:cul - 450m, :cul + 125m] << 0.5dt);

        track(:first:station :pax,
                hl[:cul - 171m, :cul - 170m] << 0.5dt
            --  hl[:cul - 30m, :cul + 125m] >> 0.5dt
        );

        track(:station,
                hl[:cul - 400m, :cul - 270m] >> 0.5dt
            ..  hl[:cul - 30m, :cul] >> 1.5dt
            --  hl[:cul + 50m, :cul + 51m] >> 0.5dt
        );
            track(:station,
                    hl[:cul - 340m] >> 0.5dt
                --  hl[:cul - 270m] << 0.5dt
            );

        track(:station,
                hl[:cul - 40m] >> 1.5dt
            --  hl[:cul + 20m] >> 2.5dt
        );

        marker(:right :de.bbf, hl[:cul] >> 2.5dt);
        marker(:right :de.exbf, hl[:cul] >> 2.5dt);
        label(hl[:cul + 0.15sw] >> 3.5dt >> 1.4sh,
            vbox(:left:middle,
                span(:medium :removed :italic, "Culloden Moor"),
                vbox(:center:top,
                    span(:medium, "Culloden"),
                    span(:xsmall, "111 30")
                )
            )
        );
    }

    with link = "line.gb.HL" {
        track(:first :double :pax, hl[:cul + 125m, :cra - 150m]);
        line_badge(:pax, hl[:cra - 1400m], "HL");
    }

    with link = "point.gb.Cradlehall" {
        with layer = 2 {
            track(:first:station :double :pax, hl[:cra - 150m, :cra + 150m]);
                track(:station,
                        hl[:cra - 100m] << 0.5dt
                    --  hl[:cra - 15m] >> 0.5dt
                );
                track(:station,
                        hl[:cra + 15m] >> 0.5dt
                    --  hl[:cra + 100m] << 0.5dt
                );
            marker(:right :de.uest, hl[:cra] >> 0.5dt);
        }
        with layer = 1 marker(:right :de.uest.casing, hl[:cra] >> 0.5dt);
        station(:right, hl[:cra] + (1.3sw, -0.2sw),
            "Cradlehall", "116 44"
        );
    }

    with link = "line.gb.HL" {
        with layer = 2 track(:first :double :pax, hl[:cra + 150m, :inv.ap]);
        with layer = 1 casing(:first :double :pax,
                hl[:cra + 160m, :inv.ap - 20m]
        );
    }

    with link = "point.gb.Millburn-Jn" {
        marker(:left :statdt, hl[:mil] << 0.5dt);
        marker(:left :de.abzw, hl[:mil] << 1.5dt);

        station(:bottom, hl[:mil] << 1.5dt << 1.2sh + (1.5sw, 0dt),
            span(:bold, "Millburn Jn"),
            hbox(:center:top,
                vbox(:right:top, "HL: ", "AI: "),
                vbox(:right:top, "117 ", "143 "),
                vbox(:left:top, "37", "39")
            )
        );
    }

    with link = "point.gb.Welshs-Bridge" {
        marker(:right :de.abzw, hl[:wel] >> 0.5dt);
        label(hl[:wel] + (-1.5sw, -1.4sh),
            vbox(:left:bottom,
                span(:medium, "Welsh's Bridge Jn"),
                hbox(:center:middle :xsmall,
                    vbox(:right:top, "  RSW: ", "HL: "),
                    vbox(:right:top, "117 56", "117 56")
                )
            )
        );
    }

    with link = "point.gb.Rose-Street-Jn" {
        let iw = path("d4.gb.wck");
        marker(:right :de.abzw, iw[:ros + 3dt]);
        guide(:open,
            iw[:ros + 3dt] >> 1.2sw -- iw[:ros + 3dt] + (0.2km, -1.0km)
        );
        label(iw[:ros + 3dt] + (0dt, -1.05km),
            vbox(:left:bottom,
                span(:medium, "Rose Street Jn"),
                hbox(:center:middle :xsmall,
                    vbox(:right:top, "  RSW: ", "WCK: "),
                    vbox(:right:top, "118 ", "0 "),
                    vbox(:left:top, "56", "01")
                )
            )
        );
    }

    with link = "point.gb.Inverness" {
        let wk = path("d4.gb.wck");
        let ai = path("d4.gb.ai");

        # Down North
        track(:first:station :pax,
                wk[:inv.aw - 49m, :inv.aw - 50m]
            ..  wk[:inv.aw - 130m, :ros + 3dt] >> 1dt
            ..  wk[:inv.yw, :inv.yw - 0.1dl] >> 5.5dt
        );

        # Platform 6
        track(:first:station :pax,
                wk[:ros + 3.1dt, :ros + 3dt]
            ..  wk[:inv.yw, :inv] >> 4.5dt
        );


        # Up North
        track(:first:station :pax,
                wk[:inv.aw, :ros + 3dt]
            ..  wk[:inv.yw, :inv] >> 3.5dt
        );
            track(:station,
                    wk[:ros + 3dt]
                --  wk[:ros + 3dt + 60m] << 1dt
            );

        # Ross-shire sdg
        track(:station,
                hl[:inv - 221m, :inv - 220m] >> 1.5dt
            ..  hl[:inv - 160m, :inv] >> 2.5dt
        );
            track(:station,
                    hl[:inv - 161m, :inv - 160m] >> 2.5dt
                ..  hl[:inv - 80m, :inv.yw] >> 3.5dt
            );

        # Platform 4
        track(:station :pax,
                hl[:wel + 109m, :wel + 110m] >> 0.5dt
            ..  hl[:inv - 220m, :inv] >> 1.5dt
        );

        # Up Line
        track(:first:station :pax, hl[:inv.ap, :inv] >> 0.5dt);

        # Down Line
        track(:first:station :pax, hl[:inv.ap, :inv] << 0.5dt);
            track(:station,
                    hl[:wel - 100m] << 0.5dt
                --  hl[:wel - 30m] << 1.5dt
            );

        # East Line
        track(:first:station :pax,
                ai[:inv.af, :inv.af + 0.1dl] << 1.5dt
            ..  hl[:mil.y, :mil - 100m] << 1.5dt
            --  hl[:mil + 30m, :mil + 31m] << 0.5dt
        );
        track(:first:station :removed,
                ai[:inv.af, :inv.af + 0.1dl] << 2.5dt
            ..  hl[:mil.y, :mil - 230m] << 2.5dt
            --  hl[:mil - 100m, :mil - 99m] << 1.5dt
        );

        # Platform 1
        track(:station :pax,
                hl[:wel + 59m, :wel + 60m] << 0.5dt
            ..  hl[:wel + 180m, :inv] << 1.5dt
        );

        # Sdg
        track(:station,
                hl[:wel - 220m, :wel - 30m] << 1.5dt
            ..  hl[:wel + 180m, :inv - 75m] << 2.5dt
        );


        # Platform 1/2
        platform(:pax,
                hl[:wel + 180m, :inv] << 0.5dt
            --  hl[:inv, :wel + 180m] >> 1.5dt
        );

        # Platform 3/4
        platform(:pax,
                hl[:inv - 180m, :inv] >> 0.5dt
            --  hl[:inv, :inv - 180m] << 1.5dt
        );

        # Platform 5/6
        platform(:pax,
                hl[:inv.yw, :inv] >> 3.5dt
            --  hl[:inv, :inv.yw] << 4.5dt
        );

        marker(:top :de.bf :pax, hl[:inv] >> 2dt);
        station(:left :pax, hl[:inv] + (-0.5sw, 1.9sh),
            span(:large :bold, "Inverness"),
            hbox(:center:top,
                vbox(:right:top, "WCK: ", "HL: "),
                vbox(:right:top, "0 ", "118 "),
                vbox(:left:top, "02", "03")
            )
        );
    }
}

