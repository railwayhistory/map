# DK KFX.  Køge - Faxe
#
let kf = path("d3.dk.kfx");

with detail = 4,
     railway = :first :pax
{
    # point.dk.Køge  dk.RKN
 
    with link = "line.dk.KFX" {
        track(:ror,
                kf[:kog.yf - 0.1dl, :kog.yf] << 1mo
            ..  kf[:kog.xf + 2mo, :kog.xf + 2.01mo]
        );
        track(kf[:kog.xf + 2mo, :kog.xf + 1.3km]);
        line_label(:left:w, kf[:kog.xf + 1.3km] << 0.5mt, "KFX");
        track(kf[:kog.xf + 1.3km, :ego - 0.5sw]);
    }

    with link = "point.dk.Egøje", railway = :station {
        track(kf[:ego - 0.5sw, :ego + 0.5sw]);
        marker(:right :de.bf, kf[:ego] >> 0.5mt);
        station(:right:left_align, kf[:ego] << 2.5mt + (0dt, 1dt),
            "Egøje", " KFX: 3,2"
        );
    }

    with link = "line.dk.KFX" {
        track(kf[:ego + 0.5sw, :val - 0.5sw]);
    }

    with link = "point.dk.Vallø", railway = :station {
        track(kf[:val - 0.5sw, :val + 0.5sw]);
        marker(:left :de.bf, kf[:val] << 0.5mt);
        station(:right:left_align, kf[:val] << 0.5mt << 1.5sh + (0dt, 1.2dt),
            "Vallø", "KFX: 5,9"
        );
    }

    with link = "line.dk.KFX" {
        track(kf[:val + 0.5sw, :gru - 0.5sw]);
    }

    with link = "point.dk.Grubberholm", railway = :station {
        track(kf[:gru - 0.5sw, :gru + 0.5sw]);
        marker(:left :de.bf, kf[:gru] << 0.5mt);
        station(:right, kf[:gru] << 0.5mt << 1.5sh + (0dt, 1.1dt),
            "Grubberholm", "KFX: 8,2"
        );
    }

    with link = "line.dk.KFX" {
        track(kf[:gru + 0.5sw, :him - 0.5sw]);
    }

    with link = "point.dk.Himlingøje", railway = :station {
        track(kf[:him - 0.5sw, :him + 0.5sw]);
        marker(:left :de.hp, kf[:him] << 0.5mt);
        station(:right, kf[:him] << 0.5mt << 1.7sh + (0dt, 1.7dt),
            "Himlingøje", "KFX: 10,2"
        );
    }

    with link = "line.dk.KFX" {
        track(kf[:him + 0.5sw, :him + 1km]);
        line_label(:right:e, kf[:him + 1km] >> 0.5mt, "KFX");
        track(kf[:him + 1km, :har.yr - 100m]);
    }

    with link = "point.dk.Hårlev", railway = :station {
        track(kf[:har.yr - 100m, :har + 230m]);
        track(
                kf[:har.yr, :har + 180m - 1dl] << 1mo
            --  kf[:har + 180m, :har + 181m]
        );
        marker(:left :de.bf, kf[:har] << 0.5mt);
        station(:right:left_align,
            kf[:har] << 1mo << 0.5mt << 1.2sh + (0dt, 1dt),
            span(:bold, "Hårlev"),
            hbox(:center:top,
                vbox(:right:top, "KFX: ", "[HLR: "),
                vbox(:sep:top,
                    hbox(:sep:base, "12,", anchor(), "1"),
                    hbox(:sep:base, "−0,", anchor(), "120]")
                )
            )
        );
    }

    with link = "line.dk.KFX" {
        track(kf[:har + 0.6sw + 2dl, :lli - 0.5sw]);
    }

    with link = "point.dk.Lille-Linde", railway = :station {
        track(kf[:lli - 0.5sw, :lli + 0.5sw]);
        marker(:left :de.hp, kf[:lli] << 0.5mt);
        station(:right, kf[:lli] << 0.5mt << 1.5sh + (0dt, 1.2dt),
            "Lille Linde", "KFX: 13,8"
        );
    }

    with link = "line.dk.KFX" {
        track(kf[:lli + 0.5sw, :sli - 0.5sw]);
    }

    with link = "point.dk.Store-Linde", railway = :station {
        track(kf[:sli - 0.5sw, :sli + 0.5sw]);
        marker(:right :de.hp :removed, kf[:sli] >> 0.5mt);
        station(:left :removed, kf[:sli] >> 0.5mt >> 1.5sh + (0dt, 1.4dt),
            "Store Linde", "KFX: ??"
        );
    }

    with link = "line.dk.KFX" {
        track(kf[:sli + 0.5sw, :sli + 1.2km]);
        line_label(:left:w, kf[:sli + 1.2km] << 0.5mt, "KFX");
        track(kf[:sli + 1.2km, :kar - 0.5sw]);
    }

    with link = "point.dk.Karise", railway = :station {
        track(kf[:kar - 0.5sw, :kar + 0.5sw]);
        marker(:left :de.bf, kf[:kar] << 0.5mt);
        station(:right, kf[:kar] << 0.5mt << 1.7sh + (0dt, 1dt),
            "Karise", "KFX: 17,5"
        );
    }

    with link = "line.dk.KFX" {
        track(kf[:kar + 0.5sw, :gan - 0.5sw]);
    }

    with link = "point.dk.Ganneskov", railway = :station {
        track(kf[:gan - 0.5sw, :gan + 0.5sw]);
        marker(:left :de.hp :removed, kf[:gan] << 0.5mt);
        station(:right :removed, kf[:gan] << 0.5mt << 1.5sh + (0dt, 1.5dt),
            "Ganneskov", "KFX: ??"
        );
    }

    with link = "line.dk.KFX" {
        track(kf[:gan + 0.5sw, :tok - 0.5sw]);
    }

    with link = "point.dk.Tokkerup", railway = :station {
        track(kf[:tok - 0.5sw, :tok + 0.5sw]);
        marker(:right :de.hp, kf[:tok] >> 0.5mt);
        marker(:right :de.exbf, kf[:tok] >> 0.5mt);
        station(:left, kf[:tok] >> 0.5mt >> 1.9sh + (0dt, 1dt),
            "Tokkerup", "KFX: 21,9"
        );
    }

    with link = "line.dk.KFX" {
        track(kf[:tok + 0.5sw, :fax - 0.5sw]);
    }

    with link = "point.dk.Fakse", railway = :station {
        track(kf[:fax - 0.5sw, :fax + 0.5sw]);
        marker(:right :de.bf :removed, kf[:fax] >> 0.5mt);
        station(:left :removed, kf[:fax] >> 0.5mt >> 1.4sh + (0dt, 1.2dt),
            "Fakse", "KFX: ??"
        );
    }

    with link = "line.dk.KFX" {
        track(kf[:fax + 0.5sw, :fas - 0.5sw]);
    }

    with link = "point.dk.Faxe-Syd", railway = :station {
        track(kf[:fas - 0.5sw, :fas + 0.5sw]);
        marker(:right :de.bf, kf[:fas] >> 0.5mt);
        label(kf[:fas] >> 0.5mt >> 1.6sh + (0dt, 0.8dt),
            vbox(:right:base,
                span(:former, "Stubberup"),
                span(:former, "Fakse Syd"),
                vbox(:center:topbase,
                    "Faxe Syd",
                    span(:xsmall, "KFX: 26,6")
                )
            )
        );
    }

    with link = "line.dk.KFX" {
        track(kf[:fas + 0.5sw, :fas + 1.4km]);
        line_label(:left:w, kf[:fas + 1.4km] << 0.5mt, (0dt, -0.2dt), "KFX");
        track(kf[:fas + 1.4km, :fal - 0.5sw]);
    }

    with link = "point.dk.Faxe-Ladeplads", railway = :station {
        track(kf[:fal - 0.5sw, :fal.f]);
        marker(:left :de.bf, kf[:fal] << 0.5mt);
        label(kf[:fal] << 0.5mt << 1.5sh + (0dt, 1.2dt),
            vbox(:left:base,
                span(:former, "Fakse Ladeplads"),
                vbox(:center:topbase,
                    span(:bold, "Faxe Ladeplads"),
                    span(:xsmall, "KFX: 29,8")
                )
            )
        );
    }
}

