# DK BTR.  Bramming - Tønder Grænse
#
let bt = path("d3.dk.btr");

with detail = 4,
     railway = :first :pax
{
    # point.dk.Bramming                           dk.LE

    with link = "line.dk.BTR" {
        track(
                path("d3.dk.leb")[:bra - 500m, :bra - 501m] >> 1.5mo
            ..  bt[:bra.xt + 1md, :sej - 1.5km]
        );
        line_label(:left:w, bt[:sej - 1.5km] << 0.5mt, "BTR");
        track(bt[:sej - 1.5km, :sej - 0.5sw]);
    }

    with link = "point.dk.Sejstrup", railway = :station {
        track(bt[:sej - 0.5sw, :sej + 0.5sw]);
        marker(:left :de.hp, bt[:sej] << 0.5mt);
        station(:right, bt[:sej + 0.4sw] << 0.5mt << 1.4sh,
            "Sejstrup", "BTR: 4,200"
        );
    }

    with link = "line.dk.BTR" {
        track(bt[:sej + 0.5sw, :gre - 0.5sw]);
    }

    with link = "point.dk.Gredstedbro", railway = :station {
        track(bt[:gre - 0.5sw, :gre + 0.5sw]);
        marker(:left :de.bf, bt[:gre] << 0.5mt);
        station(:right, bt[:gre + 0.4sw] << 0.5mt << 1.4sh,
            "Gredstedbro", "BTR: 8,464"
        );
    }

    with link = "line.dk.BTR" {
        track(bt[:gre + 0.5sw, :rin - 0.5sw]);
    }

    with link = "point.dk.Ribe-Nørremark", railway = :station {
        track(bt[:rin - 0.5sw, :rin + 0.5sw]);
        marker(:left :de.hp, bt[:rin] << 0.5mt);
        station(:right, bt[:rin] << 0.5mt << 1.4sh + (0dt, 0.45sw),
            "Ribe Nørremark", "BTR: 15,300"
        );
    }

    with link = "line.dk.BTR" {
        track(bt[:rin + 0.5sw, :rib - 0.5sw]);
    }

    with link = "point.dk.Ribe", railway = :station {
        track(bt[:rib - 0.5sw, :rib + 0.5sw]);
        marker(:right :de.bf, bt[:rib] >> 0.5mt);
        station(:left :right_align, bt[:rib + 0.5sw] >> 0.5mt >> 1.4sh,
            "Ribe", "BTR: 16,797"
        );
    }

    with link = "line.dk.BTR" {
        track(bt[:rib + 0.5sw, :rib + 2.5km]);
        line_label(:left:w, bt[:rib + 2.5km] << 0.5mt, (0dt, 0.1dt), "BTR");
        track(bt[:rib + 2.5km, :rig - 1.2sw]);
    }

    with link = "point.dk.Vedsted", railway = :station {
        track(bt[:rig - 1.2sw, :rig - 0.2sw]);
        marker(:right :de.bf :removed, bt[:rig - 0.7sw] >> 0.5mt);
        label(:removed, bt[:rig - 0.3sw] >> 0.5mt >> 1.4sh,
            hbox(:right:base,
                span(:xsmall, "BTR: ?? · "),
                "Vedsted"
            )
        );
    }

    with link = "point.dk.Hviding-Grænse", railway = :station {
        track(bt[:rig - 0.2sw, :rig + 0.2sw]);
        marker(:left :de.dirgr :removed, bt[:rig] << 0.5mt);
        label(:badgesize :removed, bt[:rig] << 4.5mo << 0.5mt,
            hbox(:left:middle,
                vbox(:center:middle :bold, "  DK ", hbar(0.3), "  DE "),
                " < 1920"
            )
        );
        label(:removed, bt[:rig + 1.2sw] >> 0.5mt >> 1.4sh,
            hbox(:right:base,
                span(:xsmall, "BTR: ?? · "),
                span(:former, "Hvidding"), " · ",
                "Hviding"
            )
        );
    }

    with link = "point.dk.Hviding", railway = :station {
        track(bt[:rig + 0.2sw, :rig + 1.2sw]);
        marker(:right :de.bf :removed, bt[:rig + 0.7sw] >> 0.5mt);
    }

    with link = "line.dk.BTR" {
        track(bt[:rig + 1.2sw, :hvt - 0.5sw]);
    }

    with link = "point.dk.Hviding", railway = :station {
        track(bt[:hvt - 0.5sw, :hvt + 0.5sw]);
        marker(:right :de.hp, bt[:hvt] >> 0.5mt);
        station(:left:right_align, bt[:hvt + 0.5sw] >> 0.5mt >> 1.4sh,
            "Hviding", "BTR: 23,200 "
        );
    }

    with link = "line.dk.BTR" {
        track(bt[:hvt + 0.5sw, :rej - 0.5sw]);
    }

    with link = "point.dk.Rejsby", railway = :station {
        track(bt[:rej - 0.5sw, :rej + 0.5sw]);
        marker(:left :de.hp, bt[:rej] << 0.5mt);
        station(:right:left_align, bt[:rej + 0.4sw] << 0.5mt << 1.5sh,
            vbox(:left:base, span(:former, "Reisby"), "Rejsby"),
            "BTR: 28,200"
        );
    }

    with link = "line.dk.BTR" {
        track(bt[:rej + 0.5sw, :bro - 0.5sw]);
    }

    with link = "point.dk.Brøns", railway = :station {
        track(bt[:bro - 0.5sw, :bro + 0.5sw]);
        marker(:right :de.hp, bt[:bro] >> 0.5mt);
        station(:left:right_align, bt[:bro + 0.4sw] >> 0.5mt >> 1.55sh,
            vbox(:left:base, span(:former, "Bröns"), "Brøns"),
            "BRT: 32,200"
        );
    }

    with link = "line.dk.BTR" {
        track(bt[:bro + 0.5sw, :bro + 2km]);
        line_label(:right:e, bt[:bro + 2km] >> 0.5mt, (0dt, 0.2dt), "BTR");
        track(bt[:bro + 2km, :ska.yu]);
    }

    with link = "line.dk.BTR" {
        track(bt[:bro + 0.5sw, :bro + 2km]);
        line_label(:right:e, bt[:bro + 2km] >> 0.5mt, (0dt, 0.2dt), "BTR");
        track(bt[:bro + 2km, :ska.yu]);
    }

    with link = "point.dk.Skærbæk", railway = :station {
        track(bt[:ska.yu, :ska + 0.5sw]);
        marker(:right :de.bf, bt[:ska] >> 0.5mt);
        label(bt[:ska + 0.2sw] >> 0.5mt >> 1.8sh,
            vbox(:right:base,
                hbox(:right:base, span(:former, "Scherrebek"), "  "),
                vbox(:center:topbase,
                    span(:bold, "Skærbæk"),
                    span(:xsmall, "BTR: 36,735")
                )
            )
        );
    }

    with link = "line.dk.BTR" {
        track(bt[:ska + 0.5sw, :dos - 0.5sw]);
    }

    with link = "point.dk.Døstrup-Sønderjylland", railway = :station {
        track(bt[:dos - 0.5sw, :dos + 0.5sw]);
        marker(:right :de.hp, bt[:dos] >> 0.5mt);
        station(:left, bt[:dos + 0.4sw] >> 0.5mt >> 1.6sh,
            vbox(:center:base,
                span(:former, "Döstrup"),
                hbox(:right:base, "Døstrup", span(:light, " Sønderjylland"))
            ),
            "BTR: 42,120"
        );
    }

    with link = "line.dk.BTR" {
        track(bt[:dos + 0.5sw, :dos + 1.5km]);
        line_label(:left:w, bt[:dos + 1.5km] << 0.5mt, (0dt, -0.1dt), "BTR");
        track(bt[:dos + 1.5km, :bre - 180m]);
    }

    with link = "point.dk.Bredebro", railway = :station {
        track(bt[:bre - 180m, :bre.yr]);
        track(:removed,
                bt[:bre - 151m, :bre - 150m]
            --  bt[:bre - 150m + 1dl, :bre.yr] << 1mo
        );
        marker(:left :de.bf, bt[:bre] << 1mo << 0.5mt);
        station(:right, bt[:bre + 0.3sw] << 1mo << 0.5mt << 1.6sh,
            span(:bold, "Bredebro"),
            hbox(:center:top,
                vbox(:right:top, "BTR: ", span(:removed, "??: ")),
                vbox(:sep:top,
                    hbox(:sep:base, "48,", anchor(), "99"),
                    hbox(:sep:base :removed, "??", anchor(), "")
                )
            )
        );
    }

    with link = "line.dk.BTR" {
        track(bt[:bre.yr, :vis - 0.5sw]);
    }

    with link = "point.dk.Visby", railway = :station {
        track(bt[:vis - 0.5sw, :vis + 0.5sw]);
        marker(:right :de.hp, bt[:vis] >> 0.5mt);
        station(:left:right_align, bt[:vis + 0.35sw] >> 0.5mt >> 1.5sh,
            vbox(:right:base,
                span(:former, "Wiesby"),
                "Visby"
            ),
            "BTR: 54,520"
        );
    }

    with link = "line.dk.BTR" {
        track(bt[:vis + 0.5sw, :vis + 5km]);
        line_label(:left:sw, bt[:vis + 5km] << 0.5mt, "BTR");
        track(bt[:vis + 5km, :tin - 0.3sw]);
    }

    with link = "point.dk.Tønder-Industrispor-Nord", railway = :station {
        track(bt[:tin - 0.3sw, :tin + 0.3sw]);
        marker(:left :de.anst, bt[:tin] << 0.5mt);
        station(:right, bt[:tin + 0.4sw] << 0.5mt << 1.4sh,
            span(:small, "T. Industrispor Nord"), "BTR: 61,7"
        );
    }

    with link = "line.dk.BTR" {
        track(bt[:tin + 0.3sw, :ton.yh]);
        track(:ror, bt[:ton.yh, :trn - 0.5sw]);
    }

    with link = "point.dk.Tønder-Nord", railway = :station {
        track(bt[:trn - 0.5sw, :trn + 0.5sw]);
        marker(:right :de.hp :casing, bt[:trn] >> 0.5mt);
        station(:left, bt[:trn] >> 0.5mt >> 1.6sh + (0dt, 1.2dt),
            "Tønder Nord", "BTR: 63,300"
        );
    }

    with link = "line.dk.BTR" {
        track(:ror, bt[:trn + 0.5sw, :ton.yt]);
    }

    with link = "point.dk.Tønder", railway = :station {
        track(:removed, bt[:ton.yt, :ton + 300m] >> 1mo);
        track(bt[:ton.yt, :ton + 300m]);
        track(:removed,
                bt[:ton.yt, :ton + 300m - 1dl] << 1mo
            --  bt[:ton + 300m, :ton + 0.1dl]
        );
        marker(:left :de.bf, bt[:ton] << 1mo << 0.5mt);
        station(:right:left_align,
            bt[:ton] << 1mo << 0.5ms << 1.6sh + (0dt, 1dt),
            vbox(:left:base,
                span(:former, "Tondern"),
                span(:bold, "Tønder")
            ),
            hbox(:center:top,
                vbox(:right:top,
                    span(:removed, "??: "), "BTR: ", span(:closed, "??: ")
                ),
                vbox(:sep:top,
                    hbox(:sep:base :removed, "??", anchor(), ""),
                    hbox(:sep:base, "63,", anchor(), "939"),
                    hbox(:sep:base :removed, "??", anchor(), "")
                )
            )
        );
    }

    with link = "line.dk.BTR" {
        track(:up:ldn :removed,
                bt[:ton + 300m, :ton.xs] >> 1mo
            ..  bt[:ton.zs + 1mo, :tog - 2km] >> 0.5mo
        );
        track(:dn:rup,
                bt[:ton + 300m, :ton.xs]
            ..  bt[:ton.zs + 1md, :tog - 2km] << 0.5mo
        );
        line_label(:left:w, bt[:tog - 2km] << 0.5mo << 0.5mt, "BTR");
        track(:up:ldn :removed, bt[:tog - 2km, :tog - 0.3sw] >> 0.5mo);
        track(:dn:rup, bt[:tog - 2km, :tog - 0.3sw] << 0.5mo);
    }
}

