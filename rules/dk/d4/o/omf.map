# DK OMF.  Odense - Middelfart
#
let om = path("d3.dk.omf");

with detail = 4,
     railway = :first :pax :removed
{
    # point.dk.Odense  dk.KFA

    with link = "line.dk.OMF" {
        track(:ror,
                om[:ode.yb - 0.1dl, :ode.yb] >> 2.5mo
            ..  om[:ode.ym - 0.1dl, :ode.ym]
        );
        track(:ror, om[:ode.ym - 0.1dl, :ode.xm]);
        track(om[:ode.xm, :sne - 0.49sw]);
    }

    with link = "point.dk.Snestrup", railway = :station {
        track(om[:sne - 0.5sw, :sne + 0.5sw]);
        marker(:left :de.hp, om[:sne] << 0.5mt);
        station(:bottom, om[:sne] << 0.5mt << 1sh + (-1.5dt, 0.8dt),
            "Snestrup", "OMF: 4,7"
        );
    }

    with link = "line.dk.OMF" {
        track(om[:sne + 0.49sw, :vil - 0.49sw]);
    }

    with link = "point.dk.Villestofte", railway = :station {
        track(om[:vil - 0.5sw, :vil + 0.5sw]);
        marker(:right :de.bf, om[:vil] >> 0.5mt);
        station(:right, om[:vil] >> 0.5mt >> 1sh + (1.8dt, 0.3dt),
            "Villestofte", "OMF: 6,0"
        );
    }

    with link = "line.dk.OMF" {
        track(om[:vil + 0.49sw, :vil + 0.9km]);
        line_label(:left:n, om[:vil + 0.9km] << 0.5mt, "OMF");
        track(om[:vil + 0.9km, :kor - 0.49sw]);
    }

    with link = "point.dk.Korup", railway = :station {
        track(om[:kor - 0.5sw, :kor + 0.5sw]);
        marker(:right :de.bf, om[:kor] >> 0.5mt);
        station(:top, om[:kor] >> 0.5mt >> 1sh + (0dt, -0.8dt),
            "Korup", "OMF: 7,9"
        );
    }

    with link = "line.dk.OMF" {
        track(om[:kor + 0.49sw, :slu - 0.49sw]);
    }

    with link = "point.dk.Slukefter", railway = :station {
        track(om[:slu - 0.5sw, :slu + 0.5sw]);
        marker(:right :de.hp, om[:slu] >> 0.5mt);
        station(:top, om[:slu] >> 0.5mt >> 1sh + (1.5dt, -1dt),
            "Slukefter", "OMF: 9,2"
        );
    }

    with link = "line.dk.OMF" {
        track(om[:slu + 0.49sw, :brb - 0.49sw]);
    }

    with link = "point.dk.Bredbjerg", railway = :station {
        track(om[:brb - 0.5sw, :brb + 0.5sw]);
        marker(:right :de.hp, om[:brb] >> 0.5mt);
        station(:top, om[:brb] >> 0.5mt >> 1sh + (1.5dt, -1dt),
            "Bredbjerg", "OMF: 10,4"
        );
    }

    with link = "line.dk.OMF" {
        track(om[:brb + 0.49sw, :lan - 0.49sw]);
    }

    with link = "point.dk.Langesø", railway = :station {
        track(om[:lan - 0.5sw, :lan + 0.5sw]);
        marker(:right :de.bf, om[:lan] >> 0.5mt);
        station(:top, om[:lan] >> 0.5mt >> 1sh + (0.5dt, -0.8dt),
            "Langesø", "OMF: 12,4"
        );
    }

    with link = "line.dk.OMF" {
        track(om[:lan + 0.49sw, :mor - 0.49sw]);
    }

    with link = "point.dk.Morud", railway = :station {
        track(om[:mor - 0.5sw, :mor + 0.5sw]);
        marker(:left :de.bf, om[:mor] << 0.5mt);
        station(:left, om[:mor] << 0.5mt << 1sh + (-1.8dt, 1.5dt),
            "Morud", "OMF: 14,0"
        );
    }

    with link = "line.dk.OMF" {
        track(om[:mor + 0.49sw, :far - 0.49sw]);
    }

    with link = "point.dk.Farstrup", railway = :station {
        track(om[:far - 0.5sw, :far + 0.5sw]);
        marker(:right :de.bf, om[:far] >> 0.5mt);
        station(:top, om[:far] >> 0.5mt >> 1sh + (1dt, -1dt),
            "Farstrup", "OMF: 16,7"
        );
    }

    with link = "line.dk.OMF" {
        track(om[:far + 0.49sw, :vef - 0.49sw]);
    }

    with link = "point.dk.Veflinge", railway = :station {
        track(om[:vef - 0.5sw, :vef + 0.5sw]);
        marker(:right :de.bf, om[:vef] >> 0.5mt);
        station(:top, om[:vef] >> 0.5mt >> 1sh + (0dt, -0.8dt),
            "Veflinge", "OMF: 19,0"
        );
    }

    with link = "line.dk.OMF" {
        track(om[:vef + 0.49sw, :vef + 1.8km]);
        line_label(:left:n, om[:vef + 1.8km] << 0.5mt, "OMF");
        track(om[:vef + 1.8km, :gam - 0.49sw]);
    }

    with link = "point.dk.Gamby", railway = :station {
        track(om[:gam - 0.5sw, :gam + 0.5sw]);
        marker(:right :de.bf, om[:gam] >> 0.5mt);
        station(:top, om[:gam] >> 0.5mt >> 1sh + (0.3dt, -0.8dt),
            "Gamby", "OMF: 22,5"
        );
    }

    with link = "line.dk.OMF" {
        track(om[:gam + 0.49sw, :nym - 0.49sw]);
    }

    with link = "point.dk.Nymark", railway = :station {
        track(om[:nym - 0.5sw, :nym + 0.5sw]);
        marker(:left :de.bf, om[:nym] << 0.5mt);
        station(:bottom, om[:nym] << 0.5mt << 1sh + (-0.5dt, 0.8dt),
            "Nymark", "OMF: 24,9"
        );
    }

    with link = "line.dk.OMF" {
        track(om[:nym + 0.49sw, :har - 0.49sw]);
    }

    with link = "point.dk.Harndrup", railway = :station {
        track(om[:har - 0.5sw, :har + 0.5sw]);
        marker(:left :de.bf, om[:har] << 0.5mt);
        station(:bottom, om[:har] << 0.5mt << 1sh + (-0.5dt, 1dt),
            "Harndrup", "OMF: 27,8"
        );
    }

    with link = "line.dk.OMF" {
        track(om[:har + 0.49sw, :har + 2.2km]);
        line_label(:left:ne, om[:har + 2.2km] << 0.5mt, "OMF");
        track(om[:har + 2.2km, :bre.yb - 0.5seg]);
        track(:ror, om[:bre.yb - 0.5seg, :bre.yb]);
    }

    with link = "point.dk.Brenderup", railway = :station {
        track(om[:bre.yb, :bre + 161m]);
        track(
                om[:bre.yb, :bre + 160m - 1dl] >> 1mo
            --  om[:bre + 160m, :bre + 161m]
        );
        marker(:right :de.bf, om[:bre] >> 1mo >> 0.5mt);
        station(:top, om[:bre] >> 1mo >> 0.5mt >> 1sh + (-1dt, -0.8dt),
            span(:bold, "Brenderup"),
            hbox(:center:top,
                vbox(:right:top, "??: ", "OMF: "),
                vbox(:sep:top,
                    hbox(:sep:base, "0,", anchor(), "0"),
                    hbox(:sep:base, "31,", anchor(), "9")
                )
            )
        );
    }

    with link = "line.dk.OMF" {
        track(om[:bre + 160m, :bre + 1.6km]);
        line_label(:right:se, om[:bre + 1.6km] >> 0.5mt, "OMF");
        track(om[:bre + 1.6km, :asp - 0.49sw]);
    }

    with link = "point.dk.Asperup", railway = :station {
        track(om[:asp - 0.5sw, :asp + 0.5sw]);
        marker(:right :de.bf, om[:asp] >> 0.5mt);
        station(:top, om[:asp] >> 0.5mt >> 1sh + (0dt, -0.8dt),
            "Asperup", "OMF: 36,6"
        );
    }

    with link = "line.dk.OMF" {
        track(om[:asp + 0.49sw, :bla - 0.49sw]);
    }

    with link = "point.dk.Blanke", railway = :station {
        track(om[:bla - 0.5sw, :bla + 0.5sw]);
        marker(:right :de.hp, om[:bla] >> 0.5mt);
        marker(:right :de.exbf, om[:bla] >> 0.5mt);
        station(:top, om[:bla] >> 0.5mt >> 1.4sh + (1dt, -0.8dt),
            "Blanke", "OMF: 38,8"
        );
    }

    with link = "line.dk.OMF" {
        track(om[:bla + 0.49sw, :kus - 0.49sw]);
    }

    with link = "point.dk.Kustrup", railway = :station {
        track(om[:kus - 0.5sw, :kus + 0.5sw]);
        marker(:right :de.hp, om[:kus] >> 0.5mt);
        marker(:right :de.exbf, om[:kus] >> 0.5mt);
        station(:top, om[:kus] >> 0.5mt >> 1.5sh + (1.5dt, -0.8dt),
            "Kustrup", "OMF: 41,3"
        );
    }

    with link = "line.dk.OMF" {
        track(om[:kus + 0.49sw, :roj - 0.49sw]);
    }

    with link = "point.dk.Røjle", railway = :station {
        track(om[:roj - 0.5sw, :roj + 0.5sw]);
        marker(:right :de.bf, om[:roj] >> 0.5mt);
        station(:top, om[:roj] >> 0.5mt >> 1sh + (1dt, -0.8dt),
            "Røjle", "OMF: 43,7"
        );
    }

    with link = "line.dk.OMF" {
        track(om[:roj + 0.49sw, :roj + 1.3km]);
        line_label(:right:s, om[:roj + 1.3km] >> 0.5mt, "OMF");
        track(om[:roj + 1.3km, :sta - 0.49sw]);
    }

    with link = "point.dk.Staurby-Skov", railway = :station {
        track(om[:sta - 0.5sw, :sta + 0.5sw]);
        marker(:left :de.hp, om[:sta] << 0.5mt);
        station(:right, om[:sta] << 0.5mt << 1sh + (1.5dt, 1.5dt),
            "Staurby Skov", "OMF: 47,0"
        );
    }

    with link = "line.dk.OMF" {
        track(om[:sta + 0.49sw, :mig.xo]);
        track(:ror, om[:mig.xo, :mig.yo]);
    }

    # point.dk.Middelfart-gamle

    with link = "line.dk.OMF" {
        track(:ror:lor,
                om[:mig.ym - 0.1dl, :mig.ym]
            ..  om[:mid.yb, :mid.yb + 0.1dl] >> 1.5mo
        );
    }
}

