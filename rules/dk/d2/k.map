# DK KFA.  København H - Fredericia
with detail = 2 {
    let kf = path("d2.dk.kfa");

    with railway = :first :double :cat:ac25 :pax {
        with link = "point.dk.København-H" {
            statdot(kf[:kob]);
            slabel(:nw, kf[:kob] + (1.5km, -1.5dt),
                span(:large :bold, "København")
            );
        }

        with link = "line.dk.KFA" {
            track(kf[:kob, :kob.yk]);
            with layer = -1 track(kf[:kob.yk, :val]);
            track(kf[:val, :val.yf]);
            with layer = -1 track(kf[:val.yf, :hvf.yv]);
            track(kf[:hvf.yv, :hvf]);
        }

        with link = "point.dk.Hvidovre-Fjern" {
            statdot(:nopax, kf[:hvf]);
        }

        with link = "line.dk.KFA" {
            track(kf[:hvf, :hoj]);
        }

        with link = "point.dk.Høje-Taastrup" {
            statdot(kf[:hoj]);
        }

        with link = "line.dk.KFA" {
            track(kf[:hoj, :ros - 4km]);
            line_label(:right:s, kf[:ros - 4km], "KFA");
            track(kf[:ros - 4km, :ros]);
        }

        with link = "point.dk.Roskilde" {
            track(kf[:ros, :ros.yn]);
            statdot(kf[:ros]);
            slabel(:left, kf[:ros] + (-1dt, -0.5dt), "Roskilde");
        }

        with link = "line.dk.KFA" {
            track(kf[:ros.yn, :ros.yk]);
            track(kf[:ros.yk, :ros + 13km]);
            line_label(:right:se, kf[:ros + 13km], "KFA");
            track(kf[:ros + 13km, :kva.yk]);
            track(kf[:kva.yk, :rin]);
        }

        with link = "point.dk.Ringsted" {
            track(kf[:rin, :rin.yr]);
            track(kf[:rin, :rin.yr] << 1md << 1ms);
            statdot(kf[:rin] << 0.5md << 0.5ms);
            slabel(:top, kf[:rin] + (0dt, -1md), "Ringsted");
        }

        with link = "line.dk.KFA" {
            track(kf[:rin.yr, :rin.yr + 6km]);
            line_label(:right:s, kf[:rin.yr + 6km], "KFA");
            track(kf[:rin.yr + 6km, :sor.yv]);
        }

        with link = "point.dk.Sorø" {
            track(kf[:sor.yv, :sor]);
            statdot(kf[:sor]);
            slabel(:nw, kf[:sor] + (-1dt, 1dt), "Sorø");
        }

        with link = "line.dk.KFA" {
            track(kf[:sor, :sla]);
        }

        with link = "point.dk.Slagelse" {
            track(kf[:sla, :sla.yv]);
            statdot(kf[:sla]);
            slabel(:nw, kf[:sla] + (1dt, 0.5dt), "Slagelse");
        }

        with link = "line.dk.KFA" {
            track(kf[:sla.yv, :sla + 6.5km]);
            line_label(:right:se, kf[:sla + 6.5km], "KFA");
            track(kf[:sla + 6.5km, :sve.yk]);
            track(kf[:sve.yk, :kor]);
        }

        with link = "point.dk.Korsør" {
            statdot(kf[:kor]);
            slabel(:left, kf[:kor] + (0.5dt, -1.3dt), "Korsør");
        }

        with link = "line.dk.KFA" {
            track(kf[:kor, :kor + 12km]);
            line_label(:left:nw, kf[:kor + 12km], "KFA");
            track(kf[:kor + 12km, :nyb]);
        }

        with link = "point.dk.Nyborg" {
            track(kf[:nyb, :nyb.yr]);
            statdot(kf[:nyb]);
            slabel(:right, kf[:nyb] + (1.5dt, -0.5dt), "Nyborg");
        }

        with link = "line.dk.KFA" {
            track(kf[:nyb.yr, :ode - 11km]);
            line_label(:right:sw, kf[:ode - 11km], "KFA");
            track(kf[:ode - 11km, :ode.ym]);
            track(kf[:ode.ym, :ode]);

        }

        with link = "point.dk.Odense" {
            statdot(:cat:ac25 :pax, kf[:ode]);
            slabel(:right :bold, kf[:ode.ym] + (1.1km, 0dt) + (1.5dt, 0.3dt), "Odense");
        }

        with link = "line.dk.KFA" {
            track(kf[:ode, :ode.yb]);
            track(kf[:ode.yb, :ode.ys]);
            track(kf[:ode.ys, :ode.ys + 5km]);
            line_label(:left:nw, kf[:ode.ys + 5km], "KFA");
            track(kf[:ode.ys + 5km, :tom.ya]);
        }

        with link = "point.dk.Tommerup" {
            track(kf[:tom.ya, :tom]);
            statdot(kf[:tom]);
            slabel(:left, kf[:tom] + (-1.5dt, 1.5dt), "Tommerup");
        }

        with link = "line.dk.KFA" {
            track(kf[:tom, :tom + 18km]);
            line_label(:left:ne, kf[:tom + 18km], "KFA");
            track(kf[:tom + 18km, :mis]);
            track(kf[:mis, :mid.yb]);
        }

        with link = "point.dk.Middelfart" {
            track(kf[:mid.yb, :mid]);
            statdot(kf[:mid]);
            slabel(:ne, kf[:mid] + (0.5dt, 1.0dt), "Middelfart");
        }

        with link = "line.dk.KFA" {
            track(kf[:mid, :mid + 2.4km]);
            line_label(:left:e, kf[:mid + 2.4km], "KFA");
            track(kf[:mid + 2.4km, :sno]);
        }

        with link = "point.dk.Snoghøj" {
            statdot(:nopax, kf[:sno]);
        }

        with link = "line.dk.KFA" {
            track(kf[:sno, :fre.yt]);
            track(kf[:fre.yt, :fre]);
        }

        with link = "point.dk.Fredericia" {
            statdot(kf[:fre]);
            slabel(:right, kf[:fre] + (2.0dt, 1.0dt),
                span(:medium :bold, "Fredericia")
            );
        }
    }
}


# DK KFS.  København H - Frederikssund
with detail = 2 {
    let kf = path("d2.dk.kfs");

    with railway = :first :double :cat:dc15 :pax {
        with link = "point.dk.København-H" {
            statdot(kf[:kob] >> 1md >> 1ms);
        }

        with link = "line.dk.KFS" {
            track(kf[:kob, :kob.yk] >> 1md >> 1ms);
            track(kf[:kob.yk, :val] >> 1md >> 1ms);
        }

        with link = "point.dk.Valby" {
            track(kf[:val, :val.yf] >> 1md >> 1ms);
            statdot(kf[:val] >> 1md >> 1ms);
        }

        with link = "line.dk.KFS" {
            track(
                    kf[:val.yf - 0.1dl, :val.yf] >> 1md >> 1ms
                ..  kf[:val.xf + 1md, :van.yf]
            );
        }

        with link = "point.dk.Vanløse" {
            track(kf[:van.yf, :van]);
            statdot(kf[:van]);
        }

        with link = "line.dk.KFS" {
            track(kf[:van, :van + 8km]);
            line_label(:left:n, kf[:van + 8km], "KFS");
            track(kf[:van + 8km, :fre - 6.3km]);
            line_label(:right:sw, kf[:fre - 6.3km], "KFS");
            track(kf[:fre - 6.3km, :fre]);
        }

        with link = "point.dk.Frederikssund" {
            statdot(kf[:fre]);
            slabel(:left, kf[:fre] + (0dt, -0.4km) + (0.5dt, -0.8dt),
                "Frederikssund"
            );
        }
    }
}


# DK KFX.  Køge - Faxe
with detail = 2 {
    let kf = path("d2.dk.kfx");

    with railway = :first :pax {
        with link = "line.dk.KFX" {
            track(kf[:kog.yf, :kog.yf + 5km]);
            line_label(:left:w, kf[:kog.yf + 5km], "KFX");
            track(kf[:kog.yf + 5km, :har.yr]);
        }

        with link = "point.dk.Hårlev" {
            track(kf[:har.yr, :har]);
            statdot(kf[:har]);
            slabel(:left, kf[:har] + (-1.5dt, 0.8dt), "Hårlev");
        }

        with link = "line.dk.KFX" {
            track(kf[:har, :har + 8km]);
            line_label(:right:se, kf[:har + 8km], "KFX");
            track(kf[:har + 8km, :fal]);
        }

        with link = "point.dk.Faxe-Ladeplads" {
            statdot(kf[:fal]);
            slabel(:bottom, kf[:fal] + (0dt, 0.8dt), "Faxe Ladeplads");
        }
    }
}


# DK KHK.  København H - Køge
with detail = 2 {
    let kk = path("d2.dk.khk");
    let vr = path("d2.dk.vrs");

    with railway = :first :double :cat:dc15 :pax {
        with link = "line.dk.KHK" {
            track(:casing, kk[:kob.yk, :kob.yg] >> 1md >> 1ms);
            track(kk[:kob.yg, :kog.yk - 1md] >> 1md >> 1ms);
            track(:casing,
                    kk[:kob.yk - 1.1md, :kog.yk - 1md] >> 1md >> 1ms
                ..  kk[:kog.xk, :kog.xk + 0.1dl]
            );
            track(kk[:kog.xk, :ols - 9.8km]);
            line_label(:left:nw, kk[:ols - 9.8km], "KHK");
            track(
                    kk[:ols - 9.8km, :ols - 1md]
                ..  vr[:kon, :kon + 0.1dl] << 1md << 1ms
            );
        }

        with link = "point.dk.Køge-Nord" {
            statdot(vr[:kon] << 1md << 1ms);
        }

        with link = "line.dk.KHK" {
            track(:casing,
                    vr[:kon, :kon.yk] << 1md << 1ms
                ..  kk[:olb.yk + 1md, :olb.yk + 1.1md] >> 0.5mt >> 1ms >> 0.5md
            );
            track(kk[:olb.yk + 1md, :kog] >> 0.5mt >> 1ms >> 0.5md);
        }
    }
}


# DK KHR.  København H - Helsingør
with detail = 2 {
    let kh = path("d2.dk.khr");

    with railway = :first :double :cat:ac25 :pax {
        with link = "line.dk.KHR" {
            track(kh[:kob, :sva]);
            track(kh[:sva, :sva.yf]);
            track(kh[:sva.yf, :hel.yv]);
        }

        with link = "point.dk.Hellerup" {
            track(kh[:hel.yv, :hel.yh]);
            statdot(kh[:hel]);
            slabel(:right, kh[:hel] + (1.5dt, 0.8dt), "Hellerup");
        }

        with link = "line.dk.KHR" {
            track(kh[:hel.yh, :kla]);
        }

        with link = "point.dk.Klampenborg" {
            statdot(kh[:kla]);
            slabel(:right, kh[:kla] + (1.5dt, 0.8dt), "Klampenborg");
        }

        with link = "line.dk.KHR" {
            track(kh[:kla, :kla + 4.5km]);
            line_label(:right:w, kh[:kla + 4.5km], "KHR");
            track(kh[:kla + 4.5km, :ved.yj]);
        }

        with link = "point.dk.Vedbæk" {
            track(kh[:ved.yj, :ved]);
            statdot(kh[:ved]);
            slabel(:right, kh[:ved] + (1.5dt, 0.8dt), "Vedbæk");
        }

        with link = "line.dk.KHR" {
            track(kh[:ved, :sne.yh - 7km]);
            line_label(:right:w, kh[:sne.yh - 7km], (0dt, 0.2dt), "KHR");
            track(kh[:sne.yh - 7km, :sne.yh]);
        }

        with link = "point.dk.Snekkersten" {
            track(kh[:sne.yh, :sne]);
            statdot(kh[:sne]);
            slabel(:nw, kh[:sne] + (0dt, 1dt), "Snekkersten");
        }

        with link = "line.dk.KHR" {
            track(kh[:sne, :sne + 1.7km]);
            line_label(:right:w, kh[:sne + 1.7km], "KHR");
            track(kh[:sne + 1.7km, :hor]);
        }
    }

    with link = "point.dk.Helsingør" {
        statdot(:cat:ac25 :pax, kh[:hor]);
        slabel(:left :cat:ac25 :pax, kh[:hor] + (-1.5dt, 0.3dt),
            span(:bold, "Helsingør")
        );
    }
}


# DK KHS.  Korsør - Halsskov
with detail = 2 {
    let kh = path("d2.dk.khs");

    with railway = :first :pax :removed {
        with link = "line.dk.KHS" {
            track(kh[:kor.yh, :hal]);
        }

        with link = "point.dk.Halsskov" {
            statdot(kh[:hal]);
            slabel(:ne, kh[:hal] + (1dt, 0.8dt), "Halsskov");
        }
    }
}


# DK KJX.  Køge Nord - Køge Nord N201
with detail = 2 {
    with link = "line.dk.KJX" {
        track(:first :cat:ac25 :pax,
                path("d2.dk.kjx")[:kon.yk, :kox]
        );
    }
}


# DK KKB.  København H - Klampenborg (S-tog)
with detail = 2 {
    let kh = path("d2.dk.khr");

    with railway = :first :double :cat:dc15 :pax {
        with link = "line.dk.KKB" {
            track(kh[:kob, :sva] << 1md << 1ms);
        }

        with link = "point.dk.Svanemøllen" {
            track(kh[:sva, :sva.yf] << 1md << 1ms);
            statdot(kh[:sva] << 1md << 1ms);
            slabel(:right, kh[:sva] + (1.8dt, 0.5dt), "Svanemøllen");
        }

        with link = "line.dk.KKB" {
            track(kh[:sva.yf, :hel.yv] << 1md << 1ms);
        }

        with link = "point.dk.Hellerup" {
            track(kh[:hel.yv, :hel.yh] << 1md << 1ms);
            statdot(kh[:hel] << 1md << 1ms);
        }

        with link = "line.dk.KKB" {
            track(kh[:hel.yh, :kla] << 1md << 1ms);
        }

        with link = "point.dk.Klampenborg" {
            statdot(kh[:kla] << 1md << 1ms);
        }
    }
}


# DK KPH.  København H - Peberholm grænse
with detail = 2 {
    let kp = path("d2.dk.kph");

    with railway = :first :double :cat:ac25 :pax {
        with link = "line.dk.KPH" {
            track(kp[:kob.yk, :kob.yg]);
            track(kp[:kob.yg, :kal.yv]);
        }

        with link = "point.dk.Kalvebod" {
            track(kp[:kal.yv, :kal]);
            statdot(:nopax, kp[:kal]);
            slabel(:right :nopax, kp[:kal] + (1.5dt, 0dt), "Kalvebod");
        }

        with link = "line.dk.KPH" {
            track(kp[:kal, :peb - 3.5km]);
            line_label(:left:sw, kp[:peb - 3.5km] << 0.5md, "KPH");
            track(kp[:peb - 3.5km, :peb]);
        }

        with link = "point.dk.Peberholm" {
            statdot(:nopax, kp[:peb]);
            slabel(:ne, kp[:peb] + (-1.3dt, -0.3dt), "Peberholm");
        }

        with link = "line.dk.KPH" {
            track(kp[:peb, :peg]);
        }
    }
}


# DK KRS.  Køge - Ringsted
with detail = 2 {
    let kr = path("d2.dk.krs");

    with railway = :first :pax :removed {
        track(
                kr[:kog.yr - 0.1dl, :kog.yr] << 2ms << 1md
            ..  kr[:kog.xr + 1md, :rin.yk - 12.5km]
        );
        line_label(:left:n, kr[:rin.yk - 12.5km], "KRS");
        track(
                kr[:rin.yk - 12.5km, :rin.xk - 2md]
            ..  kr[:rin.yk, :rin.yk + 0.1dl] << 1.5md << 1ms >> 0.5mt
        );
    }
}


# DK KTD.  Kagerup - Tisvildeleje
with detail = 2 {
    let kt = path("d2.dk.ktd");

    with railway = :first :pax {
        with link = "line.dk.KTD" {
            track(kt[:kag.yt, :kag.yt + 8km]);
            line_label(:left:ne, kt[:kag.yt + 8km], "KTD");
            track(kt[:kag.yt + 8km, :til]);
        }

        with link = "point.dk.Tisvildeleje" {
            statdot(kt[:til]);
            slabel(:left, kt[:til] + (-1.5dt, 0.8dt), "Tisvildeleje");
        }
    }
}


# DK KVH.  København H - Vigerslev - Hvidovre Fjern
with detail = 2 {
    let kh = path("d2.dk.kvh");

    with railway = :first :double :cat:ac25 :pax {
        with link = "line.dk.KVH" {
            track(kh[:kob.yg, :kog.yk - 1md]);
            with layer = -1 track(kh[:kog.yk - 1md, :vig.yk]);
        }

        with link = "point.dk.Vigerslev" {
            track(kh[:vig.yk, :vig.yr]);
            statdot(:nopax, kh[:vig]);
        }

        with link = "line.dk.KVH" {
            track(kh[:vig.yr, :vig.yh]);
            track(kh[:vig.yh, :hvf.yv]);
        }
    }
}

