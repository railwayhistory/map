# DK KHK.  København H - Køge
#
let kk = path("d3.dk.khk");
let vr = path("d3.dk.vrs");

with detail = 3,
     railway = :first :double :cat:dc15 :pax
{
    with link = "line.dk.KHK" {
        track(:casing,
                kk[:kob.yk - 0.1dl, :kob.yk] >> 1md >> 1ms
            ..  kk[:kob.xk, :syd - 0.5sw] >> 1md >> 1ms
        );
    }

    with link = "point.dk.Sydhavn", railway = :station {
        track(kk[:syd - 0.5sw, :syd + 1sw] >> 1md >> 1ms);
        marker(:right :de.hp, kk[:syd] >> 1.5md >> 1ms);
    }

    with link = "line.dk.KHK" {
        track(kk[:syd + 1sw, :sja - 0.5sw] >> 1md >> 1ms);
    }

    with link = "point.dk.Sjælør", railway = :station {
        track(kk[:sja - 0.5sw, :sja + 0.5sw] >> 1md >> 1ms);
        marker(:right :de.hp, kk[:sja] >> 1.5md >> 1ms);
    }

    with link = "line.dk.KHK" {
        track(:casing,
                kk[:sja + 0.5sw, :sja + 0.51sw] >> 1md >> 1ms
            ..  kk[:kog.xk, :kog.xk + 0.1dl]
        );
    }

    with link = "point.dk.Ellebjerg", railway = :station {
        track(:casing, kk[:kog.xk, :kog.xk + 1sw]);
        marker(:right :de.hp :removed, kk[:kog.xk + 0.5sw] >> 0.5md);
    }

    with link = "line.dk.KHK" {
        track(:casing, kk[:kog.xk + 1sw, :ama - 0.5sw]);
    }

    with link = "point.dk.Åmarken", railway = :station {
        track(kk[:ama - 0.5sw, :ama + 0.5sw]);
        marker(:left :de.hp, kk[:ama] << 0.5md);
        slabel(:left, kk[:ama] >> 1.2md + (0dt, 1dt), "Åmarken");
    }

    with link = "line.dk.KHK" {
        track(kk[:ama + 0.5sw, :fri - 0.5sw]);
    }

    with link = "point.dk.Friheden", railway = :station {
        track(kk[:fri - 0.5sw, :fri + 0.5sw]);
        marker(:right :de.hp, kk[:fri] >> 0.5md);
        slabel(:nw, kk[:fri - 0.3sw] << 0.4md, "Friheden");
    }

    with link = "line.dk.KHK" {
        track(kk[:fri + 0.5sw, :fri + 0.9km]);
        line_label(:left:n, kk[:fri + 0.9km] << 0.5md, "KHK");
        track(kk[:fri + 0.9km, :ave - 0.5sw]);
    }

    with link = "point.dk.Avedøre", railway = :station {
        track(kk[:ave - 0.5sw, :ave + 0.5sw]);
        marker(:right :de.hp, kk[:ave] >> 0.5md);
        slabel(:left, kk[:ave] >> 0.5md >> 1.4sh + (1sw, 0dt), "Avedøre");
    }

    with link = "line.dk.KHK" {
        track(kk[:ave + 0.5sw, :bro - 0.5sw]);
    }

    with link = "point.dk.Brøndby-Strand", railway = :station {
        track(kk[:bro - 0.5sw, :bro + 0.5sw]);
        marker(:right :de.hp, kk[:bro] >> 0.5md);
        slabel(:bottom, kk[:bro] << 1md + (-0.8dt, 0dt),
            vbox(:center:top, "Brøndby", "Strand")
        );
    }

    with link = "line.dk.KHK" {
        track(kk[:bro + 0.5sw, :val - 0.5sw]);
    }

    with link = "point.dk.Vallensbæk", railway = :station {
        track(kk[:val - 0.5sw, :val + 0.5sw]);
        marker(:left :de.bf, kk[:val] << 0.5md);
        slabel(:left, kk[:val - 0.8sw] >> 1.2md, "Vallensbæk");
    }

    with link = "line.dk.KHK" {
        track(kk[:val + 0.5sw, :ish - 0.5sw]);
    }

    with link = "point.dk.Ishøj", railway = :station {
        track(kk[:ish - 0.5sw, :ish + 0.5sw]);
        marker(:right :de.hp, kk[:ish] >> 0.5md);
        slabel(:left, kk[:ish] >> 0.5md >> 1.5sh + (0dt, 1.2dt), "Ishøj");
    }

    with link = "line.dk.KHK" {
        track(kk[:ish + 0.5sw, :hun - 0.5sw]);
    }

    with link = "point.dk.Hundige", railway = :station {
        track(kk[:hun - 0.5sw, :hun + 0.5sw]);
        marker(:left :de.bf, kk[:hun] << 0.5md);
        slabel(:left, kk[:hun] >> 1.3md + (0dt, 1dt), "Hundige");
    }

    with link = "line.dk.KHK" {
        track(kk[:hun + 0.5sw, :hun + 1km]);
        line_label(:left:nw, kk[:hun + 1km] << 0.5md, "KHK");
        track(kk[:hun + 1km, :gre - 0.5sw]);
    }

    with link = "point.dk.Greve", railway = :station {
        track(kk[:gre - 0.5sw, :gre + 0.5sw]);
        marker(:right :de.hp, kk[:gre] >> 0.5md);
        slabel(:nw, kk[:gre - 0.5sw] << 0.4md, "Greve");
    }

    with link = "line.dk.KHK" {
        track(kk[:gre + 0.5sw, :kar - 0.5sw]);
    }

    with link = "point.dk.Karlslunde", railway = :station {
        track(kk[:kar - 0.5sw, :kar + 0.5sw]);
        marker(:left :de.bf, kk[:kar] << 0.5md);
        slabel(:nw, kk[:kar - 0.5sw] << 0.5md << 1.1sh, "Karlslunde");
    }

    with link = "line.dk.KHK" {
        track(kk[:kar + 0.5sw, :sol - 0.5sw]);
    }

    with link = "point.dk.Solrød-Strand", railway = :station {
        track(kk[:sol - 0.5sw, :sol + 0.5sw]);
        marker(:left :de.bf, kk[:sol] << 0.5md);
        slabel(:right, kk[:sol] << 0.5md << 1.4sh + (0dt, 1dt),
            "Solrød Strand"
        );
    }

    with link = "line.dk.KHK" {
        track(kk[:sol + 0.5sw, :jer - 0.5sw]);
    }

    with link = "point.dk.Jersie", railway = :station {
        track(kk[:jer - 0.5sw, :jer + 0.5sw]);
        marker(:right :de.hp, kk[:jer] >> 0.5md);
        slabel(:right, kk[:jer] << 1.2md + (0dt, 1dt),
            "Jersie"
        );
    }

    with link = "line.dk.KHK" {
        track(kk[:jer + 0.5sw, :jer + 0.9km]);
        line_label(:left:nw, kk[:jer + 0.9km] << 0.5md, "KHK");
        track(kk[:jer + 0.9km, :ols - 0.5sw]);
    }

    with link = "point.dk.Ølsemagle", railway = :station {
        track(kk[:ols - 0.5sw, :ols + 0.5sw]);
        marker(:left :de.bbf :nopax, kk[:ols] << 0.5md);
        slabel(:right :nopax, kk[:ols] << 0.5md + (1.4sh, 2dt),
            "Ølsemagle"
        );
    }

    with link = "line.dk.KHK" {
        track(
                kk[:ols + 0.49sw, :ols + 0.5sw]
            ..  vr[:kon - 0.5sw, :kon - 0.49sw] << 1md << 2ms << 1mt
        );
    }

    with link = "point.dk.Køge-Nord", railway = :station {
        track(vr[:kon - 0.5sw, :kon + 0.5sw] << 1md << 2ms << 1mt);
    }

    with link = "line.dk.KHK" {
        track(:ror, vr[:kon + 0.5sw, :kon.yk] << 1md << 2ms << 1mt);
        track(:lor:ror :casing,
                vr[:kon.yk - 0.1dl, :kon.yk] << 1md << 2ms << 1mt
            ..  kk[:olb.yk, :olb.yk + 0.1dl] >> 0.5mt >> 1ms >> 0.5md
        );
        track(:lor, kk[:olb.yk, :olb - 0.5sw] >> 0.5mt >> 1ms >> 0.5md);

        # point.dk.Ølby  dk.RKN

        track(:lor, kk[:olb + 0.5sw, :kog.a] >> 0.5mt >> 1ms >> 0.5md);

        # point.dk.Køge  dk.RKN
    }
}

