# DE 1220.  Altona Palmaille - Kiel Altonaer Bf
#
#   Hamburg-Eidelstedt ausschl. - Kiel Hbf ausschl: d45
#
let altkie = path("path.de.1220");
let kieost = path("path.de.1022");

with detail = 4 {
    with link = "point.de.Altona-Palmaille" {
        track(:first :double :gone, altkie[:pal, :pal + 0.5sw]);
        marker(:de.bf :gone :bottom, altkie[:pal]);
    }


    with link = "line.de.1220" {
        with layer = -1 track(:first :double :gone, altkie[:pal + 0.5sw, :alt]);
    }


    with link = "point.de.Hamburg-Altona" {
        let spaalt = path("path.de.6100");

        # Richtungsgleis Strecke 1220
        track(:first:station :cat, altkie[:alt, :fbah] >> 0.5dt);

        # Gegenrichtungsgleis Strecke 6100
        with layer = 2 track(:first:station :cat,
                altkie[:alt, :aham - 100m] << 0.5dt
        );

        # Richtungsgleis Strecke 1231
        track(:first:station :cat,
                altkie[:alt, :aham] << 1.5dt
            ..  altkie[:fhol, :fbah] << 0.5dt
        );

        # Mittelgleis Strecke 1231
        track(:station :cat,
                altkie[:alt, :aham] << 2.5dt
            ..  altkie[:fbah - 1m, :fbah] << 0.5dt
        );

        # Abstellgleis
        track(:station :cat, altkie[:alt, :aham] << 3.5dt);
        track(:station :cat,
                altkie[:aham - 141m, :aham - 140m] << 3.5dt
            --  altkie[:aham - 100m, :aham] << 4.5dt
        );

        # Gegenrichtungsgleis Strecke 1231
        track(:first:station :cat,
                altkie[:alt, :atu] << 4.5dt
            ..  altkie[:aham - 101m, :aham - 100m] << 5.5dt
            ..  altkie[:fbah - 1m, :fbah] << 1.5dt
        );

        # Richtungsgleis Strecke 6100
        with layer = 2 track(:first:station :cat,
                altkie[:alt, :atu] << 5.5dt
            ..  altkie[:aham - 101m, :aham - 100m] << 6.5dt
        );

        # Gegenrichtungsgleis Strecke 1220
        track(:first:station :cat,
                altkie[:alt, :atu] << 6.5dt
            ..  altkie[:aham - 101m, :aham - 100m] << 7.5dt
            ..  altkie[:fbah - 1m, :fbah] << 2.5dt
        );

        area(:open,
                altkie[:alt - 1sh, :alt] >> 0.7dt
            --  altkie[:alt, :alt - 1sh] >> 6.7dt
        );
    }


    with link = "point.de.Hamburg-Altona-Gbf" {
        # Richtungsgleis Strecke 1232
        track(:first:station :cat, altkie[:fbah, :alt.f] >> 3.5dt);

        # Gegenrichtungsgleis Strecke 1232
        track(:first:station :cat, altkie[:fbah, :alt.f] >> 2.5dt);

        # Richtungsgleis Strecke 1220
        track(:first:station :cat,
                altkie[:fbah, :alt.f] >> 0.5dt
        );

        # Richtungsgleis Strecke 1231
        track(:first:station :cat,
                altkie[:fbah, :alt.f] << 0.5dt
        );

        # Mittelgleis Strecke 1231
        track(:station :cat,
                altkie[:fbah, :fbah + 1m] << 1.5dt
            --  altkie[:fbah + 100m, :alt.f - 160m] >> 1.5dt
            --  altkie[:alt.f - 100m, :alt.f - 99m] >> 2.5dt
        );

        # Gegenrichtungsgleis Strecke 1231
        track(:first:station :cat,
                altkie[:fbah, :alt.f] << 1.5dt
        );

        # Gegenrichtungsgleis Strecke 1220
        track(:first:station :cat, altkie[:fbah, :alt.f] << 2.5dt);

        # Strecke 1230
        track(:first:station, altkie[:fbah + 1sw, :alt.f] << 3.5dt);

        marker(:de.bft :left, altkie[:fbah + 1.5sw] << 3.5dt);
    }


    with link = "line.de.1220" {
        with layer = 2 track(:first:station :cat,
                altkie[:alt.f, :alt.f + 1m] << 2.5dt
            --  altkie[:ala.a - 0.5dt, :ala.a] >> 3.5dt
        );
        with layer = 1 casing(:first:station :cat,
                altkie[:alt.f, :alt.f + 1m] << 2.5dt
            --  altkie[:ala.a - 0.5dt, :ala.a] >> 3.5dt
        );
    }
    with link = "line.de.1230" {
        with layer = 2 track(:first:station,
                altkie[:alt.f, :alt.f + 0.6dt] << 3.5dt
            --  altkie[:ala.a - 1m, :ala.a] >> 2.5dt
        );
        with layer = 1 casing(:first:station,
                altkie[:alt.f, :alt.f + 0.6dt] << 3.5dt
            --  altkie[:ala.a - 1m, :ala.a] >> 2.5dt
        );
    }
    with link = "line.de.1232" {
        track(:first:station,
                altkie[:alt.f, :alt.f + 1.2dt] >> 3.5dt
            --  altkie[:ala.a - 1m, :ala.a] >> 0.5dt
        );
        track(:first:station,
                altkie[:alt.f, :alt.f + 0.8dt] >> 2.5dt
            --  altkie[:ala.a - 0.5dt, :ala.a] << 0.5dt
        );
    }
    with link = "line.de.1220" {
        track(:first:station,
                altkie[:alt.f, :alt.f + 1dt] >> 0.5dt
            --  altkie[:ala.a - 1.0dt, :ala.a] << 1.5dt
        );
    }
    with link = "line.de.1231" {
        track(:first:station,
                altkie[:alt.f, :alt.f + 0.5dt] << 0.5dt
            --  altkie[:ala.a - 1.5dt, :ala.a] << 2.5dt
        );
        track(:first:station,
                altkie[:alt.f, :alt.f + 1m] << 1.5dt
            --  altkie[:ala.a - 2dt, :ala.a] << 3.5dt
        );
    }
    
    with link = "point.de.Hamburg-Langenfelde-Bbf" {
        #--- Streckengleise

        # Gl. 403 (Richtungsgleis Strecke 1220)
        track(:first:station :cat,
                altkie[:ala.a, :ala.lr - 120m + 0.6dt] >> 3.5dt
            --  altkie[:ala.lr + 0.6dt, :ala - 240m] >> 1.5dt
        );

        # Strecke 1230
        track(:first:station,
                altkie[:ala.a, :ala.lr - 120m] >> 2.5dt
            --  altkie[:ala.lr, :ala.lr + 1m] >> 0.5dt
        );

        # Gegenrichtungsgleis Strecke 1231
        track(:first:station :cat,
                altkie[:ala.a, :ala.lr - 360m] << 3.5dt
            --  altkie[:ala.lr - 280m, :ala.lr - 279m] << 2.5dt
        );

        # Gl. 503 (Richtungsgleis Strecke 1232)
        track(:first:station :cat, altkie[:ala.a, :ala - 240m] >> 0.5dt);
        with layer = -1 casing(:first:station :cat,
                altkie[:ala.a, :ala.lr] >> 0.5dt
        );

        # Gl. 513 (Gegenrichtungsgleis Strecke 1232)
        track(:first:station :cat, altkie[:ala.a, :ala - 240m] << 0.5dt);
        with layer = -1 casing(:first:station :cat,
                altkie[:ala.a, :ala.lr] << 0.5dt
        );
            track(:station :cat,
                    altkie[:ala.a + 50m] >> 0.5dt
                --  altkie[:ala.a + 120m] << 0.5dt
            );
            track(:station :cat,
                    altkie[:ala.lr + 30m] >> 0.5dt
                --  altkie[:ala.lr + 90m] << 0.5dt
            );

        # Gl. 413 (Gegenrichtungsgleis Strecke 1220)
        track(:first:station :cat, altkie[:ala.a, :ala - 240m] << 1.5dt);
        with layer = -1 casing(:first:station :cat,
                altkie[:ala.a, :ala.lr] << 1.5dt
        );
            track(:station :cat,
                    altkie[:ala.a + 140m] << 0.5dt
                --  altkie[:ala.a + 210m] << 1.5dt
            );
            track(:station :cat,
                    altkie[:ala.lr + 120m] << 0.5dt
                --  altkie[:ala.lr + 220m] << 1.5dt
            );


        #--- Bahnhofsgleise

        # Gl. 1 (Richtungsgleis Strecke 1231)
        track(:first:station :cat, altkie[:ala.a, :ala - 220m] << 2.5dt);
        with layer = -1 casing(:first:station :cat,
                altkie[:ala.a, :ala.lr] << 2.5dt
        );
            track(:station :cat,
                    altkie[:ala.a + 230m] << 1.5dt
                --  altkie[:ala.a + 290m] << 2.5dt
            );
            track(:station :cat,
                    altkie[:ala.lr + 250m] << 1.5dt
                --  altkie[:ala.lr + 310m] << 2.5dt
            );

        # Gl. 2/3/4/5
        track(:station,
                altkie[:ala.lr - 160m, :ala - 140m - 3dt] << 3.5dt
            --  altkie[:ala - 60m - 3dt, :ala - 59m - 3dt] << 5.5dt
        );

        # Gl. 6/7/8/9
        track(:station, altkie[:ala.lr - 120m, :ala - 100m - 3dt] << 4.5dt);

        # Gl. 10/11/12/13
        track(:station, altkie[:ala.lr - 80m, :ala + 400m - 0.3sw] << 5.5dt);
            track(:station,
                    altkie[:ala + 20m + 1.5dt] << 5.5dt
                --  altkie[:ala + 140m + 1.5dt] << 2.5dt
            );
            track(:station,
                    altkie[:ala + 60m + 1.5dt] << 5.5dt
                --  altkie[:ala + 140m + 1.5dt] << 7.5dt
            );

        # Gl. 14/15/16/17
        track(:station,
                altkie[:ala.lr - 40m, :ala - 100m - 6dt] << 6.5dt
            --  altkie[:ala - 60m - 6dt, :ala - 59m - 6dt] << 5.5dt
        );

        # Gl. 18/19/20/21
        track(:station,
                altkie[:ala.lr - 201m, :ala.lr - 200m] << 2.5dt 
            --  altkie[:ala.lr - 160m] << 3.5dt
            --  altkie[:ala.lr - 80m] << 5.5dt
            --  altkie[:ala.lr, :ala - 140m - 4.5dt] << 7.5dt
            --  altkie[:ala - 60m - 4.5dt, :ala - 59m - 4.5dt] << 5.5dt
        );

        # Gl. 30
        track(:station, altkie[:ala - 220m, :laa - 230m] << 2.5dt);

        # Gl. 31/32/33
        track(:station,
                altkie[:ala - 181m, :ala - 180m] << 2.5dt
            --  altkie[:ala - 140m, :ala + 100m] << 3.5dt
            --  altkie[:ala + 140m, :ala + 141m] << 2.5dt
        );

        # Gl. 34/35/36/37
        track(:station,
                altkie[:ala - 181m - 1.5dt, :ala - 180m - 1.5dt] << 2.5dt
            --  altkie[:ala - 100m - 1.5dt, :ala + 60m + 1.5dt] << 4.5dt
        );

        # Gl. 40/41/42/43
        track(:station,
                altkie[:ala - 181m - 3dt, :ala - 180m - 3dt] << 8.5dt
            --  altkie[:ala - 100m - 3dt, :ala + 100m + 1.5dt] << 6.5dt
        );

        # Gl. 44/46/48/49 - Gl. 212/213/214
        track(:station,
                altkie[:ala - 140m - 3dt, :ala.ln + 100m + 0.8dt] << 7.5dt
            ..  altkie[:ala.f - 800m + 0.8dt, :ala.f - 640m] << 4.5dt
            --  altkie[:ala.f - 600m, :ala.f - 599m] << 3.5dt
        );

        # Gl. 55/56/57
        track(:station, altkie[:ala.lr + 80m - 3dt, :ala + 260m] << 9.5dt);

        # Gl. 120/63/64/65
        track(:station,
                altkie[:ala.lr + 200m - 3.5dt, :ala.ln + 80m] << 13.5dt
            --  altkie[:ala.ln + 200m, :ala.ln + 201m] << 11.5dt
        );

        # Gl. 66/67/68/69
        track(:station,
                altkie[:ala.lr + 240m - 3.5dt, :ala + 340m] << 14.5dt
        );

        # Gl. 70/71/72/73
        track(:station,
                altkie[
                    :ala.lr + 119m - 3.5dt,
                    :ala.lr + 120m - 3.5dt
                ] << 11.5dt
            --  altkie[:ala.lr + 280m - 3.5dt, :ala + 300m] << 15.5dt
            --  altkie[:ala + 380m, :ala + 381m] << 13.5dt
        );

        # Gl. 96 - Gl. 60/61
        track(:station,
                altkie[:ala.lr - 100m] << 5.0dt
            --  altkie[:ala.lr + 40m - 3.3dt] << 9.5dt
            --  altkie[:ala.lr + 120m - 3.5dt, :ala.ln + 140m] << 11.5dt
            ..  altkie[:ala.f - 660m, :ala.f - 640m + 0.5dt] << 5.5dt
            --  altkie[:ala.f - 560m + 0.5dt, :ala.f - 559m + 0.5dt] << 3.5dt
        );


        # Gl. 97 - Gl. 58/59
        track(:station,
                altkie[:ala.lr - 400m] << 3.5dt
            --  altkie[:ala.lr - 80m - 3dt] << 5.5dt
            --  altkie[:ala.lr + 120m - 3dt, :ala + 220m] << 10.5dt
        );

        # Gl. 98 - Gl. 52/53/54
        with layer = -2 track(:station,
                altkie[:ala.a, :ala.a + 1m] >> 0.5dt
            --  altkie[:ala.a + 40m, :ala.a + 80m] >> 1.5dt
            --  altkie[:ala.lr - 80m - 1.5dt] << 5.5dt
            --  altkie[:ala.lr - 1.5dt] << 7.5dt
            --  altkie[:ala.lr + 40m - 1.5dt, :ala + 260m - 0.5dt] << 8.5dt
            --  altkie[:ala + 300m - 0.5dt, :ala + 301m - 0.5dt] << 7.5dt
        );

        # Gl. 101-107
        track(:station,
                altkie[:ala + 220m + 1.3dt, :ala.ln + 100m] << 10.5dt
            --  altkie[:ala.ln + 140m, :ala.ln + 141m] << 11.5dt
        );

        # Gl. 116/117/118/119
        track(:station,
                altkie[:ala.lr + 160m - 3.5dt, :ala + 300m] << 12.5dt
            --  altkie[:ala + 340m, :ala + 341m] << 13.5dt
        );

        # Gl. 131/132/133
        track(:station,
                altkie[:ala + 179m + 1.3dt, :ala + 180m + 1.3dt] << 11.5dt
            --  altkie[:ala + 260m + 1.3dt, :ala + 610m] << 9.5dt
            --  altkie[:ala + 650m, :ala + 651m] << 10.5dt
        );

        # Gl. 200
        track(:station,
                altkie[:laa - 230m, :ala.ln + 40m] << 2.5dt
            --  altkie[:ala.ln + 120m, :ala.ln + 121m] << 4.5dt
        );

        # Gl. 201/202/204
        track(:station,
                altkie[:ala + 60m + 1.5dt, :ala + 400m - 0.3sw] << 4.5dt
        );

        # Gl. 214/215/216
        track(:station,
                altkie[:ala + 179m, :ala + 180m] << 11.5dt
            --  altkie[:ala + 300m, :ala.ln + 60m] << 8.5dt
            --  altkie[:ala.ln + 100m, :ala.ln + 101m] << 7.5dt
        );

        # Gl. 217/218
        track(:station,
                altkie[:ala + 609m + 0.5dt, :ala + 610m + 0.5dt] << 8.5dt
            --  altkie[:ala + 650m + 0.5dt, :ala.ln + 60m + 0.5dt] << 9.5dt
            --  altkie[:ala.ln + 140m + 1.5dt, :ala.ln + 141m + 1.5dt] << 7.2dt
        );

        # Gl. 221/222/223/224
        track(:station,
                altkie[:ala + 299m + 0.5dt, :ala + 300m + 0.5dt] << 11.5dt
            --  altkie[:ala + 340m + 0.5dt, :ala.ln + 140m] << 12.5dt
        );

        # Gl. 201 - Gl. 401
        track(:station,
                altkie[:ala + 400m + 0.3sw, :ala.ln + 140m] << 4.5dt
             .. altkie[:ala.f - 800m, :ala.f] << 2.5dt
        );

        # Gl. 207/208 - Gl. 402/403
        track(:station,
                altkie[:ala + 400m + 0.3sw, :ala.ln + 140m + 0.4dt] << 5.5dt
            ..  altkie[:ala.f - 800m + 0.4dt, :ala.f - 120m] << 3.5dt
            --  altkie[:ala.f - 80m, :ala.f - 79m] << 2.5dt
        );

        marker(:de.bbf :left, altkie[:ala] << 15.5dt);
        marker(:de.bw :left, altkie[:ala + 400m] << 3.5dt);
    }


    with link = "line.de.1220" {
        track(:first :cat :tight, altkie[:ala - 240m, :laa - 220m] >> 1.5dt);
        track(:first :cat :flip :tight,
                altkie[:ala - 240m, :laa - 220m] << 1.5dt
        );
    }
    with link = "line.de.1232" {
        track(:first :double :cat, altkie[:ala - 240m, :laa - 220m]);
    }


    with link = "point.de.Hamburg-Langenfelde-Abzw" {
        # Gl. 404
        track(:first:station :cat, altkie[:laa - 220m, :laa +340m] >> 1.5dt);
            track(:station,
                    altkie[:laa +  60m] >> 0.5dt
                --  altkie[:laa + 170m] >> 1.5dt
            );

        # Gl. 504
        track(:first:station :cat, altkie[:laa - 220m, :laa +340m] >> 0.5dt);
            track(:station,
                    altkie[:laa - 130m] >> 1.5dt
                --  altkie[:laa -  10m] >> 0.5dt
            );
            track(:station,
                    altkie[:laa - 20m] << 0.5dt
                --  altkie[:laa + 40m] >> 0.5dt
            );

        # Gl. 514
        track(:first:station :cat, altkie[:laa - 220m, :laa +340m] << 0.5dt);
            track(:station,
                    altkie[:laa - 100m] << 1.5dt
                --  altkie[:laa -  40m] << 0.5dt
            );

        # Gl. 414
        track(:first:station :cat, altkie[:laa - 220m, :laa +340m] << 1.5dt);
            track(:station,
                    altkie[:laa - 230m] << 2.5dt
                --  altkie[:laa - 150m] << 1.5dt
            );

        with layer = -1 marker(:de.abzw.casing :right, altkie[:laa] >> 1.5dt);
        with layer = 1 marker(:de.abzw :right, altkie[:laa] >> 1.5dt);
    }

    with link = "line.de.1220" {
        track(:first :cat :tight, altkie[:laa + 240m, :ala.f] >> 1.5dt);
        track(:first :cat :flip :tight,
                altkie[:laa - 340m, :ala.f] << 1.5dt
        );
    }
    with link = "line.de.1232" {
        track(:first :double :cat, altkie[:laa + 340m, :ala.f]);
    }


    with link = "point.de.Hamburg-Eidelstedt" {
        # Gl. 1 (Gegenrichtungsgleis Strecke 1220)
        track(:first:station :cat,
                altkie[:ala.f, :ala.f + 1dl] << 1.5dt
            ..  altkie[:frot + 300m, :eid.en - 700m] << 7.5dt
            ..  altkie[:eid.en - 2dl, :eid.en + 2dl] << 1.5dt
            --  altkie[:eid.en + 3dl, :eid.f] << 0.5dt
        );
        with layer = -1 casing(:first:station :cat,
                altkie[:ala.f, :ala.f + 1dl] << 1.5dt
            ..  altkie[:frot + 300m, :eid.ef] << 7.5dt
        );

        # Gl. 10
        track(:station,
                altkie[:frot + 300m - 1.1dl, :frot + 300m - 1dl] << 7.5dt
            --  altkie[:frot + 300m, :eid.ef] << 6.5dt
            --  altkie[:eid.ef + 2dl, :eid.ef + 2.1dl] << 4.5dt
        );

        # Gl. 11/12/13
        track(:station,
                altkie[:frot + 3dl, :frot + 300m - 3dl] << 2.5dt
            --  altkie[:frot + 300m, :eid.ef + 2dl] << 5.5dt
        );

        # Gl. 14/15/16/17
        track(:station,
                altkie[:frot + 300m - 1dl, :eid.ef + 2dl] << 4.5dt
        );

        # Gl. 18/19/20/21
        track(:station, altkie[:frot + 300m - 2dl, :eid.ef] << 3.5dt);

        # Gl. 28 etc.
        track(:station,
                altkie[:eid.egs - 1.1dl, :eid.egs - 1dl] << 0.5dt
            --  altkie[:eid.egs + 1dl, :eid.en - 700m] << 2.5dt
            ..  altkie[:eid.en - 2dl, :eid.en + 1dl] << 0.5dt
            --  altkie[:eid.en + 2dl, :eid.en + 2.1dl] >> 0.5dt
        );
            track(:station,
                    altkie[:eid.ef - 1dl] << 2.5dt
                --  altkie[:eid.ef + 2dl] << 5.5dt
            );
            track(:station,
                    altkie[:eid.en - 1dl] << 0.5dt
                --  altkie[:eid.en] << 1.5dt
            );

        # Gl. 28+
        track(:station,
                altkie[:eid.ef + 0.9dl, :eid.ef + 1.0dl] << 2.5dt
            --  altkie[:eid.ef + 2.0dl, :eid.eo - 400m - 1.0dl] << 3.5dt
            --  altkie[:eid.eo - 400m, :eid.eo - 399m] << 2.5dt
        );

        # Gl. 30 (Gegenrichtungsgleis Strecke 1232)
        track(:first:station :cat,
                altkie[:ala.f, :ala.f + 1dl] << 0.5dt
            ..  altkie[:frot, :frot + 3dl] << 2.5dt
        );
            track(:station,
                    altkie[:eid.egs - 5dl] >> 0.5dt
                --  altkie[:eid.egs - 4dl] << 0.5dt
            );
            track(:station,
                    altkie[:frot] << 2.5dt
                --  altkie[:frot + 1dl] << 1.5dt
            );

        # Gl. 31 (Strecke 1234)
        with layer = -4 track(:first:station :cat,
                path("path.de.1234")[:aa + 6dt, :aa]
            ..  altkie[:frot, :frot + 1dl] << 1.5dt
            ..  altkie[:eid.egs - 5dl, :eid.egs - 1dl] << 0.5dt
        );
            track(:station,
                    altkie[:eid.egs - 3dl] << 0.5dt
                --  altkie[:eid.egs - 2dl] >> 0.5dt
            );

        # Gl. „32“ (Richtungsgleis Strecke 1232)
        track(:first:station :cat, altkie[:ala.f, :eid.egs] >> 0.5dt);
        with layer = -1 casing(:first :cat,
                altkie[:eis, :frot] >> 0.5dt
        );

        # Gl. 54/57/58
        track(:station, altkie[:eid.egs, :eid.eo] << 1.5dt)

        # Gl. 59/60/61        
        track(:station,
                altkie[:eid.egs - 1m, :eid.egs] >> 0.5dt
            --  altkie[:eid.egs + 1dl, :eid.eo] << 0.5dt
            ..  altkie[:eid.eo + 120m, :eid.eo + 300m + 3dl] >> 0.5dt
        );
            track(:station,
                    altkie[:eid.eo + 300m] >> 0.5dt
                --  altkie[:eid.eo + 300m + 1dl] >> 1.5dt
            );

        # Gl. 62 
        track(:station,
                altkie[:eid.egs, :eid.eo - 2dl] >> 0.5dt
            --  altkie[:eid.eo, :eid.eo + 1m] << 1.5dt
        );

        # Gl. 281/282
        track(:station, altkie[:eid.eo, :eid.en - 1km] << 1.5dt);

        # Gl. 283/284
        track(:station,
                altkie[:eid.eo + 249m, :eid.eo + 250m] << 1.5dt
            --  altkie[:eid.eo + 250m + 1dl, :eid.en - 1km] << 0.5dt
        );

        # Gl. 400
        with layer = -2 track(:station,
                altkie[:ala.f, :ala.f + 1dl] << 2.5dt
            ..  altkie[:frot, :frot + 4dl] << 3.5dt
        );
            track(:station,
                    altkie[:frot + 2dl] << 3.5dt
                --  altkie[:frot + 3dl] << 2.5dt
            );

        # Gl. 405 (Richtungsgleis Strecke 1220)
        track(:first:station :cat,
                altkie[:ala.f, :esn - 1km] >> 1.5dt
            ..  altkie[:esn - 300m, :eid.f] >> 0.5dt
        );
        with layer = -1 casing(:first :cat,
                altkie[:eis, :frot] >> 1.5dt
        );
            track(:station,
                    altkie[:eid.f - 100m - 1dl] >> 0.5dt
                --  altkie[:eid.f - 100m] << 0.5dt
            );

        # Gl. 501/502/505/506
        track(:station,
                altkie[:eid.ef + 2dl, :eid.ef + 3dl] << 5.5dt
            ..  altkie[:eid.eo - 400m, :eid.en - 700m] << 6.5dt
        );

        # Abstellgleise zwischen Eo and En
        track(:station,
                altkie[:eid.eo + 800m + 2.9dl, :eid.eo + 800m + 3dl] << 6.5dt
            --  altkie[:eid.eo + 800m + 5dl, :eid.en - 700m] << 4.5dt
        );
        track(:station,
                altkie[:eid.eo + 800m + 4dl, :eid.en - 700m] << 5.5dt
        );

        # Gl. 507/508/509
        track(:station,
                altkie[:eid.ef + 2dl, :eid.eo - 400m] << 4.5dt
            --  altkie[:eid.eo - 400m + 1dl, :eid.eo - 100m - 0.5sw] << 5.5dt
        );
        track(:station,
                altkie[:eid.eo - 100m + 0.5sw, :eid.eo + 800m] << 5.5dt
            --  altkie[:eid.eo + 800m + 1dl, :eid.eo + 800m + 1.1dl] << 6.5dt
        );

        # Gl. 510
        track(:station,
                altkie[:eid.eo - 400m + 1.9dl, :eid.eo - 400m + 2dl] << 5.5dt
            --  altkie[:eid.eo - 400m + 3dl, :eid.eo - 100m - 0.5sw] << 4.5dt
        );
        track(:station,
                altkie[:eid.eo - 100m + 0.5sw, :eid.eo + 160m] << 4.5dt
            --  altkie[:eid.eo + 160m + 1dl, :eid.eo + 160m + 1.1dl] << 5.5dt
        );

        # Gl. 511/512/513
        track(:station,
                altkie[:eid.eo - 401m, :eid.eo - 400m] << 4.5dt
            --  altkie[:eid.eo - 400m + 1dl, :eid.eo - 100m - 0.5sw] << 3.5dt
        );
        track(:station,
                altkie[:eid.eo - 100m + 0.5sw, :eid.eo + 160m + 1dl] << 3.5dt
            --  altkie[:eid.eo + 160m + 3dl, :eid.eo + 160m + 3.1dl] << 5.5dt
        );

        marker(:de.bft :left, altkie[:eif] << 7.5dt);
        marker(:de.bbf :left, altkie[:eid] << 7.5dt);
        marker(:de.bw :left, altkie[:eid.eo - 100m] << 3.0dt);
        marker(:de.bft :right, altkie[:eio] >> 1.5dt);
        with layer = -1 marker(:de.bft.casing :right, altkie[:eio] >> 1.5dt);
        marker(:de.bft :left, altkie[:esn] << 0.5dt);
    }

    with link = "line.de.1220" {
        track(:first :double :cat, altkie[:eid.f, :pin.a]);
        with layer = 1 badge(
            altkie[:hal + 0.9km] >> 1.0dt,
            vbox(:center:middle :badgesize, "1225", "1220")
        );
    }


    with link = "point.de.Thesdorf-Bk" {
        with layer = -1 marker(:de.bk :removed :left, altkie[:the] << 0.5dt);
        station(:left :removed, altkie[:the - 0.2sw] << 0.5dt << 1.8sh,
            "Thesdorf", "13,81"
        );
    }


    with link = "point.de.Pinneberg" {
        # Gl. 3
        track(:station,
                altkie[:pin - 301m, :pin - 300m] >> 0.5dt
            --  altkie[:pin - 300m + 2dl, :pin + 320m] >> 1.5dt
            --  altkie[:pin + 320m + 2dl, :pin + 320m + 2.1dl] >> 0.5dt
        );

        # Gl. 4 (Richtungsgleis)
        track(:first:station :cat, altkie[:pin.a, :pin.f] >> 0.5dt);
            track(:station,
                    altkie[:pin.a + 100m] >> 0.5dt
                --  altkie[:pin.a + 100m + 2dl] << 0.5dt
            );
            track(:station,
                    altkie[:pin + 320m] >> 0.5dt
                --  altkie[:pin + 320m + 2dl] << 0.5dt
            );
            track(:station,
                    altkie[:pin + 320m + 3dl] >> 0.5dt
                --  altkie[:pin + 320m + 5dl] << 0.5dt
            );

        # Gl. 5 (Gegenrichtungsgleis)
        track(:first:station :cat, altkie[:pin.a, :pin.f] << 0.5dt);
            track(:station,
                    altkie[:pin.a + 100m + 3dl] << 0.5dt
                --  altkie[:pin.a + 100m + 5dl] >> 0.5dt
            );
            track(:station,
                    altkie[:pin.f - 100m - 2dl] << 0.5dt
                --  altkie[:pin.f - 100m] >> 0.5dt
            );

        # Gl. 6
        track(:station,
                altkie[:pin - 301m, :pin - 300m] << 0.5dt
            --  altkie[:pin - 300m + 2dl, :pin.f - 100m - 5dl] << 1.5dt
            --  altkie[:pin.f - 100m - 3dl, :pin.f + 100m - 2.9dl] << 0.5dt
        );

        # Gl. 31
        track(:station,
                altkie[:pin + 79m, :pin + 80m] >> 1.5dt
            --  altkie[:pin + 80m + 1dl, :pin + 350m] >> 2.5dt
        );

        marker(:de.bf :right, altkie[:pin] >> 1.5dt);
        station(:left, altkie[:pin - 0.2sw] << 2.5dt << 2.8pt,
            span(:bold, "Pinneberg"),
            "1220: 15,95"
        );
    }

    
    # Pinneberg ausschl. - Kiel Hbf ausschl.: d45


    with link = "point.de.Kiel-Hbf" {
        # Gleis 1
        track(:station,
                altkie[:kie.kp - 2.1dl, :kie.kp - 2dl] >> 1.5dt
            --  altkie[:kie.kp - 1dl, :kie] >> 2.5dt
        );

        # Gleis 2 - aus Neustadt
        track(:first :station, altkie[:kie.a, :kie] >> 1.5dt);

        # Gleis 3 & 4 - aus Altona
        track(:double :first :station, altkie[:kie.a, :kie]);

        # Gleis 5 - aus Hassee
        with layer = -1 track(:first :station :removed,
                kieost[:fmei, :fmei - 1dl] >> 0.5dt
            ..  altkie[:fhas - .1dl, :fhas] << 1.5dt
        );
        track(:first :station, altkie[:fhas, :kie] << 1.5dt);
        
        track(:station, altkie[:kie.ko + 2dl, :fhas] << 1.5dt);

        # Gleis 6 - nach Hassee
        track(:first :station,
                kieost[:fmei, :fmei - 1dl] << 0.5dt
            ..  altkie[:fhas - .1dl, :kie] << 2.5dt
        );

        # Gleis 19
        track(:first :station,
                altkie[:kie.a, :kie.ks + 4dl] >> 2.5dt
            --  altkie[:kie.ks + 5dl, :kie.ks + 5.1dl] >> 1.5dt
        );
        with layer = -1 track(:station :removed,
                altkie[:kie.ks + 4dl, :kie.kp - 3dl] >> 2.5dt
        );

        # Gleis 21
        track(:station, altkie[:kie.ko + 5dl, :kie.ks + 2dl] >> 3.5dt);

        # Gleis 22
        track(:station,
                altkie[:kie.ko + 3.9dl, :kie.ko + 4dl] >> 2.5dt
            --  altkie[:kie.ko + 6dl, :kie.ks + 1dl] >> 4.5dt
            --  altkie[:kie.ks + 3dl, :kie.ks + 3.1dl] >> 2.5dt
        );

        marker(:de.bft :right, altkie[:kie.ko - 1.0dl - 0.3sw] >> 2.5dt);
        with detail = 5 {
            station(:right, altkie[:kie.ko - 0.8sw] >> 2.5dt >> 1.2sh,
                "K. Hbf Ko", "??"
            );
        }

        area(:open,
                altkie[:kie, :kie + 1sh] >> 2.7dt
            --  altkie[:kie + 1sh, :kie] >> 2.7dt
        );
        label(altkie[:kie - 0.2sw] << 3.5dt, hbox(:right:bottom,
            vbox(:center:bottom,
                hbox(:center:top :xsmall,
                    vbox(:right:top,
                        span(:open, "1022: "),
                        span(:open, "1023: "),
                        span(:open, "1032: "),
                        span(:open, "1220: ")
                    ),
                    vbox(:right:top,
                        span(:open, "0,"),
                        span(:open, "0,"),
                        span(:open, "?"),
                        span(:open, "105,")
                    ),
                    vbox(:left:top,
                        span(:open, "09"),
                        span(:open, "05"),
                        span(:open, "?"),
                        span(:open, "59")
                    )
                ),
                span(:medium :bold, "KIEL Hbf")
            )
        ));
    }

    with link = "point.de.Kiel-Altonaer-Bf" {
        with layer = -2 track(:double :first :gone, altkie[:kie, :kia]);
        marker(:de.bf :top :gone, altkie[:kia]);
    }
}

