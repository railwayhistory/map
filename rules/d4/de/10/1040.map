# DE 1040.  Neumünster (ausschl) - Flensburg (einschl)
#
let altkie = path("path.de.1220");
let flefri = path("path.de.1005");
let flwhag = path("path.de.1000");
let flwlin = path("path.de.1001");
let hasfle = path("path.de.1020");
let husflw = path("path.de.12035");
let neufle = path("path.de.1040");
let neufle.neu = path("path.de.1040.neu");
let slefri = path("path.de.9103");
let slesla = path("path.de.1010");


with detail = [4, 5] {

    # Streckengleise Neumünster - Nortorf
    track(:double :first :cat, neufle[:a, :nor.a]);
    with layer = 1 line_badge(:open, neufle[:xneu + 0.7km], "1040");

    # alte Streckengleise Ausfahrt Neumünster
    with layer = -1 {
        track(:double :first :gone,
                altkie[:ahei, :ahei + 0.1dl] << 1dt
            ..  neufle.neu[:a, :f]
            ..  neufle[:xneu, :xneu + 0.1dl]
        );
    }

    
    #--- point.de.Stover
    #
    with layer = -1 marker(:de.bk :removed :left, neufle[:sto] << 0.5dt);
    station(:left :removed, neufle[:sto - 0.4sw] << 0.5dt << 1.8sh,
        "Stover", "80,09 (79,34)"
    );


    #--- point.de.Aspe
    with layer = -1 marker(:de.bf :closed :right, neufle[:asp] >> 0.5dt);
    station(:right :left_align :closed, neufle[:asp - 0.4sw] >> 0.5dt >> 1.4sh,
        "Aspe", "84,13 (83,38)"
    );


    #--- point.de.Nortorf
    track(:double :first :station, neufle[:nor.a, :nor.f]);
    track(:station,
            neufle[:nor.a + 0.9dl, :nor.a + 1dl] << 0.5dt
        --  neufle[:nor.a + 2dl, :nor.a + 2.1dl] >> 0.5dt
    );
    track(:station,
            neufle[:nor.f - 2.1dl, :nor.f - 2dl] >> 0.5dt
        --  neufle[:nor.f - 1dl, :nor.f - 0.9dl] << 0.5dt
    );
    marker(:de.bf :right, neufle[:nor] >> 0.5dt);
    station(:right :left_align, neufle[:nor - 0.4sw] >> 0.5dt >> 1.4sh,
        "Nortorf",
        hbox(:left :base,
            span(:xsmall, "88,87 "),
            span(:xsmall :closed, "(88,12)")
        )
    );

    # Streckengleise Nortorf - Bokelholm
    track(:double :first :cat, neufle[:nor.f, :bos - 1sw]);


    #--- point.de.Bokel
    #
    with layer = -1 marker(:de.hp :closed :left, neufle[:bok] << 0.5dt);
    with layer = -2 marker(:de.bf :gone :left, neufle[:bok] << 0.5dt);
    station(:left :right_align :closed,
        neufle[:bok - 0.4sw] << 0.5dt << 1.65sh,
        "Bokel", "95,13 (94,37)"
    );


    #--- point.de.Bokelholm-Süd
    #    point.de.Bokelholm
    #    point.de.Bokelholm-Nord
    track(:first :station, neufle[:bos - 1sw, :bon + 1sw] << 0.5dt);
    track(:first :station,
            neufle[:bos - 1sw, :bos - 1dl] >> 0.5dt
        --  neufle[:bos, :bon] >> 1.5dt
        --  neufle[:bon + 1dl, :bon + 1sw] >> 0.5dt
    );
    with layer = -1 {
        track(:station :closed, neufle[:bos - 1dl, :bon + 1dl] >> 0.5dt);
        marker(:de.bk :left :closed, neufle[:bos] << 0.5dt);
        marker(:de.bf :closed, neufle[:boh] >> 1.5dt);
        marker(:de.bk :left :closed, neufle[:bon] << 0.5dt);
    }
    station(:right :closed, neufle[:boh - 0.4sw] >> 1.5dt >> 1.4sh,
        "Bokelholm", "99,53 (98,44)"
    );
    slabel(:left :closed, neufle[:bos - 0.3sw] << 0.5dt << 1.7sh,
        span(:medium :closed, "Bokelholm Süd")
    );
    slabel(:left :closed,
        neufle[:bon - 0.3sw] << 0.5dt << 1.7sh - (0.5sw, 0dt),
        span(:medium :closed, "Bokelholm Nord")
    );

    # Streckengleise Bokelholm - Osterrönfeld
    track(:double :first :cat, neufle[:bon + 1sw, :oro.a]);
    with layer = 1 line_badge(:open, neufle[:oro - 3.0km], "1040");

    #--- point.de.Osterrönfeld
    #
    track(:double :first :station, neufle[:oro.a, :oro + 1sw]);
    track(:first :station,
            neufle[:oro - 1sw, :oro - 0.9sw] >> 1.5dt
        --  neufle[:oro - 0.9sw + 1dl, :oro - 0.9sw + 1.1dl] >> 0.5dt
    );
    track(:station,
            neufle[:oro - 0.9sw + 1.9dl, :oro - 0.9sw + 2dl] >> 0.5dt
        --  neufle[:oro - 0.9sw + 3dl, :oro - 0.9sw + 3.1dl] << 0.5dt
    );
    marker(:de.bf :right, neufle[:oro] >> 0.5dt);
    station(:left, neufle[:oro - 0.4sw] << 0.5dt << 1.0sh,
        span(:medium :bold, "Osterrönfeld"),
        hbox(:center :top,
            vbox(:right :top,
                span(:xsmall, "1022: "), span(:xsmall, "1040: ")
            ),
            vbox(:right :top,
                span(:xsmall, "30,"), span(:xsmall, "105,")
            ),
            vbox(:left :top,
                span(:xsmall, "96"), span(:xsmall, "01")
            ),
            vbox(:left :top,
                span(:xsmall, ""),
                span(:xsmall :closed, " (104,39)")
            )
        )
    );

    # Streckengleise Osterrönfeld - Rendsburg
    with layer = 2 track(:double :first :cat, neufle[:oro + 1sw, :orb - 3dl]);
    with layer = 2 track(:double :first :cat, neufle[:orb + 3dl, :ren.a]);
    with layer = 1.5 casing(:double :first :cat, neufle[:bhba, :bhbf]);


    #--- point.de.Osterrönfeld-Brücke
    #
    with layer = 2 {
        track(:double :first :station, neufle[:orb - 3dl, :orb + 3dl]);
        track(:station,
                neufle[:orb - 2.1dl, :orb - 2dl] << 0.5dt
            --  neufle[:orb - 1dl, :orb - 0.9dl] >> 0.5dt
        );
        track(:station,
                neufle[:orb + 0.9dl, :orb + 1dl] >> 0.5dt
            --  neufle[:orb + 2dl, :orb + 2.1dl] << 0.5dt
        );
        marker(:de.uest :right, neufle[:orb] >> 0.5dt);

        with detail = 5 {
            station(:top, neufle[:orb] >> 0.5dt >> 1.3sh,
                vbox(:center :bottom,
                    hbox(:center :base,
                        span(:medium :light :removed, "Osterrönfeld "),
                        span(:medium :removed, "Brücke")
                    ),
                    hbox(:center :base,
                        span(:medium :light, "Rendsburg "),
                        span(:medium, "Hochbrücke")
                    )
                ),
                "106,49"
            );
        }
    }

    #--- point.de.Hochbrücke
    #
    with layer = 1.8 {
        marker(:de.bk :removed :left, neufle[:hbr] << 0.5dt);
        with detail = 5 {
            station(:left :removed, neufle[:hbr - .4sw] << 0.5dt << 1.4sh,
                "Hochbrücke",
                "(104,4+2856)"
            )
        }
    }

    #--- point.de.Rendsburg-Brücke
    #
    with layer = 1.8 {
        marker(:de.uest :removed :left, neufle[:rbr] << 0.5dt);
        with detail = 5 {
            station(:left :removed, neufle[:rbr] << 0.5dt << 1.5sh,
                hbox(:right :base,
                    span(:medium :light :removed, "Rendsburg "),
                    span(:medium :removed, "Brücke")
                ),
                "109,8"
            )
        }
    }

    # Rendsburg Überlänge
    with layer = 1.8 {
        marker(:statdt :removed, neufle[:xren] >> 0.5dt);
        marker(:statdt :removed, neufle[:xren] << 0.5dt);
        marker(:statdt :removed, neufle[:xren] << 1.5dt);
        with detail = 5 {
            label(neufle[:xren] << 2.5dt,
                vbox(:right :bottom,
                    hbox(:right :base,
                        span(:xsmall, "110,063 "),
                        span(:xsmall :removed, "(104,40+4913 = 104,50)")
                    )
                )
            );
        }
    }

    #--- point.de.Rendsburg-Schleife
    #
    with layer = 1.8 {
        marker(:de.bk :removed :left, neufle[:rsl] << 0.5dt);
        with detail = 5 {
            station(:top :removed, neufle[:rsl] << 0.5dt << 1.4sh,
                "Schleife", "(105,11)"
            );
        }
    }


    #--- point.de.Rendsburg
    #
    # Gl. 1.
    track(:first :station, neufle[:ren.a, :bud.a] << 0.5dt);
    # W1 - W2
    track(:station,
            neufle[:ren.rf - 7.1dl, :ren.rf - 7dl] << .5dt
        --  neufle[:ren.rf - 6dl, :ren.rf - 5.9dl] >> .5dt
    );

    # Gl. 2
    track(:station,
            neufle[:ren - .2km - 1.1dl, :ren - .2km - 1dl] << 0.5dt
        --  neufle[:ren - .2km, :ren + .6sw] >> 0.5dt
        --  neufle[:ren + .6sw + 1dl, :ren + .6sw + 1.1dl] << 0.5dt
    );

    # Gl. 3
    track(:first :station,
            neufle[:ren.a, :ren.rf] >> 0.5dt
        ..  neufle[:ren - .2km, :ren + .6sw + 1.5dl] >> 1.5dt
        --  neufle[:ren + .6sw + 2.5dl, :bud.a] >> .5dt
    );
    # W6 - W7
    track(:station,
            neufle[:ren.rf - .1dl, :ren.rf] >> .5dt
        --  neufle[:ren.rf + 1dl, :ren.rf + 1.1dl] << 0.5dt
    );

    # Gl. 4
    track(:station,
            neufle[:ren.a, :ren.rf] >> 1.5dt
        ..  neufle[:ren - .2km, :ren + .6sw + 3dl] >> 2.5dt
        --  neufle[:ren + .6sw + 4dl, :ren + .6sw + 5dl] >> 1.5dt
        --  neufle[:ren + .6sw + 6dl, :ren + .6sw + 6.1dl] >> 0.5dt
    );
    track(:station,
            neufle[:ren.rf - 5.1dl, :ren.rf - 5dl] >> .5dt
        --  neufle[:ren.rf - 4dl, :ren.rf - 3.9dl] >> 1.5dt
    );
    with layer = -1 track(:station :removed,
            neufle[:ren + .6sw + 5dl, :ren + .6sw + 8dl] >> 1.5dt
    );

    # Gl. 5
    track(:station :removed,
            neufle[:ren.rf - 2dl, :ren.rf] >> 2.5dt
        ..  neufle[:ren - .2km, :ren - .5sw] >> 3.5dt
    );
    track(:station,
            neufle[:ren - .5sw, :ren + .6sw] >> 3.5dt
        --  neufle[:ren + .6sw + 1dl, :ren + .6sw + 1.1dl] >> 2.5dt
    );

    # Gl. 6
    track(:station :removed,
            neufle[:ren.rf - 1dl, :ren.rf] >> 3.5dt
        ..  neufle[:ren - .2km, :ren + .6sw + 1dl] >> 4.5dt
    );

    # Gl. 7
    with layer = -1 track(:station :removed,
            neufle[:ren.rf - 3.1dl, :ren.rf - 3dl] >> 1.5dt
        --  neufle[:ren.rf - .1dl, :ren.rf] >> 4.5dt
        ..  neufle[:ren - .2km, :ren + .6sw] >> 5.5dt
        --  neufle[:ren + .6sw + 3dl, :ren + .6sw + 3.01dl] >> 2.5dt
    );

    marker(:de.bf :left, neufle[:ren] << 0.5dt);
    station(:left, neufle[:ren - 0.2sw] << 0.5dt << 1.8sw,
        span(:medium :bold, "Rendsburg"),
        hbox(:center :base,
            span(:xsmall, "113,87"),
            span(:xsmall :removed, " (108,30)")
        )
    );


    #--- point.de.Büdelsdorf
    #
    track(:double :first :station, neufle[:bud.a, :bud + 1sw]);

    with layer = -1 {
        # Gleiswechsel Südkopf
        track(:station :removed,
                neufle[:bud.a + 0.9dl, :bud.a + 1dl] << 0.5dt
            --  neufle[:bud.a + 2dl, :bud.a + 2.1dl] >> 0.5dt
        );

        # Gl. 5
        track(:station :removed,
                neufle[:bud.a + 2.9dl, :bud.a + 3dl] >> 0.5dt
            --  neufle[:bud.a + 4dl, :bud - .5sw] >> 1.5dt
        );
    }

    # Strecke 1012.
    track(:station,
            neufle[:bud + .499sw, :bud + .5sw] << 0.5dt
        --  neufle[:bud + .5sw + 1dl, :bud + 1sw] << 1.5dt
    );

    with layer = -1 marker(:de.bf :removed :left, neufle[:bud] << 0.5dt);
    with detail = 4 {
        station(:left :closed, neufle[:bud - .2sw] << 0.5dt << 1.8sh,
            "Büdelsdorf",
            hbox(:center :top :closed,
                vbox(:right :top,
                    span(:xsmall, "1012: "), span(:xsmall, "1040: ")
                ),
                vbox(:right :top,
                    span(:xsmall, "0,"), span(:xsmall, "115,")
                ),
                vbox(:left :top,
                    span(:xsmall, "42"), span(:xsmall, "35")
                )
            )
        );
    }
    with detail = 5 {
        station(:left :right_align :closed,
            neufle[:bud - .2sw] << 0.5dt << 1.8sh,
            "Büdelsdorf",
            hbox(:center :top :closed,
                vbox(:right :top,
                    span(:xsmall, "1012: "), span(:xsmall, "1040: ")
                ),
                vbox(:right :top,
                    span(:xsmall, "0,"), span(:xsmall, "115,")
                ),
                vbox(:left :top,
                    span(:xsmall, "42 ← "), span(:xsmall, "35 ← ")
                ),
                vbox(:right :top,
                    span(:xsmall, "0,"), span(:xsmall, "115,")
                ),
                vbox(:left :top,
                    span(:xsmall, "34"), span(:xsmall, "27 (109,70)")
                )
            )
        );
    }

    # Büdelsdorf (ausschl.) - Alt Duvenstedt (ausschl.)
    track(:double :first :cat, neufle[:bud + 1sw, :adu - 1sw]);
    with layer = 2 line_badge(:open, neufle[:bud + 2.8km], "1040");

    #--- point.de.Alt-Duvenstedt
    track(:double :first :station, neufle[:adu - 1sw, :adu + 2sw]);
    with layer = -1 {
        track(:station :removed,
                neufle[:adu + .6sw, :adu + 2sw - 2dl] >> 1.5dt
            --  neufle[:adu + 2sw - 1dl, :adu + 2sw - 0.9dl] >> 0.5dt
        );
        marker(:de.hst :closed :right, neufle[:adu] >> 0.5dt);
    }
    with layer = -2 marker(:de.bf :gone :right, neufle[:adu] >> 0.5dt);
    station(:right :closed, neufle[:adu - 0.4sw] >> .5dt >> 1.3sh,
        "Alt Duvenstedt", "120,72 (115,19)"
    );

    # Alt Duvenstedt (ausschl.) - Owschlag (ausschl.)
    track(:double :first :cat, neufle[:adu + 2sw, :ows.a]);

    
    #--- point.de.Owschlag
    #
    track(:double :first :station, neufle[:ows.a, :ows.f]);
    track(:station,
            neufle[:ows.a + .9dl, :ows.a + 1dl] >> 0.5dt
        --  neufle[:ows.a + 2dl, :ows.a + 2.1dl] << 0.5dt
    );
    track(:station,
            neufle[:ows.a + 2.9dl, :ows.a + 3dl] << 0.5dt
        --  neufle[:ows.a + 4dl, :ows.f - 4dl] << 1.5dt
        --  neufle[:ows.f - 3dl, :ows.f - 2.9dl] << 0.5dt
    );
    track(:station :removed, neufle[:ows.f - 4dl, :ows.f + 2dl] << 1.5dt);
    track(:station,
            neufle[:ows.f - 2.1dl, :ows.f - 2dl] << 0.5dt
        --  neufle[:ows.f - 1dl, :ows.f - 0.9dl] >> 0.5dt
    );
    track(:station :removed,
            neufle[:ows - .3km - 1.1dl, :ows - .3km - 1dl] << 1.5dt
        --  neufle[:ows - .3km, :ows + .5sw] << 2.5dt
    );

    marker(:de.bf, neufle[:ows] >> 0.5dt);
    station(:left, neufle[:ows - 0.3sw] << 4.5dt,
        span(:medium :bold, "Owschlag"),
        hbox(:center :base,
            span(:xsmall, "125,41 "),
            span(:xsmall :closed, "(119,84)")
        )
    );

    # Owschlag (ausschl) - Schleswig (ausschl)
    track(:double :first :cat, neufle[:ows.f, :sle.a]);
    with layer = 2 line_badge(:open, neufle[:sle - 1.8km], "1040");


    #--- point.de.Lottorf
    with layer = -1 marker(:de.uest :closed :right, neufle[:lot] >> 0.5dt);
    with layer = -2 marker(:de.bf :gone :right, neufle[:lot] >> 0.5dt);
    station(:right :closed, neufle[:lot - .4sw] >> 0.5dt >> 1.3sh,
        "Lottorf", "(126,92)"
    );


    #--- point.de.Schleswig
    #
    track(:double :first :station, neufle[:sle.a, :sle.f]);

    # Gleiswechsel Südseite
    track(:station,
            neufle[:sle.a + .9dl, :sle.a + 1dl] >> 0.5dt
        --  neufle[:sle.a + 2dl, :sle.a + 2.1dl] << 0.5dt
    );

    # Gl. 803
    track(:station,
            neufle[:sle.a + 2.9dl, :sle.a + 3dl] << 0.5dt
        --  neufle[:sle.a + 4dl, :sle + .5sw] << 1.5dt
        --  neufle[:sle + .5sw + 1dl, :sle + .5sw + 1.1dl] << 0.5dt
    );

    # Gl.804
    with layer = -1 track(:station :closed,
            neufle[:sle.a + 4dl, :sle.a + 4.1dl] << 1.5dt
        --  neufle[:sle.a + 5.1dl, :asla - 3dl] << 2.5dt
    );

    # Gl. 856
    with layer = -1 track(:third :station :closed,
            slefri[:sle.ff, :sle.ff - 0.1dl]
        ..  neufle[:sle, :asla - 4dl] << 3.5dt
        --  neufle[:asla, :asla + .1dl] >> 0.5dt
    );

    # Ausfahrt nach Schleswig Altstadt
    track(:station :removed, neufle[:sle + .5sw + 1dl, :asla + 1dl] >> 1.5dt);
    with layer = -1 track(:second :station :removed,
            neufle[:asla - .1dl, :asla] >> 0.5dt
        --  neufle[:asla + 1dl, :asla + 2dl] >> 1.5dt
        ..  slesla[:a - 1dl, :a]
    );

    marker(:de.bf :right, neufle[:sle] >> 0.5dt);
    label(neufle[:sle - 0.3sw] >> 0.5dt >> 1.5sh,
        hbox(:middle :left,
            span(:medium :bold, "Schleswig  "),
            hbox(:center :top,
                vbox(:left :top,
                    span(:xsmall :removed, "1010: "),
                    span(:xsmall, "1040: ")
                ),
                vbox(:right :top,
                    span(:xsmall :removed, "132,"),
                    span(:xsmall, "138,")
                ),
                vbox(:left :top,
                    span(:xsmall :removed, "82"),
                    span(:xsmall, "39")
                ),
                vbox(:left :top,
                    span(:xsmall :removed, ""),
                    span(:xsmall :removed, " (132,82)")
                )
            )
        )
    );

    marker(:de.kbf :removed :left, neufle[:sle] << 3.5dt);
    station(:left :removed, neufle[:sle - 0.3sw] << 3.5dt << 1.6sh,
        span(:bold, "Schleswig-Friedrichsberg"),
        "9103: ??"
    );


    # Streckengleis Schleswig - Schuby
    track(:double :first :cat, neufle[:sle.f, :sub.a]);


    #--- point.de.Schuby
    track(:double :first :station, neufle[:sub.a, :sub.f]);
    track(:station, neufle[:sub.f - 3dl, :sub.f + .3km] << 1.5dt);
    track(:station,
            neufle[:sub.f - 2.1dl, :sub.f - 2dl] << 0.5dt
        --  neufle[:sub.f - 1dl, :sub.f - 0.9dl] << 1.5dt
    );
    with layer = -1 track(:station :removed,
            neufle[:sub.a + 0.9dl, :sub.a + 1dl] << 0.5dt
        --  neufle[:sub.a + 2dl, :sub - .5sw - 2dl] << 1.5dt
        --  neufle[:sub - .5sw - 1dl, :sub - .5sw - 0.9dl] << 0.5dt
    );
    with layer = -1 marker(:de.bf :left :removed, neufle[:sub] << 0.5dt);
    marker(:de.awanst :left, neufle[:sub.f] << 1.5dt);
    station(:left, neufle[:sub.f] << 1.5dt << 2sh + (10pt, 0pt),
        hbox(:center :top,
            span(:medium, "Schuby "), span(:medium :removed, "(Kr Schleswig)")
        ),
        hbox(:center :top,
            span(:xsmall, "142,12 "), span(:xsmall :removed, "(137,26)")
        )
    );


    # Streckengleis Schuby - Jübek
    track(:double :first :cat, neufle[:sub.f, :jub.a]);
    with layer = 2 line_badge(:open, neufle[:sub + 3.5km], "1040");


    #--- point.de.Jübek
    #
    track(:double :first :station, neufle[:jub.a, :ahus + .2km]);
    # Gleiswechsel Südkopf
    track(:station,
            neufle[:jub.a + 1.9dl, :jub.a + 2dl] << 0.5dt
        --  neufle[:jub.a + 3dl, :jub.a + 3.1dl] >> 0.5dt
    );

    # Nebengleise Ostseite
    track(:station,
            neufle[:jub - .1dl, :jub] >> 0.5dt
        --  neufle[:jub + 1dl, :ahus - 6dl] >> 1.5dt
        --  neufle[:ahus - 5dl, :ahus - 4.9dl] >> 0.5dt
    );
    track(:station,
            neufle[:jub - .15km, :ahus - 8dl] >> 2.5dt
        --  neufle[:ahus - 7dl, :ahus - 6.9dl] >> 1.5dt
    );

    # Gleiswechsel Nordkopf
    track(:station,
            neufle[:ahus - 4.1dl, :ahus - 4dl] >> 0.5dt
        --  neufle[:ahus - 3dl, :ahus - 2.9dl] << 0.5dt
    );
    track(:second :station,
            neufle[:ahus - 2.1dl, :ahus - 2dl] << 0.5dt
        --  neufle[:ahus - 1dl, :ahus] << 1.5dt
    );
    
    # Nebengleise Westseite
    track(:station :removed, neufle[:ahus - .4km, :ahus - 2dl] << 1.5dt);
    track(:station :removed, neufle[:ahus - .4km, :ahus - 3dl] << 2.5dt);
    track(:second :station :removed,
            neufle[:jub - 0.5sw, :ahus - 5dl] << .5dt << 1sh
        --  neufle[:ahus - 2dl, :ahus - 1dl] << 1.5dt
    );
    track(:station :removed,
            neufle[:jub.a + .2km, :jub - .5sw - 4dl] << 1.5dt
        --  neufle[:jub - .5sw - 1dl, :jub - .5sw] << .5dt << 1sh
    );

    with layer = 1 marker(:de.bf :left, neufle[:jub] << 0.5dt);
    station(:open :left :right_align, neufle[:jub - .4sw] << .5dt << 2sh,
        span(:medium :bold, "Jübek"),
        hbox(:left :top,
            vbox(:left :top,
                span(:xsmall, "1011: "), span(:xsmall, "1040: ")
            ),
            vbox(:right :top,
                span(:xsmall, "0,"), span(:xsmall, "149,")
            ),
            vbox(:left :top,
                span(:xsmall, "00"), span(:xsmall, "43")
            ),
            vbox(:right :top,
                span(:xsmall :removed, " (143,86)"),
                span(:xsmall :removed, " (143,86)")
            )
        )
    );

    
    # Streckengleis Jübek - Eggebek
    track(:double :first :cat, neufle[:ahus + .2km, :egb - 1sw]);
    with layer = 2 line_badge(:open, neufle[:jub + 4.0km], "1040");


    #--- point.de.Eggebek
    #
    track(:double :first :station, neufle[:egb - 1sw, :egb + 1sw]);
    track(:station :removed, neufle[:egb + .6sw, :egb.eg] << 1.5dt);
    with layer = -1 track(:station :removed,
            neufle[:egb + .6sw + 0.9dl, :egb + .6sw + 1dl] << 0.5dt
        --  neufle[:egb + .6sw + 2dl, :egb + .6sw + 2.1dl] << 1.5dt
    );
    marker(:de.hst :closed :left, neufle[:egb] << 0.5dt);
    with layer = -1 marker(:de.bf :removed :left, neufle[:egb] << 0.5dt);
    station(:right :left_align :closed, neufle[:egb - 0.4sw] >> 1.5dt,
        "Eggebek", "156,75 (151,19)"
    );

    track(:double :first :cat, neufle[:egb + 1sw, :tar.a]);

    #--- point.de.Tarp
    #
    track(:double :first :station, neufle[:tar.a, :tar.f]);
    track(:station :removed,
           neufle[:tar.a + .9dl, :tar.a + 1dl] >> 0.5dt
        -- neufle[:tar.a + 2dl, :tar.a + 2.1dl] << 0.5dt
    );
    track(:station :removed,
           neufle[:tar.ts - .51ssw, :tar.ts - .5ssw] << 0.5dt
        -- neufle[:tar.ts - .5ssw + 1dl, :tar.f] << 1.5dt
        -- neufle[:tar.f + 1sw, :tar.ff] << 2.5dt
    );
    track(:station :removed,
           neufle[:tar.f - 4.1dl, :tar.f - 4dl] << 1.5dt
        -- neufle[:tar.f - 3dl, :tar.f - 2.9dl] << 0.5dt
    );
    track(:station :removed,
           neufle[:tar.f - 2.1dl, :tar.f - 2dl] << .5dt
        -- neufle[:tar.f - 1dl, :tar.f - 0.9dl] >> .5dt
    );
    marker(:de.bf :removed, neufle[:tar] >> .5dt);
    with layer = 1 marker(:de.hp :open, neufle[:tar] >> .5dt);
    station(
        :right :left_align, neufle[:tar - 0.4sw] >> 0.5dt >> 1.6sw,
        "Tarp",
        hbox(:left :base,
            span(:xsmall, "161,97"),
            span(:xsmall :removed, " (156,42)")
        )
    );

    track(:double :first :cat, neufle[:tar.f, :bar - 1sw]);

    #--- point.de.Barderup
    #
    track(:double :first :station, neufle[:bar - 1sw, :bar + 1sw]);
    marker(:de.hp :removed :left, neufle[:bar] << .5dt);
    marker(:de.bk :removed :left, neufle[:bar] << .5dt);
    station(
        :left :removed, neufle[:bar - .4sw] << .5dt << 1.6sw,
        "Barderup", "(162,15)"
    );

    track(:double :first :cat, neufle[:bar + 1sw, :hol - 1sw]);
    with layer = 1 line_badge(:open, neufle[:bar + 1.6km], "1040");
}

with detail = 4 {
    with link = "point.de.Flensburg-Weiche" {
        #--- point.de.Flensburg-Weiche
        #
        # point.de.Holzkrug
        # point.de.Flensburg-Weiche-Süd
        #
        # Gl. 1 und 2
        with layer = 0.1 track(:double :first :station,
            neufle[:hol - 1sw, :flw.f]
        );
        track(:station,
                neufle[:flw.f - 2.1dl, :flw.f - 2dl] << 0.5dt
            --  neufle[:flw.f - 1dl, :flw.f - 0.9dl] >> 0.5dt
        );

        # Gl. 3 (Husum - Stumpf)
        track(:second :station :removed,
               husflw[:flw.a, :flw.a + 1dl]
            .. neufle[:flin, :flw.f - 6dl] << 1.5dt
        );

        # Gl.4 (Lindholm - Alter Bf)
        track(:second :station :closed,
               flwlin[:flw.f, :flw.w130]
            .. neufle[:flin, :flw.f - 5dl] << 2.5dt
            -- neufle[:flw.f - 3dl, :flw.f - 2.9dl] << 0.5dt
        );
        track(:second :station :removed,
               neufle[:flw.f - 4dl, :flw.f] << 1.5dt
        );

        # Gl. 6
        track(:station :closed,
                neufle[:flin - 2.1dl, :flin - 2dl] << 5.5dt
            --  neufle[:flin, :apad - 2dl] << 3.5dt
        );

        # Gl. 32 - Gl. 7 (Richtungsgl. Rendsburg - Padborg)
        track(:station, neufle[:flw.aa, :fws - .5sw - 1dl] << 1.5dt);
        with layer = 0.9 casing(:first :station,
               neufle[:flw.wr2 - .1dl, :flw.wr2] << 1.5dt
            .. neufle[:flin, :flin + .1dl] << 4.5dt
        );
        with layer = 1 track(:first :station,
               neufle[:fws - .5sw - 2.1dl, :fws - .5sw - 2dl] << 0.5dt
            -- neufle[:fws - .5sw - 1dl, :flw.wr2] << 1.5dt
            .. neufle[:flin, :apad] << 4.5dt
            .. flwhag[:ffle - 1dl, :ffle] >> 0.5dt
        );
        
        # Verbindung Gl. 7 nach Gl. 4
        track(:station,
                neufle[:apad - 1.1dl, :apad - 1dl] << 4.5dt
            --  neufle[:apad + 1dl, :apad + 1.1dl] << 2.5dt
        );

        # Gl. 44 - Gl. 11 (Gegenrichtung Rendsburg - Padborg)
        with layer = 0.9 casing(:first :station,
               neufle[:flw.wr2 - .1dl, :flw.wr2] << 2.5dt
            .. neufle[:flin, :flin + .1dl] << 5.5dt
        );
        with layer = 1 track(:first :station,
               neufle[:fws - .5sw - .1dl, :fws - .5sw] << 1.5dt
            -- neufle[:fws - .5sw + 1dl, :flw.wr2] << 2.5dt    
            .. neufle[:flin, :apad] << 5.5dt
            .. flwhag[:ffle - 1dl, :ffle] << 0.5dt
        );

        # Gl. 13 (Güterausfahrt nach Lindholm)
        track(:station :closed,
                flwlin[:flw.w130 + .1dl, :flw.w130]
            ..  neufle[:flin, :apad] << 6.5dt
        );

        # Gl. 14
        track(:station :removed,
                neufle[:flin - .1dl, :flin] << 5.5dt
            --  neufle[:flin + 2dl, :apad - 1dl] << 7.5dt
            --  neufle[:apad + 2dl, :apad + 2.1dl] << 4.5dt
        );

        with layer = -1 marker(:de.bf :removed :left, neufle[:hol] << 1.5dt);
	with layer = -1.5 marker(:statcase :left, neufle[:hol] << 1.5dt); 
        station(
            :left :removed, neufle[:hol - .3sw] - (450m, 0m),
            "Holzkrug", ""
        );

        marker(:de.bft :right, neufle[:fws] >> 0.5dt);
        station(
            :right, neufle[:fws - .4sw] >> 0.5dt >> 1.6sw,
            vbox(:bottom :center,
                span(:medium :removed, "„Wa“"),
                span(:medium, "F. Weiche Süd")
            ),
            span(:xsmall :removed, "(165,58)")
        );
        marker(:de.bf :right, neufle[:flw] >> 0.5dt);
        station(
            :bottom, neufle[:flw] >> 0.5dt >> 1.6sw + (20pt, 0pt),
            span(:medium :bold, "Flensburg Weiche"),
            hbox(:center :top,
                vbox(:right :xsmall,
                    span(:open,    "1000: "),
                    span(:closed,  "1001: "),
                    span(:removed, "1002: "),
                    span(:open,    "1040: "),
                    span(:removed, "12035: ")
                ),
                vbox(:right :xsmall,
                    span(:open,    "172,"),
                    span(:closed,  "0,"),
                    span(:removed, "172,"),
                    span(:open,    "172,"),
                    span(:removed, "45,")
                ),
                vbox(:left :xsmall,
                    span(:open,    "92"),
                    span(:closed,  "00"),
                    span(:removed, "92"),
                    span(:open,    "92"),
                    span(:removed, "50")
                ),
                vbox(:left :xsmall,
                    span(:removed, " (167,34)"),
                    span(:removed, " (167,01)"),
                    span(:removed, " (167,34)"),
                    span(:removed, " (167,34)")
                )
            )
        );
    }

    with link = "line.de.1040" {
        track(:double :first :cat, neufle[:flw.f, :fle.a]);
    }

    with link = "point.de.Flensburg" {
        # Gl. 1 (ex 10; aus F. Weiche)
        track(:first :station, neufle[:fle.a, :fle + .5sw] >> 0.5dt);
        track(:station,
                neufle[:fle + .5sw, :fle.fo +.5sw] >> 0.5dt
            --  neufle[:fle.fo + .5sw + 1dl, :fle.fo + .5sw + 1.1dl] << 0.5dt
        );

        # Gl. 2 (ex 9; nach F. Weiche und nach Friedensweg)
        track(:first :station,
                neufle[:fle.a, :afri] << 0.5dt
            ..  flefri[:fle.f - .1dl, :fle.f]
        );

        # Verbindung Gl. 1 nach Gl. 2 vor Fw
        track(:station,
                neufle[:fle.a + 0.9dl, :fle.a + 3dl] >> 0.5dt
            --  neufle[:fle.a + 4dl, :fle.a + 4.1dl] << 0.5dt
        );

        # Verbindung Gl. 2 nach Gl. 1 vor Fw
        track(:station,
                neufle[:fle.fw - 0.5sw - 4.1dl, :fle.fw - 0.5sw - 4dl] << 0.5dt
            --  neufle[:fle.fw - 0.5sw - 3dl, :fle.fw - 0.5sw - 2.9dl] >> 0.5dt
        );
        

        # Gl. 3 (ex 8)
        track(:station :removed,
                neufle[:fle.a, :fle.fw - .5sw - 1dl] << 1.5dt
        );
        track(:station,
                neufle[:fle.fw - .5sw - 1dl, :fle.fo - .5sw - 1dl] << 1.5dt
            --  neufle[:fle.fo - .5sw, :fle.fo - .5sw + .1dl] << 2.5dt
        );

        # Gl.4 (ex 7)
        track(:station,
                neufle[:fle.fw - .5sw - 2.1dl, :fle.fw - .5sw - 2dl] << 0.5dt
            --  neufle[:fle.fw - .5sw, :fle - .5sw] << 2.5dt
        );
        track(:second :station, neufle[:fle - .5sw, :fle.fa] << 2.5dt);

        # Abstellgleise
        track(:station :removed,
                neufle[:fle.fo - .5sw - 2dl, :afri] << 1.5dt
        );
        track(:station,
                neufle[:afri - 1.1dl, :afri - 1dl] << 0.5dt
            --  neufle[:afri, :fle.f] << 1.5dt
        );
        track(:station,
                neufle[:fle.fa - .1dl, :fle.fa] << 1.5dt
            --  neufle[:fle.fa + 1dl, :fle.wp1] << 0.5dt
            --  neufle[:fle.wp1 + 1dl, :fle.wp1 + 1.1dl] << 1.5dt
        );

        marker(:de.bf :left, neufle[:fle] << 2.5dt);
        label(neufle[:fle + 0.5sw] << 2.5dt << 1.2sh,
            vbox(:left :bottom,
                hbox(:left :bottom,
                    span(:xsmall, "  "),
                    vbox(:right :bottom,
                        span(:xsmall, "1005: "),
                        span(:xsmall, "1020: "),
                        span(:xsmall, "1040: "),
                        span(:xsmall :removed, "12035: ")
                    ),
                    vbox(:right :bottom,
                        span(:xsmall, "0,"),
                        span(:xsmall, "80,"),
                        span(:xsmall, "176,"),
                        span(:xsmall :removed, "48,")
                    ),
                    vbox(:right :bottom,
                        span(:xsmall, "00"),
                        span(:xsmall, "64"),
                        span(:xsmall, "23"),
                        span(:xsmall :removed, "82")
                    ),
                    vbox(:right :bottom,
                        span(:xsmall, ""),
                        span(:xsmall, ""),
                        span(:xsmall :removed, " (170,66)"),
                        span(:xsmall :removed, "")
                    )
                ),
                span(:medium :bold, "FLENSBURG")
            )
        );
    }
}

