# SE BBM.  Brintbodarne - Malung
with detail = 2 {
    let bm = path("d2.se.bbm");

    with railway = :first :pax :removed {
        with link = "line.se.BBM" {
            track(bm[:bri.ym, :bri.ym + 15km]);
            line_label(:right:s, bm[:bri.ym + 15km], "BBM");
            track(bm[:bri.ym + 15km, :mal.yb]);
        }
    }
}


# SE BBS.  Björndalsbron - Skymnäs
with detail = 2 {
    let bs = path("d2.se.bbs");

    with railway = :first :g891 :nopax :removed {
        with link = "line.se.BBS" {
            track(bs[:bjo.ys, :bjo.ys + 1.5km]);
            line_label(:right:se, bs[:bjo.ys + 1.5km], "BBS");
            track(bs[:bjo.ys + 1.5km, :sky]);
        }

        with link = "point.se.Skymnäs" {
            statdot(bs[:sky]);
            slabel(:left, bs[:sky] + (-1.5dt, 0.8dt), "Skymnäs");
        }
    }
}


# SE BFG.  Brattfors - Geijersdal
with detail = 2 {
    let bg = path("d2.se.bfg");

    with railway = :first :g750 :pax :removed {
        with link = "point.se.Brattfors" {
            statdot(bg[:bra]);
            slabel(:top, bg[:bra] + (0.5dt, -0.8dt), "Brattfors");
        }

        with link = "line.se.BFG" {
            track(bg[:bra, :bra + 3.2km]);
            line_label(:right:e, bg[:bra + 3.2km], "BFG");
            track(bg[:bra + 3.2km, :gei.yb]);
        }
    }
}


# SE BFV.  Bofors - Valåsen
with detail = 2 {
    let bv = path("d2.se.bfv");

    with railway = :first :nopax {
        with link = "line.se.BFV" {
            track(bv[:bof.yv, :bof.yv + 1.5km]);
            with zoom = :high line_label(
                :right:n, bv[:bof.yv + 1.5km], (-0.5dt, 0dt), "BFV"
            );
            track(bv[:bof.yv + 1.5km, :val]);
        }

        with link = "point.se.Valåsen" {
            statdot(bv[:val]);
            slabel(:right, bv[:val] + (1.5dt, 1dt), "Valåsen");
        }
    }
}


# SE BHK.  Bånghammar - Kloten
with detail = 2 {
    let bk = path("d2.se.bhk");

    with railway = :first :pax :removed {
        with link = "line.se.BHK" {
            track(bk[:ban.yk, :klo - 9km]);
            line_label(:left:se, bk[:klo - 9km], "BHK");
            track(bk[:klo - 9km, :klo]);
        }

        with link = "point.se.Kloten" {
            statdot(bk[:klo]);
            slabel(:right, bk[:klo] + (1.5dt, 0.8dt), "Kloten");
        }
    }
}


# SE BHP.  Boden central - Haparanda gräns
with detail = 2 {
    let bh = path("d2.se.bhp");

    with railway = :first :cat:ac15 :pax {
        with link = "line.se.BHP" {
            track(bh[:bud.yh, :bud.yh + 8.5km]);
            line_label(:right:nw, bh[:bud.yh + 8.5km], "BHP");
            track(bh[:bud.yh + 8.5km, :mor - 4.8km]);
            line_label(:left:se, bh[:mor - 4.8km], "BHP");
            track(bh[:mor - 4.8km, :mor]);
        }

        with link = "point.se.Morjärv" {
            track(:station, bh[:mor, :mor.yk]);
            statdot(bh[:mor]);
            slabel(:nw, bh[:mor] + (0.7km, 0dt) + (1dt, -0.3dt), "Morjärv");
        }
    }

    with railway = :first :pax :closed {
        with link = "line.se.BHP" {
            track(bh[:mor.yk, :mor.yk + 9km]);
            line_label(:left:s, bh[:mor.yk + 9km], (-0.3dt, 0dt), "BHP");
            track(bh[:mor.yk + 9km, :kar.yo - 8km]);
            line_label(:left:s, bh[:kar.yo - 8km], (0.2dt, 0dt), "BHP");
            track(bh[:kar.yo - 8km, :kar.yo]);
        }

        with link = "point.se.Karungi" {
            track(:station, bh[:kar.yo, :kar]);
            statdot(bh[:kar]);
            slabel(:right, bh[:kar] + (1.5dt, 0.7dt), "Karungi");
        }

        with link = "line.se.BHP" {
            track(bh[:kar, :kar + 10km]);
            line_label(:left:w, bh[:kar + 10km], (0dt, -0.3dt), "BHP");
            track(bh[:kar + 10km, :hap.yk]);
        }
    }

    with railway = :first :cat:ac15 :pax {
        with link = "line.se.BHP" {
            track(bh[:hap.yk, :hap]);
        }

        with link = "point.se.Haparanda" {
            statdot(bh[:hap]);
            slabel(:ne, bh[:hap] + (1.5dt, 0.8dt), "Haparanda");
        }
    }

    with railway = :first :cat:ac25 :g1435:gg1524 :nopax {
        with link = "line.se.BHP" {
            track(bh[:hap, :hag]);
        }
    }
}


# SE BKV.  Brogrenen - Kyrkviken
with detail = 2 {
    let bk = path("d2.se.bkv");

    with railway = :first :pax :removed {
        with link = "line.se.BKV" {
            track(bk[:bro.yk, :kyr]);
        }

        with link = "point.se.Kyrkviken" {
            statdot(bk[:kyr]);
            slabel(:right, bk[:kyr] + (1.5dt, 0.8dt), "Kyrkviken");
        }
    }
}


# SE BLH.  Byvalla - Långshyttan
with detail = 2 {
    let bl = path("d2.se.blh");

    with railway = :first :g891 :pax :removed {
        with link = "line.se.BLH" {
            track(bl[:byv.yl, :lan + 14km]);
            line_label(:right:sw, bl[:byv.yl + 14km], "BLH");
            track(bl[:lan + 14km, :lan]);
        }

        with link = "point.se.Långshyttan" {
            statdot(bl[:lan]);
            slabel(:ne, bl[:lan] + (2dt, 0.8dt), "Långshyttan");
        }
    }
}


# SE BLU.  Boden central - Luleå
with detail = 2 {
    let bl = path("d2.se.blu");

    with railway = :first :cat:ac15 :pax {
        with link = "line.se.BLU" {
            track(bl[:bod.yl, :bod.yl + 6.5km]);
            line_label(:right:e, bl[:bod.yl + 6.5km], "BLU");
            track(bl[:bod.yl + 6.5km, :gam]);
        }

        with link = "point.se.Gammelstad" {
            track(:station, bl[:gam, :gam.yk]);
            statdot(bl[:gam]);
            slabel(:right, bl[:gam] + (1dt, -0.6dt), "Gammelstad");
        }

        with link = "line.se.BLU" {
            track(bl[:gam.yk, :gam.yk + 4.4km]);
            line_label(:left:sw, bl[:gam.yk + 4.4km], "BLU");
            track(bl[:gam.yk + 4.4km, :lul]);
        }

        with link = "point.se.Luleå" {
            statdot(bl[:lul]);
            slabel(:right, bl[:lul] + (1.5dt, 0dt), "Luleå");
        }
    }

    with railway = :first :cat:ac15 :nopax {
        with link = "line.se.BLU" {
            track(bl[:lul, :lum]);
        }

        with link = "point.se.Luleå-malmhamn" {
            statdot(bl[:lum]);
            slabel(:nw, bl[:lum] + (-2dt, 0.8dt), "L. malmhamn");
        }
    }
}


# SE BNO.  Bollnäs - Orsa
with detail = 2 {
    let bo = path("d2.se.bno");

    with railway = :first :nopax :suspended {
        with link = "line.se.BNO" {
            track(bo[:bol.yo, :bol.yo + 14.7km]);
            line_label(:right:sw, bo[:bol.yo + 14.7km], "BNO");
            track(bo[:bol.yo + 14.7km, :vox]);
        }

        with link = "point.se.Voxna" {
            statdot(bo[:vox]);
            slabel(:top, bo[:vox] + (0dt, -1dt), "Voxna");
        }

        with link = "line.se.BNO" {
            track(bo[:vox, :vox.yl]);
            track(bo[:vox.yl, :vox.yl + 9km]);
            line_label(:right:se, bo[:vox.yl + 9km], "BNO");
            track(bo[:vox.yl + 9km, :gor]);
        }

        with link = "point.se.Göringen" {
            track(bo[:gor, :gor.yd]);
            statdot(bo[:gor]);
            slabel(:left, bo[:gor] + (-1.5dt, 0dt), "Göringen");
        }

        with link = "line.se.BNO" {
            track(bo[:gor.yd, :fur]);
        }
    }

    with railway = :first :nopax {
        with link = "point.se.Furudal" {
            statdot(bo[:fur]);
            slabel(:nw, bo[:fur] + (-1.5dt, 0.9dt), "Furudal");
        }

        with link = "line.se.BNO" {
            track(bo[:fur, :fur + 10.6km]);
            line_label(:left:n, bo[:fur + 10.6km], "BNO");
            track(bo[:fur + 10.6km, :ors.yb]);
        }
    }
}


# SE BRG.  Boden central - Riksgränsen gräns
with detail = 2 {
    let br = path("d2.se.brg");

    with railway = :first :cat:ac15 :pax {
        with link = "line.se.BRG" {
            track(br[:bod, :bod + 2km]);
            line_label(:right:w, br[:bod + 2km], (0dt, -0.1dt), "BRG");
            track(br[:bod + 2km, :bud]);
        }

        with link = "point.se.Buddbyn" {
            statdot(:nopax, br[:bud]);
            slabel(:left :nopax, br[:bud] + (-1.5dt, 0.8dt), "Buddbyn");
        }

        with link = "line.se.BRG" {
            track(br[:bud, :bud.yh]);
            track(br[:bud.yh, :bud.yh + 6.5km]);
            line_label(:left:e, br[:bud.yh + 6.5km], "BRG");
            track(br[:bud.yh + 6.5km, :tol]);
            line_label(:left:ne, br[:tol], "BRG");
            track(br[:tol, :koi - 11.2km]);
            line_label(:left:ne, br[:koi - 11.2km], "BRG");
            track(br[:koi - 11.2km, :koi]);
            track(br[:koi, :gal - 5.3km]);
            line_label(:left:e, br[:gal - 5.3km], "BRG");
            track(br[:gal - 5.3km, :gal]);
        }

        with link = "point.se.Gällivare-central" {
            track(:station, br[:gal, :gal.ym]);
            statdot(br[:gal]);
            slabel(:right, br[:gal] + (1.5dt, 0.5dt),
                hbox(:left:base, span(:bold, "Gällivare"), " c.")
            );
        }

        with link = "line.se.BRG" {
            track(br[:gal.ym, :gal.ym + 4km]);
            line_label(:left:n, br[:gal.ym + 10km], (-0.5dt, 0dt), "BRG");
            track(br[:gal.ym + 4km, :har + 0.5km]);
            line_label(:right:w, br[:har + 0.5km], "BRG");
            track(br[:har + 0.5km, :rat.ys - 7.3km]);
            line_label(:left:e, br[:rat.ys - 7.3km], "BRG");
            track(br[:rat.ys - 7.3km, :rat.ys]);
        }

        with link = "point.se.Råtsi" {
            track(:station, br[:rat.ys, :rat]);
            statdot(:nopax, br[:rat]);
            slabel(:left :nopax, br[:rat] + (-1.8dt, 1.5dt), "Råtsi");
        }
    }

    with railway = :first :cat:ac15 :pax :removed {
        with link = "line.se.BRG" {
            track(br[:rat, :rat + 3.5km]);
            line_label(:right:w, br[:rat + 3.5km], "BRG");
            track(br[:rat + 3.5km, :kir]);
        }

        with link = "point.se.Kiruna-central" {
            statdot(br[:kir]);
            slabel(:right, br[:kir] + (1.5dt, 0.5dt), "Kiruna c.");
        }

        with link = "line.se.BRG" {
            track(br[:kir, :kim.ys]);
        }
    }

    with railway = :first :cat:ac15 :pax {
        with link = "point.se.Kiruna-malmbangård" {
            track(:station :nopax, br[:kim.ys, :kim]);
            statdot(br[:kim]);
            slabel(:right, br[:kim] + (1.5dt, 0.5dt), "Kiruna malmbangård");
        }

        with link = "line.se.BRG" {
            track(br[:kim, :kim.yn]);
            track(br[:kim.yn, :peu.yn]);
            track(br[:peu.yn, :peu.yn + 5km]);
            line_label(:right:sw, br[:peu.yn + 5km], "BRG");
            track(br[:peu.yn + 5km, :ste]);
            line_label(:right:sw, br[:ste], "BRG");
            track(br[:ste, :rik - 6.4km]);
            line_label(:right:s, br[:rik - 6.4km], "BRG");
            track(br[:rik - 6.4km, :rik]);
        }

        with link = "point.se.Riksgränsen" {
            statdot(br[:rik]);
            slabel(:ne, br[:rik] + (2dt, 0.9dt), "Riksgränsen");
        }

        with link = "line.se.BRG" {
            track(br[:rik, :rig]);
        }
    }
}


# SE BSF.  Beted - Skillingsfors
with detail = 2 {
    let bs = path("d2.se.bsf");

    with railway = :first :pax :removed {
        with link = "line.se.BSF" {
            track(bs[:bet.ys, :bet.ys + 9km]);
            line_label(:left:e, bs[:bet.ys + 9km], "BSF");
            track(bs[:bet.ys + 9km, :ski]);
        }

        with link = "point.se.Skillingsfors" {
            statdot(bs[:ski]);
            slabel(:top, bs[:ski] + (-0.5dt, -0.9dt), "Skillingsfors");
        }
    }
}


# SE BSL.  Bräcke - Storlien gräns
with detail = 2 {
    let bs = path("d2.se.bsl");

    with railway = :first :cat:ac15 :pax {
        with link = "line.se.BSL" {
            track(
                    bs[:bra.ys - 0.1dl, :bra.ys] << 0.5md >> 0.5mt
                ..  bs[:bra.yyb + 0.5dt, :bra.ys + 12km]
            );
            line_label(:left:e, bs[:bra.ys + 12km], "BSL");
            track(bs[:bra.ys + 12km, :bru.ym - 6.3km]);
            line_label(:right:sw, bs[:bru.ym - 6.3km], "BSL");
            track(bs[:bru.ym - 6.3km, :bru.ym]);
            track(bs[:bru.ym, :bru]);
        }

        with link = "point.se.Brunflo" {
            statdot(bs[:bru]);
            slabel(:right, bs[:bru] + (1.3dt, -0.3dt), "Brunflo");
        }

        with link = "line.se.BSL" {
            track(bs[:bru, :bru + 6km]);
            line_label(:right:sw, bs[:bru + 6km], "BSL");
            track(bs[:bru + 6km, :osu]);
        }

        with link = "point.se.Östersunds-central" {
            statdot(bs[:osu]);
            slabel(:left, bs[:osu] + (-1.7dt, 1dt), "Östersund c.");
        }

        with link = "line.se.BSL" {
            track(bs[:osu, :osv.yh]);
            track(bs[:osv.yh, :osv.yh + 8km]);
            line_label(:left:ne, bs[:osv.yh + 8km], "BSL");
            track(bs[:osv.yh + 8km, :jar + 0.7km]);
            line_label(:right:s, bs[:jar + 0.7km], "BSL");
            track(bs[:jar + 0.7km, :str - 15.5km]);
            line_label(:left:n, bs[:str - 15.5km], (0.2dt, 0dt), "BSL");
            track(bs[:str - 15.5km, :str]);
        }

        with link = "point.se.Storlien" {
            statdot(bs[:str]);
            slabel(:ne, bs[:str] + (-1.3dt, 0dt), "Storlien");
        }
    }

    with railway = :first :pax {
        with link = "line.se.BSL" {
            track(bs[:str, :stg]);
        }
    }
}


# SE BTD.  Birsta - Johannedal växel
with detail = 2 {
    with link = "line.se.BTD" {
        track(:first :cat:ac15 :nopax, path("d2.se.btd")[:bir.yt, :joh.yb]);
    }
}


# SE BTS.  Bastuträsk - Skelleftehamn nedre
with detail = 2 {
    let bs = path("d2.se.bts");

    with railway = :first :cat:ac15 :nopax {
        with link = "line.se.BTS" {
            track(bs[:bas.yr, :bas.yo]);
            track(bs[:bas.yo, :bas.yr + 9km]);
            line_label(:left:s, bs[:bas.yr + 9km], "BTS");
            track(bs[:bas.yr + 9km, :sli]);
        }

        with link = "point.se.Slind" {
            statdot(:removed, bs[:sli]);
            slabel(:nw :removed, bs[:sli] + (1.4dt, -0.3dt), "Slind");
        }

        with link = "line.se.BTS" {
            track(bs[:sli, :sli + 15.3km]);
            line_label(:left:sw, bs[:sli + 15.3km], "BTS");
            track(bs[:sli + 15.3km, :sko]);
        }

        with link = "point.se.Skelleftehamns-övre" {
            track(:station, bs[:sko, :sko.yr]);
            statdot(bs[:sko]);
            slabel(:ne, bs[:sko] + (-0.3dt, 0.6dt),
                vbox(:right:top, "Skelleftehamns", "övre")
            );
        }

        with link = "line.se.BTS" {
            track(bs[:sko.yr, :ron]);
        }

        with link = "point.se.Rönnskärsverken" {
            statdot(bs[:ron]);
            slabel(:right, bs[:ron] + (1.5dt, 1.8dt), "Rönnskärsverken");
        }
    }
}


# SE BTX.  Bastuträsk 14 - Bastuträsk 16
with detail = 2 {
    with link = "line.se.BTX" {
        track(:first :cat:ac15 :nopax, path("d2.se.btx")[:bas.ys, :bas.yo]);
    }
}


# SE BVB.  Bollstabruk - Västeraspby
with detail = 2 {
    let bv = path("d2.se.bvb");

    with railway = :first :cat:ac15 :pax {
        with link = "line.se.BVB" {
            track(bv[:bol.yv, :bol.yv + 2.5km]);
            line_label(:left:se, bv[:bol.yv + 2.5km], "BVB");
            track(bv[:bol.yv + 2.5km, :vas.yn]);
        }
    }
}


# SE BVH.  Bredviken - Haparanda
with detail = 2 {
    let bh = path("d2.se.bvh");

    with railway = :first :cat:ac15 :pax {
        track(bh[:bre.yh, :bre.yh + 7km]);
        line_label(:right:nw, bh[:bre.yh + 7km], "BVH");
        track(bh[:bre.yh + 7km, :hap.yk - 5km]);
        line_label(:left:s, bh[:hap.yk - 5km], "BVH");
        track(bh[:hap.yk - 5km, :hap.yk]);
    }
}

