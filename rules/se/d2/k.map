# SE KAS.  Kummelby - Arkösund
with detail = 2 {
    let ka = path("d2.se.kas");

    with railway = :first :g891 :pax :removed {
        with link = "line.se.KAS" {
            track(ka[:kum.ya, :kum.ya + 9.5km]);
            line_label(:right:ne, ka[:kum.ya + 9.5km], "KAS");
            track(ka[:kum.ya + 9.5km, :ark - 8.6km]);
            line_label(:right:ne, ka[:ark - 8.6km], "KAS");
            track(ka[:ark - 8.6km, :ark]);
        }

        with link = "point.se.Arkösund" {
            statdot(ka[:ark]);
            slabel(:right, ka[:ark] + (1.5dt, 0.8dt), "Arkösund");
        }
    }
}
# SE KBB.  Kisstjärnsbäcken - Bastkärn
with detail = 2 {
    let kb = path("d2.se.kbb");

    with railway = :first :nopax :removed {
        with link = "line.se.KBB" {
            track(kb[:kis.yb, :bas]);
        }

        with link = "point.se.Bastkärn" {
            statdot(kb[:bas]);
            slabel(:right, kb[:bas] + (1.5dt, 0.3dt), "Bastkärn");
        }
    }
}


# SE KBH.  Kolbäck - Brattheden
with detail = 2 {
    let kb = path("d2.se.kbh");

    with railway = :first :cat:ac15 :pax {
        with link = "line.se.KBH" {
            track(kb[:kol.yb, :kol.yn]);
            track(kb[:kol.yn, :kol.yn + 6.8km]);
            line_label(:right:w, kb[:kol.yn + 6.8km], "KBH");
            track(kb[:kol.yn + 6.8km, :bra.yk - 5km]);
            line_label(:left:e, kb[:bra.yk - 5km], "KBH");
            track(kb[:bra.yk - 5km, :bra.yk]);
        }
    }
}


# SE KBK.  Källby - Kinne Kleva
with detail = 2 {
    let kk = path("d2.se.kbk");

    with railway = :first :g891 :pax :removed {
        with link = "line.se.KBK" {
            track(kk[:kal.yk, :kin - 3km]);
            line_label(:right:nw, kk[:kin - 3km], "KBK");
            track(kk[:kin - 3km, :kin]);
        }

        with link = "point.se.Kinne-Kleva" {
            statdot(kk[:kin]);
            slabel(:left, kk[:kin] + (0dt, -0.5dt),
                vbox(:right:bottom, "Kinne-", "Kleva ")
            );
        }
    }
}


# SE KBX.  Kolbäck 118 - Kolbäck 116
with detail = 2 {
    with link = "line.se.KBX" {
        track(:first :cat:ac15 :nopax, path("d2.se.kpx")[:kol.yo, :kol.yn]);
    }
}


# SE KFK.  Kil - Fryksta
with detail = 2 {
    let kf = path("d2.se.kfk");

    with railway = :first :pax :removed {
        with link = "line.se.KFK" {
            track(kf[:kil.yf, :kil.yf + 1.4km]);
            with zoom = :high line_label(:left:se, kf[:kil.yf + 1.4km], "KFK");
            track(kf[:kil.yf + 1.4km, :fry]);
        }

        with link = "point.se.Fryksta" {
            statdot(kf[:fry]);
            slabel(:left, kf[:fry] + (0dt, -0.5km) + (2.5dt, -1dt), "Fryksta");
        }
    }
}


# SE KFS.  Kilafors - Söderhamn V
with detail = 2 {
    let ks = path("d2.se.kfs");

    with railway = :first :cat:ac15 :nopax {
        with link = "line.se.KFS" {
            track(ks[:kil.ys, :kil.ys + 9.5km]);
            line_label(:left:s, ks[:kil.ys + 9.5km], "KFS");
            track(ks[:kil.ys + 9.5km, :ber]);
        }

        with link = "point.se.Bergvik" {
            statdot(:removed, ks[:ber]);
            slabel(:bottom :removed, ks[:ber] + (0dt, 0.8dt), "Bergvik");
        }

        with link = "line.se.KFS" {
            track(ks[:ber, :sov.yv]);
            track(ks[:sov.yv, :sov.yk]);
        }
    }
}


# SE KGH.  Kortfors - Grythyttan
with detail = 2 {
    let kg = path("d2.se.kgh");

    with railway = :first :pax :removed {
        with link = "line.se.KGH" {
            track(kg[:kor.yg, :kor.yg + 8.1km]);
            line_label(:left:e, kg[:kor.yg + 8.1km], "KGH");
            track(kg[:kor.yg + 8.1km, :gry - 8.5km]);
            line_label(:right:w, kg[:gry - 8.5km], "KGH");
            track(kg[:gry - 8.5km, :gry]);
        }
    }
}


# SE KGK.  Kärrgruvan - Klackberg
with detail = 2 {
    let kk = path("d2.se.kgk");

    with railway = :first :pax :removed {
        with link = "line.se.KGK" {
            track(kk[:kar.yk, :kar.yk + 2km]);
            line_label(:right:se, kk[:kar.yk + 2km], "KGK");
            track(kk[:kar.yk + 2km, :kla.yk]);
        }
    }
}


# SE KHB.  Kristinehamn - Brunflo
with detail = 2 {
    let kb = path("d2.se.khb");

    with railway = :first :cat:ac15 :seasonal {
        with link = "line.se.KHB" {
            track(kb[:kri, :kri + 7.3km]);
            line_label(:right:w, kb[:kri + 7.3km], (0dt, 0.2dt), "KHB");
            track(kb[:kri + 7.3km, :nyk - 8.3km]);
            line_label(:right:w, kb[:nyk - 8.3km], "KHB");
            track(kb[:nyk - 8.3km, :nyk]);
        }

        with link = "point.se.Nykroppa" {
            track(kb[:nyk, :nyk.yd]);
            statdot(kb[:nyk]);
            slabel(:right, kb[:nyk] + (1.5dt, 0.8dt), "Nykroppa");
        }
    }

    with railway = :first :pax :removed {
        with link = "line.se.KHB" {
            track(kb[:nyk.yd, :her.yk]);
        }

        # point.se.Herrhult

        with link = "line.se.KHB" {
            track(kb[:her.yp, :her.yp + 3.4km]);
            line_label(:right:sw, kb[:her.yp + 3.4km], "KHB");
            track(kb[:her.yp + 3.4km, :nyh.yf]);
        }

        with link = "point.se.Nyhyttan" {
            track(kb[:nyh.yf, :nyh]);
            statdot(kb[:nyh]);
            slabel(:right, kb[:nyh] + (1.5dt, 0.3dt), "Nyhyttan");
        }

        with link = "line.se.KHB" {
            track(kb[:nyh, :per.yf]);
        }
    }

    with railway = :first :nopax {
        with link = "point.se.Persberg" {
            track(kb[:per.yf, :per.yg]);
            statdot(kb[:per]);
            slabel(:left, kb[:per] + (-1dt, -0.3dt),
                vbox(:right:base, "Pers-", "berg ")
            );
        }
    }

    with railway = :first :pax :removed {
        with link = "line.se.KHB" {
            track(kb[:per.yg, :per + 7km]);
            line_label(:right:w, kb[:per + 7km], "KHB");
            track(kb[:per + 7km, :nev.yh - 10km]);
            line_label(:left:e, kb[:nev.yh - 10km], "KHB");
            track(kb[:nev.yh - 10km, :nev.yh]);
        }

        with link = "point.se.Neva" {
            track(kb[:nev.yh, :nev]);
            statdot(kb[:nev]);
            slabel(:left, kb[:nev] + (-1.5dt, 0.8dt), "Neva");
        }

        with link = "line.se.KHB" {
            track(kb[:nev, :nev + 9.5km]);
            line_label(:right:w, kb[:nev + 9.5km], "KHB");
            track(kb[:nev + 9.5km, :van.ys - 5.5km]);
            line_label(:right:w, kb[:van.ys - 5.5km], "KHB");
            track(kb[:van.ys - 5.5km, :van.ys]);
        }
    }

    with railway = :first :nopax {
        with link = "point.se.Vansbro" {
            track(kb[:van.ys, :van]);
            track(kb[:van, :van.yb]);
            statdot(kb[:van]);
            slabel(:right, kb[:van] + (1.5dt, 0.8dt), "Vansbro");
        }

        with link = "line.se.KHB" {
            track(kb[:van.yb, :van.fm]);
        }
    }

    with railway = :first :pax :removed {
        with link = "line.se.KHB" {
            track(kb[:van.fm, :van.yb + 8km]);
            line_label(:left:e, kb[:van.yb + 8km], (0dt, 0.1dt), "KHB");
            track(kb[:van.yb + 8km, :bri.ym]);
        }

        with link = "point.se.Brintbodarne" {
            track(kb[:bri.ym, :bri]);
            statdot(kb[:bri]);
            slabel(:right, kb[:bri] + (1.5dt, 0.7dt), "Brintbodarne");
        }

        with link = "line.se.KHB" {
            track(kb[:bri, :bri + 9km]);
            line_label(:left:se, kb[:bri + 9km], "KHB");
            track(kb[:bri + 9km, :vik]);
        }
    }

    with railway = :first :nopax {
        with link = "point.se.Vika" {
            statdot(kb[:vik]);
            slabel(:right, kb[:vik] + (1.5dt, 0.8dt), "Vika");
        }

        with link = "line.se.KHB" {
            track(kb[:vik, :vik + 2.7km]);
            line_label(:left:e, kb[:vik + 2.7km], "KHB");
            track(kb[:vik + 2.7km, :mos.ya]);
        }
    }

    with railway = :first :cat:ac15 :pax {
        with link = "point.se.Morastrand" {
            track(:station, kb[:mos.ya, :mos]);
            statdot(kb[:mos]);
            slabel(:ne, kb[:mos] + (-0.2km, 0.3km) + (-1.5dt, 0.3dt),
                "Morastrand"
            );
        }

        with link = "line.se.KHB" {
            track(kb[:mos, :mor]);
        }

        with link = "point.se.Mora-central" {
            track(kb[:mor, :mor.yr]);
            statdot(kb[:mor]);
            slabel(:left, kb[:mor] + (1.5dt, -1.4dt), "Mora c.");
        }
    }

    with railway = :first :tourist {
        with link = "line.se.KHB" {
            track(kb[:mor.yr, :mor.yr + 6.5km]);
            line_label(:left:e, kb[:mor.yr + 6.5km], "KHB");
            track(kb[:mor.yr + 6.5km, :ors]);
        }

        with link = "point.se.Orsa" {
            track(kb[:ors, :ors.yb]);
            statdot(kb[:ors]);
            slabel(:left, kb[:ors] + (-1.5dt, 0.8dt), "Orsa");
        }

        with link = "line.se.KHB" {
            track(kb[:ors.yb, :ors.yb + 7km]);
            line_label(:left:se, kb[:ors.yb + 7km], "KHB");
            track(kb[:ors.yb + 7km, :lil + 4km]);
            line_label(:right:w, kb[:lil + 4km], (0dt, -0.15dt), "KHB");
            track(kb[:lil + 4km, :sve - 10km]);
            line_label(:left:ne, kb[:sve - 10km], "KHB");
            track(kb[:sve - 10km, :sve]);
        }

        with link = "point.se.Sveg" {
            track(kb[:sve, :sve.yh]);
            statdot(kb[:sve]);
            slabel(:left, kb[:sve] + (-1.7dt, 0.8dt), "Sveg");
        }

        with link = "line.se.KHB" {
            track(kb[:sve.yh, :sve.yh + 9km]);
            line_label(:left:s, kb[:sve.yh + 9km], "KBH");
            track(kb[:sve.yh + 9km, :kva - 5.5km]);
            line_label(:left:e, kb[:kva - 5.5km], (0dt, -0.1dt), "KBH");
            track(kb[:kva - 5.5km, :bru.ym - 7.7km]);
            line_label(:left:se, kb[:bru.ym - 7.7km], "KBH");
            track(kb[:bru.ym - 7.7km, :bru.ym]);
        }
    }
}


# SE KHM.  Katrineholms central - Malmö central
with detail = 2 {
    let km = path("d2.se.khm");

    with railway = :first :double :cat:ac15 :pax {
        with link = "line.se.KHM" {
            track(km[:kat.yn, :kat.ys]);
            track(km[:kat.ys, :kat.ys - 6km]);
            line_label(:right:e, km[:kat.ys + 6km], "KHM");
            track(km[:kat.ys - 6km, :aby - 5km]);
            line_label(:right:e, km[:aby - 5km], "KHM");
            track(km[:aby - 5km, :aby]);
        }

        with link = "point.se.Åby-södra" {
            statdot(:nopax, km[:aby]);
            slabel(:left, km[:aby] + (-1.8dt, 1.3dt), "Åby södra");
        }

        with link = "line.se.KHM" {
            track(km[:aby, :nor]);
        }

        with link = "point.se.Norrköpings-central" {
            statdot(km[:nor]);
            slabel(:right :bold, km[:nor] + (1.2km, 0.2km), "Norrköping");
            with zoom = :high slabel(:ne, km[:nor] + (-0dt, 0.5dt), "c.");
        }

        with link = "line.se.KHM" {
            track(km[:nor, :nor + 9.8km]);
            line_label(:right:s, km[:nor + 9.8km], "KHM");
            track(km[:nor + 9.8km, :kim.yf]);
        }

        with link = "point.se.Kimstad" {
            track(:station, km[:kim.yf, :kim]);
            statdot(:nopax, km[:kim] << 0.5lt);
            slabel(:left, km[:kim] + (-1.7dt, 0.9dt), "Kimstad");
        }

        with link = "line.se.KHM" {
            track(km[:kim, :nho.yv]);
        }

        with link = "point.se.Norsholm" {
            track(km[:nho.yv, :nho]);
            statdot(:nopax, km[:nho] << 0.5lt);
            slabel(:left :nopax, km[:nho] + (-1.5dt, 0.3dt), "Norsholm");
        }

        with link = "line.se.KHM" {
            track(km[:nho, :nho + 11km]);
            line_label(:right:se, km[:nho + 11km], "KHM");
            track(km[:nho + 11km, :lin.yb]);
        }

        with link = "point.se.Linköpings-central" {
            track(:station, km[:lin.yb, :lin.yf]);
            statdot(km[:lin]);
            with zoom = :low slabel(
                :ne, km[:lin] + (0dt, 0.6km) + (1.5dt, 0.5dt),
                vbox(:right:top, span(:bold, "Linköping"), "c.")
            );
            with zoom = :high slabel(
                :ne, km[:lin] + (0dt, 0km) + (0dt, 0.7dt),
                vbox(:right:top, span(:bold, "Linköping"), "c.")
            );
        }

        with link = "line.se.KHM" {
            track(km[:lin.yf, :mjo.yh - 11km]);
            line_label(:left:nw, km[:mjo.yh - 11km], "KHM");
            track(km[:mjo.yh - 11km, :mjo.yh]);
        }

        with link = "point.se.Mjölby" {
            track(:station, km[:mjo.yh, :mjo.yv]);
            statdot(km[:mjo]);
            slabel(:right, km[:mjo] + (1.5dt, 1.5dt), "Mjölby");
        }

        with link = "line.se.KHM" {
            track(km[:mjo.yv, :mjo + 7.8km]);
            line_label(:right:e, km[:mjo + 7.8km], "KHM");
            track(km[:mjo + 7.8km, :gri + 1km]);
            line_label(:right:e, km[:gri + 1km], "KHM");
            track(km[:gri + 1km, :nas.yh - 6.3km]);
            line_label(:right:se, km[:nas.yh - 6.3km], "KHM");
            track(km[:nas.yh - 6.3km, :nas.yh]);
        }

        with link = "point.se.Nässjö-central" {
            track(:station, km[:nas.yh, :nas.yv]);
            statdot(km[:nas]);
            slabel(:right, km[:nas] + (1.5dt, 0dt),
                hbox(:left:base, span(:bold, "Nässjö"), " c.")
            );
        }

        with link = "line.se.KHM" {
            track(km[:nas.yv, :nas.yv + 10km]);
            line_label(:right:e, km[:nas.yv + 10km], "KHM");
            track(km[:nas.yv + 10km, :sav.ym]);
        }

        with link = "point.se.Sävsjö" {
            track(:station, km[:sav.ym, :sav]);
            statdot(km[:sav]);
            slabel(:left, km[:sav] + (-1.5dt, 0.5dt), "Sävsjö");
        }

        with link = "line.se.KHM" {
            track(km[:sav, :sav + 16km]);
            line_label(:right:e, km[:sav + 16km], "KHM");
            track(km[:sav + 16km, :alv.yk - 4.5km]);
            line_label(:left:w, km[:alv.yk - 4.5km], "KHM");
            track(km[:alv.yk - 4.5km, :alv.yk]);
        }

        with link = "point.se.Alvesta" {
            track(:station, km[:alv.yk, :alv.yg]);
            statdot(km[:alv]);
            slabel(:right, km[:alv] + (0.75km, 0dt) + (1.3dt, 0.5dt),
                "Alvesta"
            );
        }

        with link = "line.se.KHM" {
            track(km[:alv.yg, :alv.yg + 6.5km]);
            line_label(:left:nw, km[:alv.yg + 6.5km], "KHM");
            track(km[:alv.yg + 6.5km, :vis]);
        }

        with link = "point.se.Vislanda" {
            track(:station, km[:vis, :vis.yk]);
            statdot(km[:vis]);
            slabel(:right, km[:vis] + (1.8dt, 1dt), "Vislanda");
        }

        with link = "line.se.KHM" {
            track(km[:vis.yk, :vis.yk + 7km]);
            line_label(:left:nw, km[:vis.yk + 7km], "KHM");
            track(km[:vis.yk + 7km, :alm - 8km]);
            line_label(:right:se, km[:alm - 8km], "KHM");
            track(km[:alm - 8km, :alm]);
        }

        with link = "point.se.Älmhult" {
            track(:station, km[:alm, :alm.yk]);
            statdot(km[:alm]);
            slabel(:left, km[:alm] + (-1.7dt, 0.5dt), "Älmhult");
        }

        with link = "line.se.KHM" {
            track(km[:alm.yk, :alm.yk + 14km]);
            line_label(:right:se, km[:alm.yk + 14km], "KHM");
            track(km[:alm.yk + 14km, :hav.ys]);
        }

        with link = "point.se.Hästveda" {
            track(:station, km[:hav.ys, :hav]);
            statdot(km[:hav]);
            slabel(:left, km[:hav] + (-1.5dt, 0.5dt), "Hästveda");
        }

        with link = "line.se.KHM" {
            track(km[:hav, :hav + 9km]);
            line_label(:left:nw, km[:hav + 9km], "KHM");
            track(km[:hav + 9km, :has.yv]);
        }

        with link = "point.se.Hässleholm" {
            track(:station, km[:has.yv, :has.yh]);
            statdot(km[:has]);
            slabel(:right, km[:has] + (0.7km, -0.5km) + (1dt, -0.8dt),
                "Hässleholm"
            );
        }

        with link = "line.se.KHM" {
            track(km[:has.yh, :has.yh + 7km]);
            line_label(:right:e, km[:has.yh + 7km], "KHM");
            track(km[:has.yh + 7km, :hoo.yh]);
        }

        with link = "point.se.Höör" {
            track(:station, km[:hoo.yh, :hoo]);
            statdot(km[:hoo]);
            slabel(:left, km[:hoo] + (-1.3dt, -0.3dt), "Höör");
        }

        with link = "line.se.KHM" {
            track(km[:hoo, :hoo + 12km]);
            line_label(:right:se, km[:hoo + 12km], "KHM");
            track(km[:hoo + 12km, :esl.yh]);
        }

        with link = "point.se.Eslöv" {
            track(:station, km[:esl.yh, :esl.yy]);
            statdot(km[:esl]);
            slabel(:right, km[:esl] + (1.5dt, 1dt), "Eslöv");
        }

        with link = "line.se.KHM" {
            track(km[:esl.yy, :esl.yy + 3.5km]);
            line_label(:right:se, km[:esl.yy + 3.5km], "KHM");
            track(km[:esl.yy + 3.5km, :ort.ys]);
        }

        with link = "point.se.Örtofta" {
            track(:station, km[:ort.ys, :ort]);
            statdot(km[:ort]);
            slabel(:nw, km[:ort] + (-1dt, 1dt), "Örtofta");
        }

        with link = "line.se.KHM" {
            track(km[:ort, :ort + 4.5km]);
            line_label(:left:w, km[:ort + 4.5km], (0dt, 0.15dt), "KHM");
            track(km[:ort + 4.5km, :lun.yl]);
        }

        with link = "point.se.Lund-c" {
            track(:station, km[:lun.yl, :lun.yt]);
            statdot(km[:lun]);
            slabel(:right, km[:lun] + (1.5dt, 0.8dt), "Lund c");
        }

        with link = "line.se.KHM" {
            track(km[:lun.yt, :lun.yt + 5km]);
            line_label(:left:nw, km[:lun.yt + 5km], "KHM");
            track(km[:lun.yt + 5km, :arl]);
        }

        with link = "point.se.Arlöv" {
            statdot(:nopax, km[:arl]);
            slabel(:left, km[:arl] + (-1.5dt, 0dt), "Arlöv");
        }

        with link = "line.se.KHM" {
            track(km[:arl, :mal.yt]);
            track(km[:mal.yt, :mal]);
        }

        with link = "point.se.Malmö-central" {
            statdot(km[:mal]);
            slabel(:left, km[:mal] + (-1.5dt, 0dt),
                hbox(:right:base, span(:bold:medium, "Malmö "), "c")
            );
        }
    }
}

# SE KMB.  Kalmar - Berga
with detail = 2 {
    let kb = path("d2.se.kmb");

    with railway = :first :pax {
        with link = "line.se.KMB" {
            track(kb[:kas.yb, :kla.yk]);
        }
    }

    with railway = :first :pax :removed {
        let kk = path("d2.se.kmb.kal");

        with link = "line.se.KMB" {
            track(kk[:kal.yb, :kal.yt]);
            track(kk[:kal.yt, :kla.yk]);
        }
    }

    with railway = :first :pax {
        with link = "line.se.KMB" {
            track(kb[:kla.yk, :kla.yk + 5km]);
            line_label(:left:e, kb[:kla.yk + 5km], "KMB");
            track(kb[:kla.yk + 5km, :blo - 5.4km]);
            line_label(:right:w, kb[:blo - 5.4km], "KMB");
            track(kb[:blo - 5.4km, :blo]);
        }

        with link = "point.se.Blomstermåla" {
            statdot(kb[:blo]);
            slabel(:ne, kb[:blo] + (0.5dt, 0.5dt),
                vbox(:right:topbase, "Blomster-", "måla ")
            );
        }

        with link = "line.se.KMB" {
            track(kb[:blo, :blo.ym]);
            track(kb[:blo.ym, :san.ym]);
        }

        with link = "point.se.Sandbäckshult" {
            track(kb[:san.ym, :san.yf]);
            statdot(:removed, kb[:san]);
            slabel(:ne :removed, kb[:san] + (-1.2km, 0dt) + (-2dt, -1.3dt),
                "Sandbäckshult"
            );
        }

        with link = "line.se.KMB" {
            track(kb[:san.yf, :san.yf + 8km]);
            line_label(:left:e, kb[:san.yf + 8km], (0dt, 0.1dt), "KMB");
            track(kb[:san.yf + 8km, :rud.yb]);
        }

        with link = "point.se.Ruda" {
            track(kb[:rud.yb, :rud.yo]);
            statdot(:nopax, kb[:rud]);
            slabel(:left :nopax, kb[:rud] + (-1.5dt, 0.8dt), "Ruda");
        }

        with link = "line.se.KMB" {
            track(kb[:rud.yo, :rud.yo + 9.8km]);
            line_label(:left:e, kb[:rud.yo + 9.8km], "KMB");
            track(kb[:rud.yo + 9.8km, :ber.yk]);
        }
    }
}


# SE KMT.  Kalmar - Torsås
with detail = 2 {
    let kt = path("d2.se.kmt");

    with railway = :first :g891 :pax :removed {
        with link = "line.se.KMT" {
            track(kt[:kal.yt, :kal.yt + 7km]);
            line_label(:left:n, kt[:kal.yt + 7km], (0.5dt, 0dt), "KMT");
            track(kt[:kal.yt + 7km, :lju]);
        }

        with link = "point.se.Ljungbyholm" {
            track(kt[:lju, :lju.yp]);
            statdot(kt[:lju]);
            slabel(:left, kt[:lju] + (-1.3dt, 0dt), "Ljungbyholm");
        }

        with link = "line.se.KMT" {
            track(kt[:lju.yp, :lju.yp + 5km]);
            line_label(:left:w, kt[:lju.yp + 5km], "KMT");
            track(kt[:lju.yp + 5km, :tor.yg - 5km]);
            line_label(:right:se, kt[:tor.yg - 5km], "KMT");
            track(kt[:tor.yg - 5km, :tor.yg]);
        }
    }
}


# SE KMV.  Kolmården - Virå
with detail = 2 {
    let kv = path("d2.se.kmv");

    with railway = :first :g600 :pax :removed {
        with link = "point.se.Kolmården" {
            statdot(kv[:kol]);
            slabel(:bottom, kv[:kol] + (0dt, 0.9dt), "Kolmården");
        }

        with link = "line.se.KMV" {
            track(kv[:kol, :vir - 6.5km]);
            line_label(:left:e, kv[:vir - 6.5km], "KMV");
            track(kv[:vir - 6.5km, :vir]);
        }

        with link = "point.se.Virå" {
            statdot(kv[:vir]);
            slabel(:top, kv[:vir] + (0dt, -0.6dt), "Virå");
        }
    }
}


# SE KNH.  Kimstad - Norsholm
with detail = 2 {
    let km = path("d2.se.khm");

    with railway = :first :g891 :pax :removed {
        with link = "line.se.KNH" {
            track(km[:kim.yn, :kim.yn + 2km] << 0.5md << 1ms << 0.5lt);
            line_label(:left:w, km[:kim.yn + 2km] << 0.5md << 1ms << 0.5lt,
                "KNH"
            );
            track(km[:kim.yn + 2km, :nho] << 0.5md << 1ms << 0.5lt);
        }
    }
}


# SE KPS.  Kvillsfors - Pauliström
with detail = 2 {
    let kp = path("d2.se.kps");

    with railway = :first :nopax {
        with link = "line.se.KPS" {
            track(kp[:kvi.yp, :kvi.yp + 3.5km]);
            line_label(:left:e, kp[:kvi.yp + 3.5km], "KPS");
            track(kp[:kvi.yp + 3.5km, :pau]);
        }

        with link = "point.se.Pauliström" {
            statdot(kp[:pau]);
            slabel(:top, kp[:pau] + (0dt, -0.8dt), "Pauliström");
        }
    }
}


# SE KRB.  Klockrike - Borensberg
with detail = 2 {
    let kb = path("d2.se.krb");

    with railway = :first :g891 :pax :removed {
        # point.se.Klockrike  se.LKO

        with link = "line.se.KRB" {
            track(kb[:klo.yb, :bor]);
            line_label(:left:e, kb[:klo.yb + 3.5km], (0dt, 0.15dt), "KRB");
        }

        with link = "point.se.Borensberg" {
            statdot(kb[:bor]);
            slabel(:top, kb[:bor] + (0dt, -0.8dt), "Borensberg")
        }
    }
}


# SE KRH.  Knaby - Ramhäll
with detail = 2 {
    let kr = path("d2.se.krh");

    with railway = :first :g891 :nopax :removed {
        with link = "line.se.KRH" {
            track(kr[:kna.yr, :kna.yr + 4km]);
            line_label(:left:w, kr[:kna.yr + 4km], "KRH");
            track(kr[:kna.yr + 4km, :ram]);
        }

        with link = "point.se.Ramhäll" {
            statdot(kr[:ram]);
            slabel(:bottom, kr[:ram] + (-0.3dt, 0.8dt), "Ramhäll");
        }
    }
}


# SE KRO.  Karungi - Övertorneå
with detail = 2 {
    let ko = path("d2.se.kro");

    with railway = :first :pax :removed {
        with link = "line.se.KRO" {
            track(ko[:kar.yo, :kar.yo + 7km]);
            line_label(:left:e, ko[:kar.yo + 7km], "KRO");
            track(ko[:kar.yo + 7km, :ove - 8.6km]);
            line_label(:left:e, ko[:ove - 8.6km], "KRO");
            track(ko[:ove - 8.6km, :ove]);
        }

        with link = "point.se.Övertorneå" {
            statdot(ko[:ove]);
            slabel(:top, ko[:ove] + (0dt, -0.8dt), "Övertorneå");
        }
    }
}


# SE KSG.  Kristianstads central - Gullberna
with detail = 2 {
    let kg = path("d2.se.ksg");

    with railway = :first :cat:ac15 :pax {
        with link = "line.se.KSG" {
            track(kg[:kri.yk, :krg.yh]);
            track(kg[:krg.yh, :krg.ya]);
            track(kg[:krg.ya, :sol.ya]);
            line_label(:left:s, kg[:krg.ya + 13km], (-0.2dt, 0dt), "KSG");
        }

        with link = "point.se.Sölvesborg" {
            track(kg[:sol.ya, :sol]);
            statdot(kg[:sol]);
            slabel(:nw, kg[:sol] + (1.3dt, 0dt), "Sölvesborg");
        }

        with link = "line.se.KSG" {
            track(kg[:sol, :sol.yh]);
            track(kg[:sol.yh, :sol.yh + 6km]);
            line_label(:right:w, kg[:sol.yh + 6km], "KSG");
            track(kg[:sol.yh + 6km, :san]);
        }

        with link = "point.se.Sandbäck" {
            track(kg[:san, :san.yo]);
            statdot(:removed, kg[:san]);
            slabel(:right :removed, kg[:san] + (1.5dt, 1.3dt), "Sandbäck");
        }

        with link = "line.se.KSG" {
            track(kg[:san.yo, :kar.yv]);
            track(kg[:kar.yv, :kar]);
        }

        with link = "point.se.Karlshamn" {
            statdot(kg[:kar]);
            slabel(:bottom, kg[:kar] + (0dt, 0.5km) + (0dt, 0.8dt),
                "Karlshamn"
            );
        }

        with link = "line.se.KSG" {
            track(kg[:kar.yv, :kar.yv + 14.8km]);
            line_label(:right:n, kg[:kar.yv + 14.8km], "KSG");
            track(kg[:kar.yv + 14.8km, :bre.yv]);
        }

        with link = "point.se.Bredåkra" {
            track(kg[:bre.yv, :bre]);
            statdot(:removed, kg[:bre]);
            slabel(:right :removed, kg[:bre] + (0dt, -1.3dt), "Bredåkra");
        }

        with link = "line.se.KSG" {
            track(kg[:bre, :ron]);
        }

        with link = "point.se.Ronneby" {
            track(kg[:ron, :ron.yh]);
            statdot(kg[:ron]);
            slabel(:ne, kg[:ron] + (-1.5dt, -0.3dt), "Ronneby");
        }

        with link = "line.se.KSG" {
            track(kg[:ron.yh, :gul.yt - 7.3km]);
            line_label(:left:s, kg[:gul.yt - 7.3km], "KSG");
            track(:casing, kg[:gul.yt - 7.3km, :gul.yt]);
            track(kg[:gul.yt, :gul]);
        }
    }
}


# SE KSN.  Karlberg - Stockholms norra
with detail = 2 {
    with link = "line.se.KSN" {
        track(:first :cat:ac15 :nopax, path("d2.se.ksn")[:kar.yv, :sno.yk]);
    }
}


# SE KTB.  Kil - Torsby
with detail = 2 {
    let kt = path("d2.se.ktb");

    with railway = :first :pax {
        with link = "line.se.KTB" {
            track(kt[:kil.yt, :kil.yt + 9km]);
            line_label(:right:w, kt[:kil.yt + 9km], (0dt, -0.1dt), "KTB");
            track(kt[:kil.yt + 9km, :tor - 15km]);
            line_label(:right:w, kt[:tor - 15km], (0dt, -0.1dt), "KTB");
            track(kt[:tor - 15km, :tor]);
        }

        with link = "point.se.Torsby" {
            statdot(kt[:tor]);
            slabel(:left, kt[:tor] + (-1.5dt, 0.8dt), "Torsby");
        }
    }
}


# SE KTS.  Kejsartorp - Svansbo
with detail = 2 {
    let ks = path("d2.se.kts");

    with railway = :first :g1093 :nopax :removed {
        with link = "line.se.KTS" {
            with zoom = :high {
                track(ks[:kej.ys, :kej.ys + 0.7km]);
                line_label(:right:w, ks[:kej.ys + 0.7km], "KTS");
                track(ks[:kej.ys + 0.7km, :sva]);
            }
            with zoom = :low {
                track(ks[:kej.ys, :sva]);
            }
        }

        with link = "point.se.Svansbo" {
            statdot(ks[:sva]);
            slabel(:right, ks[:sva] + (1.4dt, 0.5dt), "Svansbo");
        }
    }
}


# SE KUR.  Köping - Källfallet
with detail = 2 {
    let kk = path("d2.se.kur");

    with railway = :first :g1093 :pax :removed {
        with link = "line.se.KUR" {
            track(kk[:kop.yr, :kop.yr + 6km]);
            line_label(:left:ne, kk[:kop.yr + 6km], "KUR");
            track(kk[:kop.yr + 6km, :gut]);
        }

        with link = "point.se.Guttsta" {
            statdot(kk[:gut]);
            slabel(:right, kk[:gut] + (1.5dt, 0.7dt), "Guttsta");
        }

        with link = "line.se.KUR" {
            track(kk[:gut, :kej.ys]);
        }

        with link = "point.se.Kejsartorp" {
            track(kk[:kej.ys, :kej]);
            statdot(kk[:kej]);
            slabel(:left, kk[:kej] + (-1.5dt, 1.3dt), "Kejsartorp");
        }

        with link = "line.se.KUR" {
            track(kk[:kej, :ugg - 6.8km]);
            line_label(:right:sw, kk[:ugg - 6.8km], "KUR");
            track(kk[:ugg - 6.8km, :ugg]);
        }

        with link = "line.se.KUR" {
            track(kk[:kop.yr + 6km, :ugg - 6.8km]);
            line_label(:right:sw, kk[:ugg - 6.8km], "KUR");
            track(kk[:ugg - 6.8km, :ugg]);
        }

        with link = "point.se.Uggelfors" {
            statdot(kk[:ugg]);
            slabel(:left, kk[:ugg] + (-1.5dt, 0.8dt), "Uggelfors");
        }

        with link = "line.se.KUR" {
            track(kk[:ugg, :ugg + 4.5km]);
            line_label(:right:w, kk[:ugg + 4.5km], "KUR");
            track(kk[:ugg + 4.5km, :rid.yl]);
        }

        with link = "point.se.Riddarhyttan" {
            track(:station, kk[:rid.yl, :rid]);
            statdot(kk[:rid]);
            slabel(:ne, kk[:rid] + (-1dt, 0.3dt), "Riddarhyttan");
        }
    }

    with railway = :first :g1093 :nopax :removed {
        with link = "line.se.KUR" {
            track(kk[:rid, :kal]);
        }

        with link = "point.se.Källfallet" {
            statdot(kk[:kal]);
            slabel(:left, kk[:kal] + (-1.5dt, 0.8dt), "Källfallet");
        }
    }
}


# SE KVA.  Koijuvaara - Aitik
with detail = 2 {
    let ka = path("d2.se.kva");

    with railway = :first :cat:ac15 :nopax {
        with link = "line.se.KVA" {
            track(ka[:koi, :koi + 1.3km]);
            line_label(:right:nw, ka[:koi + 1.3km], "KVA");
            track(ka[:koi + 1.3km, :ait]);
        }

        with link = "point.se.Aitik" {
            statdot(ka[:ait]);
            slabel(:right, ka[:ait] + (1.5dt, 1dt), "Aitik");
        }
    }
}


# SE KVB.  Kullsveden - Bispberg
with detail = 2 {
    let kb = path("d2.se.kvb");

    with railway = :first :pax :removed {
        with link = "line.se.KVB" {
            track(kb[:kul.yb, :kul.yb + 0.95km]);
            line_label(:right:w, kb[:kul.yb + 0.95km], (0dt, -0.2dt), "KVB");
            track(kb[:kul.yb + 0.95km, :bis]);
        }

        with link = "point.se.Bispberg" {
            statdot(kb[:bis]);
            slabel(:top, kb[:bis] + (0dt, -0.8dt), "Bispberg");
        }
    }
}


# SE KYK.  Avesta Krylbo - Kärrgruvan
with detail = 2 {
    let ak = path("d2.se.kyk");

    with railway = :first :pax :removed {
        with link = "line.se.KYK" {
            track(ak[:akr.yk, :akr.yk + 8.9km]);
            line_label(:right:s, ak[:akr.yk + 8.9km], "KYK");
            track(ak[:akr.yk + 8.9km, :kar.yk]);
            track(ak[:kar.yk, :kar]);
        }
    }
}


# SE KYX.  Kumla - Närkes Kvarntorp
with detail = 2 {
    let kn = path("d2.se.kyx");

    with railway = :side :nopax {
        with link = "line.se.KYX" {
            track(kn[:kum.yy, :kum.yy + 3.9km]);
            line_label(:left:s, kn[:kum.yy + 3.9km], "KYX");
            track(kn[:kum.yy + 3.9km, :nar]);
        }

        with link = "point.se.Närkes-Kvarntorp" {
            statdot(kn[:nar]);
            slabel(:ne, kn[:nar] + (6dt, 0.8dt),
                vbox(:right:top, "Närkes  ", "Kvarntorp")
            );
        }
    }
}

