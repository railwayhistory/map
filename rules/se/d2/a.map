# SE AAJ.  Åmål - Årjäng
with detail = 2 {
    let aa = path("d2.se.aaj");

    with railway = :first :pax :removed {
        with link = "line.se.AAJ" {
            track(aa[:ama.ya, :ama.ya + 12.5km]);
            line_label(:right:w, aa[:ama.ya + 12.5km], (0dt, -0.2dt), "AAJ");
            track(aa[:ama.ya + 12.5km, :hal]);
        }

        with link = "point.se.Hallanda" {
            track(aa[:hal, :hal.yk]);
            statdot(aa[:hal]);
            slabel(:right, aa[:hal] + (1.5dt, 0.8dt), "Hallanda");
        }

        with link = "line.se.AAJ" {
            track(aa[:hal.yk, :hal + 7.5km]);
            line_label(:left:e, aa[:hal + 7.5km], "AAJ");
            track(aa[:hal + 7.5km, :arj - 14km]);
            line_label(:right:sw, aa[:arj - 14km], "AAJ");
            track(aa[:arj - 14km, :arj]);
        }
    }
}


# SE ABK.  Ängelsberg - Kärrgruvan
with detail = 2 {
    let ak = path("d2.se.abk");

    with railway = :first :cat:ac15 :nopax {
        with link = "line.se.ABK" {
            track(ak[:ang.ys, :ang.ys + 1.5km]);
            line_label(:right:w, ak[:ang.ys + 1.5km], "ABK");
            track(ak[:ang.ys + 1.5km, :sny.ya]);
        }

        # point.se.Snyten  SE.AKF
    }

    with railway = :first :museum {
        with link = "line.se.ABK" {
            track(ak[:sny.yk, :sny.yk + 6km]);
            line_label(:left:ne, ak[:sny.yk + 6km], "ABK");
            track(ak[:sny.yk + 6km, :nor.yk]);
        }

        with link = "point.se.Norberg" {
            track(:station, ak[:nor.yk, :nor]);
            statdot(ak[:nor]);
            slabel(:right, ak[:nor] + (1.7dt, 1.2dt), "Norberg");
        }

        with link = "line.se.ABK" {
            track(ak[:nor, :kar]);
        }

        with link = "point.se.Kärrgruvan" {
            statdot(ak[:kar]);
            slabel(:right, ak[:kar] + (1.4dt, 0.5dt), "Kärrgruvan");
        }
    }
}


# SE ABP.  Älvsbyn - Piteå hamn
with detail = 2 {
    let ap = path("d2.se.abp");

    with railway = :first :pax :removed {
        with link = "line.se.ABP" {
            track(ap[:alv.yp, :alv.ys]);
        }
    }

    with railway = :first :cat:ac15 :nopax {
        with link = "line.se.ABP" {
            track(ap[:alv.ys, :alv.ys + 3.7km]);
            line_label(:left:sw, ap[:alv.ys + 3.7km], "ABP");
            track(ap[:alv.ys + 3.7km, :pit - 8.3km]);
            line_label(:left:sw, ap[:pit - 8.3km], "ABP");
            track(ap[:pit - 8.3km, :pit]);
        }

        with link = "point.se.Piteå" {
            statdot(ap[:pit]);
            slabel(:right, ap[:pit] + (1.5dt, 0dt), "Piteå");
        }

        with link = "line.se.ABP" {
            track(ap[:pit, :pit.yh]);
            track(ap[:pit.yh, :pih]);
        }

        with link = "point.se.Piteå-hamn" {
            statdot(ap[:pih]);
            slabel(:left, ap[:pih] + (-1.5dt, 0.8dt), "Piteå hamn");
        }
    }
}


# SE AGX.  Ångebyn - Ångebyn 21
with detail = 2 {
    let aa = path("d2.se.agx");

    with railway = :first :cat:ac15 :nopax {
        with link = "line.se.AGX" {
            track(
                    aa[:ang.yv - 0.1dl, :ang.yv]
                ..  aa[:ang.yn, :ang.yn + 0.1dl] << 0.5md >> 0.5mt
            );
        }
    }
}


# SE AKF.  Avesta Krylbo - Frövi
with detail = 2 {
    let af = path("d2.se.akf");

    with railway = :first :cat:ac15 :pax {
        with link = "line.se.AKF" {
            track(af[:akr.yf, :akr.yf + 9.5km]);
            line_label(:left:w, af[:akr.yf + 9.5km], "AKF");
            track(af[:akr.yf + 9.5km, :sny.yk]);
        }

        with link = "point.se.Snyten" {
            track(:station, af[:sny.yk, :sny.ya]);
            statdot(af[:sny]);
            slabel(:right, af[:sny] + (1.5dt, 0.8dt), "Snyten");
        }

        with link = "line.se.AKF" {
            track(af[:sny.ya, :sny.ya + 3.3km]);
            line_label(:right:s, af[:sny.ya + 3.3km], "AKF");
            track(af[:sny.ya + 3.3km, :fag.ya]);
        }

        # point.se.Fagersta-central  se.SVB

        with link = "line.se.AKF" {
            track(af[:fag.yf, :fag.yf + 4km]);
            line_label(:left:nw, af[:fag.yf + 4km], "AKF");
            track(af[:fag.yf + 4km, :dag]);
        }

        with link = "point.se.Dagarn" {
            track(:station, af[:dag, :dag.yh]);
            statdot(:nopax, af[:dag]);
            slabel(:right :nopax, af[:dag] + (1.5dt, 0.5dt), "Dagarn");
        }

        with link = "line.se.AKF" {
            track(af[:dag.yh, :kra.yu - 10.5km]);
            line_label(:left:nw, af[:kra.yu - 10.5km], "AKF");
            track(af[:kra.yu - 10.5km, :kra.yu]);
        }

        with link = "point.se.Krampen" {
            track(:station, af[:kra.yu, :kra]);
            statdot(:nopax, af[:kra]);
            slabel(:left :nopax, af[:kra] + (-1.5dt, 0.8dt), "Krampen");
        }

        with link = "line.se.AKF" {
            track(af[:kra, :kra + 10km]);
            line_label(:right:e, af[:kra + 10km], "AKF");
            track(af[:kra + 10km, :sal.yr]);
        }

        with link = "point.se.Sällinge" {
            track(:station, af[:sal.yr, :sal]);
            statdot(:nopax, af[:sal]);
            slabel(:right :nopax, af[:sal] + (1.5dt, 1.5dt), "Sällinge");
        }

        with link = "line.se.AKF" {
            track(af[:sal, :sal + 5km]);
            line_label(:left:w, af[:sal + 5km], "AKF");
            track(af[:sal + 5km, :fro.ya]);
        }
    }
}


# SE AKK.  Almedal - Karlskrona central
with detail = 2 {
    let ak = path("d2.se.akk");

    with railway = :first :cat:ac15 :pax {
        with link = "line.se.AKK" {
            track(ak[:alm.yb, :alm.yb + 9.5km]);
            line_label(:right:nw, ak[:alm.yb + 9.5km], "AKK");
            track(ak[:alm.yb + 9.5km, :rav + 1km]);
            line_label(:right:n, ak[:rav + 1km], (0.4dt, 0dt), "AKK");
            track(ak[:rav + 1km, :bor.yg - 6.7km]);
            line_label(:left:s, ak[:bor.yg - 6.7km], "AKK");
            track(ak[:bor.yg - 6.7km, :bor.yg]);
        }

        # point.se.Borås-central  se.UVV

        with link = "line.se.AKK" {
            track(ak[:bor.ya, :bor.ya + 3.5km]);
            line_label(:right:n, ak[:bor.ya + 3.5km], (-0.3dt, 0dt), "AKK");
            track(ak[:bor.ya + 3.5km, :gan.yj]);
        }

        with link = "point.se.Gånghester" {
            track(ak[:gan.yj, :gan]);
            statdot(:nopax, ak[:gan]);
            slabel(:right :nopax, ak[:gan] + (1.7dt, 1.3dt), "Gånghester");
        }

        with link = "line.se.AKK" {
            track(ak[:gan, :gan + 8.8km]);
            line_label(:left:sw, ak[:gan + 8.8km], "AKK");
            track(ak[:gan + 8.8km, :hil.ya]);
        }

        with link = "point.se.Hillared" {
            track(ak[:hil.ya, :hil]);
            statdot(:nopax, ak[:hil]);
            slabel(:right :nopax, ak[:hil] + (0dt, -0.2km) + (-1dt, -1dt),
                "Hillared"
            );
        }

        with link = "line.se.AKK" {
            track(ak[:hil, :hil + 10.2km]);
            line_label(:right:e, ak[:hil + 10.2km], "AKK");
            track(ak[:hil + 10.2km, :lim.yf]);
        }

        with link = "point.se.Limmared" {
            track(ak[:lim.yf, :lim.yl]);
            statdot(ak[:lim]);
            slabel(:right, ak[:lim] + (1.5dt, 0.8dt), "Limmared");
        }

        with link = "line.se.AKK" {
            track(ak[:lim.yl, :lim.yl + 10km]);
            line_label(:left:s, ak[:lim.yl + 10km], (0.2dt, 0dt), "AKK");
            track(ak[:lim.yl + 10km, :hes]);
        }

        with link = "point.se.Hestra" {
            track(ak[:hes, :hes.yr]);
            statdot(ak[:hes]);
            slabel(:right, ak[:hes] + (1.5dt, 0.8dt), "Hestra");
        }

        with link = "line.se.AKK" {
            track(ak[:hes.yr, :hes.yr + 9.5km]);
            line_label(:left:sw, ak[:hes.yr + 9.5km], "AKK");
            track(ak[:hes.yr + 9.5km, :var.yn - 6km]);
            line_label(:right:e, ak[:var.yn - 6km], (0dt, 0.15dt), "AKK");
            track(ak[:var.yn - 6km, :var.yn]);
        }

        with link = "point.se.Värnamo-central" {
            track(ak[:var.yn, :var.yh]);
            statdot(ak[:var]);
            slabel(:right, ak[:var] + (1.5dt, 0.8dt), "Värnamo c.");
        }

        with link = "line.se.AKK" {
            track(ak[:var.yh, :var.yh + 5.5km]);
            line_label(:left:sw, ak[:var.yh + 5.5km], "AKK");
            track(ak[:var.yh + 5.5km, :brr]);
        }

        with link = "point.se.Bor" {
            statdot(ak[:brr]);
            slabel(:left, ak[:brr] + (-1.8dt, 1.3dt), "Bor");
        }

        with link = "line.se.AKK" {
            track(ak[:brr, :brr + 8km]);
            line_label(:right:e, ak[:brr + 8km], "AKK");
            track(ak[:brr + 8km, :alv.yg - 8km]);
            line_label(:right:ne, ak[:alv.yg - 8km], "AKK");
            track(ak[:alv.yg - 8km, :alv.yg]);
        }

        # point.se.Alvesta  se.KHM

        with link = "line.se.AKK" {
            track(ak[:alv.yk, :alv.yk + 9km]);
            line_label(:right:n, ak[:alv.yk + 9km], (0.2dt, 0dt), "AKK");
            track(ak[:alv.yk + 9km, :vax.ya]);
        }

        with link = "point.se.Växjö" {
            track(ak[:vax.ya, :vax]);
            statdot(ak[:vax]);
            slabel(:right, ak[:vax] + (0.5dt, -1dt), "Växjö");
        }

        with link = "line.se.AKK" {
            track(ak[:vax, :vax + 9km]);
            line_label(:left:sw, ak[:vax + 9km], "AKK");
            track(ak[:vax + 9km, :les]);
        }

        with link = "point.se.Lessebo" {
            statdot(ak[:les]);
            slabel(:left, ak[:les] + (-1.7dt, 1.0dt), "Lessebo");
        }

        with link = "line.se.AKK" {
            track(ak[:les, :emm - 7km]);
            line_label(:left:sw, ak[:emm - 7km], "AKK");
            track(ak[:emm - 7km, :emm]);
        }

        with link = "point.se.Emmaboda" {
            track(ak[:emm, :emm.yk]);
            statdot(ak[:emm]);
            slabel(:ne, ak[:emm] + (0dt, 0.5dt), "Emmaboda");
        }

        with link = "line.se.AKK" {
            track(ak[:emm.yk, :emm.yk + 7km]);
            line_label(:right:e, ak[:emm.yk + 7km], "AKK");
            track(ak[:emm.yk + 7km, :gul - 11.4km]);
            line_label(:right:e, ak[:gul - 11.4km], "AKK");
            with layer = -1 track(ak[:gul - 11.4km, :gul]);
        }

        with link = "point.se.Gullberna" {
            statdot(:nopax, ak[:gul]);
            slabel(:left, ak[:gul] + (-1.5dt, 0.2dt), "Gullberna");
        }

        with link = "line.se.AKK" {
            track(ak[:gul, :gul + 2.4km]);
            line_label(:left:w, ak[:gul + 2.4km], (0dt, 0.1dt), "AKK");
            track(ak[:gul + 2.4km, :kar]);
        }

        with link = "point.se.Karlskrona-central" {
            statdot(ak[:kar]);
            slabel(:bottom, ak[:kar] + (0dt, 0.8dt),
                hbox(:center:base, span(:bold, "Karlskrona"), " c.")
            );
        }
    }
}


# SE ALE.  Alvhem - Lilla Edet
with detail = 2 {
    let al = path("d2.se.ale");

    with railway = :first :nopax {
        with link = "line.se.ALE" {
            track(al[:alv.yl, :alv.yl + 6.5km]);
            line_label(:left:e, al[:alv.yl + 6.5km], (0dt, -0.1dt), "ALE");
            track(al[:alv.yl + 6.5km, :lib]);
        }

        with link = "point.se.Lilla-Edets-bruk" {
            statdot(al[:lib]);
            slabel(:left, al[:lib] + (-1.8dt, 1.2dt), "Lilla Edet");
        }
    }

    with railway = :first :pax :removed {
        with link = "line.se.ALE" {
            track(al[:lib, :lil]);
        }

        with link = "point.se.Lilla-Edet" {
            statdot(al[:lil]);
            slabel(:top, al[:lil] + (-0.3dt, -0.8dt), "Lilla Edet");
        }
    }
}


# SE AMD.  Ånge - Ånge godsbangård - Moradal
with detail = 2 {
    let am = path("d2.se.amd");

    with railway = :first :cat:ac15 :nopax {
        with link = "line.se.AMD" {
            track(am[:ang.yg, :ang.yo]);
            track(
                    am[:ang.yo - 0.1dl, :ang.yo]
                ..  am[:ang.yn, :ang.yn + 0.1dl] << 0.5md >> 0.5mt
            );
            track(am[:ang.yn, :mod.yg] << 0.5md >> 0.5mt);
        }
    }
}


# SE ARN.  Arlanda nedre - Arlanda norra
with detail = 2 {
    let sm = path("d2.se.sam");

    with railway = :first :double :cat:ac15 :pax {
        with link = "line.se.ARN" {
            track(
                    sm[:ane - 0.1dl, :ane]
                ..  sm[:ane + 1km, :arc + 60m] >> 1md >> 1ms
            );
        }

        with link = "point.se.Arlanda-norra" {
            statdot(sm[:arc + 60m] >> 1md >> 1ms);
            slabel(:right, sm[:arc] >> 1md >> 1ms + (1.5dt, 0.8dt), "n.");
        }
    }
}


# SE ARV.  Avesta Krylbo - Rättvik
with detail = 2 {
    let ar = path("d2.se.arv");

    with railway = :first :cat:ac15 :pax {
        with link = "line.se.ARV" {
            track(ar[:akr.yr, :akr.yk]);
            track(ar[:akr.yk, :akr.yk + 7km]);
            line_label(:left:ne, ar[:akr.yk + 7km], "ARV");
            track(ar[:akr.yk + 7km, :vik]);
        }

        with link = "point.se.Vikmanshyttan" {
            track(ar[:vik, :vik.yt]);
            statdot(ar[:vik]);
            slabel(:right, ar[:vik] + (0dt, -1.3dt), "Vikmanshyttan");
        }

        with link = "line.se.ARV" {
            track(ar[:vik.yt, :kul]);
        }

        with link = "point.se.Kullsveden" {
            track(ar[:kul, :kul.yb]);
            statdot(:removed, ar[:kul]);
            slabel(:ne :removed, ar[:kul] + (0.5dt, 0.8dt), "Kullsveden");
        }

        with link = "line.se.ARV" {
            track(ar[:kul.yb, :bor.ya - 7km]);
            line_label(:right:sw, ar[:bor.ya - 7km], "ARV");
            track(ar[:bor.ya - 7km, :bor.ya]);
        }

        # point.se.Borlänge-central

        with link = "line.se.ARV" {
            track(ar[:bor.yr, :rep.yf]);
            track(ar[:rep.yf, :rep.ya]);
            track(ar[:rep.ya, :rep]);
        }

        with link = "point.se.Repbäcken" {
            track(:station, ar[:rep, :rep.yb]);
            statdot(:nopax, ar[:rep]);
            slabel(:ne, ar[:rep] + (0dt, 0.8dt), "Repbäcken");
        }

        with link = "line.se.ARV" {
            track(ar[:rep.yb, :rep.yb + 7.5km]);
            line_label(:right:s, ar[:rep.yb + 7.5km], "ARV");
            track(ar[:rep.yb + 7.5km, :rat.ya - 6.3km]);
            line_label(:left:se, ar[:rat.ya - 6.3km], "ARV");
            track(ar[:rat.ya - 6.3km, :rat.ya]);
        }
    }
}


# SE ASL.  Askersund - Lerbäck
with detail = 2 {
    let al = path("d2.se.asl");

    with railway = :first :g891 :pax :removed {
        with link = "point.se.Askersund" {
            statdot(al[:ask]);
            slabel(:left, al[:ask] + (-1.5dt, 1dt), "Askersund");
        }

        with link = "line.se.ASL" {
            track(al[:ask, :ask + 5.3km]);
            line_label(:left:se, al[:ask + 5.3km], "ASL");
            track(al[:ask + 5.3km, :ler.ya]);
        }
    }
}


# SE ASN.  Askesta - Sandarna
with detail = 2 {
    let as = path("d2.se.asn");

    with railway = :first :pax :removed {
        with link = "point.se.Askesta" {
            statdot(as[:ask]);
            slabel(:left, as[:ask] + (-1.3dt, 0.8dt), "Askesta");
        }

        with link = "line.se.ASN" {
            track(as[:ask, :sav]);
            line_label(:right:n, as[:ask + 2.3km], (0.5dt, 0dt), "ASN");
        }

        with link = "point.se.Sandarne-MaSJ" {
            statdot(as[:sav]);
        }
    }

    with railway = :side :nopax {
        with link = "line.se.ASN" {
            track(as[:sav, :kal]);
        }
    }
}


# SE ASR.  Åkers styckebruk - Strängnäs
with detail = 2 {
    let as = path("d2.se.asr");

    with railway = :first :nopax :suspended {
        with link = "line.se.ASR" {
            track(as[:ake.ys, :ake.ys + 3km]);
            line_label(:left:e, as[:ake.ys + 3km], "ASR");
            track(as[:ake.ys + 3km, :gru.ya]);
        }
    }

    with railway = :first :pax :removed {
        with link = "line.se.ASR" {
            line_label(:left:ne, as[:gru.ya + 3km], "ASR");

            track(as[:str.ys, :str]);
        }

        with link = "point.se.Strängnäs-gamla" {
            statdot(as[:str]);
        }
    }
}


# SE ASV.  Ånge - Sundsvalls central
with detail = 2 {
    let as = path("d2.se.asv");

    with railway = :first :cat:ac15 :pax {
        with link = "line.se.ASV" {
            track(as[:ang.ys, :ang.ys + 9.8km]);
            line_label(:left:s, as[:ang.ys + 9.8km], "ASV");
            track(as[:ang.ys + 9.8km, :joh]);
        }

        with link = "point.se.Johannisberg" {
            track(as[:joh, :joh.yl]);
            statdot(as[:joh]);
            slabel(:ne, as[:joh] + (-0.3dt, 0.5dt), "Johannisberg");
        }

        with link = "line.se.ASV" {
            track(as[:joh.yl, :lju.yl]);
            track(as[:lju.yl, :tor]);
        }

        with link = "point.se.Torpshammar" {
            statdot(as[:tor]);
            slabel(:right, as[:tor] + (1.3dt, 0dt), "Torpshammar");
        }

        with link = "line.se.ASV" {
            track(as[:tor, :tor + 7km]);
            line_label(:right:ne, as[:tor + 7km], "ASV");
            track(as[:tor + 7km, :vat]);
        }

        with link = "point.se.Vattjom" {
            track(:station, as[:vat, :vat.ym]);
            statdot(as[:vat]);
            slabel(:top, as[:vat] + (0dt, -1dt), "Vattjom");
        }

        with link = "line.se.ASV" {
            track(as[:vat.ym, :nas - 4.5km]);
            line_label(:right:nw, as[:nas - 4.5km], "ASV");
            track(as[:nas - 4.5km, :nas.yv]);
            track(as[:nas.yv, :nas]);
        }
    }
}


# SE AZG.  Åmmeberg - Zinkgruvan
with detail = 2 {
    let az = path("d2.se.azg");

    with railway = :first :nopax :removed {
        with link = "point.se.Åmmeberg" {
            statdot(az[:amm]);
            slabel(:ne, az[:amm] + (1.5dt, 0.8dt), "Åmmeberg");
        }

        with link = "line.se.AZG" {
            track(az[:amm, :amm + 5km]);
            line_label(:left:w, az[:amm + 5km], "AZG");
            track(az[:amm + 5km, :zin]);
        }

        with link = "point.se.Zinkgruvan" {
            statdot(az[:zin]);
            slabel(:bottom, az[:zin] + (0dt, 250m) + (-2dt, 0.5dt),
                "Zinkgruvan"
            );
        }
    }
}

