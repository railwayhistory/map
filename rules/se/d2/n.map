# SE NFH.  Nyhyttan - Finnshyttan
with detail = 2 {
    let nf = path("d2.se.nfh");

    with railway = :first :pax :removed {
        with link = "line.se.NFH" {
            track(nf[:nyh.yf, :nyh.yf + 1.5km]);
            line_label(:left:n, nf[:nyh.yf + 1.5km], "NFH");
            track(nf[:nyh.yf + 1.5km, :fin.yn]);
            track(nf[:fin.yn, :fin]);
        }
    }
}


# SE NHA.  Nynäshamn - Älvsjö
with detail = 2 {
    let na = path("d2.se.nha");

    with railway = :first :cat:ac15 :pax {
        with link = "point.se.Nynäshamns-centrum" {
            statdot(na[:nyn]);
            slabel(:right, na[:nyn] + (1.5dt, 0.8dt),
                hbox(:left:base, "Nynäshamn", span(:light, "s centrum"))
            );
        }

        with link = "line.se.NHA" {
            track(na[:nyn, :nyn + 10.5km]);
            line_label(:left:e, na[:nyn + 10.5km], "NHA");
            track(na[:nyn + 10.5km, :hem]);
        }
    }

    with railway = :first :double :cat:ac15 :pax {
        with link = "line.se.NHA" {
            track(na[:hem, :alv.yn - 8km]);
            line_label(:right:sw, na[:alv.yn - 8km], "NHA");
            track(na[:alv.yn - 8km, :alv.yn]);
        }
    }
}


# SE NHD.  Näs bruk - Horndals bruk
with detail = 2 {
    let nh = path("d2.se.nhd");

    with railway = :first :pax :removed {
        with link = "point.se.Näs-bruk" {
            statdot(nh[:nas]);
            slabel(:bottom, nh[:nas] + (0.3dt, 0.8dt), "Näs bruk");
        }

        with link = "line.se.SHD" {
            track(nh[:nas, :vas]);
            line_label(:right:w, nh[:nas + 3.6km], (0dt, -0.2dt), "NHD");
        }

        with link = "point.se.Västanhede" {
            track(nh[:vas, :vas.ym]);
            statdot(nh[:vas]);
            slabel(:right, nh[:vas] + (1.5dt, 0.5dt), "Västanhede");
        }

        with link = "line.se.SHD" {
            track(nh[:vas, :hob.yn]);
        }
    }
}


# SE NHS.  Nässjö central - Halmstads central
with detail = 2 {
    let nh = path("d2.se.nhs");

    with railway = :first :pax {
        with link = "line.se.NHS" {
            track(nh[:nas.yv, :nas.yv + 8.2km]);
            line_label(:left:nw, nh[:nas.yv + 8.2km], "NHS");
            track(nh[:nas.yv + 8.2km, :vag.yj - 7km]);
            line_label(:right:s, nh[:vag.yj - 7km], "NHS");
            track(nh[:vag.yj - 7km, :vag.yj]);
        }

        with link = "point.se.Vaggeryd" {
            track(nh[:vag.yj, :vag]);
            statdot(nh[:vag]);
            slabel(:left, nh[:vag] + (-1.5dt, 0.3dt), "Vaggeryd");
        }

        with link = "line.se.NHS" {
            track(nh[:vag, :vag + 6km]);
            line_label(:right:e, nh[:vag + 6km], (0dt, -0.1dt), "NHS");
            track(nh[:vag + 6km, :var.yn - 7.4km]);
            line_label(:left:w, nh[:var.yn - 7.4km], "NHS");
            track(nh[:var.yn - 7.4km, :var.yn]);
        }

        # point.se.Värnamo-central  se.AKK

        with link = "line.se.NHS" {
            track(nh[:var.yh, :var.yk]);
            track(nh[:var.yk, :var.yk + 13.3km]);
            line_label(:left:n, nh[:var.yk + 13.3km], "NHS");
            track(nh[:var.yk + 13.3km, :ref]);
        }

        with link = "point.se.Reftele" {
            track(nh[:ref, :ref.yh]);
            statdot(nh[:ref]);
            slabel(:bottom, nh[:ref] + (0dt, 0.8dt), "Reftele");
        }

        with link = "line.se.NHS" {
            track(nh[:ref.yh, :ref.yh + 13.5km]);
            line_label(:left:nw, nh[:ref.yh + 13.5km], "NHS");
            track(nh[:ref.yh + 13.5km, :lan.yf]);
        }

        with link = "point.se.Landeryd" {
            track(nh[:lan.yf, :lan]);
            statdot(nh[:lan]);
            slabel(:left, nh[:lan] + (-1.7dt, 0dt), "Landeryd");
        }

        with link = "line.se.NHS" {
            track(nh[:lan, :lan + 5.5km]);
            line_label(:left:nw, nh[:lan + 5.5km], "NHS");
            track(nh[:lan + 5.5km, :kin.yv]);
        }

        with link = "point.se.Kinnared" {
            track(nh[:kin.yv, :kin]);
            statdot(nh[:kin]);
            slabel(:left, nh[:kin] + (-1.5dt, 0.8dt), "Kinnared");
        }

        with link = "line.se.NHS" {
            track(nh[:kin, :kin + 3.7km]);
            line_label(:right:e, nh[:kin + 3.7km], "NHS");
            track(nh[:kin + 3.7km, :tor.yn]);
            track(nh[:tor.yn, :tor.yh]);
        }

        with link = "point.se.Torup" {
            track(nh[:tor.yh, :tor]);
            statdot(nh[:tor]);
            slabel(:left, nh[:tor] + (-1.5dt, 0dt), "Torup");
        }

        with link = "line.se.NHS" {
            track(nh[:tor, :tor + 6.8km]);
            line_label(:right:e, nh[:tor + 6.8km], "NHS");
            track(nh[:tor + 6.8km, :fur - 7.6km]);
            line_label(:left:w, nh[:fur - 7.6km], "NHS");
            track(nh[:fur - 7.6km, :fur]);
        }
    }
}


# SE NKB.  Norberg - Klackberg
with detail = 2 {
    let nk = path("d2.se.nkb");

    with railway = :first :removed {
        with link = "line.se.NKB" {
            track(nk[:nor.yk, :kla.yk]);
        }

        with link = "point.se.Klackberg" {
            track(:station, nk[:kla.yk, :kla]);
            statdot(nk[:kla]);
            slabel(:left, nk[:kla] + (-1.5dt, 0.8dt), "Klackberg");
        }
    }
}


# SE NLB.  Norrmon - Lövstabruk
with detail = 2 {
    let nl = path("d2.se.nlb");

    with railway = :first :g891 :nopax :removed {
        with link = "line.se.NLB" {
            track(nl[:nor.yl, :nor.yl + 16.5km]);
            line_label(:right:sw, nl[:nor.yl + 16.5km], "NLB");
            track(nl[:nor.yl + 16.5km, :lov]);
        }

        with link = "point.se.Lövstabruk" {
            statdot(nl[:lov]);
            slabel(:top, nl[:lov] + (0dt, -0.8dt), "Lövstabruk");
        }
    }
}


# SE NMH.  Näs bruk - Morshyttan
with detail = 2 {
    let nm = path("d2.se.nmh");

    with railway = :first :g891 :pax :removed {
        with link = "line.se.NMH" {
            track(nm[:vas.ym, :mor.yn]);
        }
    }
}


# SE NNB.  Nässjo central - Nybro
with detail = 2 {
    let nn = path("d2.se.nnb");

    with railway = :first :pax {
        with link = "line.se.NNB" {
            track(nn[:nas.yv, :nas.yv + 6.5km]);
            line_label(:left:w, nn[:nas.yv + 6.5km], (0dt, -0.3dt), "NNB");
            track(nn[:nas.yv + 6.5km, :vet.ys - 7km]);
            line_label(:left:sw, nn[:vet.ys - 7km], "NNB");
            track(nn[:vet.ys - 7km, :vet.ys]);
        }

        with link = "point.se.Vetlanda" {
            track(nn[:vet.ys, :vet.ym]);
            statdot(nn[:vet]);
            slabel(:right, nn[:vet] + (-0.8dt, -1.5dt), "Vetlanda");
        }
    }

    with railway = :first :pax :closed {
        with link = "line.se.NNB" {
            track(nn[:vet.ys, :vet.ys + 9km]);
            line_label(:left:w, nn[:vet.ys + 9km], "NNB");
            track(nn[:vet.ys + 9km, :ase.yv - 8km]);
            line_label(:left:sw, nn[:ase.yv - 8km], "NNB");
            track(nn[:ase.yv - 8km, :ase.yv]);
        }

        with link = "point.se.Åseda" {
            track(nn[:ase.yv, :ase.yh]);
            statdot(nn[:ase.yv]);
            slabel(:top, nn[:ase.yv] + (-0.8dt, -1.5dt), "Åseda");
        }
    }

    with railway = :first :pax :removed {
        with link = "line.se.NNB" {
            track(nn[:ase.yh, :ase.yh + 11km]);
            line_label(:right:e, nn[:ase.yh + 11km], "NNB");
            track(nn[:ase.yh + 11km, :sav.yb]);
        }

        with link = "point.se.Sävsjöström" {
            track(nn[:sav.yb, :sav.yo]);
            statdot(nn[:sav]);
            slabel(:ne, nn[:sav] + (0dt, 0.5dt),
                vbox(:right:topbase, "Sävsjö-", "ström ")
            );
        }

        with link = "line.se.NNB" {
            track(nn[:sav.yo, :sav.yo + 5km]);
            line_label(:left:sw, nn[:sav.yo + 5km], "NNB");
            track(nn[:sav.yo + 5km, :mal]);
        }

        with link = "point.se.Målerås" {
            statdot(nn[:mal]);
            slabel(:right, nn[:mal] + (1.3dt, -0.3dt), "Målerås");
        }

        with link = "line.se.NNB" {
            track(nn[:mal, :nyb.yn - 9km]);
            line_label(:right:ne, nn[:nyb.yn - 9km], "NNB");
            track(nn[:nyb.yn - 9km, :nyb.yn]);
        }
    }
}


# SE NOH.  Nässjö - Oskarshamn
with detail = 2 {
    let no = path("d2.se.noh");

    with railway = :first :pax {
        with link = "line.se.NOH" {
            track(no[:nas.yh, :nas.yh + 6.3km]);
            line_label(:left:se, no[:nas.yh + 6.3km], "NOH");
            track(no[:nas.yh + 6.3km, :orm]);
        }

        with link = "point.se.Ormaryd" {
            statdot(no[:orm]);
            slabel(:right, no[:orm] + (0.5dt, -0.8dt), "Ormaryd");
        }

        with link = "line.se.NOH" {
            track(no[:orm, :eks]);
        }

        with link = "point.se.Eksjö" {
            statdot(no[:eks]);
            slabel(:ne, no[:eks] + (1dt, 1.3dt), "Eksjö");
        }
    }

    with railway = :first :nopax {
        with link = "line.se.NOH" {
            track(no[:eks, :eks.yo]);
            track(no[:eks.yo, :eks.yo + 10.5km]);
            line_label(:right:n, no[:eks.yo + 10.5km], "NOH");
            track(no[:eks.yo + 10.5km, :hul.yl - 10km]);
            line_label(:right:ne, no[:hul.yl - 10km], "NOH");
            track(no[:hul.yl - 10km, :hul.yl]);
        }
    }

    with railway = :first :pax {
        with link = "point.se.Hultsfred" {
            track(no[:hul.yl, :hul]);
            statdot(no[:hul]);
            slabel(:left, no[:hul] + (-1.5dt, 1dt), "Hultsfred");
        }

        with link = "line.se.NOH" {
            track(no[:hul, :hul.ya]);
            track(no[:hul.ya, :hul.ya + 4.1km]);
            line_label(:left:w, no[:hul.ya + 4.1km], "NOH");
            track(no[:hul.ya + 4.1km, :mal]);
        }

        with link = "point.se.Målilla" {
            track(no[:mal, :mal.ys]);
            statdot(:nopax, no[:mal]);
            slabel(:nw :nopax, no[:mal] + (1.5dt, -0.5dt), "Målilla");
        }

        with link = "line.se.NOH" {
            track(no[:mal.ys, :ber.yk - 11.7km]);
            line_label(:left:w, no[:ber.yk - 11.7km], "NOH");
            track(no[:ber.yk - 11.7km, :ber.yk]);
        }

        with link = "point.se.Berga" {
            track(no[:ber.yk, :ber]);
            statdot(no[:ber]);
            slabel(:right, no[:ber] + (-1dt, -1.8dt), "Berga");
        }
    }

    with railway = :first :nopax {
        with link = "line.se.NOH" {
            track(no[:ber, :ber + 15km]);
            line_label(:left:s, no[:ber + 15km], (-0.8dt, 0dt), "NOH");
            track(no[:ber + 15km, :osk.yr]);
            track(no[:osk.yr, :osk]);
        }

        with link = "point.se.Oskarshamn" {
            statdot(no[:osk]);
            slabel(:top, no[:osk] + (0dt, -0.8dt), "Oskarshamn");
        }
    }
}


# SE NTB.  Nordmark - Taberg
with detail = 2 {
    let nn = path("d2.se.ntb.1");
    let nt = path("d2.se.ntb.2");

    with railway = :first :g891 :nopax :removed {
        with link = "line.se.NTB" {
            track(nn[:nor.yt, :nor.yt + 1.8km]);
            line_label(:left:s, nn[:nor.yt + 1.8km], "NTB");
            track(nn[:nor.yt + 1.8km, :nob.yt]);
        }

        with link = "point.se.Nordmarksberg" {
            track(nn[:nob.yt, :nob]);
            statdot(nn[:nob]);
            slabel(:nw, nn[:nob] + (-1dt, 0.9dt),
                vbox(:left:top, "Nordmarks-", " berg")
            );
        }

        with link = "line.se.NTB" {
            track(nt[:nob.yt, :tab]);
        }

        with link = "point.se.Taberg" {
            statdot(nt[:tab]);
            slabel(:right, nt[:tab] + (1.3dt, 0.5dt), "Taberg");
        }
    }
}


# SE NTX.  Nacksta 513 - Nacksta 511
with detail = 2 {
    with link = "line.se.NTX" {
        track(:first :cat:ac15 :nopax, path("d2.se.ntx")[:nas.yv, :nas.yn]);
    }
}


# SE NVM.  Norrköpings östra - Valdemarsvik
with detail = 2 {
    let nv = path("d2.se.nvm");

    with railway = :first :g891 :pax :removed {
        with link = "line.se.NVM" {
            track(nv[:noo.yk, :noo.yk + 2.5km]);
            line_label(:right:ne, nv[:noo.yk + 2.5km], "NVM");
            track(nv[:noo.yk + 2.5km, :kum]);
        }

        with link = "point.se.Kummelby" {
            statdot(nv[:kum]);
            slabel(:right, nv[:kum] + (0dt, -1.5dt), "Kummelby");
        }

        with link = "line.se.NVM" {
            track(nv[:kum, :kum.ya]);
            track(nv[:kum.ya, :kum.ya + 5.4km]);
            line_label(:right:ne, nv[:kum.ya + 5.4km], "NVM");
            track(nv[:kum.ya + 5.4km, :val - 9.8km]);
            line_label(:left:w, nv[:val - 9.8km], (0dt, -0.15dt), "NVM");
            track(nv[:val - 9.8km, :val]);
        }

        with link = "point.se.Valdemarsvik" {
            statdot(nv[:val]);
            slabel(:right, nv[:val] + (1.5dt, 1dt), "Valdemarsvik");
        }
    }
}


# SE NVV.  Norsholm - Västervik
with detail = 2 {
    let nv = path("d2.se.nvv");

    with railway = :first :g891 :pax :removed {
        with link = "line.se.NVV" {
            track(nv[:nho.yv, :nho.yv + 6km]);
            line_label(:left:w, nv[:nho.yv + 6km], "NVV");
            track(nv[:nho.yv + 6km, :rin.yl]);
        }

        with link = "point.se.Ringstorp" {
            track(nv[:rin.yl, :rin]);
            statdot(nv[:rin]);
            slabel(:right, nv[:rin] + (1.0dt, -0.5dt), "Ringstorp");
        }

        with link = "line.se.NVV" {
            track(nv[:rin, :rin + 12.85km]);
            line_label(:left:w, nv[:rin + 12.85km], "NVV");
            track(nv[:rin + 12.85km, :atv.yb]);
        }
    }

    with railway = :first :pax {
        with link = "point.se.Åtvidaberg" {
            track(nv[:atv.yb, :atv]);
            statdot(nv[:atv]);
            slabel(:bottom, nv[:atv] + (0.5dt, 1.3dt), "Åtvidaberg");
        }

        with link = "line.se.NVV" {
            track(nv[:atv, :atv + 8.1km]);
            line_label(:left:sw, nv[:atv + 8.1km], "NVV");
            track(nv[:atv + 8.1km, :jen.yh - 8km]);
            line_label(:left:sw, nv[:jen.yh - 8km], "NVV");
            track(nv[:jen.yh - 8km, :jen.yh]);
        }

        with link = "point.se.Jenny" {
            track(nv[:jen.yh, :jen]);
            statdot(:nopax, nv[:jen]);
            slabel(:right :nopax, nv[:jen] + (0.8dt, -1.3dt), "Jenny");
        }

        with link = "line.se.NVV" {
            track(nv[:jen, :jen + 2.8km]);
            line_label(:right:n, nv[:jen + 2.8km], "NVV");
            track(nv[:jen + 2.8km, :vas]);
        }

        with link = "point.se.Västervik" {
            statdot(nv[:vas]);
            slabel(:right, nv[:vas] + (1.5dt, 0.8dt), "Västervik");
        }
    }
}


# SE NYF.  Nyfors 1 - Älvsbyn växel
with detail = 2 {
    let na = path("d2.se.nyf");

    with railway = :first :cat:ac15 :nopax {
        with link = "line.se.NYF" {
            track(na[:nyf.yo, :nyf.ys]);
            track(na[:nyf.ys, :nyf.ys + 1km]);
            line_label(:right:n, na[:nyf.ys + 1km], "NYF");
            track(na[:nyf.ys + 1km, :alv.ys]);
        }
    }
}


# SE NYX.  Nyfors 2 - Nyfors 4
with detail = 2 {
    with link = "line.se.NYX" {
        track(:first :cat:ac15 :nopax, path("d2.se.nyx")[:nyf.yv, :nyf.ys]);
    }
}


# SE NXN.  Nykroppa - Nykroppa 101
with detail = 2 {
    let nn = path("d2.se.nxn");

    with railway = :first :cat:ac15 :seasonal {
        track(nn[:nyk.yd, :nyk.yn]);
        track(nn[:nyk.yn, :nyk.yh]);
    }
}


# SE NXV.  Nykroppa - Hornkullen
with detail = 2 {
    with link = "line.se.NXV" {
        track(:first :cat:ac15 :nopax, path("d2.se.nxv")[:nyk.yn, :nyk.yv]);
    }
}

