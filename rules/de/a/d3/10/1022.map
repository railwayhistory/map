# DE 1022.  Kiel Hbf - Osterrönfeld
#
let ko = path("d3.de.1022");

with detail = 3 {
    with railway = :first :pax {
        with link = "line.de.1022" {
            track(
                    ko[:kie.ks - 0.1dl, :kie.ks] >> 0.5md >> 1ms >> 0.5mt
                ..  ko[:khg.ym, :khg.ym + 0.1dl] >> 0.5ms >> 0.5mt
            );
            track(ko[:khg.ym, :khg] >> 0.5ms >> 0.5mt);
        }

        with link = "point.de.Kiel-Hg", railway = :station {
            marker(:left :de.abzw :removed, ko[:khg] << 0.5ms << 1mt);
            slabel(:bottom :removed :xsmall,
                ko[:khg] << 0.5ms << 1mt << 1.2sh,
                "Hg"
            );
        }

        with link = "line.de.1022" {
            track(ko[:khg, :has - 160m - 1dl] >> 0.5ms >> 0.5mt);
        }

        with link = "point.de.Kiel-Hassee", railway = :station {
            let hf = path("d3.de.1020");

            # DE 1031
            track(:nopax,
                    ko[:has - 160m - 1.1dl, :has - 160m - 1dl]
                        << 0.5ms << 0.5mt
                --  ko[:has - 160m, :has - 159m] >> 0.5ms >> 0.5mt
            );
            track(:removed,
                    ko[:has - 160m - 1dl, :has + 1dl] << 0.5ms << 0.5mt
            );

            # DE 1022
            track(
                    ko[:has - 160m - 1dl, :has] >> 0.5ms >> 0.5mt
                --  ko[:has + 1dl, :has.yf] << 0.5ms << 0.5mt
            );

            # DE 1020
            track(hf[:has - 160m - 1dl, :has.yk] >> 0.5ms >> 0.5mt);

            # DE 1021
            track(:nopax :removed,
                    hf[:has + 0.9dl, :has + 1dl] >> 0.5ms >> 0.5mt
                --  hf[:has + 2dl, :has.yk] >> 1.5ms >> 1.5mt
            );

            marker(:left :de.bf, hf[:has] << 1mt << 0.5ms);
            slabel(:ne :bold, hf[:has] + (1sw, 1.5sh),
                vbox(:right:topbase, "Kiel-Hassee", "Cittipark")
            );
        }

        with link = "line.de.1022" {
            track(
                    ko[:has.yf - 0.1dl, :has.yf] << 0.5ms << 0.5mt
                ..  ko[:has.xf + 0.5mt, :rus - 0.5sw]
            );
        }

        with link = "point.de.Russee", railway = :station {
            track(ko[:rus - 0.5sw, :rus + 0.5sw]);
            marker(:left :de.hp, ko[:rus] << 0.5mt);
            slabel(:left, ko[:rus] + (1.7sw, -1.7mt),
                vbox(:right:base, "Kiel- ", "Russee*")
            );
        }

        with link = "line.de.1022" {
            track(ko[:rus + 0.5sw, :met - 0.5sw]);
        }

        with link = "point.de.Kiel-Mettenhof", railway = :station {
            track(ko[:met - 0.5sw, :met + 0.5sw]);
            marker(:right :de.hp :removed, ko[:met] >> 0.5mt);
            slabel(:bottom :removed, ko[:met] + (-0.5sw, 1mt),
                vbox(:center:top, " Kiel-", " Mettenhof ")
            );
        }

        with link = "line.de.1022" {
            track(ko[:met + 0.5sw, :meh - 0.5sw]);
        }

        with link = "point.de.Melsdorf", railway = :station {
            track(ko[:meh - 0.5sw, :meh + 0.5sw]);
            marker(:right :de.hp, ko[:meh] >> 0.5mt);
            marker(:right :de.exbf, ko[:meh] >> 0.5mt);
            slabel(:top, ko[:meh] >> 1.7sh, "Melsdorf");
        }

        with link = "line.de.1022" {
            track(ko[:meh + 0.5sw, :meh + 1.7km]);
            line_label(:left:n, ko[:meh + 1.7km] << 0.5mt, (-0.7dt, 0dt),
                "1022"
            );
            track(ko[:meh + 1.7km, :fle - 0.5sw]);
        }

        with link = "point.de.Flemhude", railway = :station {
            track(ko[:fle - 0.5sw, :fle + 0.5sw]);
            marker(:right :de.hp :removed, ko[:fle] >> 0.5mt);
            slabel(:top :removed, ko[:fle] >> 1.2sh, "Flemhude");
        }

        with link = "line.de.1022" {
            track(ko[:fle + 0.5sw, :ach - 0.5sw]);
        }

        with link = "point.de.Achterwehr", railway = :station {
            track(ko[:ach - 0.5sw, :ach + 0.5sw]);
            marker(:left :de.hp, ko[:ach] << 0.5mt);
            slabel(:left, ko[:ach + 0.4sw] >> 1mt, "Achterwehr");
        }

        with link = "line.de.1022" {
            track(ko[:ach + 0.5sw, :fel - 0.5sw]);
        }

        with link = "point.de.Felde-Brandsbek", railway = :station {
            track(ko[:fel - 0.5sw, :fel + 0.5sw]);
            marker(:left :de.bf, ko[:fel] << 0.5mt);
            slabel(:bottom, ko[:fel] << 1.3sh, " Felde-Brandsbek*");
        }

        with link = "line.de.1022" {
            track(ko[:fel + 0.5sw, :bre - 0.5sw]);
        }

        with link = "point.de.Bredenbek", railway = :station {
            track(ko[:bre - 0.5sw, :bre + 0.5sw]);
            marker(:left :de.hp, ko[:bre] << 0.5mt);
            slabel(:bottom, ko[:bre] << 1.3sh, "Bredenbek");
        }

        with link = "line.de.1022" {
            track(ko[:bre + 0.5sw, :kro - 0.5sw]);
        }

        with link = "point.de.Kronsburg", railway = :station {
            track(ko[:kro - 0.5sw, :kro + 0.5sw]);
            marker(:right :de.bf :removed, ko[:kro] >> 0.5mt);
            slabel(:top :removed, ko[:kro] >> 1.3sh, "Kronsburg");
        }

        with link = "line.de.1022" {
            track(ko[:kro + 0.5sw, :ost - 0.5sw]);
        }

        with link = "point.de.Ostenfeld-Rendsburg", railway = :station {
            track(ko[:ost - 0.5sw, :ost + 0.5sw]);
            marker(:right :de.hst :removed, ko[:ost] >> 0.5mt);
            slabel(:left :removed, ko[:ost - 1.3sw] >> 1.3sh,
                vbox(:right:base,
                    "Ostenfeld", span(:light, " (Kr Rendsburg)")
                )
            );
        }

        with link = "line.de.1022" {
            track(ko[:ost + 0.5sw, :suh - 0.5sw]);
        }

        with link = "point.de.Schülldorf", railway = :station {
            track(ko[:suh - 0.5sw, :suh + 0.5sw]);
            marker(:right :de.hp, ko[:suh] >> 0.5mt);
            marker(:right :de.exbf, ko[:suh] >> 0.5mt);
            slabel(:nw, ko[:sul] << 0.5mt, "Schülldorf");
        }

        with link = "line.de.1022" {
            track(ko[:suh + 0.5sw, :suh + 1.2km]);
            line_label(:left:w, ko[:suh + 1.2km] << 0.5mt, "1022");
            track(
                    ko[:suh + 1.2km, :oro.xk - 0.5md]
                ..  ko[:oro.yk, :ora] >> 0.5md >> 1ms >> 0.5mt
            );
        }

        with link = "point.de.Osterrönfeld-Awanst" {
            marker(:right :de.awanst, ko[:ora] >> 0.5md >> 1ms >> 1mt);
        }

        with link = "line.de.1022" {
            track(ko[:ora, :oro - 0.5sw] >> 0.5md >> 1ms >> 0.5mt);
        }

        # point.de.Osterrönfeld  de.1040
    }
}

