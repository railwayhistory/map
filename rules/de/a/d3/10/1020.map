# DE 1020. Kiel-Hassee Cittipark - Flensburg
#
let hf = path("d3.de.1020");

with detail = 3 {
    with railway = :second :pax {
        # point.de.Kiel-Hassee  de.1022

        with link = "line.de.1020" {
            track(
                    hf[:has.yk, :has.yk + 200m] >> 0.5ms >> 0.5mt
                ..  hf[:has.xk, :kro - 0.5sw]
            );
        }

        with link = "point.de.Kronshagen", railway = :station {
            track(hf[:kro - 0.5sw, :kro + 0.5sw]);
            marker(:left :de.hp, hf[:kro] << 0.5mt);
            marker(:left :de.exbf, hf[:kro] << 0.5mt);
            slabel(:left, hf[:kro - 0.3sw] << 0.5mt << 2sh, "Kronshagen");
        }

        with link = "line.de.1020" {
            track(hf[:kro + 0.5sw, :kro + 0.9km]);
            line_label(
                :left:e, hf[:kro + 0.9km] << 0.5mt, (0dt, -0.3dt), "1020"
            );
            track(hf[:kro + 0.9km, :suc - 480m]);
        }

        with link = "point.de.Suchsdorf", railway = :station {
            let ks = path("d3.de.9105");

            # DE 1020
            track(hf[:suc - 480m, :suc.ys + 100m]);

            # DE 9105
            track(:nopax,
                    hf[:suc - 381m, :suc - 380m]
                --  ks[:suc - 380m + 1dl, :suc.ys + 100m] >> 1mt >> 1ms
            );

            marker(:left :de.bf, hf[:suc] << 0.5mt);
            slabel(:left :bold, hf[:suc - 0.55sw] << 0.5mt << 1.4sh,
                "Suchsdorf"
            );
        }

        with link = "line.de.1020" {
            track(hf[:suc.ys + 100m, :lev - 0.5sw]);
        }

        with link = "point.de.Levensau", railway = :station {
            track(hf[:lev - 0.5sw, :lev + 0.5sw]);
            marker(:left :de.hp :removed, hf[:lev] << 0.5mt);
            slabel(:ne :removed,
                hf[:lev] + (0dt, 1sh),
                "Levensau"
            );
        }

        with link = "line.de.1020" {
            track(hf[:lev + 0.5sw, :nwi - 310m]);
        }

        with link = "point.de.Neuwittenbek", railway = :station {
            # DE 1020
            track(hf[:nwi - 310m, :nwi.ys + 100m]);

            # DE 9104
            track(:nopax,
                    hf[:nwi - 211m, :nwi - 210m]
                --  hf[:nwi - 210m + 1dl, :nwi.ys] >> 1mt >> 1ms
            );

            marker(:left :de.bf, hf[:nwi] << 0.5mt);
            slabel(:ne :bold, hf[:nwi + 0.8sw] << 0.5mt << 1.1sh,
                "Neuwittenbek"
            );
        }

        with link = "line.de.1020" {
            track(hf[:nwi.ys + 100m, :nwi.ys + 2.3km]);
            line_badge(hf[:nwi.ys + 2.3km], "1020");
            track(hf[:nwi.ys + 2.3km, :get - 0.5sw]);
        }

        with link = "point.de.Gettorf", railway = :station {
            track(hf[:get - 0.5sw, :get + 0.5sw]);
            marker(:right :de.bf, hf[:get] >> 0.5mt);
            slabel(:right, hf[:get - 0.5sw] >> 0.5mt >> 1.25sh, "Gettorf");
        }

        with link = "line.de.1020" {
            track(hf[:get + 0.5sw, :ndo - 0.5sw]);
        }

        with link = "point.de.Neudorf", railway = :station {
            track(hf[:ndo - 0.5sw, :ndo + 0.5sw]);
            marker(:left :de.ldst :removed, hf[:ndo] << 0.5mt);
            slabel(:right :removed, hf[:ndo - 0.5sw] >> 1mt, "Neudorf");
        }

        with link = "line.de.1020" {
            track(hf[:ndo + 0.5sw, :aho - 0.5sw]);
        }

        with link = "point.de.Altenhof-Schlesw", railway = :station {
            track(hf[:aho - 0.5sw, :aho + 0.5sw]);
            marker(:left :de.hp :removed, hf[:aho] << 0.5mt);
            marker(:left :de.exbf :removed, hf[:aho] << 0.5mt);
            slabel(:right :removed, hf[:aho - 0.5sw] >> 1.2mt,
                hbox(:left:base, "Altenhof", span(:light, " (Schlesw)"))
            );
        }

        with link = "line.de.1020" {
            track(hf[:aho + 0.5sw, :aho + 1.9km]);
            line_label(
                :left:e, hf[:aho + 1.9km] << 0.5mt, (0dt, 0.2dt), "1020"
            );
            track(hf[:aho + 1.9km, :ecs - 0.5sw]);
        }

        with link = "point.de.Eckernförde", railway = :station {
            track(hf[:ecs - 0.5sw, :ecs + 0.5sw]);
            marker(:right :de.bf, hf[:ecs] >> 0.5mt);
            slabel(:right :bold, hf[:ecs - 0.9sw] >> 0.5mt >> 1.3sh,
                "Eckernförde"
            );
        }

        with link = "line.de.1020" {
            track(hf[:ecs + 0.5sw, :eck.yk]);
            track(hf[:eck.yk, :eck.yk + 4.5km]);
            line_label(:left:e, hf[:eck.yk + 4.5km] << 0.5mt, "1020");
            track(hf[:eck.yk + 4.5km, :rie - 0.5sw]);
        }

        with link = "point.de.Rieseby", railway = :station {
            track(hf[:rie - 0.5sw, :rie + 0.5sw]);
            marker(:right :de.hp, hf[:rie] >> 0.5mt);
            marker(:right :de.exbf, hf[:rie] >> 0.5mt);
            slabel(:right, hf[:rie - 0.5sw] >> 0.5mt >> 1.9sh,
                "Rieseby"
            );
        }

        with link = "line.de.1020" {
            track(hf[:rie + 0.5sw, :sls - 1sw]);
        }

        with link = "point.de.Schleibrücke-Süd", railway = :station {
            track(hf[:sls - 1sw, :sls]);
            marker(:right :de.hp, hf[:sls - 0.5sw] >> 0.5mt);
            slabel(:right, hf[:sls - 1sw] >> 0.5mt >> 1.2sh,
                "Schleibrücke Süd"
            );
        }
    }

    with railway = :second :pax :suspended {
        with link = "line.de.1020" {
            track(hf[:sls, :sle]);
        }

        with link = "point.de.Boren-Schleibrücke", railway = :station {
            marker(:right :de.bk, hf[:sle] >> 0.5mt);
            slabel(:left :xsmall, hf[:sle - 0.3sw] << 2mt,
                hbox(:right:base, span(:light, "Boren "), "Schleibrücke")
            );
        }

        with link = "line.de.1020" {
            track(hf[:sle, :sle + 0.5sw]);
        }
    }

    with railway = :second :pax {
        with link = "point.de.Schleibrücke-Nord", railway = :station {
            track(hf[:sle + 0.5sw, :sle + 1.5sw]);
            marker(:right :de.hp, hf[:sle + 1sw] >> 0.5mt);
            slabel(:right, hf[:sle + 0.7sw] >> 0.5mt >> 1.2sh,
                "Schleibrücke Nord"
            );
        }

        with link = "point.de.Lindaunis", railway = :station {
            track(hf[:sle + 1.5sw, :sle + 2.6sw]);
            marker(:right :de.hp, hf[:sle + 2.1sw] >> 0.5mt);
            marker(:right :de.exbf, hf[:sle + 2.1sw] >> 0.5mt);
            slabel(:right, hf[:sle + 1.9sw] >> 0.5mt >> 1.6sh, "Lindaunis");
        }

        with link = "line.de.1020" {
            track(hf[:sle + 2.6sw, :fah - 0.5sw]);
        }

        with link = "point.de.Fahrtoft", railway = :station {
            track(hf[:fah - 0.5sw, :fah + 0.5sw]);
            marker(:left :de.hp :removed, hf[:fah] << 0.5mt);
            slabel(:left :removed, hf[:fah - 0.3sw] << 0.5mt << 1.7sh,
                "Fahrtoft"
            );
        }

        with link = "line.de.1020" {
            track(hf[:fah + 0.5sw, :fah + 1.6km]);
            line_label(:right:w, hf[:fah + 1.6km] >> 0.5mt, (0dt, -0.15dt),
                "1020"
            );
            track(hf[:fah + 1.6km, :sud.ys]);

        }

        with link = "point.de.Süderbrarup", railway = :station {
            track(hf[:sud.ys, :sud.yk + 100m]);
            track(:nopax,
                    hf[:sud.yk - 1.1dl, :sud.yk - 1dl]
                --  hf[:sud.yk, :sud.yk + 0.1dl] >> 1mt >> 1ms
            );
            marker(:right :de.bf, hf[:sud] >> 0.5mt);
            slabel(:right :bold, hf[:sud - 0.4sw] >> 0.5mt >> 1.3sh,
                "Süderbrarup"
            );
        }

        with link = "line.de.1020" {
            track(hf[:sud.yk + 100m, :moh - 0.5sw]);
        }

        with link = "point.de.Mohrkirch", railway = :station {
            track(hf[:moh - 0.5sw, :moh + 0.5sw]);
            marker(:right :de.bf :removed, hf[:moh] >> 0.5mt);
            slabel(:right :removed, hf[:moh - 0.5sw] >> 0.5mt >> 1.3sh,
                "Mohrkirch*"
            );
        }

        with link = "line.de.1020" {
            track(hf[:moh + 0.5sw, :moh + 3km]);
            line_label(:right:w, hf[:moh + 3km] >> 0.5mt, (0dt, -0.3dt),
                "1020"
            );
            track(hf[:moh + 3km, :sor.yr - 800m]);
            with layer = -1 track(hf[:sor.yr - 800m, :sor.yr]);
            track(hf[:sor.yr, :sor.ys]);
            track(hf[:sor.ys, :sor - 0.5sw]);
        }

        with link = "point.de.Sörup", railway = :station {
            track(hf[:sor - 0.5sw, :sor + 0.5sw]);
            marker(:right :de.bf, hf[:sor] >> 0.5mt);
            slabel(:right :bold, hf[:sor - 0.3sw] >> 0.5mt >> 1.25sh,
                "Sörup"
            );
        }

        with link = "line.de.1020" {
            track(hf[:sor + 0.5sw, :win - 0.5sw]);
        }

        with link = "point.de.Winderatt", railway = :station {
            track(hf[:win - 0.5sw, :win + 0.5sw]);
            marker(:right :de.hst :removed, hf[:win] >> 0.5mt);
            marker(:right :de.exbf :removed, hf[:win] >> 0.5mt);
            slabel(:right :removed, hf[:win - 0.5sw] >> 0.5mt >> 1.6sh,
                "Winderatt"
            );
        }

        with link = "line.de.1020" {
            track(hf[:win + 0.5sw, :hus - 0.5sw]);
        }

        with link = "point.de.Husby", railway = :station {
            track(hf[:hus - 0.5sw, :hus + 0.5sw]);
            marker(:right :de.hp, hf[:hus] >> 0.5mt);
            marker(:right :de.exbf, hf[:hus] >> 0.5mt);
            slabel(:right, hf[:hus - 0.25sw] >> 0.5mt >> 1.7sh,
                "Husby"
            );
        }

        with link = "line.de.1020" {
            track(hf[:hus + 0.5sw, :maa - 0.5sw]);
        }

        with link = "point.de.Maasbüll-Angeln", railway = :station {
            track(hf[:maa - 0.5sw, :maa + 0.5sw]);
            marker(:left :de.bf :removed, hf[:maa] << 0.5mt);
            slabel(:right :removed, hf[:maa - 0.4sw] >> 1.2mt,
                hbox(:left:base, "Maasbüll", span(:light, " (Angeln)"))
            );
        }

        with link = "line.de.1020" {
            track(hf[:maa + 0.5sw, :maa + 1.5km]);
            line_label(:right:sw, hf[:maa + 1.5km] >> 0.5mt, "1020");
            track(hf[:maa + 1.5km, :mag]);
            track(
                    hf[:mag, :fle.xk]
                ..  hf[:fle.yk, :fle.yk + 0.1dl] >> 0.5md << 0.5mt
            );
        }

    }
}

