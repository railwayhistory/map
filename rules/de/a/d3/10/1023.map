# DE 1023.  Kiel Hbf - Neustadt (Holst)
#
let kn = path("d3.de.1023");

with detail = 3 {
    with railway = :first :pax {
        # point.de.Kiel-Hbf  de.1220

        with link = "line.de.1023" {
            track(
                    kn[:kie.ys, :kie.xs] << 0.5md << 1ms << 0.5mt
                ..  kn[:kss.ys - 0.1dl, :kss.ys]
            );
        }

        with link = "point.de.Kiel-Hbf-Ss", railway = :station {
            # DE 9107
            track(:nopax,
                    kn[:kss.ym, :kss.ym + 0.5dl] << 1mt << 1ms
            );

            # DE 1023
            track(kn[:kss.ys, :kss + 1dl]);

            # DE 1033
            track(
                    kn[:kss.ym, :kss] >> 1mt >> 1ms
                --  kn[:kss + 1dl, :kss + 1.1dl]
            );

            marker(:right :de.abzw, kn[:kss] >> 1.5mt >> 1ms);
            slabel(:bottom :xsmall, kn[:kss] >> 1.8sh, "Ss");
        }

        with link = "line.de.1023" {
            track(kn[:kss + 1dl, :kss + 1.7km]);
            line_label(:left:sw, kn[:kss + 1.7km] << 0.5mt, "1023");
            track(kn[:kss + 1.7km, :elh - 0.5sw]);
        }

        with link = "point.de.Kiel-Elmschenhagen", railway = :station {
            track(kn[:elh - 0.5sw, :elh + 0.5sw]);
            marker(:left :de.bf, kn[:elh] << 0.5mt);
            slabel(:right, kn[:elh] + (-0.5sw, -1.5sh),
                "Kiel-Elmschenhagen"
            );
        }

        with link = "line.de.1023" {
            track(kn[:elh + 0.5sw, :kro - 0.5sw]);
        }

        with link = "point.de.Kroog", railway = :station {
            track(kn[:kro - 0.5sw, :kro + 0.5sw]);
            marker(:right :de.hp :removed, kn[:kro] >> 0.5mt);
            slabel(:bottom :removed, kn[:kro] >> 0.5mt >> 1.1sh, "Kroog");
        }

        with link = "line.de.1023" {
            track(kn[:kro + 0.5sw, :raw]);
        }

        with link = "point.de.Raisdorf-West", railway = :station {
            marker(:left :de.awanst, kn[:raw] << 0.5mt);
            slabel(:right :xsmall, kn[:raw] + (0.6sw, -0.9sh),
                "Raisdorf West"
            );
        }

        with link = "line.de.1023" {
            track(kn[:raw, :rai - 0.5sw]);
        }

        with link = "point.de.Raisdorf", railway = :station {
            track(kn[:rai - 0.5sw, :rai + 0.5sw]);
            marker(:right :de.bf, kn[:rai] >> 0.5mt);
            slabel(:right, kn[:rai + 0.5sw] << 1mt, "Raisdorf");
        }

        with link = "line.de.1023" {
            track(kn[:rai + 0.5sw, :pre - 500m]);
            track(:casing, kn[:pre - 500m, :pre - 0.5sw]);
        }

        with link = "point.de.Preetz", railway = :station {
            track(kn[:pre - 0.5sw, :pre + 0.5sw]);
            marker(:left :de.bf, kn[:pre] << 0.5mt);
            slabel(:right, kn[:pre + 0.5sw] << 1.5sh, "Preetz");
        }

        with link = "line.de.1023" {
            track(kn[:pre + 0.5sw, :pre + 1.3km]);
            line_label(:left:w, kn[:pre + 1.3km] << 0.5mt, "1023");
            track(kn[:pre + 1.3km, :kuh - 0.5sw]);
        }

        with link = "point.de.Kühren-Holst", railway = :station {
            track(kn[:kuh - 0.5sw, :kuh + 0.5sw]);
            marker(:right :de.bf :removed, kn[:kuh] >> 0.5mt);
            slabel(:ne :removed, kn[:kuh - 0.7sw] >> 1.5sh,
                hbox(:right:base, "Kühren", span(:light, " (Holst)"))
            );
        }

        with link = "line.de.1023" {
            track(kn[:kuh + 0.5sw, :wah - 0.5sw]);
        }

        with link = "point.de.Wahlstorf", railway = :station {
            track(kn[:wah - 0.5sw, :wah + 0.5sw]);
            marker(:right :de.hp :removed, kn[:wah] >> 0.5mt);
            marker(:right :de.exbf :removed, kn[:wah] >> 0.5mt);
            slabel(:right :removed, kn[:wah + 0.4sw] << 1mt,
                "Wahlstorf"
            );
        }

        with link = "line.de.1023" {
            track(kn[:wah + 0.5sw, :wah + 3.3km]);
            line_badge(kn[:wah + 3.3km], "1023");
            track(kn[:wah + 3.3km, :asc.yn - 100m]);
        }

        with link = "point.de.Ascheberg-Holst", railway = :station {
            track(kn[:asc.yn - 100m, :asc + 0.5sw]);
            marker(:right :de.bf, kn[:asc] >> 0.5mt);
            slabel(:nw, kn[:asc - 0.5sw] >> 0.5mt >> 1.2sh,
                hbox(:left:top,
                    hbox(:left:base,
                        span(:bold, "Ascheberg"), " (Holst)"
                    )
                )
            );
        }

        with link = "line.de.1023" {
            track(kn[:asc + 0.5sw, :asc + 3km]);
            line_label(:left:s, kn[:asc + 3km] << 0.5mt, "1023");
            track(kn[:asc + 3km, :plo - 0.5sw]);
        }

        with link = "point.de.Plön", railway = :station {
            track(kn[:plo - 0.5sw, :plo + 0.5sw]);
            marker(:left :de.bf, kn[:plo] << 0.5mt);
            slabel(:top, kn[:plo] << 0.5mt << 1.3sh + (-0.5dt, 0dt), "Plön");
        }

        with link = "line.de.1023" {
            track(kn[:plo + 0.5sw, :tim - 0.5sw]);
        }

        with link = "point.de.Timmdorf", railway = :station {
            track(kn[:tim - 0.5sw, :tim + 0.5sw]);
            marker(:right :de.bf :removed, kn[:tim] >> 0.5mt);
            slabel(:bottom :removed, kn[:tim] >> 0.5mt >> 1.1sh,
                "Timmdorf"
            );
        }

        with link = "line.de.1023" {
            track(kn[:tim - 0.5sw, :mal.xk]);
        }

        with link = "point.de.Malente-Gremsmühlen", railway = :station {
            # DE 1112
            track(:second :removed,
                    kn[:mal, :mal + 0.6sw] << 0.5md << 1insh << 0.5mt
                --  kn[:mal + 0.6sw + 2dl, :mal + 0.7km - 1dl]
                        << 0.5md << 1ms << 0.5mt
                --  kn[:mal + 0.7km, :mal + 0.71km] << 0.5md >> 0.5mt
            );

            # DE 1023
            track(:double, kn[:mal.xk, :mal + 0.8km]);

            marker(:left :de.inhp, kn[:mal] << 0.5md);
            slabel(:right :bold, kn[:mal + 0.4sw] << 0.5md << 1.1sh,
                hbox(:right:base, span(:bold, "Bad Malente-Gremsmühlen"), "*")
            );
        }

        with link = "line.de.1023" {
            track(:double, kn[:mal + 0.8km, :mal + 2.9km]);
            line_label(:right:ne, kn[:mal + 2.9km] >> 0.5md, "1023");
            track(:double, kn[:mal + 2.9km, :eut - 0.5sw]);
        }

        with link = "point.de.Eutin", railway = :station {
            track(:double, kn[:eut - 0.5sw, :eut + 0.5sw]);
            marker(:left :de.bf, kn[:eut] << 0.5md);
            slabel(:right :bold, kn[:eut + 0.5sw] << 0.5md << 1.2sh,
                "Eutin"
            );
        }
    }

    with railway = :second :pax :removed {
        with link = "line.de.1023" {
            track(:ror, kn[:eut + 0.5sw, :eut + 3km] << 0.5md >> 0.5mt);
            line_label(:left:sw, kn[:eut + 3km] << 0.5md >> 1mt, "1023");
            track(
                    kn[:eut + 3km, :eut.xn] << 0.5md >> 0.5mt
                ..  kn[:eut.zn, :rob - 0.5sw]
            );
        }

        with link = "point.de.Röbel", railway = :station {
            track(kn[:rob - 0.5sw, :rob + 0.5sw]);
            marker(:right :de.hp, kn[:rob] >> 0.5mt);
            slabel(:right, kn[:rob + 0.5sw] << 1mt, "Röbel");
        }

        with link = "line.de.1023" {
            track(kn[:rob + 0.5sw, :buj - 0.5sw]);
        }

        with link = "point.de.Bujendorf", railway = :station {
            track(kn[:buj - 0.5sw, :buj + 0.5sw]);
            marker(:left :de.hst, kn[:buj] << 0.5mt);
            marker(:left :de.exbf, kn[:buj] << 0.5mt);
            slabel(:ne, kn[:buj - 0.5sw] >> 0.5mt, "Bujendorf");
        }

        with link = "line.de.1023" {
            track(kn[:buj + 0.5sw, :ove - 0.5sw]);
        }

        with link = "point.de.Ovelgönne-Holst", railway = :station {
            track(kn[:ove - 0.5sw, :ove + 0.5sw]);
            marker(:right :de.hp, kn[:ove] >> 0.5mt);
            slabel(:ne, kn[:ove + 0.5sw] >> 0.5mt >> 0.8sh, "Ovelgönne");
        }

        with link = "line.de.1023" {
            track(
                    kn[:ove + 0.5sw, :neg.yl - 0.7km]
                ..  kn[:neg.yl, :neg.yl + 0.1dl] << 0.5ms << 0.5mt
            );
        }
    }

    with railway = :first :pax {
        with link = "point.de.Neustadt-Holst-Gbf", railway = :station {
            let lp = path("d3.de.1100");

            # DE 1023 - DE 1100
            track(lp[:neg.yl, :neg.yp] << 0.5ms << 0.5mt);
            track(:suspended, lp[:neg.yp, :neg.yp + 100m] << 0.5ms << 0.5mt);

            # DE 1100 - DE 1023
            track(kn[:neg.yl, :neg.yp + 100m] >> 0.5ms >> 0.5mt);

            marker(:right :de.gbf, kn[:neg] >> 0.5ms >> 1mt);
            slabel(:left, kn[:neg - 0.2sw] << 0.5ms << 1.5mt,
                vbox(:right:base,
                    span(:bold, "Neustadt"),
                    hbox(:right:base, "(Holst) ", span(:bold, "Gbf"))
                )
            );
        }

        with link = "line.de.1023" {
            track(
                    kn[:neg.yp + 100m, :neg.yp + 101m] >> 0.5ms >> 0.5mt
                ..  kn[:neg.xp + 1mt, :nst.yp]
            );
            track(kn[:nst.yp, :nst - 0.5sw]);
        }

        with link = "point.de.Neustadt-Holst", railway = :station {
            track(kn[:nst - 0.5sw, :nst + 0.5sw]);
            marker(:left :de.hp, kn[:nst] << 0.5mt);
            marker(:left :de.awanst, kn[:nst] << 0.5mt);
            slabel(:right, kn[:nst] + (1sw, -0.3sh),
                hbox(:center:base, span(:bold, "Neustadt"), " (Holst)")
            );
        }
    }
}

