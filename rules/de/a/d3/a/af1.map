# DE AF1.  Flensburg Kreisb - Kappeln (Schlei)
#
let fk = path("d4.de.af1");

with detail = 3 {
    with link = "point.de.Flensburg-Kreisb" {
        track(:third:station :narrow:g1000 :removed,
                fk[:fkr - 0.5sw, :fkr.f] >> 1dt
        );
        marker(:right :de.bf :removed, fk[:fkr + 0.2sw] >> 0.8dt);
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed,
                fk[:fkr.f, :xgl - 1dt] >> 1dt
            ..  fk[:eng - 1.1sw, :eng - 1sw]
        );
    }

    with link = "point.de.Engelsby" {
        track(:third:station :narrow:g1000 :removed,
                fk[:eng - 1sw, :eng + 1sw]
        );
        marker(:right :de.zst :removed, fk[:eng]);
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:eng + 1sw, :kau - 1sw]);
    }

    with link = "point.de.Kauslund" {
        track(:third:station :narrow:g1000 :removed,
                fk[:kau - 1sw, :kau + 1sw]
        );
        marker(:right :de.zst :removed, fk[:kau]);
        slabel(:bottom :removed, fk[:kau] >> 1.1sh + (2sw, 0dt),
            "Kauslund"
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:kau + 1sw, :wee - 1sw]);
    }

    with link = "point.de.Wees" {
        track(:third:station :narrow:g1000 :removed,
                fk[:wee - 1sw, :wee + 1sw]
        );
        marker(:right :de.bf :removed, fk[:wee]);
        slabel(:right :removed, fk[:wee] + (0.8sw, -0.2sh),
            hbox(:left:top, "Wees")
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:wee + 1sw, :rot - 1sw]);

        line_label(:left:e :removed, fk[:wee + 1.2km], "AF1");
    }

    with link = "point.de.Rothenhaus" {
        track(:third:station :narrow:g1000 :removed,
                fk[:rot - 1sw, :rot + 1sw]
        );
        marker(:right :de.bf :removed, fk[:rot]);
        slabel(:left :removed, fk[:rot] + (-0.3sw, -0.7sh),
            "Rothenhaus"
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:rot + 1sw, :glu - 1sw]);
    }
    
    with link = "point.de.Glücksburg" {
        track(:third:station :narrow:g1000 :removed,
                fk[:glu - 1sw, :glu + 1.8sw]
        );
        marker(:right :de.bf :removed, fk[:glu + 0.8sw]);
        slabel(:right :removed, fk[:glu + 0.8sw] + (0.3sw, -0.2sw),
            hbox(:left:base, "Glücksburg", span(:light, " (Kr Flensburg)"))
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:glu + 1.8sw, :rud - 1sw]);
    }

    with link = "point.de.Rüde" {
        track(:third:station :narrow:g1000 :removed,
                fk[:rud - 1sw, :rud + 1sw]
        );
        marker(:left :de.zst :removed, fk[:rud]);
        slabel(:right :removed, fk[:rud + 0.7sw] << 1.0sw, "Rüde");
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:rud + 1sw, :rin - 0.8sw]);
    }

    with link = "point.de.Ringsberg" {
        track(:third:station :narrow:g1000 :removed,
                fk[:rin - 0.8sw, :rin + 1.2sw]
        );
        marker(:left :de.bf :removed, fk[:rin + 0.2sw]);
        slabel(:right :removed, fk[:rin] + (0.2sw, -1.2sw), "Ringsberg");
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:rin + 1.2sw, :lan - 1sw]);
        line_label(:right:n :removed, fk[:rin + 1.0km], "AF1");
    }

    with link = "point.de.Langballig" {
        track(:third:station :narrow:g1000 :removed,
                fk[:lan - 1sw, :lan + 1sw]
        );
        marker(:left :de.bf :removed, fk[:lan]);
        slabel(:right :removed, fk[:lan - 1.0sw] << 1.3sw, "Langballig");
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:lan + 1sw, :str - 1sw]);
    }

    with link = "point.de.Streichmühle" {
        track(:third:station :narrow:g1000 :removed,
                fk[:str - 1sw, :str + 1sw]
        );
        marker(:left :de.bf :removed, fk[:str]);
        slabel(:right :removed, fk[:str] + (-0.8sw, -1.3sw), "Streichmühle");
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:str + 1sw, :dol - 1.3sw]);
    }

    with link = "point.de.Dollerup" {
        track(:third:station :narrow:g1000 :removed,
                fk[:dol - 1.3sw, :dol + 0.7sw]
        );
        marker(:left :de.bf :removed, fk[:dol - 0.34sw]);
        slabel(:left :removed, fk[:dol] + (-0.5sw, 0.2sw), "Dollerup");
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:dol + 0.7sw, :nub - 1sw]);
    }

    with link = "point.de.Nübelfeld" {
        track(:third:station :narrow:g1000 :removed,
                fk[:nub - 1sw, :nub + 1sw]
        );
        marker(:right :de.bf :removed, fk[:nub + 0.1sw]);
        slabel(:right :removed, fk[:nub - 0.5sw] << 0.5sh, "Nübelfeld");
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:nub + 1sw, :stk - 1sw]);
    }

    with link = "point.de.Steinbergkirche" {
        track(:third:station :narrow:g1000 :removed,
                fk[:stk - 1sw, :stk + 1sw]
        );
        marker(:right :de.bf :removed, fk[:stk]);
        slabel(:left :removed, fk[:stk + 0.8sw] >> 1.0sh,
            hbox(:right:top, "Steinbergkirche")
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:stk + 1sw, :ste - 1sw]);
    }

    with link = "point.de.Steinberg-Flensburg" {
        track(:third:station :narrow:g1000 :removed,
                fk[:ste - 1sw, :ste + 1sw]
        );
        marker(:left :de.bf :removed, fk[:ste]);
        slabel(:right :removed, fk[:ste] + (-1.2sw, -1.4sw),
            hbox(:center:base, "Steinberg", span(:light, " (Kr Flensburg)"))
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:ste + 1sw, :nie - 1sw]);
    }

    with link = "point.de.Niesgrau" {
        track(:third:station :narrow:g1000 :removed,
                fk[:nie - 1sw, :nie + 1sw]
        );
        marker(:left :de.bf :removed, fk[:nie]);
        slabel(:right :removed, fk[:nie] + (-1.2sw, -1.4sw), "Niesgrau");
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:nie + 1sw, :sta - 1sw]);
    }

    with link = "point.de.Stausmark" {
        track(:third:station :narrow:g1000 :removed,
                fk[:sta - 1sw, :sta + 1sw]
        );
        marker(:left :de.bf :removed, fk[:sta]);
        slabel(:left :removed, fk[:sta - 0.5sw] >> -0.1sw,
            hbox(:right:top, "Stausmark")
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:sta + 1sw, :run.ys]);
        line_label(:right:ne :removed, fk[:sta + 0.9km], "AF1");
    }

    with link = "point.de.Rundhof" {
        track(:third:station :narrow:g1000 :removed,
                fk[:run.ys, :run + 1sw]
        );
        marker(:right :de.bf :removed, fk[:run]);
        slabel(:right :removed, fk[:run] + (-0.5sw, 1.0sw),
            hbox(:left:top :bold, "Rundhof")
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:run + 1sw, :leh - 1sw]);
        line_label(:left:se :removed, fk[:run + 1.9km], "AF1");
    }

    with link = "point.de.Lehbek" {
        track(:third:station :narrow:g1000 :removed,
                fk[:leh - 1sw, :leh + 1sw]
        );
        marker(:right :de.bf :removed, fk[:leh + 0.25sw]);
        slabel(:right :removed, fk[:leh] + (-0.5sw, 0.8sw),
            hbox(:left:top, "Lehbek")
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:leh + 1sw, :gel - 1sw]);
    }

    with link = "point.de.Gelting" {
        track(:third:station :narrow:g1000 :removed,
                fk[:gel - 1sw, :gel + 1sw]
        );
        marker(:left :de.bf :removed, fk[:gel]);
        slabel(:top :removed, fk[:gel] << 1.1sh, "Gelting");
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:gel + 1sw, :stp - 1sw]);
    }

    with link = "point.de.Stenderup" {
        track(:third:station :narrow:g1000 :removed,
                fk[:stp - 1sw, :stp + 1sw]
        );
        marker(:right :de.bf :removed, fk[:stp] >> 0.2dt);
        slabel(:right :removed, fk[:stp + 0.4sw] << 0.4sh, "Stenderup");
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:stp + 1sw, :swa - 1sw]);
    }

    with link = "point.de.Schwackendorf" {
        track(:third:station :narrow:g1000 :removed,
                fk[:swa - 1sw, :swa + 1sw]
        );
        marker(:left :de.bf :removed, fk[:swa] @ 5 << 0.2dt);
        slabel(:right :removed, fk[:swa + 0.4sw] << 1.3sh, "Schwackendorf");
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:swa + 1sw, :rab - 1sw]);
    }

    with link = "point.de.Rabel" {
        track(:third:station :narrow:g1000 :removed,
                fk[:rab - 1sw, :rab + 1sw]
        );
        marker(:left :de.bf :removed, fk[:rab]);
        slabel(:right :removed, fk[:rab + 0.42sw] << 1.3sh, "Rabel");
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:rab + 1sw, :gri - 1sw]);
    }

    with link = "point.de.Grimsnis" {
        track(:third:station :narrow:g1000 :removed,
                fk[:gri - 1sw, :gri + 1sw]
        );
        marker(:right :de.hp :removed, fk[:gri]);
        slabel(:left :removed, fk[:gri] + (-1.5sw, 0.5sw), "Grimsnis");
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:gri + 1sw, :kap.a]);
        line_label(:left:w :removed, fk[:gri + 1.2km], "AF1");
    }
}

