# DE 1023.  Kiel Hbf - Neustadt (Holst)
#
let kn = path("d3.de.1023");

with detail = 4 {
    with railway = :first :pax {
        # point.de.Kiel-Hbf  de.1220

        with link = "line.de.1023" {
            track(
                    kn[:kie.ys, :kie.xs] << 0.5md << 1ms << 0.5mt
                ..  kn[:kss.ys - 0.1dl, :kss.ys]
            );
        }

        with link = "point.de.Kiel-Hbf-Ss", railway = :station {
            # DE 9107
            track(:nopax,
                    kn[:kss.ym, :kss.ym + 0.5dl] << 1mo
            );

            # DE 1023
            track(kn[:kss.ys, :kss]);

            # DE 1033
            track(
                    kn[:kss.ym, :kss - 1.5dl] >> 1mo
                --  kn[:kss - 0.5dl, :kss - 0.4dl]
            );

            marker(:right :statdt, kn[:kss] >> 0.5mt);
            marker(:right :de.abzw, kn[:kss] >> 0.5mo >> 0.5mt);
            station(:bottom, kn[:kss] >> 1.7sh + (-1.5sw, 0dt),
                span(:small, "K. Hbf (Ss)"),
                hbox(:center:top,
                    vbox(:right:top, "1023: ", "1033: "),
                    vbox(:sep:top,
                        hbox(:sep:base, "2,", anchor(), "54"),
                        hbox(:sep:base, "103,", anchor(), "85")
                    )
                )
            );
        }

        with link = "line.de.1023" {
            track(kn[:kss, :wel]);
        }

        with link = "point.de.Kiel-Wellsee-Awanst", railway = :station {
            marker(:right :de.awanst, kn[:wel] >> 0.5mt);
            label(kn[:wel] + (0.5sw, 0dt),
                hbox(:left:base, 
                    span(:small, "Kiel-Wellsee"),
                    span(:xsmall, " • 2,62")
                )
            );
        }

        with link = "line.de.1023" {
            track(kn[:wel, :kss + 1.7km]);
            line_label(:left:sw, kn[:kss + 1.7km] << 0.5mt, "1023");
            track(kn[:kss + 1.7km, :elh - 0.5sw]);
        }

        with link = "point.de.Kiel-Elmschenhagen", railway = :station {
            track(kn[:elh - 0.5sw, :elh + 0.5sw]);
            marker(:left :de.bf, kn[:elh] << 0.5mt);
            station(:right, kn[:elh + 0.5sw] << 0.5mt << 1.3sh,
                vbox(:center:base,
                    span(:former, "Elmschenhagen"),
                    "Kiel-Elmschenhagen"
                ),
                hbox(:center:base,
                    "5,19", span(:removed, "\u{2006}←\u{2006}5,30"),
                    span(:former, " (121,49)")
                )
            );
        }

        with link = "line.de.1023" {
            track(kn[:elh + 0.5sw, :kro - 0.5sw]);
        }

        with link = "point.de.Kroog", railway = :station {
            track(kn[:kro - 0.5sw, :kro + 0.5sw]);
            marker(:right :de.hp :removed, kn[:kro] >> 0.5mt);
            station(:bottom :removed, kn[:kro] >> 0.5mt >> 1.2sh,
                "Kroog", "6,45"
            );
        }

        with link = "line.de.1023" {
            track(kn[:kro + 0.5sw, :raw]);
        }

        with link = "point.de.Raisdorf-West", railway = :station {
            marker(:left :de.awanst, kn[:raw] << 0.5mt);
            station(:top, kn[:raw] << 1.3sh,
                span(:small, "Raisdorf West"), "8,06"
            );
        }

        with link = "line.de.1023" {
            track(kn[:raw, :rai - 0.5sw]);
        }

        with link = "point.de.Raisdorf", railway = :station {
            track(kn[:rai - 0.5sw, :rai + 0.5sw]);
            marker(:right :de.bf, kn[:rai] >> 0.5mt);
            station(:left, kn[:rai - 0.5sw] >> 1.4sh + (0dt, -1dt),
                hbox(:right:top, "Raisdorf"),
                hbox(:center:base, "9,52", span(:former, " (117,28)"))
            );
        }

        with link = "line.de.1023" {
            track(kn[:rai + 0.5sw, :pre - 500m]);
            track(:casing, kn[:pre - 500m, :pre - 0.5sw]);
        }

        with link = "point.de.Preetz", railway = :station {
            track(kn[:pre - 0.5sw, :pre + 0.5sw]);
            marker(:left :de.bf, kn[:pre] << 0.5mt);
            station(:right :left_align, kn[:pre + 0.4sw] << 1.5sh,
                "Preetz",
                hbox(:center:base, "15,38", span(:former, " (111,43)"))
            );
        }

        with link = "line.de.1023" {
            track(kn[:pre + 0.5sw, :pre + 1.3km]);
            line_label(:left:w, kn[:pre + 1.3km] << 0.5mt, "1023");
            track(kn[:pre + 1.3km, :kuh - 0.5sw]);
        }

        with link = "point.de.Kühren-Holst", railway = :station {
            track(kn[:kuh - 0.5sw, :kuh + 0.5sw]);
            marker(:right :de.bf :removed, kn[:kuh] >> 0.5mt);
            station(:left :removed, kn[:kuh + 0.3sw] >> 1.8sh,
                hbox(:right:base, "Kühren", span(:light, " (Holst)")),
                hbox(:center:base, "19,18", span(:former, " (107,63)"))
            );
        }

        with link = "line.de.1023" {
            track(kn[:wah + 0.5sw, :wah + 3.3km]);
            line_badge(kn[:wah + 3.3km], "1023");
            track(kn[:wah + 3.3km, :asc.yn - 100m]);
        }

        with link = "point.de.Wahlstorf", railway = :station {
            track(kn[:wah - 0.5sw, :wah + 0.5sw]);
            marker(:right :de.hp :removed, kn[:wah] >> 0.5mt);
            marker(:right :de.exbf :removed, kn[:wah] >> 0.5mt);
            station(:left :removed, kn[:wah - 0.8sw] >> 1.7sh,
                hbox(:right:top, "Wahlstorf"),
                hbox(:center:base, "21,65", span(:former, " (105,15)"))
            );
        }

        with link = "line.de.1023" {
            track(kn[:wah + 0.5sw, :asc.yn - 100m]);
        }

        with link = "point.de.Ascheberg-Holst", railway = :station {
            track(kn[:asc.yn - 100m, :asc + 0.5sw]);
            marker(:right :de.bf, kn[:asc] >> 0.5mt);
            station(:right, kn[:asc - 0.5sw] >> 0.5mt >> 1.1sh,
                hbox(:left:top,
                    hbox(:left:base,
                        span(:bold, "Ascheberg"), " (Holst)"
                    )
                ),
                hbox(:center:top,
                    vbox(:right:top, "1023: ", span(:removed, "1041: ")),
                    vbox(:sep:top,
                        hbox(:sep:base, "26,", anchor(), "70",
                            span(:former, " (100,11)")
                        ),
                        hbox(:sep:base :removed, "100,", anchor(), "12")
                    )
                )
            );
        }

        with link = "line.de.1023" {
            track(kn[:asc + 0.5sw, :asc + 3km]);
            line_label(:left:s, kn[:asc + 3km] << 0.5mt, "1023");
            track(kn[:asc + 3km, :plo - 0.5sw]);
        }

        with link = "point.de.Plön", railway = :station {
            track(kn[:plo - 0.5sw, :plo + 0.5sw]);
            marker(:left :de.bf, kn[:plo] << 0.5mt);
            station(:top, kn[:plo] << 0.5mt << 1.3sh + (-0.5dt, 0dt),
                "Plön",
                hbox(:center:base, "33,05", span(:former, " (106,48)"))
            );
        }

        with link = "line.de.1023" {
            track(kn[:plo + 0.5sw, :tim - 0.5sw]);
        }

        with link = "point.de.Timmdorf", railway = :station {
            track(kn[:tim - 0.5sw, :tim + 0.5sw]);
            marker(:right :de.bf :removed, kn[:tim] >> 0.5mt);
            station(:bottom :removed, kn[:tim] >> 0.5mt >> 1.1sh,
                "Timmdorf",
                hbox(:center:base, "38,66", span(:former, " (112,10)"))
            );
        }

        with link = "line.de.1023" {
            track(kn[:tim - 0.5sw, :mal.xk]);
        }

        with link = "point.de.Malente-Gremsmühlen", railway = :station {
            # DE 1112
            track(:second :removed,
                    kn[:mal, :mal + 0.6sw] << 0.5mo << 1insh << 1mt
                ..  kn[:mal + 200m, :mal + 0.7km - 1dl] << 1.5mo
                --  kn[:mal + 0.7km, :mal + 0.71km] << 0.5md << 0.5mo
            );

            # DE 1023
            track(
                    kn[:mal.xk, :mal.xk + 90m]
                ..  kn[:mal - 0.5sw, :mal + 0.75km] << 0.5mo
            );
            track(
                    kn[:mal.xk + 89m, :mal.xk + 90m]
                ..  kn[:mal - 0.5sw, :mal + 0.75km] >> 0.5mo
            );                   

            marker(:left :de.inhp, kn[:mal] << 0.5mo << 0.5mt);
            station(:right, kn[:mal + 0.4sw] << 0.5mo << 1.1sh,
                vbox(:center:base :bold,
                    span(:former, "Gremsmühlen"),
                    span(:former, "Malente-Gremsmühlen"),
                    "Bad Malente-Gremsmühlen"
                ),
                hbox(:center:top,
                    vbox(:right:top, span(:removed, "1112: "), "1023: "),
                    vbox(:sep:top,
                        hbox(:sep:base :removed, "0,", anchor(), "11"),
                        hbox(:sep:base, "42,", anchor(), "41 ",
                            span(:former, "(115,82)")
                        )
                    )
                )
            );
        }

        with link = "line.de.1023" {
            track(:double, kn[:mal + 0.75km, :mal + 2.9km]);
            line_badge(kn[:mal + 2.9km], "1023");
            track(:double, kn[:mal + 2.9km, :eut - 0.5sw]);
        }

        with link = "point.de.Eutin", railway = :station {
            # DE 1023 dn
            track(
                    kn[:eut - 0.5sw, :eut + 330m - 1dl] << 0.5mo
                --  kn[:eut + 330m, :eut + 331m] >> 0.5mo
            );
            track(:side :nopax,
                    kn[:eut + 479m, :eut + 480m] >> 0.5mo
                --  kn[:eut + 480m + 1dl, :eut.fn] << 0.5mo
            );

            # DE 1023 up - DE 1110
            track(kn[:eut - 0.5sw, :eut + 580m] >> 0.5mo);

            marker(:left :de.bf, kn[:eut] << 0.5md);
            station(:right :left_align, kn[:eut + 0.5sw] << 0.5md << 1.2sh,
                span(:bold, "Eutin"),
                hbox(:center:top,
                    "     ",
                    vbox(:right:top, "1023: ", "1110: "),
                    vbox(:sep:top,
                        hbox(:sep:base,
                            "47,", anchor(), "74 ",
                            span(:former, "(121,15)")
                        ),
                        hbox(:sep:base, "0,", anchor(), "00")
                    )
                )
            );
        }
    }

    with railway = :second :pax :removed {
        with link = "line.de.1023" {
            track(kn[:eut.fn, :eut + 3km] << 0.5mo);
            line_badge(kn[:eut + 3km] << 0.5mo, "1023");
            track(
                    kn[:eut + 3km, :eut.xn] << 0.5mo
                ..  kn[:eut.zn, :rob - 0.5sw]
            );
        }

        with link = "point.de.Röbel" {
            track(kn[:rob - 0.5sw, :rob + 0.5sw]);
            marker(:right :de.hp, kn[:rob] >> 0.5mt);
            station(:left :right_align, kn[:rob - 0.6sw] >> 0.5mt >> 1.3sh,
                hbox(:right:top, "Röbel"),
                hbox(:center:base, "53,53", span(:former, " (126,85)"))
            );
        }

        with link = "line.de.1023" {
            track(kn[:rob + 0.5sw, :buj - 0.5sw]);
        }

        with link = "point.de.Bujendorf", railway = :station {
            track(kn[:buj - 0.5sw, :buj + 0.5sw]);
            marker(:left :de.hst, kn[:buj] << 0.5mt);
            marker(:left :de.exbf, kn[:buj] << 0.5mt);
            station(:right :left_align, kn[:buj + 0.5sw] << 0.5mt << 1.7sh,
                "Bujendorf",
                hbox(:center:base, "  55,49", span(:former, " (128,90)"))
            );
        }

        with link = "line.de.1023" {
            track(kn[:buj + 0.5sw, :ove - 0.5sw]);
        }

        with link = "point.de.Ovelgönne-Holst", railway = :station {
            track(kn[:ove - 0.5sw, :ove + 0.5sw]);
            marker(:right :de.hp, kn[:ove] >> 0.5mt);
            station(:bottom, kn[:ove - 0.2sw] >> 0.5mt >> 1.3sh,
                "Ovelgönne", "59,0"
            );
        }

        with link = "line.de.1023" {
            track(kn[:ove + 0.5sw, :ove + 1.5km]);
            line_label(:left:s, kn[:ove + 1.5km] << 0.5mt, "1023");
            track(
                    kn[:ove + 1.5km, :neg.yl - 0.7km]
                ..  kn[:neg.yl, :neg.yl + 0.1dl] << 0.5mo
            );
        }
    }

    with railway = :first :pax {
        with link = "point.de.Neustadt-Holst-Gbf", railway = :station {
            let lp = path("d3.de.1100");

            # DE 1023 - DE 1100
            track(:removed, lp[:neg.yl, :neg.yl + 1dl] << 0.5mo);
            track(
                    lp[:neg.yl, :neg.yl + 0.1dl] >> 0.5mo
                --  lp[:neg.yl + 1.1dl, :neg.yp] << 0.5mo
            );
            track(:suspended, lp[:neg.yp, :neg.yp + 100m] << 0.5mo);

            # DE 1100 - DE 1023
            track(kn[:neg.yl, :neg.yp + 100m] >> 0.5mo);

            marker(:right :de.gbf, kn[:neg] >> 0.5mo >> 0.5mt);
            station(:left, kn[:neg - 0.2sw] << 1.5mo,
                hbox(:right:base,
                    span(:bold, "Neustadt"), " (Holst) ", span(:bold, "Gbf")
                ),
                hbox(:center:top,
                    vbox(:right:top,
                        "1023: ", "1100: ", span(:removed, "SNS: ")
                    ),
                    vbox(:sep:top,
                        hbox(:sep:base, "62,", anchor(), "02"),
                        hbox(:sep:base, "29,", anchor(), "07"),
                        hbox(:sep:base :removed, "23,", anchor(), "37")
                    )
                )
            );
        }

        with link = "line.de.1023" {
            track(
                    kn[:neg.yp + 100m, :neg.yp + 101m] >> 0.5mo
                ..  kn[:neg.xp + 0.5mo, :nst.yp - 200m]
            );
            line_label(:right:nw, kn[:nst.yp - 200m] >> 0.5mt, "1023");
            track(kn[:nst.yp - 200m, :nst.yp]);
            track(kn[:nst.yp, :nst - 0.5sw]);
        }

        with link = "point.de.Neustadt-Holst", railway = :station {
            track(kn[:nst - 0.5sw, :nst + 0.5sw]);
            marker(:left :de.hp, kn[:nst] << 0.5mt);
            marker(:left :de.awanst, kn[:nst] << 0.5mt);
            station(:right, kn[:nst] + (1sw, -0.5sh),
                hbox(:center:base, span(:bold, "Neustadt"), " (Holst)"),
                hbox(:center:top,
                    vbox(:right:top,
                        "1023: ",
                        span(:removed, "SNS: "),
                        span(:removed, "NHH: ")
                    ),
                    vbox(:sep:top,
                        hbox(:sep:base,
                            "63,", anchor(), "30 ",
                            span(:former, "(136,75)")
                        ),
                        hbox(:sep:base :removed, "24,", anchor(), "45"),
                        hbox(:sep:base :removed, "0,", anchor(), "00")
                    )
                )
            );
        }
    }
}

