# DE 1020. Kiel-Hassee Cittipark - Flensburg
#
let hf = path("d3.de.1020");

with detail = 4 {
    with railway = :second :pax {
        # point.de.Kiel-Hassee  de.1022

        with link = "line.de.1020" {
            track(
                    hf[:has.yk, :has.yk + 200m] >> 0.5mo
                ..  hf[:has.xk, :kro - 0.9km]
            );
            line_badge(hf[:kro - 0.9km], "1020");
            track(hf[:kro - 0.9km, :kro - 0.5sw]);
        }

        with link = "point.de.Kronshagen", railway = :station {
            track(hf[:kro - 0.5sw, :kro + 0.5sw]);
            marker(:left :de.hp, hf[:kro] << 0.5mt);
            marker(:left :de.exbf, hf[:kro] << 0.5mt);
            station(:left, hf[:kro - 0.3sw] << 0.5mt << 2sh,
                "Kronshagen",
                hbox(:center:base,
                    "5,60", span(:removed, "\u{2006}←\u{2006}5,63")
                )
            );
        }

        with link = "line.de.1020" {
            track(hf[:kro + 0.5sw, :suc - 430m]);
        }

        with link = "point.de.Suchsdorf", railway = :station {
            let ks = path("d3.de.9105");

            # DE 1020
            track(hf[:suc - 430m, :suc.ys + 50m]);

            # DE 9105
            track(:nopax,
                    hf[:suc - 381m, :suc - 380m]
                --  ks[:suc - 380m + 1dl, :suc.ys + 50m] >> 1mo
            );

            marker(:left :de.bf, hf[:suc] << 0.5mt);
            station(:left :right_align, hf[:suc - 0.55sw] << 0.5mt << 1.4sh,
                span(:bold, "Suchsdorf"),
                hbox(:center:top,
                    vbox(:right:top, "1020: ", "9105: "),
                    vbox(:sep:top,
                        hbox(:sep:base,
                            "7,", anchor(), "75",
                            span(:removed, "\u{2006}←\u{2006}7,81")
                        ),
                        hbox(:sep:base, "0,", anchor(), "00")
                    )
                )
            );
        }

        with link = "line.de.1020" {
            track(hf[:suc.ys + 50m, :suc.ys + 1.1km]);
            line_label(:right:sw, hf[:suc.ys + 1.1km] >> 0.5mt, "1020");
            track(hf[:suc.ys + 1.1km, :lev - 0.5sw]);
        }

        with link = "point.de.Levensau" {
            track(hf[:lev - 0.5sw, :lev + 0.5sw]);
            marker(:left :de.hp :removed, hf[:lev] << 0.5mt);
            station(:left :removed, hf[:lev - 0.2sw] << 0.5mt << 1.8sh,
                "Levensau", "10,19"
            );
        }

        with link = "line.de.1020" {
            track(hf[:lev + 0.5sw, :nwi - 260m]);
        }

        with link = "point.de.Neuwittenbek", railway = :station {
            # DE 1020
            track(hf[:nwi - 260m, :nwi.ys + 50m]);

            # DE 9104
            track(:nopax,
                    hf[:nwi - 211m, :nwi - 210m]
                --  hf[:nwi - 210m + 1dl, :nwi.ys] >> 1mt >> 1ms
            );

            marker(:left :de.bf, hf[:nwi] << 0.5mt);
            station(:left, hf[:nwi + 0.8sw] << 0.5mt << 1.1sh,
                hbox(:right:top :bold, "Neuwittenbek"),
                hbox(:center:base,
                    vbox(:right:top, "1020: ", "9104: "),
                    vbox(:sep:top,
                        hbox(:sep:base, "13,", anchor(), "70"),
                        hbox(:sep:base, "0,", anchor(), "00")
                    )
                )
            );
        }

        with link = "line.de.1020" {
            track(hf[:nwi.ys + 50m, :nwi.ys + 2.3km]);
            line_badge(hf[:nwi.ys + 2.3km], "1020");
            track(hf[:nwi.ys + 2.3km, :get - 0.5sw]);
        }

        with link = "point.de.Gettorf", railway = :station {
            track(hf[:get - 0.5sw, :get + 0.5sw]);
            marker(:right :de.bf, hf[:get] >> 0.5mt);
            station(:right, hf[:get - 0.5sw] >> 0.5mt >> 1.25sh,
                "Gettorf", "19,15");
        }

        with link = "line.de.1020" {
            track(hf[:get + 0.5sw, :ndo - 0.5sw]);
        }

        with link = "point.de.Neudorf", railway = :station {
            track(hf[:ndo - 0.5sw, :ndo + 0.5sw]);
            marker(:left :de.ldst :removed, hf[:ndo] << 0.5mt);
            station(:left :removed, hf[:ndo + 0.7sw] << 0.5mt << 1.2sh,
                hbox(:right:top, "Neudorf"),
                "22,80"
            );
        }

        with link = "line.de.1020" {
            track(hf[:ndo + 0.5sw, :aho - 0.5sw]);
        }

        with link = "point.de.Altenhof-Schlesw", railway = :station {
            track(hf[:aho - 0.5sw, :aho + 0.5sw]);
            marker(:left :de.hp :removed, hf[:aho] << 0.5mt);
            marker(:left :de.exbf :removed, hf[:aho] << 0.5mt);
            station(:right :removed, hf[:aho - 0.4sw] >> 2mt,
                hbox(:left:base, "Altenhof", span(:light, " (Schlesw)")),
                "27,97"
            );
        }

        with link = "line.de.1020" {
            track(hf[:aho + 0.5sw, :aho + 1.9km]);
            line_label(
                :left:e, hf[:aho + 1.9km] << 0.5mt, (0dt, 0.2dt), "1020"
            );
            track(hf[:aho + 1.9km, :ecs - 0.5sw]);
        }

        with link = "point.de.Eckernförde", railway = :station {
            track(hf[:ecs - 0.5sw, :ecs + 0.5sw]);
            marker(:right :de.bf, hf[:ecs] >> 0.5mt);
            station(:right, hf[:ecs - 0.5sw] >> 0.5mt >> 1.3sh,
                span(:bold, "Eckernförde"),
                "1020: 31,10"
            );
        }

        with link = "line.de.1020" {
            track(hf[:ecs + 0.5sw, :eck.yk]);
            track(hf[:eck.yk, :eck.yk + 4.5km]);
            line_label(:left:e, hf[:eck.yk + 4.5km] << 0.5mt, "1020");
            track(hf[:eck.yk + 4.5km, :rie - 0.5sw]);
        }

        with link = "point.de.Rieseby", railway = :station {
            track(hf[:rie - 0.5sw, :rie + 0.5sw]);
            marker(:right :de.hp, hf[:rie] >> 0.5mt);
            marker(:right :de.exbf, hf[:rie] >> 0.5mt);
            station(:right, hf[:rie - 0.45sw] >> 0.5mt >> 1.9sh,
                "Rieseby", "39,74"
            );
        }

        with link = "line.de.1020" {
            track(hf[:rie + 0.5sw, :rie + 3.1km]);
            line_badge(hf[:rie + 3.1km], "1020");
            track(hf[:rie + 3.1km, :sls - 0.5sw]);
        }

        with link = "point.de.Schleibrücke-Süd", railway = :station {
            track(hf[:sls - 0.5sw, :sls + 0.5sw]);
            marker(:right :de.hp, hf[:sls] >> 0.5mt);
            station(:right, hf[:sls - 0.5sw] >> 0.5mt >> 1.2sh,
                "Schleibrücke Süd", "44,32"
            );
        }
    }

    with railway = :second :pax :suspended {
        with link = "line.de.1020" {
            track(hf[:sls + 0.5sw, :sle]);
        }

        with link = "point.de.Boren-Schleibrücke", railway = :station {
            marker(:right :de.bk, hf[:sle] >> 0.5mt);
            station(:left, hf[:sle - 0.2sw] << 3.5mt,
                hbox(:right:base, span(:light, "Boren "), "Schleibrücke"),
                "44,55"
            );
        }

        with link = "line.de.1020" {
            track(hf[:sle, :sle + 0.7sw]);
        }
    }

    with railway = :second :pax {
        with link = "point.de.Schleibrücke-Nord", railway = :station {
            track(hf[:sle + 0.7sw, :sle + 1.7sw]);
            marker(:right :de.hp, hf[:sle + 1.2sw] >> 0.5mt);
            station(:right, hf[:sle + 0.8sw] >> 0.5mt >> 1.2sh,
                "Schleibrücke Nord", "44,66"
            );
        }

        with link = "point.de.Lindaunis", railway = :station {
            track(hf[:sle + 1.7sw, :sle + 2.8sw]);
            marker(:right :de.hp, hf[:sle + 2.3sw] >> 0.5mt);
            marker(:right :de.exbf, hf[:sle + 2.3sw] >> 0.5mt);
            label(hf[:sle + 2.3sw] >> 0.5mt >> 1.6sh,
                hbox(:left:base,
                    span(:medium, "Lindaunis"),
                    span(:xsmall, " • 44,89"),
                    span(:xsmall :removed, "\u{2006}←\u{2006}44,81")
                )
            );
        }

        with link = "line.de.1020" {
            track(hf[:sle + 2.8sw, :fah - 0.5sw]);
        }

        with link = "point.de.Fahrtoft", railway = :station {
            track(hf[:fah - 0.5sw, :fah + 0.5sw]);
            marker(:left :de.hp :removed, hf[:fah] << 0.5mt);
            station(:left :removed, hf[:fah - 0.3sw] << 0.5mt << 1.7sh,
                "Fahrtoft", "47,98"
            );
        }

        with link = "line.de.1020" {
            track(hf[:fah + 0.5sw, :fah + 1.6km]);
            line_badge(hf[:fah + 1.6km], "1020");
            track(hf[:fah + 1.6km, :sud.ys]);
        }

        with link = "point.de.Süderbrarup", railway = :station {
            track(hf[:sud.ys, :sud.yk + 50m]);
            track(:nopax,
                    hf[:sud.yk - 1.1dl, :sud.yk - 1dl]
                --  hf[:sud.yk, :sud.yk + 0.1dl] >> 1mt >> 1ms
            );
            marker(:right :de.bf, hf[:sud] >> 0.5mt);
            station(:right, hf[:sud - 0.4sw] >> 0.5mt >> 1.3sh,
                span(:bold, "Süderbrarup"),
                hbox(:center:top,
                    vbox(:right:top, "1020: ", "9102: "),
                    vbox(:sep:top,
                        hbox(:sep:base, "51,", anchor(), "33"),
                        hbox(:sep:base, "21,", anchor(), "0")
                    )
                )
            );
        }

        with link = "line.de.1020" {
            track(hf[:sud.yk + 50m, :moh - 0.5sw]);
        }

        with link = "point.de.Mohrkirch", railway = :station {
            track(hf[:moh - 0.5sw, :moh + 0.5sw]);
            marker(:right :de.bf :removed, hf[:moh] >> 0.5mt);
            label(hf[:moh - 0.5sw] >> 0.5mt >> 1.3sh,
                vbox(:left:base :removed,
                    vbox(:left:base,
                        span(:former, "Mohrkirch-Osterholz"),
                        span(:former, "Mohrkirchosterholz")
                    ),
                    hbox(:left:base,
                        vbox(:center:topbase,
                            "Mohrkirch",
                            span(:xsmall, "57,08")
                        )
                    )
                )
            );
        }

        with link = "line.de.1020" {
            track(hf[:moh + 0.5sw, :sor.yr - 800m]);
            line_badge(hf[:moh + 3km], "1020");
            with layer = -1 track(hf[:sor.yr - 800m, :sor.yr]);
            track(hf[:sor.yr, :sor.ys]);
            track(hf[:sor.ys, :sor - 0.5sw]);
        }

        with link = "point.de.Sörup", railway = :station {
            track(hf[:sor - 0.5sw, :sor + 0.5sw]);
            marker(:right :de.bf, hf[:sor] >> 0.5mt);
            station(:right :left_align, hf[:sor - 0.5sw] >> 0.5mt >> 1.25sh,
                span(:bold, "Sörup"), "  1020: 62,50"
            );
        }

        with link = "line.de.1020" {
            track(hf[:sor + 0.5sw, :sor + 1.3km]);
            line_badge(hf[:sor + 1.3km], "1020");
            track(hf[:sor + 1.3km, :win - 0.5sw]);
        }

        with link = "point.de.Winderatt", railway = :station {
            track(hf[:win - 0.5sw, :win + 0.5sw]);
            marker(:right :de.hst :removed, hf[:win] >> 0.5mt);
            marker(:right :de.exbf :removed, hf[:win] >> 0.5mt);
            station(:right :removed, hf[:win - 0.5sw] >> 0.5mt >> 1.6sh,
                "Winderatt", "65,60"
            );
        }

        with link = "line.de.1020" {
            track(hf[:win + 0.5sw, :hus - 0.5sw]);
        }

        with link = "point.de.Husby", railway = :station {
            track(hf[:hus - 0.5sw, :hus + 0.5sw]);
            marker(:right :de.hp, hf[:hus] >> 0.5mt);
            marker(:right :de.exbf, hf[:hus] >> 0.5mt);
            station(:top, hf[:hus - 0.1sw] >> 0.5mt >> 1.7sh,
                "Husby",
                hbox(:center:base,
                    "70,64", span(:removed, "\u{2006}←\u{2006}70,50")
                )
            );
        }

        with link = "line.de.1020" {
            track(hf[:hus + 0.5sw, :maa - 0.5sw]);
        }

        with link = "point.de.Maasbüll-Angeln", railway = :station {
            track(hf[:maa - 0.5sw, :maa + 0.5sw]);
            marker(:left :de.bf :removed, hf[:maa] << 0.5mt);
            station(:right :removed, hf[:maa - 0.4sw] >> 1.5mt,
                hbox(:left:base, "Maasbüll", span(:light, " (Angeln)")),
                "74,08"
            );
        }

        with link = "line.de.1020" {
            track(hf[:maa + 0.5sw, :maa + 1.5km]);
            line_badge(hf[:maa + 1.5km], "1020");
            track(hf[:maa + 1.5km, :mag]);
            track(hf[:mag, :fle.yk - 1.8km]);
            line_badge(hf[:fle.yk - 1.8km], "1020");
            track(
                    hf[:fle.yk - 1.8km, :fle.xk]
                ..  hf[:fle.yk, :fle.yk + 0.1dl] >> 0.5mo
            );
        }

    }
}

