# DE 1022.  Kiel Hbf - Osterrönfeld
#
let ko = path("d3.de.1022");

with detail = 4 {
    with railway = :first :pax {
        with link = "line.de.1022" {
            track(:up:ldn,
                    ko[:kie.ks - 0.1dl, :kie.ks] >> 2.5mo
                ..  ko[:khg.ym, :khg.ym + 0.1dl] >> 0.5mo
            );
            track(:dn:rup:lor :removed,  
                    ko[:kie.ks - 0.1dl, :kie.ks] >> 1.5mo
                ..  ko[:khg.ym, :khg.ym + 0.1dl] << 0.5mo
            );
            track(ko[:khg.ym, :khg.ym + 0.15km] >> 0.5mo);
            line_label(:right:s, ko[:khg.ym + 0.15km] >> 0.5mo >> 0.5mt,
                "1022"
            );
            track(ko[:khg.ym + 0.15km, :khg] >> 0.5mo);
        }

        with link = "point.de.Kiel-Hg", railway = :station {
            marker(:left :de.abzw :removed, ko[:khg] << 0.5mo << 0.5mt);
            station(:bottom :removed,
                ko[:khg] << 0.5mo << 1.2sh,
                span(:small, "Hg"),
                hbox(:center:top,
                    vbox(:right:top, "1022: ", "1031: "),
                    vbox(:sep:top,
                        hbox(:sep:base, "1,", anchor(), "53"),
                        hbox(:sep:base, "?", anchor(), "?")
                    )
                )
            );
        }

        with link = "line.de.1022" {
            track(ko[:khg, :has - 160m - 2dl] >> 0.5mo);
        }

        with link = "point.de.Kiel-Hassee", railway = :station {
            let hf = path("d3.de.1020");

            # DE 1031
            track(:nopax,
                    ko[:has - 160m - 2dl, :has - 160m - 1dl] << 0.5mo
                --  ko[:has - 160m, :has - 159m] >> 0.5mo
            );
            track(:removed,
                    ko[:has - 160m - 1dl, :has + 1dl] << 0.5mo
            );

            # DE 1022
            track(
                    ko[:has - 160m - 2dl, :has] >> 0.5mo
                --  ko[:has + 1dl, :has.yf] << 0.5mo
            );

            # DE 1020
            track(hf[:has, :has.yk] >> 0.5mo);

            # DE 1021
            track(:nopax :removed,
                    hf[:has + 0.9dl, :has + 1dl] >> 0.5mo
                --  hf[:has + 2dl, :has.yk] >> 1.5mo
            );

            marker(:left :de.bf, ko[:has] << 0.5mo << 0.5mt);
            station(:left, hf[:has - 0.25sw] << 0.5mo << 1.7sh,
                span(:bold, "Kiel-Hassee Cittipark"),
                hbox(:center:top,
                    vbox(:right:top,
                        "1020: ", span(:removed, "1021: "), "1022: ", "1031: "
                    ),
                    vbox(:sep:top,
                        hbox(:sep:base, "2,", anchor(), "90"),
                        hbox(:sep:base :removed, "0,", anchor(), "00"),
                        hbox(:sep:base, "2,", anchor(), "90"),
                        hbox(:sep:base, "106,", anchor(), "52")
                    )
                )
            );
        }

        with link = "line.de.1022" {
            track(
                    ko[:has.yf - 0.1dl, :has.yf] << 0.5mo
                ..  ko[:has.xf + 0.5mo, :has.xf + 0.2km]
            );
            line_badge(ko[:has.xf + 0.2km], "1022");
            track(ko[:has.xf + 0.2km, :rus - 0.5sw]);
        }

        with link = "point.de.Russee", railway = :station {
            track(ko[:rus - 0.5sw, :rus + 0.5sw]);
            marker(:left :de.hp, ko[:rus] << 0.5mt);
            station(:top :right_align, ko[:rus - 0.5sw] >> 1mt,
                vbox(:right:base,
                    span(:former, "Russee"),
                    "Kiel-Russee"
                ),
                hbox(:center:base,
                    span(:removed, "5,36\u{2006}→\u{2006}"), "5,34"
                )
            );
        }

        with link = "line.de.1022" {
            track(ko[:rus + 0.5sw, :met - 0.5sw]);
        }

        with link = "point.de.Kiel-Mettenhof", railway = :station {
            track(ko[:met - 0.5sw, :met + 0.5sw]);
            marker(:right :de.hp :removed, ko[:met] >> 0.5mt);
            station(:top :removed, ko[:met] >> 1.4sh,
                "Kiel-Mettenhof", "??"
            );
        }

        with link = "line.de.1022" {
            track(ko[:met + 0.5sw, :meh - 0.5sw]);
        }

        with link = "point.de.Melsdorf", railway = :station {
            track(ko[:meh - 0.5sw, :meh + 0.5sw]);
            marker(:right :de.hp, ko[:meh] >> 0.5mt);
            marker(:right :de.exbf, ko[:meh] >> 0.5mt);
            station(:top, ko[:meh] >> 1.7sh,
                "Melsdorf",
                hbox(:center:base,
                    span(:removed, "8,07\u{2006}→\u{2006}"), "7,96"
                )
            );
        }

        with link = "line.de.1022" {
            track(ko[:meh + 0.5sw, :meh + 1.7km]);
            line_badge(ko[:meh + 1.7km], "1022");
            track(ko[:meh + 1.7km, :fle - 0.5sw]);
        }

        with link = "point.de.Flemhude", railway = :station {
            track(ko[:fle - 0.5sw, :fle + 0.5sw]);
            marker(:right :de.hp :removed, ko[:fle] >> 0.5mt);
            station(:top :removed, ko[:fle] >> 1.3sh, "Flemhude", "11,59");
        }

        with link = "line.de.1022" {
            track(ko[:fle + 0.5sw, :ach - 0.5sw]);
        }

        with link = "point.de.Achterwehr", railway = :station {
            track(ko[:ach - 0.5sw, :ach + 0.5sw]);
            marker(:left :de.hp, ko[:ach] << 0.5mt);
            station(:right, ko[:ach - 0.4sw] << 1.3sh,
                hbox(:left:top, "Achterwehr"),
                hbox(:center:base,
                    span(:removed, "12,60\u{2006}→\u{2006}"), "12,58"
                )
            );
        }

        with link = "line.de.1022" {
            track(ko[:ach + 0.5sw, :fel - 0.5sw]);
        }

        with link = "point.de.Felde-Brandsbek", railway = :station {
            track(ko[:fel - 0.5sw, :fel + 0.5sw]);
            marker(:left :de.bf, ko[:fel] << 0.5mt);
            station(:bottom, ko[:fel] << 1.3sh,
                vbox(:center:base,
                    span(:former, "Brandsbek"),
                    "Felde-Brandsbek"
                ),
                hbox(:center:base,
                    "13,88", span(:removed, "\u{2006}←\u{2006}13,85")
                )
            );
        }

        with link = "line.de.1022" {
            track(ko[:fel + 0.5sw, :bre - 0.5sw]);
        }

        with link = "point.de.Bredenbek", railway = :station {
            track(ko[:bre - 0.5sw, :bre + 0.5sw]);
            marker(:left :de.hp, ko[:bre] << 0.5mt);
            station(:bottom, ko[:bre] << 1.3sh, "Bredenbek", "19,16");
        }

        with link = "line.de.1022" {
            track(ko[:bre + 0.5sw, :kro - 0.5sw]);
        }

        with link = "point.de.Kronsburg", railway = :station {
            track(ko[:kro - 0.5sw, :kro + 0.5sw]);
            marker(:right :de.bf :removed, ko[:kro] >> 0.5mt);
            station(:top :removed, ko[:kro] >> 1.3sh, "Kronsburg", "20,42");
        }

        with link = "line.de.1022" {
            track(ko[:kro + 0.5sw, :kro + 1.3km]);
            line_badge(ko[:kro + 1.3km], "1022");
            track(ko[:kro + 1.3km, :ost - 0.5sw]);
        }

        with link = "point.de.Ostenfeld-Rendsburg", railway = :station {
            track(ko[:ost - 0.5sw, :ost + 0.5sw]);
            marker(:right :de.hst :removed, ko[:ost] >> 0.5mt);
            station(:top :right_align :removed, ko[:ost - 1.3sw] >> 0.8sh,
                vbox(:right:base,
                    "Ostenfeld ", span(:light, " (Kr Rendsburg)")
                ),
                "24,35  "
            );
        }

        with link = "line.de.1022" {
            track(ko[:ost + 0.5sw, :sul - 0.5sw]);
        }

        with link = "point.de.Schülldorf", railway = :station {
            track(ko[:sul - 0.5sw, :suh + 0.5sw]);
            marker(:right :de.bf :removed, ko[:sul] >> 0.5mt);
            marker(:right :de.hp, ko[:suh] >> 0.5mt);
            station(:top, ko[:suh] >> 1.8sh + (-1sw, 0dt),
                "Schülldorf",
                hbox(:center:base,
                    "27,38", span(:removed, "\u{2006}←\u{2006}27,16")
                )
            );
        }

        with link = "line.de.1022" {
            track(ko[:suh + 0.5sw, :suh + 1.2km]);
            line_badge(ko[:suh + 1.2km], "1022");
            track(
                    ko[:suh + 1.2km, :oro.xk - 1.5mo]
                ..  ko[:oro.yk, :ora] >> 1.5mo
            );
        }

        with link = "point.de.Osterrönfeld-Awanst" {
            marker(:right :de.awanst, ko[:ora] >> 1.5mo >> 0.5mt);
            station(:left, ko[:ora] << 2.5mo,
                span(:small, "Osterrönfeld Awanst"),
                "1022: 30,59"
            );
        }

        with link = "line.de.1022" {
            track(ko[:ora, :oro - 0.5sw] >> 1.5mo);
        }

        # point.de.Osterrönfeld  de.1040
    }
}

