# DE AF1.  Flensburg Kreisb - Kappeln (Schlei)
#
let fk = path("d4.de.af1");

with detail = [4, 5] {
    with link = "point.de.Flensburg-Kreisb" {
        track(:third:station :narrow:g1000 :removed,
                fk[:fkr - 0.5sw, :fkr.f] >> 1dt
        );
        track(:third:station :narrow:g1000 :removed,
                fk[:fkr - 0.5sw, :fkr.f] >> 2dt
        );
        marker(:right :de.bf :removed, fk[:fkr] >> 2dt);
        label(fk[:fkr] + (-0.3sw, -1.3dt),
            hbox(:left:bottom :removed,
                vbox(:left:bottom,
                    span(:medium:bold, "F. Kreisb"),
                    hbox(:center:top :xsmall,
                        vbox(:right:top, "AF1: ", "AF2: "),
                        vbox(:left:top, "0,0", "0,0")
                    )
                )
            )
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed,
                fk[:fkr.f, :fkr.f + 50m] >> 1dt
            ..  fk[:xkr, :xgl] << 2dt
            ..  fk[:eng - 1.1sw, :eng - 1sw]
        );
    }

    with link = "point.de.Engelsby" {
        track(:third:station :narrow:g1000 :removed,
                fk[:eng - 1sw, :eng + 1sw]
        );
        marker(:right :de.zst :removed, fk[:eng]);
        label(:removed, fk[:eng + 0.4sw] >> 1.0sh,
            hbox(:left:top,
                hbox(:left:base,
                    span(:medium, "Engelsby "),
                    span(:xsmall, "· 2,3")
                )
            )
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:eng + 1sw, :kau - 1sw]);
    }

    with link = "point.de.Kauslund" {
        track(:third:station :narrow:g1000 :removed,
                fk[:kau - 1sw, :kau + 1sw]
        );
        marker(:right :de.zst :removed, fk[:kau]);
        station(:bottom :removed, fk[:kau] >> 1.2sh,
            "Kauslund", "3,7"
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:kau + 1sw, :wee - 1sw]);
    }

    with link = "point.de.Wees" {
        track(:third:station :narrow:g1000 :removed,
                fk[:wee - 1sw, :wee + 1sw]
        );
        marker(:right :de.bf :removed, fk[:wee]);
        station(:right :removed, fk[:wee] + (0.4sw, 2.0sh),
            "Wees", "4,8"
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:wee + 1sw, :rot - 1sw]);
        line_badge(:removed, fk[:wee + 1.1km], "AF1");
    }

    with link = "point.de.Rothenhaus" {
        track(:third:station :narrow:g1000 :removed,
                fk[:rot - 1sw, :rot + 1sw]
        );
        marker(:right :de.bf :removed, fk[:rot]);
        station(:right :removed, fk[:rot] + (1.2sw, 1.1sh),
            "Rothenhaus", "7,3"
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:rot + 1sw, :glu - 1sw]);
    }

    with link = "point.de.Glücksburg" {
        track(:third:station :narrow:g1000 :removed,
                fk[:glu - 1sw, :glu + 1sw]
        );
        marker(:right :de.bf :removed, fk[:glu]);
        station(:right :removed, fk[:glu] + (0.5sw, 0sw),
            hbox(:left:base, "Glücksburg", span(:light, " (Kr Flensburg)")),
            "9,9"
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:glu + 1sw, :rud - 1sw]);
    }

    with link = "point.de.Rüde" {
        track(:third:station :narrow:g1000 :removed,
                fk[:rud - 1sw, :rud + 1sw]
        );
        marker(:left :de.zst :removed, fk[:rud]);
        station(:top :removed, fk[:rud + 0.05sw] << 1.3sw,
            "Rüde", "12,1"
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:rud + 1sw, :rin - 1sw]);
        line_badge(:removed, fk[:rud + 0.8km], "AF1");
    }

    with link = "point.de.Ringsberg" {
        track(:third:station :narrow:g1000 :removed,
                fk[:rin - 1sw, :rin + 1sw]
        );
        marker(:left :de.bf :removed, fk[:rin]);
        station(:top :removed, fk[:rin] << 1.3sw,
            "       Ringsberg", "14,4"
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:rin + 1sw, :lan - 1sw]);
    }

    with link = "point.de.Langballig" {
        track(:third:station :narrow:g1000 :removed,
                fk[:lan - 1sw, :lan + 1sw]
        );
        marker(:left :de.bf :removed, fk[:lan]);
        station(:top :removed, fk[:lan] << 1.1sw,
            "Langballig", "17,3"
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:lan + 1sw, :str - 1sw]);
    }

    with link = "point.de.Streichmühle" {
        track(:third:station :narrow:g1000 :removed,
                fk[:str - 1sw, :str + 1sw]
        );
        marker(:left :de.bf :removed, fk[:str]);
        station(:top :removed, fk[:str] << 1.1sw,
            "    Streichmühle", "19,7"
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:str + 1sw, :dol - 1sw]);
    }

    with link = "point.de.Dollerup" {
        track(:third:station :narrow:g1000 :removed,
                fk[:dol - 1sw, :dol + 1sw]
        );
        marker(:left :de.bf :removed, fk[:dol]);
        station(:left :removed, fk[:dol] + (-0.4sw, 0.4sw),
            "Dollerup", "21,2"
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:dol + 1sw, :nub - 1sw]);
        line_badge(:removed, fk[:dol + 1.62km], "AF1");
    }

    with link = "point.de.Nübelfeld" {
        track(:third:station :narrow:g1000 :removed,
                fk[:nub - 1sw, :nub + 1sw]
        );
        marker(:right :de.bf :removed, fk[:nub]);
        station(:bottom :removed, fk[:nub] >> 1.3sh,
            "Nübelfeld", "24,4"
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:nub + 1sw, :stk - 1sw]);
    }

    with link = "point.de.Steinbergkirche" {
        track(:third:station :narrow:g1000 :removed,
                fk[:stk - 1sw, :stk + 1sw]
        );
        marker(:right :de.bf :removed, fk[:stk]);
        station(:bottom :removed, fk[:stk] >> 1.3sh,
            "Steinbergkirche", "27,3"
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:stk + 1sw, :ste - 1sw]);
    }

    with link = "point.de.Steinberg-Flensburg" {
        track(:third:station :narrow:g1000 :removed,
                fk[:ste - 1sw, :ste + 1sw]
        );
        marker(:left :de.bf :removed, fk[:ste]);
        station(:top :removed, fk[:ste] << 1.3sh,
            hbox(:center:base, "Steinberg", span(:light, " (Kr Flensburg)")),
            "28,9"
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:ste + 1sw, :nie - 1sw]);
    }

    with link = "point.de.Niesgrau" {
        track(:third:station :narrow:g1000 :removed,
                fk[:nie - 1sw, :nie + 1sw]
        );
        marker(:left :de.bf :removed, fk[:nie]);
        station(:top :removed, fk[:nie] << 1.2sh,
            "Niesgrau", "31,5"
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:nie + 1sw, :sta - 1sw]);
    }

    with link = "point.de.Stausmark" {
        track(:third:station :narrow:g1000 :removed,
                fk[:sta - 1sw, :sta + 1sw]
        );
        marker(:left :de.bf :removed, fk[:sta]);
        station(:right :removed, fk[:sta + 0.4sw] << 1.25sh,
            "Stausmark", "32,3"
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:sta + 1sw, :run.ys]);
        line_label(:right:e :removed, fk[:sta + 0.7km], "AF1");
    }

    with link = "point.de.Rundhof" {
        track(:third:station :narrow:g1000 :removed,
                fk[:run.ys, :run + 1sw]
        );
        marker(:right :de.bf :removed, fk[:run]);
        station(:right :removed, fk[:run] + (-0.3sw, 2.1sw),
            span(:bold, "Rundhof"),
            hbox(:center:top,
                vbox(:right:top, "AF1: ", "AF2: "),
                vbox(:right:top, "34,", "49,"),
                vbox(:left:top, "2", "5")
            )
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:run + 1sw, :leh - 1sw]);
        line_badge(:removed, fk[:run + 1.3km], "AF1");
    }

    with link = "point.de.Lehbek" {
        track(:third:station :narrow:g1000 :removed,
                fk[:leh - 1sw, :leh + 1sw]
        );
        marker(:right :de.bf :removed, fk[:leh]);
        station(:bottom :removed, fk[:leh] >> 1.4sh + (0.5sw, 0sw),
            "Lehbek", "36,9"
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:leh + 1sw, :gel - 1sw]);
    }

    with link = "point.de.Gelting" {
        track(:third:station :narrow:g1000 :removed,
                fk[:gel - 1sw, :gel + 1sw]
        );
        marker(:left :de.bf :removed, fk[:gel]);
        station(:top :removed, fk[:gel] << 1.2sh,
            "Gelting", "38,3"
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:gel + 1sw, :stp - 1sw]);
    }

    with link = "point.de.Stenderup" {
        track(:third:station :narrow:g1000 :removed,
                fk[:stp - 1sw, :stp + 1sw]
        );
        marker(:right :de.bf :removed, fk[:stp]);
        station(:right :removed, fk[:stp + 0.4sw] << 0.4sh,
            "Stenderup", "41,4"
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:stp + 1sw, :swa - 1sw]);
        line_label(:left:w :removed, fk[:stp + 1.0km], "AF1");
    }

    with link = "point.de.Schwackendorf" {
        track(:third:station :narrow:g1000 :removed,
                fk[:swa - 1sw, :swa + 1sw]
        );
        marker(:left :de.bf :removed, fk[:swa]);
        station(:right :removed, fk[:swa + 0.4sw] << 1.3sh,
            "Schwackendorf", "43,2"
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:swa + 1sw, :rab - 1sw]);
    }

    with link = "point.de.Rabel" {
        track(:third:station :narrow:g1000 :removed,
                fk[:rab - 1sw, :rab + 1sw]
        );
        marker(:left :de.bf :removed, fk[:rab]);
        station(:right :removed, fk[:rab + 0.55sw] << 1.3sh,
            "Rabel", "45,9"
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:rab + 1sw, :gri - 1sw]);
    }

    with link = "point.de.Grimsnis" {
        track(:third:station :narrow:g1000 :removed,
                fk[:gri - 1sw, :gri + 1sw]
        );
        marker(:right :de.hp :removed, fk[:gri]);
        station(:left :removed, fk[:gri + 0.4sw] >> 1.4sh,
            "Grimsnis", "47,6"
        );
    }

    with link = "line.de.AF1" {
        track(:third :narrow:g1000 :removed, fk[:gri + 1sw, :kap.a]);
        line_label(:right:ne :removed, fk[:gri + 0.6km], "AF1");
    }
}

