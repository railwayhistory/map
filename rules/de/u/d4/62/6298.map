# DE 6298.  Neudietendorf - Ritschenhausen
#
let nr = path("d4.de.6298");

with detail = [4, 5] {
    # point.de.Neudietendorf: de.6340

    with link = "point.de.Neudietendorf-Ds" {
        # Gl. 3
        track(:first:station :pax,
                nr[:ndi.yw, :ndi.fa] >> 0.5dt
        );
            # W61 - W62
            track(:station,
                    nr[:ndi.yw + 200m] >> 0.5dt
                --  nr[:ndi.yw + 280m] << 0.5dt
            );
            # Anschl.
            track(:station :removed,
                    nr[:ndi.yf + 70m] >> 0.5dt
                --  nr[:ndi.yf + 150m] >> 2.0dt
            );

        # Gl. 4
        track(:first:station :pax,
                nr[:ndi.yw, :ndi.fa] << 0.5dt
        );
            # W61 - W62
            track(:station,
                    nr[:ndi.yw + 320m] << 0.5dt
                --  nr[:ndi.yw + 400m] >> 0.5dt
            );

        # Anschl. Lager
        track(:station :closed,
                nr[:ndi.yf + 70m, :ndi.yf + 600m] >> 2.0dt
        );
        track(:station :closed,
                nr[:ndi.yf + 149m, :ndi.yf + 150m] >> 2.0dt
            --  nr[:ndi.yf + 220m, :ndi.yf + 400m] >> 3.0dt
        );
        track(:station :closed,
                nr[:ndi.yf + 200m, :ndi.yf + 300m] >> 5.0dt
            --  nr[:ndi.yf + 450m, :ndi.yf + 451m] >> 2.0dt
        );

        # Str. 6730
        track(:station :removed,
                nr[:ndi.yw] >> 1.5dt
            --  nr[:ndi.yw + 60m] >> 0.5dt
        );

        marker(:left :de.bft :removed, nr[:ndi.yw + 130m] << 0.5dt);
        with layer = -1 marker(:left :de.bft.casing :removed,
            nr[:ndi.yw + 130m] << 0.5dt
        );
        station(:right:left_align :removed,
            nr[:ndi.yw + 130m - 0.5sw] << 0.5dt << 2.1sw,
            hbox(:left:top, "N. Ds"),
            hbox(:left:top,
                vbox(:right:top, "6370: ", "6298: "),
                vbox(:right:top, "??", "??")
            )
        );
    }

    with link = "line.de.6298" {
        let nd = path("d4.de.6298.nd");

        with layer = -2 track(:first:station :double :removed,
                nd[:ndi.ya - 0.1dl, :ndi.ya] << 1dt
            ..  nd[:ndi.yya, :ndi.yf]
        );

        track(:first :double :excat:ac15 :pax,
                nr[:ndi.fa, :sul - 210m]
        );
    }


    with link = "point.de.Sülzenbrücken" {
        track(:first:station :double :pax, nr[:sul - 210m, :sul + 200m]);

        platform(:pax,
                nr[:sul - 155m, :sul - 20m] >> 0.5dt
            --  nr[:sul - 20m, :sul - 155m] << 1.2dt
        );
        platform(:pax,
                nr[:sul + 10m, :sul + 145m] << 0.5dt
            --  nr[:sul + 145m, :sul + 10m] >> 1.2dt
        );

        marker(:right :de.hp :pax, nr[:sul] >> 0.5dt);
        station(:left :pax, nr[:sul + 0.4sw] >> 0.5dt >> 1.4sw,
            "Sülzenbrücken", "3,38"
        );
    }


    with link = "line.de.6298" {
        track(:first :double :excat:ac15 :pax,
                nr[:sul + 1.1km, :sul + 200m]
        );
        line_badge(:pax, nr[:sul + 1.1km], "6298");
        track(:first :double :excat:ac15 :pax,
                nr[:sul + 1.1km, :haa - 230m]
        );
    }


    with link = "point.de.Haarhausen" {
        track(:first:station :double :pax, nr[:haa - 230m, :haa + 230m]);

        platform(:pax,
                nr[:haa - 180m, :haa - 40m] >> 0.5dt
            --  nr[:haa - 40m, :haa - 180m] << 1.2dt
        );
        platform(:removed,
                nr[:haa - 180m, :haa - 40m] << 0.5dt
            --  nr[:haa - 40m, :haa - 180m] >> 1.2dt
        );
        platform(:pax,
                nr[:haa + 40m, :haa + 180m] << 0.5dt
            --  nr[:haa + 180m, :haa + 40m] >> 1.2dt
        );

        marker(:right :de.hp :pax, nr[:haa] >> 0.5dt);
        marker(:right :de.bf :removed, nr[:haa - 20m] >> 0.5dt);
        station(:left :pax, nr[:haa + 0.3sw] >> 0.5dt >> 1.6sw,
            "Haarhausen",
            hbox(:center:base, span(:removed, "5,69 → "), "5,71")
        );
    }


    with link = "line.de.6298" {
        track(:first :double :excat:ac15 :pax, nr[:haa + 230m, :arn.a]);
    }


    with link = "point.de.Arnstadt-Hbf" {
        let ai = path("d4.de.6733");
        let as = path("d4.de.6299");
        let ar = path("d4.de.6298.ar");

        # Gl. 1
        track(:first:station :excat:ac15 :pax, nr[:arn.a, :arn.fp] >> 0.5dt);
            # W1 - W2
            track(:station,
                    nr[:arn - 850m] >> 0.5dt
                --  nr[:arn - 770m] << 0.5dt
            );
            # W10 - W11
            track(:station,
                    nr[:arn + 100m] >> 0.5dt
                --  nr[:arn + 190m] << 0.5dt
            );

        # Gl. 2
        track(:first:station :excat:ac15 :pax, nr[:arn.a, :arn.fp] << 0.5dt);
            # W13 - W14
            track(:station,
                    nr[:arn + 200m] << 0.5dt
                --  nr[:arn + 290m] << 1.5dt
            );
            # W17 - W18
            track(:station,
                    nr[:arn + 630m] << 0.5dt
                --  nr[:arn + 720m] >> 0.5dt
            );

        # Gl. 6
        track(:first:station :excat:ac15 :pax,
                nr[:arn - 651m, :arn - 650m] << 0.5dt
            --  nr[:arn - 570m, :arn.ys + 350m] << 1.5dt
            ..  as[:arn.fr - 0.1dl, :arn.fr]
        );
            # W15 - W16
            track(:station,
                    nr[:arn + 320m] << 1.5dt
                --  nr[:arn + 410m] << 0.5dt
            );

        # Gl. 7
        track(:station,
                nr[:arn - 511m, :arn - 510m] << 1.5dt
            --  nr[:arn - 440m, :arn + 130m - 0.7dl] << 2.5dt
            --  nr[:arn + 200m - 0.7dl, :arn + 201m - 0.7dl] << 1.5dt
        );

        # Gl. 8
        track(:station,
                nr[:arn - 140m, :arn + 150m] << 3.5dt
        );

        # Gl. 9
        track(:station,
                nr[:arn - 800m, :arn - 200m] << 3.5dt
            --  nr[:arn - 150m, :arn + 100m] << 4.5dt
        );
            # W10 - W6
            track(:station,
                    nr[:arn - 630m] << 3.5dt
                --  nr[:arn - 530m] << 1.5dt
            );

        # Gl. 13/17
        track(:station,
                nr[:arn - 490m, :arn - 0.7dl] << 5.5dt
            --  nr[:arn + 50m - 0.7dl, :arn + 51m - 0.7dl] << 4.5dt
        );

        # Gl. 18/19
        track(:station,
                nr[:arn - 591m, :arn - 590m] << 3.5dt
            --  nr[:arn - 440m, :arn] << 6.5dt
            --  nr[:arn + 200m, :arn.ys] << 2.5dt
            ..  ai[:arn.xi - 60m, :arn.xi]
        );

        # Ex-Gleise rechts
        track(:station :removed,
                nr[:arn - 790m, :arn - 100m] >> 1.5dt
        );
        track(:station :removed,
                nr[:arn - 560m, :arn - 400m] >> 3.5dt
        );
        track(:station :removed,
                nr[:arn - 560m, :arn - 450m] >> 4.5dt
            --  nr[:arn - 350m, :arn - 100m] >> 2.5dt
        );
            track(:station :removed,
                    nr[:arn - 300m] >> 2.5dt
                --  nr[:arn - 200m] >> 0.5dt
            );

        # Bahnsteig 1
        platform(:excat:ac15 :pax,
                nr[:arn - 160m, :arn + 40m] >> 0.5dt
            --  nr[:arn + 40m, :arn - 70m] << 1.2dt
            --  nr[:arn - 70m, :arn - 165m] << 1.1dt
        );
        platform(:removed,
                nr[:arn + 40m, :arn + 90m] >> 0.5dt
            --  nr[:arn + 90m, :arn + 40m] << 1.2dt
        );

        # Bahnsteig 2/6
        platform(:excat:ac15 :pax,
                nr[:arn - 130m, :arn + 90m] << 0.5dt
            --  nr[:arn + 90m, :arn - 130m] >> 1.5dt
        );

        # Bw
        track(:station,
                nr[:arn - 890m, :arn - 580m] << 2.5dt
        );
        track(:station,
                nr[:arn - 890m, :arn - 680m] << 1.5dt
            --  nr[:arn - 630m, :arn - 629m] << 2.5dt
        );

        marker(:left :de.bw, nr[:arn - 890m - 0.3sw] << 1.5dt);
        slabel(:left, nr[:arn - 890m - 0.65sw] >> 3.5dt,
            "Bw Arnstadt/hist"
        );

        # Anschluss Stadtverwaltung
        track(:station,
                nr[:arn - 630m, :arn - 631m] >> 3.5dt
            ..  ar[:a + 4dt, :a + 670m]
            --  ar[:a + 710m, :xa - 50m] << 1dt
            --  ar[:xa, :f]
        );
        track(:station,
                ar[:a + 499m, :a + 500m]
            --  ar[:a + 550m, :a + 670m + 0.7dl] >> 1dt
            --  ar[:a + 710m + 0.7dl, :xa]
        );
        track(:station,
                ar[:a + 859m, :a + 860m] << 1dt
            --  ar[:a + 910m, :a + 1070m] << 2dt
        );
        track(:station,
                ar[:f - 951m, :f - 950m]
            --  ar[:f - 800m, :f - 400m] << 3dt
            --  ar[:f - 250m, :f - 249m]
        );
        track(:station,
                ar[:f - 850m, :f - 550m] << 2dt
        );

        marker(:right :de.bf :pax, nr[:arn] >> 1.2dt);
        station(:left :pax, nr[:arn + 0.2sw] >> 1.2dt >> 1.8sw,
            span(:bold, "Arnstadt Hbf"),
            hbox(:center:top,
                vbox(:right:top, "6298: ", "6299: ", "6377: "),
                vbox(:right:top, "9,", "0,", "0,"),
                vbox(:left:top, "96", "00", "00")
            )
        );
    }


    with link = "line.de.6298" {
        track(:first :double :pax, nr[:arn.fp, :ars - 1sw]);
    }


    with link = "point.de.Arnstadt-Süd" {
        track(:first:station :double :pax, nr[:ars - 1sw, :ars + 250m]);

        platform(:pax,
                nr[:ars, :ars + 130m] >> 0.5dt
            --  nr[:ars + 130m, :ars] >> 0.5dt
        );
        platform(:removed,
                nr[:ars + 130m, :ars + 200m] >> 0.5dt
            --  nr[:ars + 200m, :ars + 130m] >> 0.5dt
        );

        marker(:right :de.hp :pax, nr[:ars] >> 0.5dt);
        station(:left :pax, nr[:ars + 0.55sw] >> 0.5dt >> 1.2sw,
            "Arnstadt Süd", "11,31"
        );
    }


    with link = "line.de.6298" {
        track(:first :double :pax, nr[:ars + 250m, :pla.a]);
        line_badge(:pax, nr[:ars + 2.0km], "6298");
    }


    with link = "point.de.Arnstadt-Goerdelerdamm" {
        marker(:left :de.bk :removed, nr[:goe] << 0.5dt);
        station(:left :removed, nr[:goe + 0.5sw] >> 2.0dt,
            "Goerdelerdamm", "12,18"
        );
    }


    with link = "point.de.Lohmühle" {
        marker(:right :de.bk :removed, nr[:loh] >> 0.5dt);
        station(:left :removed, nr[:loh + 0.4sw] >> 0.5dt >> 1.0sw,
            vbox(:center:bottom,
                span(:gone, "Siegelbach"),
                "Lohmühle"
            ),
            "14,98"
        );
    }


    with link = "point.de.Plaue-Thür" {
        let pr = path("d4.de.6694");

        # Gl. 1
        track(:first:station :pax, nr[:pla.a, :pla.fg] >> 0.5dt);
            # W1 - W2
            track(:station :pax,
                    nr[:pla.pn - 220m + 0.7dl] >> 0.5dt
                --  nr[:pla.pn - 130m + 0.7dl] << 0.5dt
            );

        # Gl. 2
        track(:first:station :pax,
                nr[:pla.a, :pla.yi] << 0.5dt
            --  nr[:pla.yi + 100m, :pla.yi + 101m] >> 0.5dt
        );
        track(:first:station :removed,
                nr[:pla.yi, :pla.fg] << 0.5dt
        );
            # W6 - W7
            track(:station,
                    nr[:pla.yi - 50m] << 0.5dt
                --  pr[:pla.yi + 40m] << 1.5dt
            );

        # Gl. 3
        track(:second:station :pax,
                nr[:pla.pn - 221m, :pla.pn - 220m] << 0.5dt
            --  pr[:pla.pn - 130m, :pla.fi] << 1.5dt
        );
            # W4 - W5
            track(:station,
                    nr[:pla.yi - 160m] << 1.5dt
                --  nr[:pla.yi - 70m] << 0.5dt
            );

        # Gl. 4
        track(:station :removed,
                nr[:pla.pn - 80m, :pla + 80m] << 2.5dt
        );

        # Gl. 5
        track(:station :removed,
                nr[:pla.pn - 131m, :pla.pn - 130m] << 1.5dt
            --  nr[:pla.pn - 30m, :pla + 30m] << 3.5dt
            --  nr[:pla + 130m, :pla + 131m] << 1.5dt
        );

        # Ladegl. rechts
        track(:station :removed,
                nr[:pla - 321m, :pla - 320m] >> 0.5dt
            --  nr[:pla - 220m, :pla - 0.5sw] >> 2.5dt
        );

        # Bahnsteig 1
        platform(:removed,
                nr[:pla - 220m, :pla - 110m] >> 0.5dt
            --  nr[:pla - 110m, :pla - 220m] << 1.2dt
        );
        platform(:pax,
                nr[:pla - 110m, :pla + 50m] >> 0.5dt
            --  nr[:pla + 50m, :pla - 110m] << 1.2dt
        );

        # Bahnsteig 2/3
        platform(:removed,
                nr[:pla - 220m, :pla - 140m] << 0.5dt
            --  nr[:pla - 140m, :pla - 220m] >> 1.5dt
        );
        platform(:pax,
                nr[:pla - 140m, :pla + 20m] << 0.5dt
            --  nr[:pla + 20m, :pla - 140m] >> 1.5dt
        );

        marker(:right :de.bf :pax, nr[:pla] >> 1.2dt);
        station(:left :pax, nr[:pla + 0.4sw] >> 1.2dt >> 1.2sw,
            hbox(:center:base, span(:bold, "Plaue "), "(Thür)"),
            hbox(:center:base,
                vbox(:right:top, "6298: ", "6694: "),
                vbox(:right:top, "18,", "0,"),
                vbox(:left:top, "17", "00")
            )
        );
    }


    with link = "line.de.6298" {
        track(:first :pax, nr[:pla.fg, :gra.a] >> 0.5dt);
        track(:first :removed, nr[:pla.fg, :gra.a] << 0.5dt);
        line_badge(:pax, nr[:pla.fg + 1.3km], "6298");
    }


    with link = "point.de.Gräfenroda" {
        # Gl. 1
        track(:second:station,
                nr[:gra, :gra.f - 250m] >> 2.0dt
            ..  nr[:gra.f - 1m, :gra.f] >> 1.5dt
        );

        # Gl. 2
        track(:station,
                nr[:gra - 416m, :gra - 415m] >> 0.5dt
            --  nr[:gra - 320m, :gra - 105m] >> 1.5dt
            --  nr[:gra - 10m, :gra - 9m] >> 0.5dt
        );

        # Gl. 3
        track(:first:station :pax, nr[:gra.a, :gra.f] >> 0.5dt);
            # W4 - W5
            track(:station,
                    nr[:gra + 170m] >> 0.5dt
                --  nr[:gra + 265m] >> 2.0dt
            );

        # Gl. 4
        track(:first:station :removed, nr[:gra.a, :gra - 280m] << 0.5dt);
        track(:station,
                nr[:gra - 366m, :gra - 365m] >> 0.5dt
            --  nr[:gra - 280m, :gra.f - 400m] << 0.5dt
            --  nr[:gra.f - 310m, :gra.f - 309m] >> 0.5dt
        );
        track(:first:station :removed, nr[:gra.f - 400m, :gra.f] << 0.5dt);

        # Bahnsteig 1
        platform(:open,
                nr[:gra, :gra + 60m] >> 2.0dt
            --  nr[:gra + 60m, :gra] << 1.3dt
        );

        # Bahnsteig 2
        platform(:open,
                nr[:gra - 275m, :gra - 140m] >> 1.5dt
            --  nr[:gra - 140m, :gra - 275m] << 2.2dt
        );

        # Bahnsteig 3
        platform(:pax,
                nr[:gra + 10m, :gra + 165m] >> 0.5dt
            --  nr[:gra + 165m, :gra + 10m] << 1.1dt
        );

        marker(:right :de.bf :pax, nr[:gra] >> 2dt);
        station(:top :pax, nr[:gra + 0.2sw] >> 2.0dt >> 1.4sw,
            span(:bold, "Gräfenroda"),
            hbox(:center:top,
                vbox(:right:top, span(:closed, "6697: "), "6298: "),
                vbox(:right:top, span(:closed, "35,"), "24,"),
                vbox(:left:top, span(:closed, "70"), "17")
            )
        );
    }


    with link = "line.de.6298" {
        track(:first :pax, nr[:gra.f, :dor - 200m] >> 0.5dt);
        track(:first :removed, nr[:gra.f,  :dor - 200m] << 0.5dt);
        line_badge(:pax, nr[:dor - 1.6km], "6298");
    }


    with link = "point.de.Dörrberg" {
        track(:first:station :pax, nr[:dor - 200m, :dor + 1sw] >> 0.5dt);
        track(:first:station :removed, nr[:dor - 200m, :dor + 1sw] << 0.5dt);

        platform(:pax,
                nr[:dor - 150m, :dor - 10m] >> 0.5dt
            --  nr[:dor - 10m, :dor - 150m] << 1.2dt
        );

        marker(:right :de.hp :pax, nr[:dor] >> 0.5dt);
        marker(:right :de.bk :removed, nr[:dor] >> 0.5dt);
        station(:left :pax, nr[:dor + 0.6sw] >> 0.5dt >> 1.3sw,
            "Dörrberg", "27,97"
        );
    }


    with link = "line.de.6298" {
        track(:first :pax, nr[:dor + 1sw, :tzw.a] >> 0.5dt);
        track(:first :removed, nr[:dor + 1sw, :tzw.a] << 0.5dt);
    }


    with link = "struct.de.Tunnel-am-Zwang" {
        marker(:top :tunnel.r :pax, nr[:tzw.a] >> 0.5dt);
        marker(:right :tunnel.dt :pax, nr[:tzw.a] << 0.5dt);
        marker(:top :tunnel.l :pax, nr[:tzw.a] << 0.5dt);

        marker(:bottom :tunnel.l :pax, nr[:tzw.f] >> 0.5dt);
        marker(:right :tunnel.dt :pax, nr[:tzw.f] << 0.5dt);
        marker(:bottom :tunnel.r :pax, nr[:tzw.f] << 0.5dt);

        slabel(:right :italic :pax, nr[:tzw.a - 2dt] << 2.5dt,
            hbox(:left:top, vbox(:center:top,
                "Tunnel am Zwang", "104 m"
            ))
        );
    }


    with link = "line.de.6298" {
        track(:first :pax, nr[:tzw.f, :geh.a] >> 0.5dt);
        track(:first :removed, nr[:tzw.f, :geh.a] << 0.5dt);
    }


    with link = "point.de.Kehltal" {
        marker(:right :de.bk :removed, nr[:keh] >> 0.5dt);
        station(:left :removed, nr[:keh + 0.5sw] >> 0.5dt >> 1.2sw,
            "Kehltal", "32,30"
        );
    }


    with link = "point.de.Gehlberg" {
        # Gl. 1
        track(:first:station :removed,
                nr[:geh.a, :geh.a + 200m] << 0.5dt
        );
        track(:first:station :pax,
                nr[:geh.a, :geh.a + 0.1dl] >> 0.5dt
            ..  nr[:geh.a + 200m, :geh.f] << 0.5dt
        );
            track(:station,
                    nr[:geh + 180m] << 0.5dt
                --  nr[:geh + 270m] >> 0.5dt
            );

        # Gl. 2
        track(:first:station :removed,
                nr[:geh.a, :geh.a + 280m] >> 0.5dt
        );
        track(:first:station :pax,
                nr[:geh.a + 199m, :geh.a + 200m] << 0.5dt
            ..  nr[:geh.a + 280m, :geh.f] >> 0.5dt
        );

        # Bahnsteig 1
        platform(:pax,
                nr[:geh - 60m, :geh + 100m] << 0.5dt
            --  nr[:geh + 100m, :geh - 60m] >> 1.2dt
        );

        # Bahnsteig 2
        platform(:pax,
                nr[:geh - 60m, :geh + 100m] >> 0.5dt
            --  nr[:geh + 100m, :geh - 60m] << 1.2dt
        );

        marker(:left :de.bf :pax, nr[:geh] << 0.5dt);
        station(:bottom :pax, nr[:geh] << 0.5dt << 1.2sw,
            "Gehlberg", "35,59"
        );
    }


    with link = "line.de.6298" {
        track(:first :double :pax, nr[:geh.f, :brt.a]);
    }


    with link = "struct.de.Brandleite-Tunnel" {
        marker(:top :tunnel.r :pax, nr[:brt.a] >> 0.5dt);
        marker(:right :tunnel.dt :pax, nr[:brt.a] << 0.5dt);
        marker(:top :tunnel.l :pax, nr[:brt.a] << 0.5dt);

        track(:first:tunnel :double :pax, nr[:brt.a, :brt.f]);

        marker(:bottom :tunnel.l :pax, nr[:brt.f] >> 0.5dt);
        marker(:right :tunnel.dt :pax, nr[:brt.f] << 0.5dt);
        marker(:bottom :tunnel.r :pax, nr[:brt.f] << 0.5dt);
    }


}

