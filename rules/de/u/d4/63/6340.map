# DE 6340.  Halle (Saale) Hbf - Baunatal-Guntershausen
#
let hg = path("d3.de.u.6340");

with detail = 4,
     railway = :first :cat:ac15 :pax
{

    badge(:cat:ac15 :pax, hg[:ndi.a] >> 0.5mo,
        hbox(:left:middle,
            " ",
            vbox(:center:middle :badgesize, " 6291 ", " 6340 "),
            "→ Erfurt"
        )
    );
    

    with link = "point.de.Neudietendorf", railway = :station {
        let nr = path("d3.de.6298");

        # Gl. 1 (DE 6340 up)
        track(:casing, hg[:ndi.a, :ndi.ys - 250m] >> 0.5mo);
            # W5 - W6
            track(:side :nopax,
                    hg[:ndi - 380m] >> 0.5mo
                --  hg[:ndi - 280m] >> 1.5mo
            );
            # W9 - W10
            track(:side :nopax,
                    hg[:ndi - 150m] >> 0.5mo
                --  hg[:ndi -  50m] << 0.5mo
            );
            # W21 - W22
            track(:side :nopax,
                    hg[:ndi + 480m] >> 0.5mo
                --  hg[:ndi + 590m] >> 1.5mo
            );

        # Gl. 2 (DE 6340 dn)
        track(:casing, hg[:ndi.a, :ndi.ys - 250m] << 0.5mo);
            # W3 - W4
            track(:side :nopax,
                    hg[:ndi - 500m] << 0.5mo
                --  hg[:ndi - 400m] >> 0.5mo
            );

        # Gl. 3 (DE 6291 - DE 6298 up)
        track(hg[:ndi.a, :ndi.yr - 120m] >> 1.5mo);
        track(:nocat, hg[:ndi.yr - 120m, :ndi.yr + 20m] >> 1.5mo);
        with layer = -1 track(:nocat,
                hg[:ndi.yr + 19m, :ndi.yr + 20m] >> 1.5mo
            ..  nr[:ndi.yw, :ndi.yw + 0.1dl] >> 0.5mo
        );
            # W1 - W2
            track(:side :nopax,
                    hg[:ndi - 580m] >> 1.5mo
                --  hg[:ndi - 480m] >> 0.5mo
            );
            # W24 - W25
            track(:side :nopax,
                    hg[:ndi + 610m] >> 1.5mo
                --  hg[:ndi + 700m] >> 2.5mo
            );
            # W26 - W27
            track(:side :nopax,
                    hg[:ndi.yr - 120m] >> 1.5mo
                --  hg[:ndi.yr] >> 0.5mo
            );

        # Gl. 4 (DE 6298 dn)
        track(:nocat :nopax,
                hg[:ndi + 220m, :ndi.yr + 100m] << 1.5mo
        );
        track(:nocat,
                hg[:ndi.yr - 0.1dl, :ndi.yr] << 0.5mo
            --  hg[:ndi.yr + 100m, :ndi.yr + 101m] << 1.5mo
            ..  nr[:ndi.yw, :ndi.yw + 0.1dl] << 0.5mo
        );

        # Gl. 5
        track(:side :nopax, hg[:ndi - 150m, :ndi.yr] >> 2.5mo);
            # W28 - W29
            track(:side :nocat :nopax,
                    hg[:ndi.yr - 80m] >> 2.5mo
                --  hg[:ndi.yr + 20m] >> 1.5mo
            );

        # Gl. 7
        track(:side :nopax,
                hg[:ndi - 221m, :ndi - 220m] >> 1.5mo
            --  hg[:ndi - 80m, :ndi + 460m] >> 3.5mo
            --  hg[:ndi + 540m, :ndi + 541m] >> 2.5mo
        );

        # Bahnsteig Gl. 1/3
        platform(
                hg[:ndi - 20m, :ndi + 190m] >> 0.5mo >> 0.5mt
            --  hg[:ndi + 190m, :ndi - 20m] << 1.5mo >> 0.5mt
        );

        # Bahnsteig Gl. 2
        platform(
                hg[:ndi - 20m, :ndi + 190m] << 0.5mo << 0.5mt
            --  hg[:ndi + 190m, :ndi - 20m] >> 1.2mo
        );

        # Bahnsteig Gl. 4
        platform(:nocat,
                hg[:ndi + 220m, :ndi + 490m] << 1.5mo << 0.4mt
            --  hg[:ndi + 490m, :ndi + 220m] >> 2.2mo
        );

        marker(:left :de.bf :cat:ac15 :pax, hg[:ndi] << 1.2mo);
        station(:top :cat:ac15 :pax, hg[:ndi] >> 5.5mo + (-6dt, -0.3dt),
            hbox(:left:top :bold, "Neudietendorf"),
            hbox(:center:top,
                vbox(:right:top, "6291: ", "6340: ", "6298: "),
                vbox(:right:top, "120,", "120,", "−0,"),
                vbox(:left:top, "96", "96", "14"),
                vbox(:right:top :removed, " ← ", " ← ", " ← "),
                vbox(:right:top :removed, "120,", "120,", "−0,"),
                vbox(:left:top :removed, "89", "89", "21")
            )
        );
    }


    with link = "point.de.Neudietendorf-Dn", railway = :station {
        # Gl. 1 (DE 6340 up)
        track(hg[:ndi.ys - 250m, :ndi.fg] >> 0.5mo);
            # W43 - W44
            track(:side :nopax,
                    hg[:ndi.ys + 120m] >> 0.5mo
                --  hg[:ndi.ys + 200m] << 0.5mo
            );

        # Gl. 2 (DE 6340 dn)
        track(hg[:ndi.ys - 250m, :ndi.fg] << 0.5mo);
            # W45 - W46
            track(:side :nopax,
                    hg[:ndi.ys + 220m] << 0.5mo
                --  hg[:ndi.ys + 300m] >> 0.5mo
            );

        # Gl. 5
        track(:side :nopax,
                hg[:ndi.yr - 0.1dl, :ndi.yr] >> 2.5mo
            ..  hg[:ndi.ys - 21m, :ndi.ys - 20m] >> 1.5mo
            --  hg[:ndi.ys + 50m, :ndi.ys + 51m] >> 0.5mo
        );
            # Schutzgleis W41
            track(:side :nocat :nopax,
                    hg[:ndi.ys - 20m, :ndi.ys + 70m] >> 1.5mo
            );

        # Str. 6730
        track(:side :nopax :removed,
                hg[:ndi.ys, :ndi.ys + 50m] << 1.5mo
            --  hg[:ndi.ys + 120m, :ndi.ys + 121m] << 0.5mo
        );

        marker(:right :de.bft :removed,
            hg[:ndi.ys + 70m + 0.5sw] >> 0.5mo >> 0.5mt
        );
        station(:top :removed,
            hg[:ndi.ys + 70m + 0.5sw] >> 0.5mo >> 0.5mt >> 1sh + (-0.5dt, -1dt),
            "N. Dn",
            hbox(:center:top,
                vbox(:right:top, "6340: ", "6730: "),
                vbox(:right:top, "??", "??")
            )
        );
    }

    badge(:cat:ac15 :pax, hg[:ndi.fg],
        hbox(:right:middle, "Gotha ← ", span(:badgesize, "6340 "))
    );
}

