# DE 6170.  Berlin-Moabit - Berlin-Moabit
#
let mm = path("d4.de.6170");

with detail = [4, 5] {
    with link = "point.de.Berlin-Moabit" {
        let bl = path("d4.de.b.6107");

        # Gl. 331
        track(:first:station :removed,
                mm[:moa.a, :moa - 1020m] >> 2.5dt
        );
        track(:station :cat:ac15,
                mm[:moa - 1020m, :moa + 200m] >> 2.5dt
        );
            # W351 - W352
            track(:station :cat:ac15,
                    mm[:moa + 70m] >> 2.5dt
                --  mm[:moa + 160m] >> 0.5dt
            );
            # W353 - W354
            track(:station :cat:ac15,
                    mm[:moa + 140m] >> 2.5dt
                --  mm[:moa + 210m] >> 3.5dt
            );

        # „Gl. 332“
        track(:first:station :removed,
                mm[:moa.a, :moa.yl] >> 1.5dt
        );

        # Gl. 314 - 333
        with layer = 2 track(:first:station :cat:ac15 :pax,
                mm[:moa.a, :moa.xr + 0.7dl] >> 4.5dt
            ..  mm[:moa.xs + 0.7dl, :wea.a] >> 0.5dt
        );
        with layer = 1 casing(:first:station :cat:ac15 :pax,
                mm[:moa.xr + 0.6dl, :moa.xr + 0.7dl] >> 4.5dt
            ..  mm[:moa.xs + 0.7dl, :moa.xs + 0.8dl] >> 0.5dt
        );
            # W312 - W313
            track(:station :cat:ac15,
                    mm[:moa - 1720m] >> 4.5dt
                --  mm[:moa - 1620m] >> 3.5dt
            );
            # W333 - W401
            track(:station,
                    mm[:moa - 910m] >> 4.5dt
                --  mm[:moa - 830m] >> 5.5dt
            );

        # Gl. 313 - 334
        with layer = 3 track(:first:station :cat:ac15 :pax,
                mm[:moa.a, :moa.xr] >> 3.5dt
            ..  mm[:moa.xs, :wea.a] << 0.5dt
        );
        with layer = 1 casing(:first:station :cat:ac15 :pax,
                mm[:moa.xr - 0.1dl, :moa.xr] >> 3.5dt
            ..  mm[:moa.xs, :moa.xs + 0.1dl] << 0.5dt
        );
            # W314 - W315
            track(:station :cat:ac15,
                    mm[:moa - 1550m] >> 3.5dt
                --  mm[:moa - 1410m] >> 0.5dt
            );
            # W331 - W332
            track(:station :cat:ac15,
                    mm[:moa - 1100m] >> 3.5dt
                --  mm[:moa - 1000m] >> 4.5dt
            );
            # W334 - W335
            track(:station :cat:ac15,
                    mm[:moa - 1020m] >> 3.5dt
                --  mm[:moa - 950m] >> 2.5dt
            );

        # Gl. 502 - 335 - 395
        track(:first:station :cat:ac15 :pax,
                mm[:moa.a, :moa.xr] >> 0.5dt
            ..  mm[:moa.xs, :moa.yl] >> 4.5dt
            ..  bl[:hbn.y, :hbn.y - 0.1dl] >> 1.5dt
        );
            # W318 - W319
            track(:station :cat:ac15,
                    mm[:moa - 1350m] >> 0.5dt
                --  mm[:moa - 1220m] >> 3.5dt
            );
            # W321 - W322
            track(:station :cat:ac15,
                    mm[:moa - 1240m] >> 0.5dt
                --  mm[:moa - 1140m] << 0.5dt
            );
            # W336 - W337
            track(:station :cat:ac15,
                    mm[:moa - 1000m] >> 0.5dt
                --  mm[:moa - 910m] >> 2.5dt
            );

        # Gl. 501 - 336 - 396
        track(:first:station :cat:ac15 :pax,
                mm[:moa.a, :moa.xr + 0.7dl] << 0.5dt
            ..  mm[:moa.xs + 0.7dl, :moa.yl] >> 3.5dt
            ..  bl[:hbn.y - 1dl, :hbn.y - 1.1dl] << 1.5dt
        );
            # W316 - W317
            track(:station :cat:ac15,
                    mm[:moa - 1540m] << 0.5dt
                --  mm[:moa - 1470m] >> 0.5dt
            );

        # Gl. 374
        with layer = 3 track(:first:station :cat:ac15 :pax,
                mm[:moa + 119m, :moa + 120m] << 0.5dt
            --  mm[:moa + 200m, :moa.xs - 80m] << 1.5dt
            --  mm[:moa.xs, :moa.xs + 0.1dl] << 0.5dt
        );

        # Gl. 442
        track(:station,
                mm[:moa - 890m, :moa] >> 5.5dt
            --  mm[:moa + 80m, :moa + 81m] >> 7.5dt
        );

        # Gl. 443
        track(:station,
                mm[:moa - 661m, :moa - 660m] >> 5.5dt
            --  mm[:moa - 610m, :moa + 40m] >> 6.5dt
        );

        # Gl. 444
        with layer = 3 track(:station,
                mm[:moa - 711m - 0.7dl, :moa - 710m - 0.7dl] >> 5.5dt
            --  mm[:moa - 610m - 0.7dl, :moa.xr] >> 7.5dt
            ..  mm[:moa.xs + 1dl, :moa.yl] >> 2.5dt
        );
        with layer = 2 casing(:station,
                mm[:moa.xr - 0.1dl, :moa.xr] >> 7.5dt
            ..  mm[:moa.xs + 1dl, :moa.xs + 1.1dl] >> 2.5dt
        );

        # Gl. 445/446
        track(:station,
                mm[:moa - 610m - 1.4dl, :moa - 140m] >> 8.5dt
        );

        # Gl. 447/448
        track(:station,
                mm[:moa - 761m - 1.4dl, :moa - 760m - 1.4dl] >> 5.5dt
            --  mm[:moa - 560m - 1.4dl, :moa - 180m] >> 9.5dt
            --  mm[:moa - 100m, :moa - 99m] >> 7.5dt
        );

        marker(:right :de.bbf :cat:ac15, mm[:moa] >> 8.0dt);
        station(:bottom :cat:ac15, mm[:moa - 1km] >> 9.0dt,
            span(:bold, "Berlin-Moabit"),
            hbox(:center:top,
                vbox(:right:top, "6097: ", "6107: ", "6170: ", "6106: "),
                vbox(:right:top, "2,", "2,", "0,", "2,"),
                vbox(:left:top, "74", "88", "33", "87")
            )
        );
    }


    with link = "point.de.Moabit-Ost" {
        marker(
            :left :de.bft :cat:ac15, mm[:moa.xs + 0.5dt] << 0.5dt
        );
        with layer = -0.5 marker(
            :left :de.bft.casing :cat:ac15, mm[:moa.xs + 0.5dt] << 0.5dt
        );
    }


    with link = "point.de.Berlin-Wedding-Abzw" {
        # Ri. Moabit
        track(:first:station :cat:ac15 :pax, mm[:wea.a, :wea.f] << 0.5dt);

        # Ri. Hbf
        track(:first:station :cat:ac15 :pax,
                mm[:wea.y, :wea - 125m] >> 0.5dt
            --  mm[:wea - 25m, :wea - 24m] << 0.5dt
        );

        # aus Ri. Hbf
        track(:first:station :cat:ac15 :pax,
                mm[:wea.y, :wea - 125m + 0.7dl] >> 1.5dt
        );

        # aus Ri. Moabit
        track(:first:station :cat:ac15 :pax,
                mm[:wea.a, :wea.a + 0.1dl] >> 0.5dt
            ..  mm[:wea - 250m, :wea - 225m + 0.7dl] >> 2.5dt
            --  mm[:wea - 25m + 0.7dl, :wea.f] >> 0.5dt
        );

        marker(:right :de.abzw :cat:ac15, mm[:wea + 0.5dt] >> 0.5dt);
        station(:right :cat:ac15, mm[:wea] >> 0.5dt >> 1.8sh,
            hbox(:center:base, "B.-", span(:bold, "Wedding "), "Abzw"),
            hbox(:center:top,
                vbox(:right:top, "6170: ", "6171: "),
                vbox(:right:top, "2,", "0,"),
                vbox(:left:top, "35", "00")
            )
        );
    }


    with link = "line.de.6170" {
        track(:first :double :cat:ac15 :pax, mm[:wea.f, :ges.a]);
    }





    with link = "line.de.6170" {
        track(:first :double :cat:ac15 :pax, mm[:chg.f, :moa.a] >> 4dt);
    }
}

